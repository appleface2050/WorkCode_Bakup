



<!DOCTYPE html>
<html lang="en" class=" is-copy-enabled emoji-size-boost is-u2f-enabled">
  <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# object: http://ogp.me/ns/object# article: http://ogp.me/ns/article# profile: http://ogp.me/ns/profile#">
    <meta charset='utf-8'>

    <link crossorigin="anonymous" href="https://assets-cdn.github.com/assets/frameworks-06e4d8f59f5b927f13919c423f40f0888f37f9af7f426e4020948b00b9371059.css" integrity="sha256-BuTY9Z9bkn8TkZxCP0DwiI83+a9/Qm5AIJSLALk3EFk=" media="all" rel="stylesheet" />
    <link crossorigin="anonymous" href="https://assets-cdn.github.com/assets/github-bd0c638c6195e0bb3be91e68f6413a38b76ba79258d13675ca2bada5493cc7a2.css" integrity="sha256-vQxjjGGV4Ls76R5o9kE6OLdrp5JY0TZ1yiutpUk8x6I=" media="all" rel="stylesheet" />
    
    
    
    
    

    <link as="script" href="https://assets-cdn.github.com/assets/frameworks-f9a40617e5ea71342dc57103554b07a3c1edc88712b04de1a040aed44891a11d.js" rel="preload" />
    
    <link as="script" href="https://assets-cdn.github.com/assets/github-15a011bc17ae58c18cb7457d61942904a3f87d7d5d65f73ea6ebc4cfa60f3db7.js" rel="preload" />

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Content-Language" content="en">
    <meta name="viewport" content="width=device-width">
    
    
    <title>fabric.js/fabric.min.js at master · kangax/fabric.js</title>
    <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="GitHub">
    <link rel="fluid-icon" href="https://github.com/fluidicon.png" title="GitHub">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
    <meta property="fb:app_id" content="1401488693436528">

      <meta content="https://avatars3.githubusercontent.com/u/383?v=3&amp;s=400" name="twitter:image:src" /><meta content="@github" name="twitter:site" /><meta content="summary" name="twitter:card" /><meta content="kangax/fabric.js" name="twitter:title" /><meta content="fabric.js - Javascript Canvas Library, SVG-to-Canvas (&amp; canvas-to-SVG) Parser" name="twitter:description" />
      <meta content="https://avatars3.githubusercontent.com/u/383?v=3&amp;s=400" property="og:image" /><meta content="GitHub" property="og:site_name" /><meta content="object" property="og:type" /><meta content="kangax/fabric.js" property="og:title" /><meta content="https://github.com/kangax/fabric.js" property="og:url" /><meta content="fabric.js - Javascript Canvas Library, SVG-to-Canvas (&amp; canvas-to-SVG) Parser" property="og:description" />
      <meta name="browser-stats-url" content="https://api.github.com/_private/browser/stats">
    <meta name="browser-errors-url" content="https://api.github.com/_private/browser/errors">
    <link rel="assets" href="https://assets-cdn.github.com/">
    <link rel="web-socket" href="wss://live.github.com/_sockets/MTE3MTc0Mzc6YjU1MDZlM2M5NDViM2RmMTdmNTIzZjc1YjdjNzhjM2I6ZjRjMTUyNTE2M2JjMDY0MjE1NWM5MzZmY2I0NGE3YWUyMTQ1MjRmN2E3YzIxZWZkZmEyODNkMDYxNTQ3OTk4Zg==--9f97482ce7e51f4363bb6de11ba6a8ef8412e388">
    <meta name="pjax-timeout" content="1000">
    <link rel="sudo-modal" href="/sessions/sudo_modal">

    <meta name="msapplication-TileImage" content="/windows-tile.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="selected-link" value="repo_source" data-pjax-transient>

    <meta name="google-site-verification" content="KT5gs8h0wvaagLKAVWq8bbeNwnZZK1r1XQysX3xurLU">
<meta name="google-site-verification" content="ZzhVyEFwb7w3e0-uOTltm8Jsck2F5StVihD0exw2fsA">
    <meta name="google-analytics" content="UA-3769691-2">

<meta content="collector.githubapp.com" name="octolytics-host" /><meta content="github" name="octolytics-app-id" /><meta content="B64025BA:732C:19E8D9DE:57709C11" name="octolytics-dimension-request_id" /><meta content="11717437" name="octolytics-actor-id" /><meta content="bst-manish" name="octolytics-actor-login" /><meta content="24510bfdc95c9f580303cad8ae5d9d27fd60136484fd919a811f8ca29d45cfdc" name="octolytics-actor-hash" />
<meta content="/&lt;user-name&gt;/&lt;repo-name&gt;/blob/show" data-pjax-transient="true" name="analytics-location" />



  <meta class="js-ga-set" name="dimension1" content="Logged In">



        <meta name="hostname" content="github.com">
    <meta name="user-login" content="bst-manish">

        <meta name="expected-hostname" content="github.com">
      <meta name="js-proxy-site-detection-payload" content="NTU3OTYzMTRjYTY4ZmRmODhlZWNjNmJiMGYzMjYwNzAzZmY2NjNkMTJjMGMxYzQwZWY0NzY2OGM4YWZlNjQyYXx7InJlbW90ZV9hZGRyZXNzIjoiMTgyLjY0LjM3LjE4NiIsInJlcXVlc3RfaWQiOiJCNjQwMjVCQTo3MzJDOjE5RThEOURFOjU3NzA5QzExIiwidGltZXN0YW1wIjoxNDY2OTk3Nzc3fQ==">


      <link rel="mask-icon" href="https://assets-cdn.github.com/pinned-octocat.svg" color="#4078c0">
      <link rel="icon" type="image/x-icon" href="https://assets-cdn.github.com/favicon.ico">

    <meta name="html-safe-nonce" content="377aed12d2010a94c25b2f69ad2754c13dce3536">
    <meta content="b9b23677ec8144ef271ff7d77ab09f37677a6f23" name="form-nonce" />

    <meta http-equiv="x-pjax-version" content="08bd0eb930f23722d970dd7f77a71eba">
    

      
  <meta name="description" content="fabric.js - Javascript Canvas Library, SVG-to-Canvas (&amp; canvas-to-SVG) Parser">
  <meta name="go-import" content="github.com/kangax/fabric.js git https://github.com/kangax/fabric.js.git">

  <meta content="383" name="octolytics-dimension-user_id" /><meta content="kangax" name="octolytics-dimension-user_login" /><meta content="712530" name="octolytics-dimension-repository_id" /><meta content="kangax/fabric.js" name="octolytics-dimension-repository_nwo" /><meta content="true" name="octolytics-dimension-repository_public" /><meta content="false" name="octolytics-dimension-repository_is_fork" /><meta content="712530" name="octolytics-dimension-repository_network_root_id" /><meta content="kangax/fabric.js" name="octolytics-dimension-repository_network_root_nwo" />
  <link href="https://github.com/kangax/fabric.js/commits/master.atom" rel="alternate" title="Recent Commits to fabric.js:master" type="application/atom+xml">


      <link rel="canonical" href="https://github.com/kangax/fabric.js/blob/master/dist/fabric.min.js" data-pjax-transient>
  </head>


  <body class="logged-in   env-production macintosh vis-public page-blob">
    <div id="js-pjax-loader-bar" class="pjax-loader-bar"></div>
    <a href="#start-of-content" tabindex="1" class="accessibility-aid js-skip-to-content">Skip to content</a>

    
    
    



        <div class="header header-logged-in true" role="banner">
  <div class="container clearfix">

    <a class="header-logo-invertocat" href="https://github.com/" data-hotkey="g d" aria-label="Homepage" data-ga-click="Header, go to dashboard, icon:logo">
  <svg aria-hidden="true" class="octicon octicon-mark-github" height="28" version="1.1" viewBox="0 0 16 16" width="28"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></svg>
</a>


        <div class="header-search scoped-search site-scoped-search js-site-search" role="search">
  <!-- </textarea> --><!-- '"` --><form accept-charset="UTF-8" action="/kangax/fabric.js/search" class="js-site-search-form" data-scoped-search-url="/kangax/fabric.js/search" data-unscoped-search-url="/search" method="get"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /></div>
    <label class="form-control header-search-wrapper js-chromeless-input-container">
      <div class="header-search-scope">This repository</div>
      <input type="text"
        class="form-control header-search-input js-site-search-focus js-site-search-field is-clearable"
        data-hotkey="s"
        name="q"
        placeholder="Search"
        aria-label="Search this repository"
        data-unscoped-placeholder="Search GitHub"
        data-scoped-placeholder="Search"
        tabindex="1"
        autocapitalize="off">
    </label>
</form></div>


      <ul class="header-nav left" role="navigation">
        <li class="header-nav-item">
          <a href="/pulls" class="js-selected-navigation-item header-nav-link" data-ga-click="Header, click, Nav menu - item:pulls context:user" data-hotkey="g p" data-selected-links="/pulls /pulls/assigned /pulls/mentioned /pulls">
            Pull requests
</a>        </li>
        <li class="header-nav-item">
          <a href="/issues" class="js-selected-navigation-item header-nav-link" data-ga-click="Header, click, Nav menu - item:issues context:user" data-hotkey="g i" data-selected-links="/issues /issues/assigned /issues/mentioned /issues">
            Issues
</a>        </li>
          <li class="header-nav-item">
            <a class="header-nav-link" href="https://gist.github.com/" data-ga-click="Header, go to gist, text:gist">Gist</a>
          </li>
      </ul>

    
<ul class="header-nav user-nav right" id="user-links">
  <li class="header-nav-item">
    
    <a href="/notifications" aria-label="You have unread notifications" class="header-nav-link notification-indicator tooltipped tooltipped-s js-socket-channel js-notification-indicator" data-channel="tenant:1:notification-changed:11717437" data-ga-click="Header, go to notifications, icon:unread" data-hotkey="g n">
        <span class="mail-status unread"></span>
        <svg aria-hidden="true" class="octicon octicon-bell" height="16" version="1.1" viewBox="0 0 14 16" width="14"><path d="M14 12v1H0v-1l.73-.58c.77-.77.81-2.55 1.19-4.42C2.69 3.23 6 2 6 2c0-.55.45-1 1-1s1 .45 1 1c0 0 3.39 1.23 4.16 5 .38 1.88.42 3.66 1.19 4.42l.66.58H14zm-7 4c1.11 0 2-.89 2-2H5c0 1.11.89 2 2 2z"></path></svg>
</a>
  </li>

  <li class="header-nav-item dropdown js-menu-container">
    <a class="header-nav-link tooltipped tooltipped-s js-menu-target" href="/new"
       aria-label="Create new…"
       data-ga-click="Header, create new, icon:add">
      <svg aria-hidden="true" class="octicon octicon-plus left" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M12 9H7v5H5V9H0V7h5V2h2v5h5z"></path></svg>
      <span class="dropdown-caret"></span>
    </a>

    <div class="dropdown-menu-content js-menu-content">
      <ul class="dropdown-menu dropdown-menu-sw">
        
<a class="dropdown-item" href="/new" data-ga-click="Header, create new repository">
  New repository
</a>

  <a class="dropdown-item" href="/new/import" data-ga-click="Header, import a repository">
    Import repository
  </a>


  <a class="dropdown-item" href="/organizations/new" data-ga-click="Header, create new organization">
    New organization
  </a>



  <div class="dropdown-divider"></div>
  <div class="dropdown-header">
    <span title="kangax/fabric.js">This repository</span>
  </div>
    <a class="dropdown-item" href="/kangax/fabric.js/issues/new" data-ga-click="Header, create new issue">
      New issue
    </a>

      </ul>
    </div>
  </li>

  <li class="header-nav-item dropdown js-menu-container">
    <a class="header-nav-link name tooltipped tooltipped-sw js-menu-target" href="/bst-manish"
       aria-label="View profile and more"
       data-ga-click="Header, show menu, icon:avatar">
      <img alt="@bst-manish" class="avatar" height="20" src="https://avatars3.githubusercontent.com/u/11717437?v=3&amp;s=40" width="20" />
      <span class="dropdown-caret"></span>
    </a>

    <div class="dropdown-menu-content js-menu-content">
      <div class="dropdown-menu dropdown-menu-sw">
        <div class="dropdown-header header-nav-current-user css-truncate">
          Signed in as <strong class="css-truncate-target">bst-manish</strong>
        </div>

        <div class="dropdown-divider"></div>

        <a class="dropdown-item" href="/bst-manish" data-ga-click="Header, go to profile, text:your profile">
          Your profile
        </a>
        <a class="dropdown-item" href="/stars" data-ga-click="Header, go to starred repos, text:your stars">
          Your stars
        </a>
        <a class="dropdown-item" href="/explore" data-ga-click="Header, go to explore, text:explore">
          Explore
        </a>
          <a class="dropdown-item" href="/integrations" data-ga-click="Header, go to integrations, text:integrations">
            Integrations
          </a>
        <a class="dropdown-item" href="https://help.github.com" data-ga-click="Header, go to help, text:help">
          Help
        </a>


        <div class="dropdown-divider"></div>

        <a class="dropdown-item" href="/settings/profile" data-ga-click="Header, go to settings, icon:settings">
          Settings
        </a>

        <!-- </textarea> --><!-- '"` --><form accept-charset="UTF-8" action="/logout" class="logout-form" data-form-nonce="b9b23677ec8144ef271ff7d77ab09f37677a6f23" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /><input name="authenticity_token" type="hidden" value="3bXyOH7siYgmmR0bxgcJr/0hat5UuODexVK4m+RIgORsPSL2+T3JvCY4PPwTCBmCOnoPtIcHpzp7h21O0rRDQA==" /></div>
          <button class="dropdown-item dropdown-signout" data-ga-click="Header, sign out, icon:logout">
            Sign out
          </button>
</form>      </div>
    </div>
  </li>
</ul>


    
  </div>
</div>


      


    <div id="start-of-content" class="accessibility-aid"></div>

      <div id="js-flash-container">
</div>


    <div role="main" class="main-content">
        <div itemscope itemtype="http://schema.org/SoftwareSourceCode">
    <div id="js-repo-pjax-container" data-pjax-container>
      
<div class="pagehead repohead instapaper_ignore readability-menu experiment-repo-nav">
  <div class="container repohead-details-container">

    

<ul class="pagehead-actions">

  <li>
        <!-- </textarea> --><!-- '"` --><form accept-charset="UTF-8" action="/notifications/subscribe" class="js-social-container" data-autosubmit="true" data-form-nonce="b9b23677ec8144ef271ff7d77ab09f37677a6f23" data-remote="true" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /><input name="authenticity_token" type="hidden" value="PZIYoCQnSGPjuXjMB4WSXjXB+0E9R2epT/0fytZUn7jEHQRECbgFoXU+Y/9Px4Jv0uhmQDWSoJVRQHpDL/7vAQ==" /></div>      <input class="form-control" id="repository_id" name="repository_id" type="hidden" value="712530" />

        <div class="select-menu js-menu-container js-select-menu">
          <a href="/kangax/fabric.js/subscription"
            class="btn btn-sm btn-with-count select-menu-button js-menu-target" role="button" tabindex="0" aria-haspopup="true"
            data-ga-click="Repository, click Watch settings, action:blob#show">
            <span class="js-select-button">
              <svg aria-hidden="true" class="octicon octicon-eye" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M8.06 2C3 2 0 8 0 8s3 6 8.06 6C13 14 16 8 16 8s-3-6-7.94-6zM8 12c-2.2 0-4-1.78-4-4 0-2.2 1.8-4 4-4 2.22 0 4 1.8 4 4 0 2.22-1.78 4-4 4zm2-4c0 1.11-.89 2-2 2-1.11 0-2-.89-2-2 0-1.11.89-2 2-2 1.11 0 2 .89 2 2z"></path></svg>
              Watch
            </span>
          </a>
          <a class="social-count js-social-count" href="/kangax/fabric.js/watchers">
            335
          </a>

        <div class="select-menu-modal-holder">
          <div class="select-menu-modal subscription-menu-modal js-menu-content" aria-hidden="true">
            <div class="select-menu-header js-navigation-enable" tabindex="-1">
              <svg aria-label="Close" class="octicon octicon-x js-menu-close" height="16" role="img" version="1.1" viewBox="0 0 12 16" width="12"><path d="M7.48 8l3.75 3.75-1.48 1.48L6 9.48l-3.75 3.75-1.48-1.48L4.52 8 .77 4.25l1.48-1.48L6 6.52l3.75-3.75 1.48 1.48z"></path></svg>
              <span class="select-menu-title">Notifications</span>
            </div>

              <div class="select-menu-list js-navigation-container" role="menu">

                <div class="select-menu-item js-navigation-item selected" role="menuitem" tabindex="0">
                  <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
                  <div class="select-menu-item-text">
                    <input checked="checked" id="do_included" name="do" type="radio" value="included" />
                    <span class="select-menu-item-heading">Not watching</span>
                    <span class="description">Be notified when participating or @mentioned.</span>
                    <span class="js-select-button-text hidden-select-button-text">
                      <svg aria-hidden="true" class="octicon octicon-eye" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M8.06 2C3 2 0 8 0 8s3 6 8.06 6C13 14 16 8 16 8s-3-6-7.94-6zM8 12c-2.2 0-4-1.78-4-4 0-2.2 1.8-4 4-4 2.22 0 4 1.8 4 4 0 2.22-1.78 4-4 4zm2-4c0 1.11-.89 2-2 2-1.11 0-2-.89-2-2 0-1.11.89-2 2-2 1.11 0 2 .89 2 2z"></path></svg>
                      Watch
                    </span>
                  </div>
                </div>

                <div class="select-menu-item js-navigation-item " role="menuitem" tabindex="0">
                  <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
                  <div class="select-menu-item-text">
                    <input id="do_subscribed" name="do" type="radio" value="subscribed" />
                    <span class="select-menu-item-heading">Watching</span>
                    <span class="description">Be notified of all conversations.</span>
                    <span class="js-select-button-text hidden-select-button-text">
                      <svg aria-hidden="true" class="octicon octicon-eye" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M8.06 2C3 2 0 8 0 8s3 6 8.06 6C13 14 16 8 16 8s-3-6-7.94-6zM8 12c-2.2 0-4-1.78-4-4 0-2.2 1.8-4 4-4 2.22 0 4 1.8 4 4 0 2.22-1.78 4-4 4zm2-4c0 1.11-.89 2-2 2-1.11 0-2-.89-2-2 0-1.11.89-2 2-2 1.11 0 2 .89 2 2z"></path></svg>
                      Unwatch
                    </span>
                  </div>
                </div>

                <div class="select-menu-item js-navigation-item " role="menuitem" tabindex="0">
                  <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
                  <div class="select-menu-item-text">
                    <input id="do_ignore" name="do" type="radio" value="ignore" />
                    <span class="select-menu-item-heading">Ignoring</span>
                    <span class="description">Never be notified.</span>
                    <span class="js-select-button-text hidden-select-button-text">
                      <svg aria-hidden="true" class="octicon octicon-mute" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M8 2.81v10.38c0 .67-.81 1-1.28.53L3 10H1c-.55 0-1-.45-1-1V7c0-.55.45-1 1-1h2l3.72-3.72C7.19 1.81 8 2.14 8 2.81zm7.53 3.22l-1.06-1.06-1.97 1.97-1.97-1.97-1.06 1.06L11.44 8 9.47 9.97l1.06 1.06 1.97-1.97 1.97 1.97 1.06-1.06L13.56 8l1.97-1.97z"></path></svg>
                      Stop ignoring
                    </span>
                  </div>
                </div>

              </div>

            </div>
          </div>
        </div>
</form>
  </li>

  <li>
    
  <div class="js-toggler-container js-social-container starring-container ">

    <!-- </textarea> --><!-- '"` --><form accept-charset="UTF-8" action="/kangax/fabric.js/unstar" class="starred" data-form-nonce="b9b23677ec8144ef271ff7d77ab09f37677a6f23" data-remote="true" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /><input name="authenticity_token" type="hidden" value="UuVz8WlYyhN2gKGrnNu9RDp/bwA8UDEDWF8A36Y7xgdVuDiDH47h8ssACV7qtuLmNkloPlO7VkDERozLWjgf3A==" /></div>
      <button
        class="btn btn-sm btn-with-count js-toggler-target"
        aria-label="Unstar this repository" title="Unstar kangax/fabric.js"
        data-ga-click="Repository, click unstar button, action:blob#show; text:Unstar">
        <svg aria-hidden="true" class="octicon octicon-star" height="16" version="1.1" viewBox="0 0 14 16" width="14"><path d="M14 6l-4.9-.64L7 1 4.9 5.36 0 6l3.6 3.26L2.67 14 7 11.67 11.33 14l-.93-4.74z"></path></svg>
        Unstar
      </button>
        <a class="social-count js-social-count" href="/kangax/fabric.js/stargazers">
          6,086
        </a>
</form>
    <!-- </textarea> --><!-- '"` --><form accept-charset="UTF-8" action="/kangax/fabric.js/star" class="unstarred" data-form-nonce="b9b23677ec8144ef271ff7d77ab09f37677a6f23" data-remote="true" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /><input name="authenticity_token" type="hidden" value="MJG3tEZ12Vk98hHdX7porA3Bxk5r8F7/SxSst+etYwo9aYlzTAGbDic5nHDycvlvWI3F5wrwxWuoI0qee7pjnQ==" /></div>
      <button
        class="btn btn-sm btn-with-count js-toggler-target"
        aria-label="Star this repository" title="Star kangax/fabric.js"
        data-ga-click="Repository, click star button, action:blob#show; text:Star">
        <svg aria-hidden="true" class="octicon octicon-star" height="16" version="1.1" viewBox="0 0 14 16" width="14"><path d="M14 6l-4.9-.64L7 1 4.9 5.36 0 6l3.6 3.26L2.67 14 7 11.67 11.33 14l-.93-4.74z"></path></svg>
        Star
      </button>
        <a class="social-count js-social-count" href="/kangax/fabric.js/stargazers">
          6,086
        </a>
</form>  </div>

  </li>

  <li>
          <a href="#fork-destination-box" class="btn btn-sm btn-with-count"
              title="Fork your own copy of kangax/fabric.js to your account"
              aria-label="Fork your own copy of kangax/fabric.js to your account"
              rel="facebox"
              data-ga-click="Repository, show fork modal, action:blob#show; text:Fork">
              <svg aria-hidden="true" class="octicon octicon-repo-forked" height="16" version="1.1" viewBox="0 0 10 16" width="10"><path d="M8 1a1.993 1.993 0 0 0-1 3.72V6L5 8 3 6V4.72A1.993 1.993 0 0 0 2 1a1.993 1.993 0 0 0-1 3.72V6.5l3 3v1.78A1.993 1.993 0 0 0 5 15a1.993 1.993 0 0 0 1-3.72V9.5l3-3V4.72A1.993 1.993 0 0 0 8 1zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zm3 10c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zm3-10c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"></path></svg>
            Fork
          </a>

          <div id="fork-destination-box" style="display: none;">
            <h2 class="facebox-header" data-facebox-id="facebox-header">Where should we fork this repository?</h2>
            <include-fragment src=""
                class="js-fork-select-fragment fork-select-fragment"
                data-url="/kangax/fabric.js/fork?fragment=1">
              <img alt="Loading" height="64" src="https://assets-cdn.github.com/images/spinners/octocat-spinner-128.gif" width="64" />
            </include-fragment>
          </div>

    <a href="/kangax/fabric.js/network" class="social-count">
      1,070
    </a>
  </li>
</ul>

    <h1 class="public ">
  <svg aria-hidden="true" class="octicon octicon-repo" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M4 9H3V8h1v1zm0-3H3v1h1V6zm0-2H3v1h1V4zm0-2H3v1h1V2zm8-1v12c0 .55-.45 1-1 1H6v2l-1.5-1.5L3 16v-2H1c-.55 0-1-.45-1-1V1c0-.55.45-1 1-1h10c.55 0 1 .45 1 1zm-1 10H1v2h2v-1h3v1h5v-2zm0-10H2v9h9V1z"></path></svg>
  <span class="author" itemprop="author"><a href="/kangax" class="url fn" rel="author">kangax</a></span><!--
--><span class="path-divider">/</span><!--
--><strong itemprop="name"><a href="/kangax/fabric.js" data-pjax="#js-repo-pjax-container">fabric.js</a></strong>

</h1>

  </div>
  <div class="container">
    
<nav class="reponav js-repo-nav js-sidenav-container-pjax"
     itemscope
     itemtype="http://schema.org/BreadcrumbList"
     role="navigation"
     data-pjax="#js-repo-pjax-container">

  <span itemscope itemtype="http://schema.org/ListItem" itemprop="itemListElement">
    <a href="/kangax/fabric.js" aria-selected="true" class="js-selected-navigation-item selected reponav-item" data-hotkey="g c" data-selected-links="repo_source repo_downloads repo_commits repo_releases repo_tags repo_branches /kangax/fabric.js" itemprop="url">
      <svg aria-hidden="true" class="octicon octicon-code" height="16" version="1.1" viewBox="0 0 14 16" width="14"><path d="M9.5 3L8 4.5 11.5 8 8 11.5 9.5 13 14 8 9.5 3zm-5 0L0 8l4.5 5L6 11.5 2.5 8 6 4.5 4.5 3z"></path></svg>
      <span itemprop="name">Code</span>
      <meta itemprop="position" content="1">
</a>  </span>

    <span itemscope itemtype="http://schema.org/ListItem" itemprop="itemListElement">
      <a href="/kangax/fabric.js/issues" class="js-selected-navigation-item reponav-item" data-hotkey="g i" data-selected-links="repo_issues repo_labels repo_milestones /kangax/fabric.js/issues" itemprop="url">
        <svg aria-hidden="true" class="octicon octicon-issue-opened" height="16" version="1.1" viewBox="0 0 14 16" width="14"><path d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>
        <span itemprop="name">Issues</span>
        <span class="counter">208</span>
        <meta itemprop="position" content="2">
</a>    </span>

  <span itemscope itemtype="http://schema.org/ListItem" itemprop="itemListElement">
    <a href="/kangax/fabric.js/pulls" class="js-selected-navigation-item reponav-item" data-hotkey="g p" data-selected-links="repo_pulls /kangax/fabric.js/pulls" itemprop="url">
      <svg aria-hidden="true" class="octicon octicon-git-pull-request" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M11 11.28V5c-.03-.78-.34-1.47-.94-2.06C9.46 2.35 8.78 2.03 8 2H7V0L4 3l3 3V4h1c.27.02.48.11.69.31.21.2.3.42.31.69v6.28A1.993 1.993 0 0 0 10 15a1.993 1.993 0 0 0 1-3.72zm-1 2.92c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zM4 3c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v6.56A1.993 1.993 0 0 0 2 15a1.993 1.993 0 0 0 1-3.72V4.72c.59-.34 1-.98 1-1.72zm-.8 10c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"></path></svg>
      <span itemprop="name">Pull requests</span>
      <span class="counter">25</span>
      <meta itemprop="position" content="3">
</a>  </span>

    <a href="/kangax/fabric.js/wiki" class="js-selected-navigation-item reponav-item" data-hotkey="g w" data-selected-links="repo_wiki /kangax/fabric.js/wiki">
      <svg aria-hidden="true" class="octicon octicon-book" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M3 5h4v1H3V5zm0 3h4V7H3v1zm0 2h4V9H3v1zm11-5h-4v1h4V5zm0 2h-4v1h4V7zm0 2h-4v1h4V9zm2-6v9c0 .55-.45 1-1 1H9.5l-1 1-1-1H2c-.55 0-1-.45-1-1V3c0-.55.45-1 1-1h5.5l1 1 1-1H15c.55 0 1 .45 1 1zm-8 .5L7.5 3H2v9h6V3.5zm7-.5H9.5l-.5.5V12h6V3z"></path></svg>
      Wiki
</a>

  <a href="/kangax/fabric.js/pulse" class="js-selected-navigation-item reponav-item" data-selected-links="pulse /kangax/fabric.js/pulse">
    <svg aria-hidden="true" class="octicon octicon-pulse" height="16" version="1.1" viewBox="0 0 14 16" width="14"><path d="M11.5 8L8.8 5.4 6.6 8.5 5.5 1.6 2.38 8H0v2h3.6l.9-1.8.9 5.4L9 8.5l1.6 1.5H14V8z"></path></svg>
    Pulse
</a>
  <a href="/kangax/fabric.js/graphs" class="js-selected-navigation-item reponav-item" data-selected-links="repo_graphs repo_contributors /kangax/fabric.js/graphs">
    <svg aria-hidden="true" class="octicon octicon-graph" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M16 14v1H0V0h1v14h15zM5 13H3V8h2v5zm4 0H7V3h2v10zm4 0h-2V6h2v7z"></path></svg>
    Graphs
</a>

</nav>

  </div>
</div>

<div class="container new-discussion-timeline experiment-repo-nav">
  <div class="repository-content">

    

<a href="/kangax/fabric.js/blob/5166ab76c810953e7a56c3b03b6f1b3894051c0c/dist/fabric.min.js" class="hidden js-permalink-shortcut" data-hotkey="y">Permalink</a>

<!-- blob contrib key: blob_contributors:v21:c0cd4f017f13ce5cb426ba0fa2bf4787 -->

<div class="file-navigation js-zeroclipboard-container">
  
<div class="select-menu branch-select-menu js-menu-container js-select-menu left">
  <button class="btn btn-sm select-menu-button js-menu-target css-truncate" data-hotkey="w"
    title="master"
    type="button" aria-label="Switch branches or tags" tabindex="0" aria-haspopup="true">
    <i>Branch:</i>
    <span class="js-select-button css-truncate-target">master</span>
  </button>

  <div class="select-menu-modal-holder js-menu-content js-navigation-container" data-pjax aria-hidden="true">

    <div class="select-menu-modal">
      <div class="select-menu-header">
        <svg aria-label="Close" class="octicon octicon-x js-menu-close" height="16" role="img" version="1.1" viewBox="0 0 12 16" width="12"><path d="M7.48 8l3.75 3.75-1.48 1.48L6 9.48l-3.75 3.75-1.48-1.48L4.52 8 .77 4.25l1.48-1.48L6 6.52l3.75-3.75 1.48 1.48z"></path></svg>
        <span class="select-menu-title">Switch branches/tags</span>
      </div>

      <div class="select-menu-filters">
        <div class="select-menu-text-filter">
          <input type="text" aria-label="Filter branches/tags" id="context-commitish-filter-field" class="form-control js-filterable-field js-navigation-enable" placeholder="Filter branches/tags">
        </div>
        <div class="select-menu-tabs">
          <ul>
            <li class="select-menu-tab">
              <a href="#" data-tab-filter="branches" data-filter-placeholder="Filter branches/tags" class="js-select-menu-tab" role="tab">Branches</a>
            </li>
            <li class="select-menu-tab">
              <a href="#" data-tab-filter="tags" data-filter-placeholder="Find a tag…" class="js-select-menu-tab" role="tab">Tags</a>
            </li>
          </ul>
        </div>
      </div>

      <div class="select-menu-list select-menu-tab-bucket js-select-menu-tab-bucket" data-tab-filter="branches" role="menu">

        <div data-filterable-for="context-commitish-filter-field" data-filterable-type="substring">


            <a class="select-menu-item js-navigation-item js-navigation-open "
               href="/kangax/fabric.js/blob/clear1/dist/fabric.min.js"
               data-name="clear1"
               data-skip-pjax="true"
               rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target js-select-menu-filter-text" title="clear1">
                clear1
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open "
               href="/kangax/fabric.js/blob/eventjs/dist/fabric.min.js"
               data-name="eventjs"
               data-skip-pjax="true"
               rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target js-select-menu-filter-text" title="eventjs">
                eventjs
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open "
               href="/kangax/fabric.js/blob/feature/promises/dist/fabric.min.js"
               data-name="feature/promises"
               data-skip-pjax="true"
               rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target js-select-menu-filter-text" title="feature/promises">
                feature/promises
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open "
               href="/kangax/fabric.js/blob/fixes/dist/fabric.min.js"
               data-name="fixes"
               data-skip-pjax="true"
               rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target js-select-menu-filter-text" title="fixes">
                fixes
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open "
               href="/kangax/fabric.js/blob/flow/dist/fabric.min.js"
               data-name="flow"
               data-skip-pjax="true"
               rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target js-select-menu-filter-text" title="flow">
                flow
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open selected"
               href="/kangax/fabric.js/blob/master/dist/fabric.min.js"
               data-name="master"
               data-skip-pjax="true"
               rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target js-select-menu-filter-text" title="master">
                master
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open "
               href="/kangax/fabric.js/blob/no-padding-in-viewport/dist/fabric.min.js"
               data-name="no-padding-in-viewport"
               data-skip-pjax="true"
               rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target js-select-menu-filter-text" title="no-padding-in-viewport">
                no-padding-in-viewport
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open "
               href="/kangax/fabric.js/blob/objectCache/dist/fabric.min.js"
               data-name="objectCache"
               data-skip-pjax="true"
               rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target js-select-menu-filter-text" title="objectCache">
                objectCache
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open "
               href="/kangax/fabric.js/blob/scrollingText/dist/fabric.min.js"
               data-name="scrollingText"
               data-skip-pjax="true"
               rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target js-select-menu-filter-text" title="scrollingText">
                scrollingText
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open "
               href="/kangax/fabric.js/blob/targetInGroup/dist/fabric.min.js"
               data-name="targetInGroup"
               data-skip-pjax="true"
               rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target js-select-menu-filter-text" title="targetInGroup">
                targetInGroup
              </span>
            </a>
        </div>

          <div class="select-menu-no-results">Nothing to show</div>
      </div>

      <div class="select-menu-list select-menu-tab-bucket js-select-menu-tab-bucket" data-tab-filter="tags">
        <div data-filterable-for="context-commitish-filter-field" data-filterable-type="substring">


            <a class="select-menu-item js-navigation-item js-navigation-open "
              href="/kangax/fabric.js/tree/v1.6.1/dist/fabric.min.js"
              data-name="v1.6.1"
              data-skip-pjax="true"
              rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v1.6.1">
                v1.6.1
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open "
              href="/kangax/fabric.js/tree/v1.6.0/dist/fabric.min.js"
              data-name="v1.6.0"
              data-skip-pjax="true"
              rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v1.6.0">
                v1.6.0
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open "
              href="/kangax/fabric.js/tree/v1.6.0-rc.1/dist/fabric.min.js"
              data-name="v1.6.0-rc.1"
              data-skip-pjax="true"
              rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v1.6.0-rc.1">
                v1.6.0-rc.1
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open "
              href="/kangax/fabric.js/tree/v1.5.0/dist/fabric.min.js"
              data-name="v1.5.0"
              data-skip-pjax="true"
              rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v1.5.0">
                v1.5.0
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open "
              href="/kangax/fabric.js/tree/v1.4.13/dist/fabric.min.js"
              data-name="v1.4.13"
              data-skip-pjax="true"
              rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v1.4.13">
                v1.4.13
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open "
              href="/kangax/fabric.js/tree/v1.4.12/dist/fabric.min.js"
              data-name="v1.4.12"
              data-skip-pjax="true"
              rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v1.4.12">
                v1.4.12
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open "
              href="/kangax/fabric.js/tree/v1.4.11/dist/fabric.min.js"
              data-name="v1.4.11"
              data-skip-pjax="true"
              rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v1.4.11">
                v1.4.11
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open "
              href="/kangax/fabric.js/tree/v1.4.10/dist/fabric.min.js"
              data-name="v1.4.10"
              data-skip-pjax="true"
              rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v1.4.10">
                v1.4.10
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open "
              href="/kangax/fabric.js/tree/v1.4.9/dist/fabric.min.js"
              data-name="v1.4.9"
              data-skip-pjax="true"
              rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v1.4.9">
                v1.4.9
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open "
              href="/kangax/fabric.js/tree/v1.4.8/dist/fabric.min.js"
              data-name="v1.4.8"
              data-skip-pjax="true"
              rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v1.4.8">
                v1.4.8
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open "
              href="/kangax/fabric.js/tree/v1.4.7/dist/fabric.min.js"
              data-name="v1.4.7"
              data-skip-pjax="true"
              rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v1.4.7">
                v1.4.7
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open "
              href="/kangax/fabric.js/tree/v1.4.6/dist/fabric.min.js"
              data-name="v1.4.6"
              data-skip-pjax="true"
              rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v1.4.6">
                v1.4.6
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open "
              href="/kangax/fabric.js/tree/v1.4.5/dist/fabric.min.js"
              data-name="v1.4.5"
              data-skip-pjax="true"
              rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v1.4.5">
                v1.4.5
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open "
              href="/kangax/fabric.js/tree/v1.4.4/dist/fabric.min.js"
              data-name="v1.4.4"
              data-skip-pjax="true"
              rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v1.4.4">
                v1.4.4
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open "
              href="/kangax/fabric.js/tree/v1.4.0/dist/fabric.min.js"
              data-name="v1.4.0"
              data-skip-pjax="true"
              rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v1.4.0">
                v1.4.0
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open "
              href="/kangax/fabric.js/tree/v1.3.7/dist/fabric.min.js"
              data-name="v1.3.7"
              data-skip-pjax="true"
              rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v1.3.7">
                v1.3.7
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open "
              href="/kangax/fabric.js/tree/v1.3.0/dist/fabric.min.js"
              data-name="v1.3.0"
              data-skip-pjax="true"
              rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v1.3.0">
                v1.3.0
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open "
              href="/kangax/fabric.js/tree/v1.2.0/dist/fabric.min.js"
              data-name="v1.2.0"
              data-skip-pjax="true"
              rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v1.2.0">
                v1.2.0
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open "
              href="/kangax/fabric.js/tree/v1.1.0/dist/fabric.min.js"
              data-name="v1.1.0"
              data-skip-pjax="true"
              rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v1.1.0">
                v1.1.0
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open "
              href="/kangax/fabric.js/tree/v1.0.13/dist/fabric.min.js"
              data-name="v1.0.13"
              data-skip-pjax="true"
              rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v1.0.13">
                v1.0.13
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open "
              href="/kangax/fabric.js/tree/v0.9.35/dist/fabric.min.js"
              data-name="v0.9.35"
              data-skip-pjax="true"
              rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="v0.9.35">
                v0.9.35
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open "
              href="/kangax/fabric.js/tree/1.6.2/dist/fabric.min.js"
              data-name="1.6.2"
              data-skip-pjax="true"
              rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"></path></svg>
              <span class="select-menu-item-text css-truncate-target" title="1.6.2">
                1.6.2
              </span>
            </a>
        </div>

        <div class="select-menu-no-results">Nothing to show</div>
      </div>

    </div>
  </div>
</div>

  <div class="btn-group right">
    <a href="/kangax/fabric.js/find/master"
          class="js-pjax-capture-input btn btn-sm"
          data-pjax
          data-hotkey="t">
      Find file
    </a>
    <button aria-label="Copy file path to clipboard" class="js-zeroclipboard btn btn-sm zeroclipboard-button tooltipped tooltipped-s" data-copied-hint="Copied!" type="button">Copy path</button>
  </div>
  <div class="breadcrumb js-zeroclipboard-target">
    <span class="repo-root js-repo-root"><span class="js-path-segment"><a href="/kangax/fabric.js"><span>fabric.js</span></a></span></span><span class="separator">/</span><span class="js-path-segment"><a href="/kangax/fabric.js/tree/master/dist"><span>dist</span></a></span><span class="separator">/</span><strong class="final-path">fabric.min.js</strong>
  </div>
</div>


  <div class="commit-tease">
      <span class="right">
        <a class="commit-tease-sha" href="/kangax/fabric.js/commit/77dab2115581a5c5a578123100b2a83cdbb60f40" data-pjax>
          77dab21
        </a>
        <relative-time datetime="2016-06-11T12:10:20Z">Jun 11, 2016</relative-time>
      </span>
      <div>
        <img alt="@asturur" class="avatar" height="20" src="https://avatars2.githubusercontent.com/u/1194048?v=3&amp;s=40" width="20" />
        <a href="/asturur" class="user-mention" rel="contributor">asturur</a>
          <a href="/kangax/fabric.js/commit/77dab2115581a5c5a578123100b2a83cdbb60f40" class="message" data-pjax="true" title="Additional method for centering objects (#3044)">Additional method for centering objects (</a><a href="https://github.com/kangax/fabric.js/pull/3044" class="issue-link js-issue-link" data-url="https://github.com/kangax/fabric.js/issues/3044" data-id="159739566" data-error-text="Failed to load issue title" data-permission-text="Issue title is private">#3044</a><a href="/kangax/fabric.js/commit/77dab2115581a5c5a578123100b2a83cdbb60f40" class="message" data-pjax="true" title="Additional method for centering objects (#3044)">)</a>
      </div>

    <div class="commit-tease-contributors">
      <button type="button" class="btn-link muted-link contributors-toggle" data-facebox="#blob_contributors_box">
        <strong>2</strong>
         contributors
      </button>
          <a class="avatar-link tooltipped tooltipped-s" aria-label="kangax" href="/kangax/fabric.js/commits/master/dist/fabric.min.js?author=kangax"><img alt="@kangax" class="avatar" height="20" src="https://avatars1.githubusercontent.com/u/383?v=3&amp;s=40" width="20" /> </a>
    <a class="avatar-link tooltipped tooltipped-s" aria-label="asturur" href="/kangax/fabric.js/commits/master/dist/fabric.min.js?author=asturur"><img alt="@asturur" class="avatar" height="20" src="https://avatars2.githubusercontent.com/u/1194048?v=3&amp;s=40" width="20" /> </a>


    </div>

    <div id="blob_contributors_box" style="display:none">
      <h2 class="facebox-header" data-facebox-id="facebox-header">Users who have contributed to this file</h2>
      <ul class="facebox-user-list" data-facebox-id="facebox-description">
          <li class="facebox-user-list-item">
            <img alt="@kangax" height="24" src="https://avatars3.githubusercontent.com/u/383?v=3&amp;s=48" width="24" />
            <a href="/kangax">kangax</a>
          </li>
          <li class="facebox-user-list-item">
            <img alt="@asturur" height="24" src="https://avatars0.githubusercontent.com/u/1194048?v=3&amp;s=48" width="24" />
            <a href="/asturur">asturur</a>
          </li>
      </ul>
    </div>
  </div>

<div class="file">
  <div class="file-header">
  <div class="file-actions">

    <div class="btn-group">
      <a href="/kangax/fabric.js/raw/master/dist/fabric.min.js" class="btn btn-sm " id="raw-url">Raw</a>
        <a href="/kangax/fabric.js/blame/master/dist/fabric.min.js" class="btn btn-sm js-update-url-with-hash">Blame</a>
      <a href="/kangax/fabric.js/commits/master/dist/fabric.min.js" class="btn btn-sm " rel="nofollow">History</a>
    </div>

        <a class="btn-octicon tooltipped tooltipped-nw"
           href="https://mac.github.com"
           aria-label="Open this file in GitHub Desktop"
           data-ga-click="Repository, open with desktop, type:mac">
            <svg aria-hidden="true" class="octicon octicon-device-desktop" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M15 2H1c-.55 0-1 .45-1 1v9c0 .55.45 1 1 1h5.34c-.25.61-.86 1.39-2.34 2h8c-1.48-.61-2.09-1.39-2.34-2H15c.55 0 1-.45 1-1V3c0-.55-.45-1-1-1zm0 9H1V3h14v8z"></path></svg>
        </a>

        <!-- </textarea> --><!-- '"` --><form accept-charset="UTF-8" action="/kangax/fabric.js/edit/master/dist/fabric.min.js" class="inline-form js-update-url-with-hash" data-form-nonce="b9b23677ec8144ef271ff7d77ab09f37677a6f23" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /><input name="authenticity_token" type="hidden" value="e0a7LHE7mvJXoNooik40Tbtq0ogPK0UF5k9CLT3t1idiiw/eqCREEQpv9sq5alc8xhvJPQXlYWXEkS+RttowhQ==" /></div>
          <button class="btn-octicon tooltipped tooltipped-nw" type="submit"
            aria-label="Fork this project and edit the file" data-hotkey="e" data-disable-with>
            <svg aria-hidden="true" class="octicon octicon-pencil" height="16" version="1.1" viewBox="0 0 14 16" width="14"><path d="M0 12v3h3l8-8-3-3-8 8zm3 2H1v-2h1v1h1v1zm10.3-9.3L12 6 9 3l1.3-1.3a.996.996 0 0 1 1.41 0l1.59 1.59c.39.39.39 1.02 0 1.41z"></path></svg>
          </button>
</form>        <!-- </textarea> --><!-- '"` --><form accept-charset="UTF-8" action="/kangax/fabric.js/delete/master/dist/fabric.min.js" class="inline-form" data-form-nonce="b9b23677ec8144ef271ff7d77ab09f37677a6f23" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /><input name="authenticity_token" type="hidden" value="hwK7aTeHIYINQvafE9l/DczgKtNATmQCzJDeM0EaPjyPSmlEAW+sRN0Jd86AZznHehv6Ai57M6x8Ae7a5vYfnQ==" /></div>
          <button class="btn-octicon btn-octicon-danger tooltipped tooltipped-nw" type="submit"
            aria-label="Fork this project and delete the file" data-disable-with>
            <svg aria-hidden="true" class="octicon octicon-trashcan" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M11 2H9c0-.55-.45-1-1-1H5c-.55 0-1 .45-1 1H2c-.55 0-1 .45-1 1v1c0 .55.45 1 1 1v9c0 .55.45 1 1 1h7c.55 0 1-.45 1-1V5c.55 0 1-.45 1-1V3c0-.55-.45-1-1-1zm-1 12H3V5h1v8h1V5h1v8h1V5h1v8h1V5h1v9zm1-10H2V3h9v1z"></path></svg>
          </button>
</form>  </div>

  <div class="file-info">
      11 lines (11 sloc)
      <span class="file-info-divider"></span>
    328 KB
  </div>
</div>

  

  <div itemprop="text" class="blob-wrapper data type-javascript">
      <table class="highlight tab-size js-file-line-container" data-tab-size="2">
      <tr>
        <td id="L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="LC1" class="blob-code blob-code-inner js-file-line">var fabric=fabric||{version:&quot;1.6.2&quot;};if(typeof exports!==&quot;undefined&quot;){exports.fabric=fabric}if(typeof document!==&quot;undefined&quot;&amp;&amp;typeof window!==&quot;undefined&quot;){fabric.document=document;fabric.window=window;window.fabric=fabric}else{fabric.document=require(&quot;jsdom&quot;).jsdom(&quot;&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;&quot;);if(fabric.document.createWindow){fabric.window=fabric.document.createWindow()}else{fabric.window=fabric.document.parentWindow}}fabric.isTouchSupported=&quot;ontouchstart&quot;in fabric.document.documentElement;fabric.isLikelyNode=typeof Buffer!==&quot;undefined&quot;&amp;&amp;typeof window===&quot;undefined&quot;;fabric.SHARED_ATTRIBUTES=[&quot;display&quot;,&quot;transform&quot;,&quot;fill&quot;,&quot;fill-opacity&quot;,&quot;fill-rule&quot;,&quot;opacity&quot;,&quot;stroke&quot;,&quot;stroke-dasharray&quot;,&quot;stroke-linecap&quot;,&quot;stroke-linejoin&quot;,&quot;stroke-miterlimit&quot;,&quot;stroke-opacity&quot;,&quot;stroke-width&quot;,&quot;id&quot;];fabric.DPI=96;fabric.reNum=&quot;(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)&quot;;fabric.fontPaths={};fabric.charWidthsCache={};fabric.devicePixelRatio=fabric.window.devicePixelRatio||fabric.window.webkitDevicePixelRatio||fabric.window.mozDevicePixelRatio||1;(function(){function _removeEventListener(eventName,handler){if(!this.__eventListeners[eventName]){return}var eventListener=this.__eventListeners[eventName];if(handler){eventListener[eventListener.indexOf(handler)]=false}else{fabric.util.array.fill(eventListener,false)}}function observe(eventName,handler){if(!this.__eventListeners){this.__eventListeners={}}if(arguments.length===1){for(var prop in eventName){this.on(prop,eventName[prop])}}else{if(!this.__eventListeners[eventName]){this.__eventListeners[eventName]=[]}this.__eventListeners[eventName].push(handler)}return this}function stopObserving(eventName,handler){if(!this.__eventListeners){return}if(arguments.length===0){for(eventName in this.__eventListeners){_removeEventListener.call(this,eventName)}}else if(arguments.length===1&amp;&amp;typeof arguments[0]===&quot;object&quot;){for(var prop in eventName){_removeEventListener.call(this,prop,eventName[prop])}}else{_removeEventListener.call(this,eventName,handler)}return this}function fire(eventName,options){if(!this.__eventListeners){return}var listenersForEvent=this.__eventListeners[eventName];if(!listenersForEvent){return}for(var i=0,len=listenersForEvent.length;i&lt;len;i++){listenersForEvent[i]&amp;&amp;listenersForEvent[i].call(this,options||{})}this.__eventListeners[eventName]=listenersForEvent.filter(function(value){return value!==false});return this}fabric.Observable={observe:observe,stopObserving:stopObserving,fire:fire,on:observe,off:stopObserving,trigger:fire}})();fabric.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var i=0,length=arguments.length;i&lt;length;i++){this._onObjectAdded(arguments[i])}this.renderOnAddRemove&amp;&amp;this.renderAll();return this},insertAt:function(object,index,nonSplicing){var objects=this.getObjects();if(nonSplicing){objects[index]=object}else{objects.splice(index,0,object)}this._onObjectAdded(object);this.renderOnAddRemove&amp;&amp;this.renderAll();return this},remove:function(){var objects=this.getObjects(),index;for(var i=0,length=arguments.length;i&lt;length;i++){index=objects.indexOf(arguments[i]);if(index!==-1){objects.splice(index,1);this._onObjectRemoved(arguments[i])}}this.renderOnAddRemove&amp;&amp;this.renderAll();return this},forEachObject:function(callback,context){var objects=this.getObjects(),i=objects.length;while(i--){callback.call(context,objects[i],i,objects)}return this},getObjects:function(type){if(typeof type===&quot;undefined&quot;){return this._objects}return this._objects.filter(function(o){return o.type===type})},item:function(index){return this.getObjects()[index]},isEmpty:function(){return this.getObjects().length===0},size:function(){return this.getObjects().length},contains:function(object){return this.getObjects().indexOf(object)&gt;-1},complexity:function(){return this.getObjects().reduce(function(memo,current){memo+=current.complexity?current.complexity():0;return memo},0)}};(function(global){var sqrt=Math.sqrt,atan2=Math.atan2,pow=Math.pow,abs=Math.abs,PiBy180=Math.PI/180;fabric.util={removeFromArray:function(array,value){var idx=array.indexOf(value);if(idx!==-1){array.splice(idx,1)}return array},getRandomInt:function(min,max){return Math.floor(Math.random()*(max-min+1))+min},degreesToRadians:function(degrees){return degrees*PiBy180},radiansToDegrees:function(radians){return radians/PiBy180},rotatePoint:function(point,origin,radians){point.subtractEquals(origin);var v=fabric.util.rotateVector(point,radians);return new fabric.Point(v.x,v.y).addEquals(origin)},rotateVector:function(vector,radians){var sin=Math.sin(radians),cos=Math.cos(radians),rx=vector.x*cos-vector.y*sin,ry=vector.x*sin+vector.y*cos;return{x:rx,y:ry}},transformPoint:function(p,t,ignoreOffset){if(ignoreOffset){return new fabric.Point(t[0]*p.x+t[2]*p.y,t[1]*p.x+t[3]*p.y)}return new fabric.Point(t[0]*p.x+t[2]*p.y+t[4],t[1]*p.x+t[3]*p.y+t[5])},makeBoundingBoxFromPoints:function(points){var xPoints=[points[0].x,points[1].x,points[2].x,points[3].x],minX=fabric.util.array.min(xPoints),maxX=fabric.util.array.max(xPoints),width=Math.abs(minX-maxX),yPoints=[points[0].y,points[1].y,points[2].y,points[3].y],minY=fabric.util.array.min(yPoints),maxY=fabric.util.array.max(yPoints),height=Math.abs(minY-maxY);return{left:minX,top:minY,width:width,height:height}},invertTransform:function(t){var a=1/(t[0]*t[3]-t[1]*t[2]),r=[a*t[3],-a*t[1],-a*t[2],a*t[0]],o=fabric.util.transformPoint({x:t[4],y:t[5]},r,true);r[4]=-o.x;r[5]=-o.y;return r},toFixed:function(number,fractionDigits){return parseFloat(Number(number).toFixed(fractionDigits))},parseUnit:function(value,fontSize){var unit=/\D{0,2}$/.exec(value),number=parseFloat(value);if(!fontSize){fontSize=fabric.Text.DEFAULT_SVG_FONT_SIZE}switch(unit[0]){case&quot;mm&quot;:return number*fabric.DPI/25.4;case&quot;cm&quot;:return number*fabric.DPI/2.54;case&quot;in&quot;:return number*fabric.DPI;case&quot;pt&quot;:return number*fabric.DPI/72;case&quot;pc&quot;:return number*fabric.DPI/72*12;case&quot;em&quot;:return number*fontSize;default:return number}},falseFunction:function(){return false},getKlass:function(type,namespace){type=fabric.util.string.camelize(type.charAt(0).toUpperCase()+type.slice(1));return fabric.util.resolveNamespace(namespace)[type]},resolveNamespace:function(namespace){if(!namespace){return fabric}var parts=namespace.split(&quot;.&quot;),len=parts.length,obj=global||fabric.window;for(var i=0;i&lt;len;++i){obj=obj[parts[i]]}return obj},loadImage:function(url,callback,context,crossOrigin){if(!url){callback&amp;&amp;callback.call(context,url);return}var img=fabric.util.createImage();img.onload=function(){callback&amp;&amp;callback.call(context,img);img=img.onload=img.onerror=null};img.onerror=function(){fabric.log(&quot;Error loading &quot;+img.src);callback&amp;&amp;callback.call(context,null,true);img=img.onload=img.onerror=null};if(url.indexOf(&quot;data&quot;)!==0&amp;&amp;crossOrigin){img.crossOrigin=crossOrigin}img.src=url},enlivenObjects:function(objects,callback,namespace,reviver){objects=objects||[];function onLoaded(){if(++numLoadedObjects===numTotalObjects){callback&amp;&amp;callback(enlivenedObjects)}}var enlivenedObjects=[],numLoadedObjects=0,numTotalObjects=objects.length;if(!numTotalObjects){callback&amp;&amp;callback(enlivenedObjects);return}objects.forEach(function(o,index){if(!o||!o.type){onLoaded();return}var klass=fabric.util.getKlass(o.type,namespace);if(klass.async){klass.fromObject(o,function(obj,error){if(!error){enlivenedObjects[index]=obj;reviver&amp;&amp;reviver(o,enlivenedObjects[index])}onLoaded()})}else{enlivenedObjects[index]=klass.fromObject(o);reviver&amp;&amp;reviver(o,enlivenedObjects[index]);onLoaded()}})},groupSVGElements:function(elements,options,path){var object;object=new fabric.PathGroup(elements,options);if(typeof path!==&quot;undefined&quot;){object.setSourcePath(path)}return object},populateWithProperties:function(source,destination,properties){if(properties&amp;&amp;Object.prototype.toString.call(properties)===&quot;[object Array]&quot;){for(var i=0,len=properties.length;i&lt;len;i++){if(properties[i]in source){destination[properties[i]]=source[properties[i]]}}}},drawDashedLine:function(ctx,x,y,x2,y2,da){var dx=x2-x,dy=y2-y,len=sqrt(dx*dx+dy*dy),rot=atan2(dy,dx),dc=da.length,di=0,draw=true;ctx.save();ctx.translate(x,y);ctx.moveTo(0,0);ctx.rotate(rot);x=0;while(len&gt;x){x+=da[di++%dc];if(x&gt;len){x=len}ctx[draw?&quot;lineTo&quot;:&quot;moveTo&quot;](x,0);draw=!draw}ctx.restore()},createCanvasElement:function(canvasEl){canvasEl||(canvasEl=fabric.document.createElement(&quot;canvas&quot;));if(!canvasEl.getContext&amp;&amp;typeof G_vmlCanvasManager!==&quot;undefined&quot;){G_vmlCanvasManager.initElement(canvasEl)}return canvasEl},createImage:function(){return fabric.isLikelyNode?new(require(&quot;canvas&quot;).Image):fabric.document.createElement(&quot;img&quot;)},createAccessors:function(klass){var proto=klass.prototype;for(var i=proto.stateProperties.length;i--;){var propName=proto.stateProperties[i],capitalizedPropName=propName.charAt(0).toUpperCase()+propName.slice(1),setterName=&quot;set&quot;+capitalizedPropName,getterName=&quot;get&quot;+capitalizedPropName;if(!proto[getterName]){proto[getterName]=function(property){return new Function(&#39;return this.get(&quot;&#39;+property+&#39;&quot;)&#39;)}(propName)}if(!proto[setterName]){proto[setterName]=function(property){return new Function(&quot;value&quot;,&#39;return this.set(&quot;&#39;+property+&#39;&quot;, value)&#39;)}(propName)}}},clipContext:function(receiver,ctx){ctx.save();ctx.beginPath();receiver.clipTo(ctx);ctx.clip()},multiplyTransformMatrices:function(a,b,is2x2){return[a[0]*b[0]+a[2]*b[1],a[1]*b[0]+a[3]*b[1],a[0]*b[2]+a[2]*b[3],a[1]*b[2]+a[3]*b[3],is2x2?0:a[0]*b[4]+a[2]*b[5]+a[4],is2x2?0:a[1]*b[4]+a[3]*b[5]+a[5]]},qrDecompose:function(a){var angle=atan2(a[1],a[0]),denom=pow(a[0],2)+pow(a[1],2),scaleX=sqrt(denom),scaleY=(a[0]*a[3]-a[2]*a[1])/scaleX,skewX=atan2(a[0]*a[2]+a[1]*a[3],denom);return{angle:angle/PiBy180,scaleX:scaleX,scaleY:scaleY,skewX:skewX/PiBy180,skewY:0,translateX:a[4],translateY:a[5]}},customTransformMatrix:function(scaleX,scaleY,skewX){var skewMatrixX=[1,0,abs(Math.tan(skewX*PiBy180)),1],scaleMatrix=[abs(scaleX),0,0,abs(scaleY)];return fabric.util.multiplyTransformMatrices(scaleMatrix,skewMatrixX,true)},resetObjectTransform:function(target){target.scaleX=1;target.scaleY=1;target.skewX=0;target.skewY=0;target.flipX=false;target.flipY=false;target.setAngle(0)},getFunctionBody:function(fn){return(String(fn).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(ctx,x,y,tolerance){if(tolerance&gt;0){if(x&gt;tolerance){x-=tolerance}else{x=0}if(y&gt;tolerance){y-=tolerance}else{y=0}}var _isTransparent=true,imageData=ctx.getImageData(x,y,tolerance*2||1,tolerance*2||1);for(var i=3,l=imageData.data.length;i&lt;l;i+=4){var temp=imageData.data[i];_isTransparent=temp&lt;=0;if(_isTransparent===false){break}}imageData=null;return _isTransparent},parsePreserveAspectRatioAttribute:function(attribute){var meetOrSlice=&quot;meet&quot;,alignX=&quot;Mid&quot;,alignY=&quot;Mid&quot;,aspectRatioAttrs=attribute.split(&quot; &quot;),align;if(aspectRatioAttrs&amp;&amp;aspectRatioAttrs.length){meetOrSlice=aspectRatioAttrs.pop();if(meetOrSlice!==&quot;meet&quot;&amp;&amp;meetOrSlice!==&quot;slice&quot;){align=meetOrSlice;meetOrSlice=&quot;meet&quot;}else if(aspectRatioAttrs.length){align=aspectRatioAttrs.pop()}}alignX=align!==&quot;none&quot;?align.slice(1,4):&quot;none&quot;;alignY=align!==&quot;none&quot;?align.slice(5,8):&quot;none&quot;;return{meetOrSlice:meetOrSlice,alignX:alignX,alignY:alignY}},clearFabricFontCache:function(fontFamily){if(fabric.charWidthsCache[fontFamily]){fabric.charWidthsCache[fontFamily]={}}}}})(typeof exports!==&quot;undefined&quot;?exports:this);(function(){var arcToSegmentsCache={},segmentToBezierCache={},boundsOfCurveCache={},_join=Array.prototype.join;function arcToSegments(toX,toY,rx,ry,large,sweep,rotateX){var argsString=_join.call(arguments);if(arcToSegmentsCache[argsString]){return arcToSegmentsCache[argsString]}var PI=Math.PI,th=rotateX*PI/180,sinTh=Math.sin(th),cosTh=Math.cos(th),fromX=0,fromY=0;rx=Math.abs(rx);ry=Math.abs(ry);var px=-cosTh*toX*.5-sinTh*toY*.5,py=-cosTh*toY*.5+sinTh*toX*.5,rx2=rx*rx,ry2=ry*ry,py2=py*py,px2=px*px,pl=rx2*ry2-rx2*py2-ry2*px2,root=0;if(pl&lt;0){var s=Math.sqrt(1-pl/(rx2*ry2));rx*=s;ry*=s}else{root=(large===sweep?-1:1)*Math.sqrt(pl/(rx2*py2+ry2*px2))}var cx=root*rx*py/ry,cy=-root*ry*px/rx,cx1=cosTh*cx-sinTh*cy+toX*.5,cy1=sinTh*cx+cosTh*cy+toY*.5,mTheta=calcVectorAngle(1,0,(px-cx)/rx,(py-cy)/ry),dtheta=calcVectorAngle((px-cx)/rx,(py-cy)/ry,(-px-cx)/rx,(-py-cy)/ry);if(sweep===0&amp;&amp;dtheta&gt;0){dtheta-=2*PI}else if(sweep===1&amp;&amp;dtheta&lt;0){dtheta+=2*PI}var segments=Math.ceil(Math.abs(dtheta/PI*2)),result=[],mDelta=dtheta/segments,mT=8/3*Math.sin(mDelta/4)*Math.sin(mDelta/4)/Math.sin(mDelta/2),th3=mTheta+mDelta;for(var i=0;i&lt;segments;i++){result[i]=segmentToBezier(mTheta,th3,cosTh,sinTh,rx,ry,cx1,cy1,mT,fromX,fromY);fromX=result[i][4];fromY=result[i][5];mTheta=th3;th3+=mDelta}arcToSegmentsCache[argsString]=result;return result}function segmentToBezier(th2,th3,cosTh,sinTh,rx,ry,cx1,cy1,mT,fromX,fromY){var argsString2=_join.call(arguments);if(segmentToBezierCache[argsString2]){return segmentToBezierCache[argsString2]}var costh2=Math.cos(th2),sinth2=Math.sin(th2),costh3=Math.cos(th3),sinth3=Math.sin(th3),toX=cosTh*rx*costh3-sinTh*ry*sinth3+cx1,toY=sinTh*rx*costh3+cosTh*ry*sinth3+cy1,cp1X=fromX+mT*(-cosTh*rx*sinth2-sinTh*ry*costh2),cp1Y=fromY+mT*(-sinTh*rx*sinth2+cosTh*ry*costh2),cp2X=toX+mT*(cosTh*rx*sinth3+sinTh*ry*costh3),cp2Y=toY+mT*(sinTh*rx*sinth3-cosTh*ry*costh3);segmentToBezierCache[argsString2]=[cp1X,cp1Y,cp2X,cp2Y,toX,toY];return segmentToBezierCache[argsString2]}function calcVectorAngle(ux,uy,vx,vy){var ta=Math.atan2(uy,ux),tb=Math.atan2(vy,vx);if(tb&gt;=ta){return tb-ta}else{return 2*Math.PI-(ta-tb)}}fabric.util.drawArc=function(ctx,fx,fy,coords){var rx=coords[0],ry=coords[1],rot=coords[2],large=coords[3],sweep=coords[4],tx=coords[5],ty=coords[6],segs=[[],[],[],[]],segsNorm=arcToSegments(tx-fx,ty-fy,rx,ry,large,sweep,rot);for(var i=0,len=segsNorm.length;i&lt;len;i++){segs[i][0]=segsNorm[i][0]+fx;segs[i][1]=segsNorm[i][1]+fy;segs[i][2]=segsNorm[i][2]+fx;segs[i][3]=segsNorm[i][3]+fy;segs[i][4]=segsNorm[i][4]+fx;segs[i][5]=segsNorm[i][5]+fy;ctx.bezierCurveTo.apply(ctx,segs[i])}};fabric.util.getBoundsOfArc=function(fx,fy,rx,ry,rot,large,sweep,tx,ty){var fromX=0,fromY=0,bound=[],bounds=[],segs=arcToSegments(tx-fx,ty-fy,rx,ry,large,sweep,rot),boundCopy=[[],[]];for(var i=0,len=segs.length;i&lt;len;i++){bound=getBoundsOfCurve(fromX,fromY,segs[i][0],segs[i][1],segs[i][2],segs[i][3],segs[i][4],segs[i][5]);boundCopy[0].x=bound[0].x+fx;boundCopy[0].y=bound[0].y+fy;boundCopy[1].x=bound[1].x+fx;boundCopy[1].y=bound[1].y+fy;bounds.push(boundCopy[0]);bounds.push(boundCopy[1]);fromX=segs[i][4];fromY=segs[i][5]}return bounds};function getBoundsOfCurve(x0,y0,x1,y1,x2,y2,x3,y3){var argsString=_join.call(arguments);if(boundsOfCurveCache[argsString]){return boundsOfCurveCache[argsString]}var sqrt=Math.sqrt,min=Math.min,max=Math.max,abs=Math.abs,tvalues=[],bounds=[[],[]],a,b,c,t,t1,t2,b2ac,sqrtb2ac;b=6*x0-12*x1+6*x2;a=-3*x0+9*x1-9*x2+3*x3;c=3*x1-3*x0;for(var i=0;i&lt;2;++i){if(i&gt;0){b=6*y0-12*y1+6*y2;a=-3*y0+9*y1-9*y2+3*y3;c=3*y1-3*y0}if(abs(a)&lt;1e-12){if(abs(b)&lt;1e-12){continue}t=-c/b;if(0&lt;t&amp;&amp;t&lt;1){tvalues.push(t)}continue}b2ac=b*b-4*c*a;if(b2ac&lt;0){continue}sqrtb2ac=sqrt(b2ac);t1=(-b+sqrtb2ac)/(2*a);if(0&lt;t1&amp;&amp;t1&lt;1){tvalues.push(t1)}t2=(-b-sqrtb2ac)/(2*a);if(0&lt;t2&amp;&amp;t2&lt;1){tvalues.push(t2)}}var x,y,j=tvalues.length,jlen=j,mt;while(j--){t=tvalues[j];mt=1-t;x=mt*mt*mt*x0+3*mt*mt*t*x1+3*mt*t*t*x2+t*t*t*x3;bounds[0][j]=x;y=mt*mt*mt*y0+3*mt*mt*t*y1+3*mt*t*t*y2+t*t*t*y3;bounds[1][j]=y}bounds[0][jlen]=x0;bounds[1][jlen]=y0;bounds[0][jlen+1]=x3;bounds[1][jlen+1]=y3;var result=[{x:min.apply(null,bounds[0]),y:min.apply(null,bounds[1])},{x:max.apply(null,bounds[0]),y:max.apply(null,bounds[1])}];boundsOfCurveCache[argsString]=result;return result}fabric.util.getBoundsOfCurve=getBoundsOfCurve})();(function(){var slice=Array.prototype.slice;if(!Array.prototype.indexOf){Array.prototype.indexOf=function(searchElement){if(this===void 0||this===null){throw new TypeError}var t=Object(this),len=t.length&gt;&gt;&gt;0;if(len===0){return-1}var n=0;if(arguments.length&gt;0){n=Number(arguments[1]);if(n!==n){n=0}else if(n!==0&amp;&amp;n!==Number.POSITIVE_INFINITY&amp;&amp;n!==Number.NEGATIVE_INFINITY){n=(n&gt;0||-1)*Math.floor(Math.abs(n))}}if(n&gt;=len){return-1}var k=n&gt;=0?n:Math.max(len-Math.abs(n),0);for(;k&lt;len;k++){if(k in t&amp;&amp;t[k]===searchElement){return k}}return-1}}if(!Array.prototype.forEach){Array.prototype.forEach=function(fn,context){for(var i=0,len=this.length&gt;&gt;&gt;0;i&lt;len;i++){if(i in this){fn.call(context,this[i],i,this)}}}}if(!Array.prototype.map){Array.prototype.map=function(fn,context){var result=[];for(var i=0,len=this.length&gt;&gt;&gt;0;i&lt;len;i++){if(i in this){result[i]=fn.call(context,this[i],i,this)}}return result}}if(!Array.prototype.every){Array.prototype.every=function(fn,context){for(var i=0,len=this.length&gt;&gt;&gt;0;i&lt;len;i++){if(i in this&amp;&amp;!fn.call(context,this[i],i,this)){return false}}return true}}if(!Array.prototype.some){Array.prototype.some=function(fn,context){for(var i=0,len=this.length&gt;&gt;&gt;0;i&lt;len;i++){if(i in this&amp;&amp;fn.call(context,this[i],i,this)){return true}}return false}}if(!Array.prototype.filter){Array.prototype.filter=function(fn,context){var result=[],val;for(var i=0,len=this.length&gt;&gt;&gt;0;i&lt;len;i++){if(i in this){val=this[i];if(fn.call(context,val,i,this)){result.push(val)}}}return result}}if(!Array.prototype.reduce){Array.prototype.reduce=function(fn){var len=this.length&gt;&gt;&gt;0,i=0,rv;if(arguments.length&gt;1){rv=arguments[1]}else{do{if(i in this){rv=this[i++];break}if(++i&gt;=len){throw new TypeError}}while(true)}for(;i&lt;len;i++){if(i in this){rv=fn.call(null,rv,this[i],i,this)}}return rv}}function invoke(array,method){var args=slice.call(arguments,2),result=[];for(var i=0,len=array.length;i&lt;len;i++){result[i]=args.length?array[i][method].apply(array[i],args):array[i][method].call(array[i])}return result}function max(array,byProperty){return find(array,byProperty,function(value1,value2){return value1&gt;=value2})}function min(array,byProperty){return find(array,byProperty,function(value1,value2){return value1&lt;value2})}function fill(array,value){var k=array.length;while(k--){array[k]=value}return array}function find(array,byProperty,condition){if(!array||array.length===0){return}var i=array.length-1,result=byProperty?array[i][byProperty]:array[i];if(byProperty){while(i--){if(condition(array[i][byProperty],result)){result=array[i][byProperty]}}}else{while(i--){if(condition(array[i],result)){result=array[i]}}}return result}fabric.util.array={fill:fill,invoke:invoke,min:min,max:max}})();(function(){function extend(destination,source){for(var property in source){destination[property]=source[property]}return destination}function clone(object){return extend({},object)}fabric.util.object={extend:extend,clone:clone}})();(function(){if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,&quot;&quot;).replace(/[\s\xA0]+$/,&quot;&quot;)}}function camelize(string){return string.replace(/-+(.)?/g,function(match,character){return character?character.toUpperCase():&quot;&quot;})}function capitalize(string,firstLetterOnly){return string.charAt(0).toUpperCase()+(firstLetterOnly?string.slice(1):string.slice(1).toLowerCase())}function escapeXml(string){return string.replace(/&amp;/g,&quot;&amp;amp;&quot;).replace(/&quot;/g,&quot;&amp;quot;&quot;).replace(/&#39;/g,&quot;&amp;apos;&quot;).replace(/&lt;/g,&quot;&amp;lt;&quot;).replace(/&gt;/g,&quot;&amp;gt;&quot;)}fabric.util.string={camelize:camelize,capitalize:capitalize,escapeXml:escapeXml}})();(function(){var slice=Array.prototype.slice,apply=Function.prototype.apply,Dummy=function(){};if(!Function.prototype.bind){Function.prototype.bind=function(thisArg){var _this=this,args=slice.call(arguments,1),bound;if(args.length){bound=function(){return apply.call(_this,this instanceof Dummy?this:thisArg,args.concat(slice.call(arguments)))}}else{bound=function(){return apply.call(_this,this instanceof Dummy?this:thisArg,arguments)}}Dummy.prototype=this.prototype;bound.prototype=new Dummy;return bound}}})();(function(){var slice=Array.prototype.slice,emptyFunction=function(){},IS_DONTENUM_BUGGY=function(){for(var p in{toString:1}){if(p===&quot;toString&quot;){return false}}return true}(),addMethods=function(klass,source,parent){for(var property in source){if(property in klass.prototype&amp;&amp;typeof klass.prototype[property]===&quot;function&quot;&amp;&amp;(source[property]+&quot;&quot;).indexOf(&quot;callSuper&quot;)&gt;-1){klass.prototype[property]=function(property){return function(){var superclass=this.constructor.superclass;this.constructor.superclass=parent;var returnValue=source[property].apply(this,arguments);this.constructor.superclass=superclass;if(property!==&quot;initialize&quot;){return returnValue}}}(property)}else{klass.prototype[property]=source[property]}if(IS_DONTENUM_BUGGY){if(source.toString!==Object.prototype.toString){klass.prototype.toString=source.toString}if(source.valueOf!==Object.prototype.valueOf){klass.prototype.valueOf=source.valueOf}}}};function Subclass(){}function callSuper(methodName){var fn=this.constructor.superclass.prototype[methodName];return arguments.length&gt;1?fn.apply(this,slice.call(arguments,1)):fn.call(this)}function createClass(){var parent=null,properties=slice.call(arguments,0);if(typeof properties[0]===&quot;function&quot;){parent=properties.shift()}function klass(){this.initialize.apply(this,arguments)}klass.superclass=parent;klass.subclasses=[];if(parent){Subclass.prototype=parent.prototype;klass.prototype=new Subclass;parent.subclasses.push(klass)}for(var i=0,length=properties.length;i&lt;length;i++){addMethods(klass,properties[i],parent)}if(!klass.prototype.initialize){klass.prototype.initialize=emptyFunction}klass.prototype.constructor=klass;klass.prototype.callSuper=callSuper;return klass}fabric.util.createClass=createClass})();(function(){var unknown=&quot;unknown&quot;;function areHostMethods(object){var methodNames=Array.prototype.slice.call(arguments,1),t,i,len=methodNames.length;for(i=0;i&lt;len;i++){t=typeof object[methodNames[i]];if(!/^(?:function|object|unknown)$/.test(t)){return false}}return true}var getElement,setElement,getUniqueId=function(){var uid=0;return function(element){return element.__uniqueID||(element.__uniqueID=&quot;uniqueID__&quot;+uid++)}}();(function(){var elements={};getElement=function(uid){return elements[uid]};setElement=function(uid,element){elements[uid]=element}})();function createListener(uid,handler){return{handler:handler,wrappedHandler:createWrappedHandler(uid,handler)}}function createWrappedHandler(uid,handler){return function(e){handler.call(getElement(uid),e||fabric.window.event)}}function createDispatcher(uid,eventName){return function(e){if(handlers[uid]&amp;&amp;handlers[uid][eventName]){var handlersForEvent=handlers[uid][eventName];for(var i=0,len=handlersForEvent.length;i&lt;len;i++){handlersForEvent[i].call(this,e||fabric.window.event)}}}}var shouldUseAddListenerRemoveListener=areHostMethods(fabric.document.documentElement,&quot;addEventListener&quot;,&quot;removeEventListener&quot;)&amp;&amp;areHostMethods(fabric.window,&quot;addEventListener&quot;,&quot;removeEventListener&quot;),shouldUseAttachEventDetachEvent=areHostMethods(fabric.document.documentElement,&quot;attachEvent&quot;,&quot;detachEvent&quot;)&amp;&amp;areHostMethods(fabric.window,&quot;attachEvent&quot;,&quot;detachEvent&quot;),listeners={},handlers={},addListener,removeListener;if(shouldUseAddListenerRemoveListener){addListener=function(element,eventName,handler){element.addEventListener(eventName,handler,false)};removeListener=function(element,eventName,handler){element.removeEventListener(eventName,handler,false)}}else if(shouldUseAttachEventDetachEvent){addListener=function(element,eventName,handler){var uid=getUniqueId(element);setElement(uid,element);if(!listeners[uid]){listeners[uid]={}}if(!listeners[uid][eventName]){listeners[uid][eventName]=[]}var listener=createListener(uid,handler);listeners[uid][eventName].push(listener);element.attachEvent(&quot;on&quot;+eventName,listener.wrappedHandler)};removeListener=function(element,eventName,handler){var uid=getUniqueId(element),listener;if(listeners[uid]&amp;&amp;listeners[uid][eventName]){for(var i=0,len=listeners[uid][eventName].length;i&lt;len;i++){listener=listeners[uid][eventName][i];if(listener&amp;&amp;listener.handler===handler){element.detachEvent(&quot;on&quot;+eventName,listener.wrappedHandler);listeners[uid][eventName][i]=null}}}}}else{addListener=function(element,eventName,handler){var uid=getUniqueId(element);if(!handlers[uid]){handlers[uid]={}}if(!handlers[uid][eventName]){handlers[uid][eventName]=[];var existingHandler=element[&quot;on&quot;+eventName];if(existingHandler){handlers[uid][eventName].push(existingHandler)}element[&quot;on&quot;+eventName]=createDispatcher(uid,eventName)}handlers[uid][eventName].push(handler)};removeListener=function(element,eventName,handler){var uid=getUniqueId(element);if(handlers[uid]&amp;&amp;handlers[uid][eventName]){var handlersForEvent=handlers[uid][eventName];for(var i=0,len=handlersForEvent.length;i&lt;len;i++){if(handlersForEvent[i]===handler){handlersForEvent.splice(i,1)}}}}}fabric.util.addListener=addListener;fabric.util.removeListener=removeListener;function getPointer(event){event||(event=fabric.window.event);var element=event.target||(typeof event.srcElement!==unknown?event.srcElement:null),scroll=fabric.util.getScrollLeftTop(element);return{x:pointerX(event)+scroll.left,y:pointerY(event)+scroll.top}}var pointerX=function(event){return typeof event.clientX!==unknown?event.clientX:0},pointerY=function(event){return typeof event.clientY!==unknown?event.clientY:0};function _getPointer(event,pageProp,clientProp){var touchProp=event.type===&quot;touchend&quot;?&quot;changedTouches&quot;:&quot;touches&quot;;return event[touchProp]&amp;&amp;event[touchProp][0]?event[touchProp][0][pageProp]-(event[touchProp][0][pageProp]-event[touchProp][0][clientProp])||event[clientProp]:event[clientProp]}if(fabric.isTouchSupported){pointerX=function(event){return _getPointer(event,&quot;pageX&quot;,&quot;clientX&quot;)};pointerY=function(event){return _getPointer(event,&quot;pageY&quot;,&quot;clientY&quot;)}}fabric.util.getPointer=getPointer;fabric.util.object.extend(fabric.util,fabric.Observable)})();(function(){function setStyle(element,styles){var elementStyle=element.style;if(!elementStyle){return element}if(typeof styles===&quot;string&quot;){element.style.cssText+=&quot;;&quot;+styles;return styles.indexOf(&quot;opacity&quot;)&gt;-1?setOpacity(element,styles.match(/opacity:\s*(\d?\.?\d*)/)[1]):element}for(var property in styles){if(property===&quot;opacity&quot;){setOpacity(element,styles[property])}else{var normalizedProperty=property===&quot;float&quot;||property===&quot;cssFloat&quot;?typeof elementStyle.styleFloat===&quot;undefined&quot;?&quot;cssFloat&quot;:&quot;styleFloat&quot;:property;elementStyle[normalizedProperty]=styles[property]}}return element}var parseEl=fabric.document.createElement(&quot;div&quot;),supportsOpacity=typeof parseEl.style.opacity===&quot;string&quot;,supportsFilters=typeof parseEl.style.filter===&quot;string&quot;,reOpacity=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,setOpacity=function(element){return element};if(supportsOpacity){setOpacity=function(element,value){element.style.opacity=value;return element}}else if(supportsFilters){setOpacity=function(element,value){var es=element.style;if(element.currentStyle&amp;&amp;!element.currentStyle.hasLayout){es.zoom=1}if(reOpacity.test(es.filter)){value=value&gt;=.9999?&quot;&quot;:&quot;alpha(opacity=&quot;+value*100+&quot;)&quot;;es.filter=es.filter.replace(reOpacity,value)}else{es.filter+=&quot; alpha(opacity=&quot;+value*100+&quot;)&quot;}return element}}fabric.util.setStyle=setStyle})();(function(){var _slice=Array.prototype.slice;function getById(id){return typeof id===&quot;string&quot;?fabric.document.getElementById(id):id}var sliceCanConvertNodelists,toArray=function(arrayLike){return _slice.call(arrayLike,0)};try{sliceCanConvertNodelists=toArray(fabric.document.childNodes)instanceof Array}catch(err){}if(!sliceCanConvertNodelists){toArray=function(arrayLike){var arr=new Array(arrayLike.length),i=arrayLike.length;while(i--){arr[i]=arrayLike[i]}return arr}}function makeElement(tagName,attributes){var el=fabric.document.createElement(tagName);for(var prop in attributes){if(prop===&quot;class&quot;){el.className=attributes[prop]}else if(prop===&quot;for&quot;){el.htmlFor=attributes[prop]}else{el.setAttribute(prop,attributes[prop])}}return el}function addClass(element,className){if(element&amp;&amp;(&quot; &quot;+element.className+&quot; &quot;).indexOf(&quot; &quot;+className+&quot; &quot;)===-1){element.className+=(element.className?&quot; &quot;:&quot;&quot;)+className}}function wrapElement(element,wrapper,attributes){if(typeof wrapper===&quot;string&quot;){wrapper=makeElement(wrapper,attributes)}if(element.parentNode){element.parentNode.replaceChild(wrapper,element)}wrapper.appendChild(element);return wrapper}function getScrollLeftTop(element){var left=0,top=0,docElement=fabric.document.documentElement,body=fabric.document.body||{scrollLeft:0,scrollTop:0};while(element&amp;&amp;(element.parentNode||element.host)){element=element.parentNode||element.host;if(element===fabric.document){left=body.scrollLeft||docElement.scrollLeft||0;top=body.scrollTop||docElement.scrollTop||0}else{left+=element.scrollLeft||0;top+=element.scrollTop||0}if(element.nodeType===1&amp;&amp;fabric.util.getElementStyle(element,&quot;position&quot;)===&quot;fixed&quot;){break}}return{left:left,top:top}}function getElementOffset(element){var docElem,doc=element&amp;&amp;element.ownerDocument,box={left:0,top:0},offset={left:0,top:0},scrollLeftTop,offsetAttributes={borderLeftWidth:&quot;left&quot;,borderTopWidth:&quot;top&quot;,paddingLeft:&quot;left&quot;,paddingTop:&quot;top&quot;};if(!doc){return offset}for(var attr in offsetAttributes){offset[offsetAttributes[attr]]+=parseInt(getElementStyle(element,attr),10)||0}docElem=doc.documentElement;if(typeof element.getBoundingClientRect!==&quot;undefined&quot;){box=element.getBoundingClientRect()}scrollLeftTop=getScrollLeftTop(element);return{left:box.left+scrollLeftTop.left-(docElem.clientLeft||0)+offset.left,top:box.top+scrollLeftTop.top-(docElem.clientTop||0)+offset.top}}var getElementStyle;if(fabric.document.defaultView&amp;&amp;fabric.document.defaultView.getComputedStyle){getElementStyle=function(element,attr){var style=fabric.document.defaultView.getComputedStyle(element,null);return style?style[attr]:undefined}}else{getElementStyle=function(element,attr){var value=element.style[attr];if(!value&amp;&amp;element.currentStyle){value=element.currentStyle[attr]}return value}}(function(){var style=fabric.document.documentElement.style,selectProp=&quot;userSelect&quot;in style?&quot;userSelect&quot;:&quot;MozUserSelect&quot;in style?&quot;MozUserSelect&quot;:&quot;WebkitUserSelect&quot;in style?&quot;WebkitUserSelect&quot;:&quot;KhtmlUserSelect&quot;in style?&quot;KhtmlUserSelect&quot;:&quot;&quot;;function makeElementUnselectable(element){if(typeof element.onselectstart!==&quot;undefined&quot;){element.onselectstart=fabric.util.falseFunction}if(selectProp){element.style[selectProp]=&quot;none&quot;}else if(typeof element.unselectable===&quot;string&quot;){element.unselectable=&quot;on&quot;}return element}function makeElementSelectable(element){if(typeof element.onselectstart!==&quot;undefined&quot;){element.onselectstart=null}if(selectProp){element.style[selectProp]=&quot;&quot;}else if(typeof element.unselectable===&quot;string&quot;){element.unselectable=&quot;&quot;}return element}fabric.util.makeElementUnselectable=makeElementUnselectable;fabric.util.makeElementSelectable=makeElementSelectable})();(function(){function getScript(url,callback){var headEl=fabric.document.getElementsByTagName(&quot;head&quot;)[0],scriptEl=fabric.document.createElement(&quot;script&quot;),loading=true;scriptEl.onload=scriptEl.onreadystatechange=function(e){if(loading){if(typeof this.readyState===&quot;string&quot;&amp;&amp;this.readyState!==&quot;loaded&quot;&amp;&amp;this.readyState!==&quot;complete&quot;){return}loading=false;callback(e||fabric.window.event);scriptEl=scriptEl.onload=scriptEl.onreadystatechange=null}};scriptEl.src=url;headEl.appendChild(scriptEl)}fabric.util.getScript=getScript})();fabric.util.getById=getById;fabric.util.toArray=toArray;fabric.util.makeElement=makeElement;fabric.util.addClass=addClass;fabric.util.wrapElement=wrapElement;fabric.util.getScrollLeftTop=getScrollLeftTop;fabric.util.getElementOffset=getElementOffset;fabric.util.getElementStyle=getElementStyle})();(function(){function addParamToUrl(url,param){return url+(/\?/.test(url)?&quot;&amp;&quot;:&quot;?&quot;)+param}var makeXHR=function(){var factories=[function(){return new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;)},function(){return new ActiveXObject(&quot;Msxml2.XMLHTTP&quot;)},function(){return new ActiveXObject(&quot;Msxml2.XMLHTTP.3.0&quot;)},function(){return new XMLHttpRequest}];for(var i=factories.length;i--;){try{var req=factories[i]();if(req){return factories[i]}}catch(err){}}}();function emptyFn(){}function request(url,options){options||(options={});var method=options.method?options.method.toUpperCase():&quot;GET&quot;,onComplete=options.onComplete||function(){},xhr=makeXHR(),body;</td>
      </tr>
      <tr>
        <td id="L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="LC2" class="blob-code blob-code-inner js-file-line">xhr.onreadystatechange=function(){if(xhr.readyState===4){onComplete(xhr);xhr.onreadystatechange=emptyFn}};if(method===&quot;GET&quot;){body=null;if(typeof options.parameters===&quot;string&quot;){url=addParamToUrl(url,options.parameters)}}xhr.open(method,url,true);if(method===&quot;POST&quot;||method===&quot;PUT&quot;){xhr.setRequestHeader(&quot;Content-Type&quot;,&quot;application/x-www-form-urlencoded&quot;)}xhr.send(body);return xhr}fabric.util.request=request})();fabric.log=function(){};fabric.warn=function(){};if(typeof console!==&quot;undefined&quot;){[&quot;log&quot;,&quot;warn&quot;].forEach(function(methodName){if(typeof console[methodName]!==&quot;undefined&quot;&amp;&amp;typeof console[methodName].apply===&quot;function&quot;){fabric[methodName]=function(){return console[methodName].apply(console,arguments)}}})}(function(){function animate(options){requestAnimFrame(function(timestamp){options||(options={});var start=timestamp||+new Date,duration=options.duration||500,finish=start+duration,time,onChange=options.onChange||function(){},abort=options.abort||function(){return false},easing=options.easing||function(t,b,c,d){return-c*Math.cos(t/d*(Math.PI/2))+c+b},startValue=&quot;startValue&quot;in options?options.startValue:0,endValue=&quot;endValue&quot;in options?options.endValue:100,byValue=options.byValue||endValue-startValue;options.onStart&amp;&amp;options.onStart();(function tick(ticktime){time=ticktime||+new Date;var currentTime=time&gt;finish?duration:time-start;if(abort()){options.onComplete&amp;&amp;options.onComplete();return}onChange(easing(currentTime,startValue,byValue,duration));if(time&gt;finish){options.onComplete&amp;&amp;options.onComplete();return}requestAnimFrame(tick)})(start)})}var _requestAnimFrame=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(callback){fabric.window.setTimeout(callback,1e3/60)};function requestAnimFrame(){return _requestAnimFrame.apply(fabric.window,arguments)}fabric.util.animate=animate;fabric.util.requestAnimFrame=requestAnimFrame})();(function(){function normalize(a,c,p,s){if(a&lt;Math.abs(c)){a=c;s=p/4}else{if(c===0&amp;&amp;a===0){s=p/(2*Math.PI)*Math.asin(1)}else{s=p/(2*Math.PI)*Math.asin(c/a)}}return{a:a,c:c,p:p,s:s}}function elastic(opts,t,d){return opts.a*Math.pow(2,10*(t-=1))*Math.sin((t*d-opts.s)*(2*Math.PI)/opts.p)}function easeOutCubic(t,b,c,d){return c*((t=t/d-1)*t*t+1)+b}function easeInOutCubic(t,b,c,d){t/=d/2;if(t&lt;1){return c/2*t*t*t+b}return c/2*((t-=2)*t*t+2)+b}function easeInQuart(t,b,c,d){return c*(t/=d)*t*t*t+b}function easeOutQuart(t,b,c,d){return-c*((t=t/d-1)*t*t*t-1)+b}function easeInOutQuart(t,b,c,d){t/=d/2;if(t&lt;1){return c/2*t*t*t*t+b}return-c/2*((t-=2)*t*t*t-2)+b}function easeInQuint(t,b,c,d){return c*(t/=d)*t*t*t*t+b}function easeOutQuint(t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b}function easeInOutQuint(t,b,c,d){t/=d/2;if(t&lt;1){return c/2*t*t*t*t*t+b}return c/2*((t-=2)*t*t*t*t+2)+b}function easeInSine(t,b,c,d){return-c*Math.cos(t/d*(Math.PI/2))+c+b}function easeOutSine(t,b,c,d){return c*Math.sin(t/d*(Math.PI/2))+b}function easeInOutSine(t,b,c,d){return-c/2*(Math.cos(Math.PI*t/d)-1)+b}function easeInExpo(t,b,c,d){return t===0?b:c*Math.pow(2,10*(t/d-1))+b}function easeOutExpo(t,b,c,d){return t===d?b+c:c*(-Math.pow(2,-10*t/d)+1)+b}function easeInOutExpo(t,b,c,d){if(t===0){return b}if(t===d){return b+c}t/=d/2;if(t&lt;1){return c/2*Math.pow(2,10*(t-1))+b}return c/2*(-Math.pow(2,-10*--t)+2)+b}function easeInCirc(t,b,c,d){return-c*(Math.sqrt(1-(t/=d)*t)-1)+b}function easeOutCirc(t,b,c,d){return c*Math.sqrt(1-(t=t/d-1)*t)+b}function easeInOutCirc(t,b,c,d){t/=d/2;if(t&lt;1){return-c/2*(Math.sqrt(1-t*t)-1)+b}return c/2*(Math.sqrt(1-(t-=2)*t)+1)+b}function easeInElastic(t,b,c,d){var s=1.70158,p=0,a=c;if(t===0){return b}t/=d;if(t===1){return b+c}if(!p){p=d*.3}var opts=normalize(a,c,p,s);return-elastic(opts,t,d)+b}function easeOutElastic(t,b,c,d){var s=1.70158,p=0,a=c;if(t===0){return b}t/=d;if(t===1){return b+c}if(!p){p=d*.3}var opts=normalize(a,c,p,s);return opts.a*Math.pow(2,-10*t)*Math.sin((t*d-opts.s)*(2*Math.PI)/opts.p)+opts.c+b}function easeInOutElastic(t,b,c,d){var s=1.70158,p=0,a=c;if(t===0){return b}t/=d/2;if(t===2){return b+c}if(!p){p=d*(.3*1.5)}var opts=normalize(a,c,p,s);if(t&lt;1){return-.5*elastic(opts,t,d)+b}return opts.a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-opts.s)*(2*Math.PI)/opts.p)*.5+opts.c+b}function easeInBack(t,b,c,d,s){if(s===undefined){s=1.70158}return c*(t/=d)*t*((s+1)*t-s)+b}function easeOutBack(t,b,c,d,s){if(s===undefined){s=1.70158}return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b}function easeInOutBack(t,b,c,d,s){if(s===undefined){s=1.70158}t/=d/2;if(t&lt;1){return c/2*(t*t*(((s*=1.525)+1)*t-s))+b}return c/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+b}function easeInBounce(t,b,c,d){return c-easeOutBounce(d-t,0,c,d)+b}function easeOutBounce(t,b,c,d){if((t/=d)&lt;1/2.75){return c*(7.5625*t*t)+b}else if(t&lt;2/2.75){return c*(7.5625*(t-=1.5/2.75)*t+.75)+b}else if(t&lt;2.5/2.75){return c*(7.5625*(t-=2.25/2.75)*t+.9375)+b}else{return c*(7.5625*(t-=2.625/2.75)*t+.984375)+b}}function easeInOutBounce(t,b,c,d){if(t&lt;d/2){return easeInBounce(t*2,0,c,d)*.5+b}return easeOutBounce(t*2-d,0,c,d)*.5+c*.5+b}fabric.util.ease={easeInQuad:function(t,b,c,d){return c*(t/=d)*t+b},easeOutQuad:function(t,b,c,d){return-c*(t/=d)*(t-2)+b},easeInOutQuad:function(t,b,c,d){t/=d/2;if(t&lt;1){return c/2*t*t+b}return-c/2*(--t*(t-2)-1)+b},easeInCubic:function(t,b,c,d){return c*(t/=d)*t*t+b},easeOutCubic:easeOutCubic,easeInOutCubic:easeInOutCubic,easeInQuart:easeInQuart,easeOutQuart:easeOutQuart,easeInOutQuart:easeInOutQuart,easeInQuint:easeInQuint,easeOutQuint:easeOutQuint,easeInOutQuint:easeInOutQuint,easeInSine:easeInSine,easeOutSine:easeOutSine,easeInOutSine:easeInOutSine,easeInExpo:easeInExpo,easeOutExpo:easeOutExpo,easeInOutExpo:easeInOutExpo,easeInCirc:easeInCirc,easeOutCirc:easeOutCirc,easeInOutCirc:easeInOutCirc,easeInElastic:easeInElastic,easeOutElastic:easeOutElastic,easeInOutElastic:easeInOutElastic,easeInBack:easeInBack,easeOutBack:easeOutBack,easeInOutBack:easeInOutBack,easeInBounce:easeInBounce,easeOutBounce:easeOutBounce,easeInOutBounce:easeInOutBounce}})();(function(global){&quot;use strict&quot;;var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,capitalize=fabric.util.string.capitalize,clone=fabric.util.object.clone,toFixed=fabric.util.toFixed,parseUnit=fabric.util.parseUnit,multiplyTransformMatrices=fabric.util.multiplyTransformMatrices,reAllowedSVGTagNames=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/i,reViewBoxTagNames=/^(symbol|image|marker|pattern|view|svg)$/i,reNotAllowedAncestors=/^(?:pattern|defs|symbol|metadata)$/i,reAllowedParents=/^(symbol|g|a|svg)$/i,attributesMap={cx:&quot;left&quot;,x:&quot;left&quot;,r:&quot;radius&quot;,cy:&quot;top&quot;,y:&quot;top&quot;,display:&quot;visible&quot;,visibility:&quot;visible&quot;,transform:&quot;transformMatrix&quot;,&quot;fill-opacity&quot;:&quot;fillOpacity&quot;,&quot;fill-rule&quot;:&quot;fillRule&quot;,&quot;font-family&quot;:&quot;fontFamily&quot;,&quot;font-size&quot;:&quot;fontSize&quot;,&quot;font-style&quot;:&quot;fontStyle&quot;,&quot;font-weight&quot;:&quot;fontWeight&quot;,&quot;stroke-dasharray&quot;:&quot;strokeDashArray&quot;,&quot;stroke-linecap&quot;:&quot;strokeLineCap&quot;,&quot;stroke-linejoin&quot;:&quot;strokeLineJoin&quot;,&quot;stroke-miterlimit&quot;:&quot;strokeMiterLimit&quot;,&quot;stroke-opacity&quot;:&quot;strokeOpacity&quot;,&quot;stroke-width&quot;:&quot;strokeWidth&quot;,&quot;text-decoration&quot;:&quot;textDecoration&quot;,&quot;text-anchor&quot;:&quot;originX&quot;},colorAttributes={stroke:&quot;strokeOpacity&quot;,fill:&quot;fillOpacity&quot;};fabric.cssRules={};fabric.gradientDefs={};function normalizeAttr(attr){if(attr in attributesMap){return attributesMap[attr]}return attr}function normalizeValue(attr,value,parentAttributes,fontSize){var isArray=Object.prototype.toString.call(value)===&quot;[object Array]&quot;,parsed;if((attr===&quot;fill&quot;||attr===&quot;stroke&quot;)&amp;&amp;value===&quot;none&quot;){value=&quot;&quot;}else if(attr===&quot;strokeDashArray&quot;){value=value.replace(/,/g,&quot; &quot;).split(/\s+/).map(function(n){return parseFloat(n)})}else if(attr===&quot;transformMatrix&quot;){if(parentAttributes&amp;&amp;parentAttributes.transformMatrix){value=multiplyTransformMatrices(parentAttributes.transformMatrix,fabric.parseTransformAttribute(value))}else{value=fabric.parseTransformAttribute(value)}}else if(attr===&quot;visible&quot;){value=value===&quot;none&quot;||value===&quot;hidden&quot;?false:true;if(parentAttributes&amp;&amp;parentAttributes.visible===false){value=false}}else if(attr===&quot;originX&quot;){value=value===&quot;start&quot;?&quot;left&quot;:value===&quot;end&quot;?&quot;right&quot;:&quot;center&quot;}else{parsed=isArray?value.map(parseUnit):parseUnit(value,fontSize)}return!isArray&amp;&amp;isNaN(parsed)?value:parsed}function _setStrokeFillOpacity(attributes){for(var attr in colorAttributes){if(typeof attributes[colorAttributes[attr]]===&quot;undefined&quot;||attributes[attr]===&quot;&quot;){continue}if(typeof attributes[attr]===&quot;undefined&quot;){if(!fabric.Object.prototype[attr]){continue}attributes[attr]=fabric.Object.prototype[attr]}if(attributes[attr].indexOf(&quot;url(&quot;)===0){continue}var color=new fabric.Color(attributes[attr]);attributes[attr]=color.setAlpha(toFixed(color.getAlpha()*attributes[colorAttributes[attr]],2)).toRgba()}return attributes}fabric.parseTransformAttribute=function(){function rotateMatrix(matrix,args){var angle=args[0],x=args.length===3?args[1]:0,y=args.length===3?args[2]:0;matrix[0]=Math.cos(angle);matrix[1]=Math.sin(angle);matrix[2]=-Math.sin(angle);matrix[3]=Math.cos(angle);matrix[4]=x-(matrix[0]*x+matrix[2]*y);matrix[5]=y-(matrix[1]*x+matrix[3]*y)}function scaleMatrix(matrix,args){var multiplierX=args[0],multiplierY=args.length===2?args[1]:args[0];matrix[0]=multiplierX;matrix[3]=multiplierY}function skewXMatrix(matrix,args){matrix[2]=Math.tan(fabric.util.degreesToRadians(args[0]))}function skewYMatrix(matrix,args){matrix[1]=Math.tan(fabric.util.degreesToRadians(args[0]))}function translateMatrix(matrix,args){matrix[4]=args[0];if(args.length===2){matrix[5]=args[1]}}var iMatrix=[1,0,0,1,0,0],number=fabric.reNum,commaWsp=&quot;(?:\\s+,?\\s*|,\\s*)&quot;,skewX=&quot;(?:(skewX)\\s*\\(\\s*(&quot;+number+&quot;)\\s*\\))&quot;,skewY=&quot;(?:(skewY)\\s*\\(\\s*(&quot;+number+&quot;)\\s*\\))&quot;,rotate=&quot;(?:(rotate)\\s*\\(\\s*(&quot;+number+&quot;)(?:&quot;+commaWsp+&quot;(&quot;+number+&quot;)&quot;+commaWsp+&quot;(&quot;+number+&quot;))?\\s*\\))&quot;,scale=&quot;(?:(scale)\\s*\\(\\s*(&quot;+number+&quot;)(?:&quot;+commaWsp+&quot;(&quot;+number+&quot;))?\\s*\\))&quot;,translate=&quot;(?:(translate)\\s*\\(\\s*(&quot;+number+&quot;)(?:&quot;+commaWsp+&quot;(&quot;+number+&quot;))?\\s*\\))&quot;,matrix=&quot;(?:(matrix)\\s*\\(\\s*&quot;+&quot;(&quot;+number+&quot;)&quot;+commaWsp+&quot;(&quot;+number+&quot;)&quot;+commaWsp+&quot;(&quot;+number+&quot;)&quot;+commaWsp+&quot;(&quot;+number+&quot;)&quot;+commaWsp+&quot;(&quot;+number+&quot;)&quot;+commaWsp+&quot;(&quot;+number+&quot;)&quot;+&quot;\\s*\\))&quot;,transform=&quot;(?:&quot;+matrix+&quot;|&quot;+translate+&quot;|&quot;+scale+&quot;|&quot;+rotate+&quot;|&quot;+skewX+&quot;|&quot;+skewY+&quot;)&quot;,transforms=&quot;(?:&quot;+transform+&quot;(?:&quot;+commaWsp+&quot;*&quot;+transform+&quot;)*&quot;+&quot;)&quot;,transformList=&quot;^\\s*(?:&quot;+transforms+&quot;?)\\s*$&quot;,reTransformList=new RegExp(transformList),reTransform=new RegExp(transform,&quot;g&quot;);return function(attributeValue){var matrix=iMatrix.concat(),matrices=[];if(!attributeValue||attributeValue&amp;&amp;!reTransformList.test(attributeValue)){return matrix}attributeValue.replace(reTransform,function(match){var m=new RegExp(transform).exec(match).filter(function(match){return match!==&quot;&quot;&amp;&amp;match!=null}),operation=m[1],args=m.slice(2).map(parseFloat);switch(operation){case&quot;translate&quot;:translateMatrix(matrix,args);break;case&quot;rotate&quot;:args[0]=fabric.util.degreesToRadians(args[0]);rotateMatrix(matrix,args);break;case&quot;scale&quot;:scaleMatrix(matrix,args);break;case&quot;skewX&quot;:skewXMatrix(matrix,args);break;case&quot;skewY&quot;:skewYMatrix(matrix,args);break;case&quot;matrix&quot;:matrix=args;break}matrices.push(matrix.concat());matrix=iMatrix.concat()});var combinedMatrix=matrices[0];while(matrices.length&gt;1){matrices.shift();combinedMatrix=fabric.util.multiplyTransformMatrices(combinedMatrix,matrices[0])}return combinedMatrix}}();function parseStyleString(style,oStyle){var attr,value;style.replace(/;\s*$/,&quot;&quot;).split(&quot;;&quot;).forEach(function(chunk){var pair=chunk.split(&quot;:&quot;);attr=normalizeAttr(pair[0].trim().toLowerCase());value=normalizeValue(attr,pair[1].trim());oStyle[attr]=value})}function parseStyleObject(style,oStyle){var attr,value;for(var prop in style){if(typeof style[prop]===&quot;undefined&quot;){continue}attr=normalizeAttr(prop.toLowerCase());value=normalizeValue(attr,style[prop]);oStyle[attr]=value}}function getGlobalStylesForElement(element,svgUid){var styles={};for(var rule in fabric.cssRules[svgUid]){if(elementMatchesRule(element,rule.split(&quot; &quot;))){for(var property in fabric.cssRules[svgUid][rule]){styles[property]=fabric.cssRules[svgUid][rule][property]}}}return styles}function elementMatchesRule(element,selectors){var firstMatching,parentMatching=true;firstMatching=selectorMatches(element,selectors.pop());if(firstMatching&amp;&amp;selectors.length){parentMatching=doesSomeParentMatch(element,selectors)}return firstMatching&amp;&amp;parentMatching&amp;&amp;selectors.length===0}function doesSomeParentMatch(element,selectors){var selector,parentMatching=true;while(element.parentNode&amp;&amp;element.parentNode.nodeType===1&amp;&amp;selectors.length){if(parentMatching){selector=selectors.pop()}element=element.parentNode;parentMatching=selectorMatches(element,selector)}return selectors.length===0}function selectorMatches(element,selector){var nodeName=element.nodeName,classNames=element.getAttribute(&quot;class&quot;),id=element.getAttribute(&quot;id&quot;),matcher;matcher=new RegExp(&quot;^&quot;+nodeName,&quot;i&quot;);selector=selector.replace(matcher,&quot;&quot;);if(id&amp;&amp;selector.length){matcher=new RegExp(&quot;#&quot;+id+&quot;(?![a-zA-Z\\-]+)&quot;,&quot;i&quot;);selector=selector.replace(matcher,&quot;&quot;)}if(classNames&amp;&amp;selector.length){classNames=classNames.split(&quot; &quot;);for(var i=classNames.length;i--;){matcher=new RegExp(&quot;\\.&quot;+classNames[i]+&quot;(?![a-zA-Z\\-]+)&quot;,&quot;i&quot;);selector=selector.replace(matcher,&quot;&quot;)}}return selector.length===0}function elementById(doc,id){var el;doc.getElementById&amp;&amp;(el=doc.getElementById(id));if(el){return el}var node,i,nodelist=doc.getElementsByTagName(&quot;*&quot;);for(i=0;i&lt;nodelist.length;i++){node=nodelist[i];if(id===node.getAttribute(&quot;id&quot;)){return node}}}function parseUseDirectives(doc){var nodelist=doc.getElementsByTagName(&quot;use&quot;),i=0;while(nodelist.length&amp;&amp;i&lt;nodelist.length){var el=nodelist[i],xlink=el.getAttribute(&quot;xlink:href&quot;).substr(1),x=el.getAttribute(&quot;x&quot;)||0,y=el.getAttribute(&quot;y&quot;)||0,el2=elementById(doc,xlink).cloneNode(true),currentTrans=(el2.getAttribute(&quot;transform&quot;)||&quot;&quot;)+&quot; translate(&quot;+x+&quot;, &quot;+y+&quot;)&quot;,parentNode,oldLength=nodelist.length,attr,j,attrs,l;applyViewboxTransform(el2);if(/^svg$/i.test(el2.nodeName)){var el3=el2.ownerDocument.createElement(&quot;g&quot;);for(j=0,attrs=el2.attributes,l=attrs.length;j&lt;l;j++){attr=attrs.item(j);el3.setAttribute(attr.nodeName,attr.nodeValue)}while(el2.firstChild!=null){el3.appendChild(el2.firstChild)}el2=el3}for(j=0,attrs=el.attributes,l=attrs.length;j&lt;l;j++){attr=attrs.item(j);if(attr.nodeName===&quot;x&quot;||attr.nodeName===&quot;y&quot;||attr.nodeName===&quot;xlink:href&quot;){continue}if(attr.nodeName===&quot;transform&quot;){currentTrans=attr.nodeValue+&quot; &quot;+currentTrans}else{el2.setAttribute(attr.nodeName,attr.nodeValue)}}el2.setAttribute(&quot;transform&quot;,currentTrans);el2.setAttribute(&quot;instantiated_by_use&quot;,&quot;1&quot;);el2.removeAttribute(&quot;id&quot;);parentNode=el.parentNode;parentNode.replaceChild(el2,el);if(nodelist.length===oldLength){i++}}}var reViewBoxAttrValue=new RegExp(&quot;^&quot;+&quot;\\s*(&quot;+fabric.reNum+&quot;+)\\s*,?&quot;+&quot;\\s*(&quot;+fabric.reNum+&quot;+)\\s*,?&quot;+&quot;\\s*(&quot;+fabric.reNum+&quot;+)\\s*,?&quot;+&quot;\\s*(&quot;+fabric.reNum+&quot;+)\\s*&quot;+&quot;$&quot;);function applyViewboxTransform(element){var viewBoxAttr=element.getAttribute(&quot;viewBox&quot;),scaleX=1,scaleY=1,minX=0,minY=0,viewBoxWidth,viewBoxHeight,matrix,el,widthAttr=element.getAttribute(&quot;width&quot;),heightAttr=element.getAttribute(&quot;height&quot;),x=element.getAttribute(&quot;x&quot;)||0,y=element.getAttribute(&quot;y&quot;)||0,preserveAspectRatio=element.getAttribute(&quot;preserveAspectRatio&quot;)||&quot;&quot;,missingViewBox=!viewBoxAttr||!reViewBoxTagNames.test(element.tagName)||!(viewBoxAttr=viewBoxAttr.match(reViewBoxAttrValue)),missingDimAttr=!widthAttr||!heightAttr||widthAttr===&quot;100%&quot;||heightAttr===&quot;100%&quot;,toBeParsed=missingViewBox&amp;&amp;missingDimAttr,parsedDim={},translateMatrix=&quot;&quot;;parsedDim.width=0;parsedDim.height=0;parsedDim.toBeParsed=toBeParsed;if(toBeParsed){return parsedDim}if(missingViewBox){parsedDim.width=parseUnit(widthAttr);parsedDim.height=parseUnit(heightAttr);return parsedDim}minX=-parseFloat(viewBoxAttr[1]),minY=-parseFloat(viewBoxAttr[2]),viewBoxWidth=parseFloat(viewBoxAttr[3]),viewBoxHeight=parseFloat(viewBoxAttr[4]);if(!missingDimAttr){parsedDim.width=parseUnit(widthAttr);parsedDim.height=parseUnit(heightAttr);scaleX=parsedDim.width/viewBoxWidth;scaleY=parsedDim.height/viewBoxHeight}else{parsedDim.width=viewBoxWidth;parsedDim.height=viewBoxHeight}preserveAspectRatio=fabric.util.parsePreserveAspectRatioAttribute(preserveAspectRatio);if(preserveAspectRatio.alignX!==&quot;none&quot;){scaleY=scaleX=scaleX&gt;scaleY?scaleY:scaleX}if(scaleX===1&amp;&amp;scaleY===1&amp;&amp;minX===0&amp;&amp;minY===0&amp;&amp;x===0&amp;&amp;y===0){return parsedDim}if(x||y){translateMatrix=&quot; translate(&quot;+parseUnit(x)+&quot; &quot;+parseUnit(y)+&quot;) &quot;}matrix=translateMatrix+&quot; matrix(&quot;+scaleX+&quot; 0&quot;+&quot; 0 &quot;+scaleY+&quot; &quot;+minX*scaleX+&quot; &quot;+minY*scaleY+&quot;) &quot;;if(element.tagName===&quot;svg&quot;){el=element.ownerDocument.createElement(&quot;g&quot;);while(element.firstChild!=null){el.appendChild(element.firstChild)}element.appendChild(el)}else{el=element;matrix=el.getAttribute(&quot;transform&quot;)+matrix}el.setAttribute(&quot;transform&quot;,matrix);return parsedDim}fabric.parseSVGDocument=function(){function hasAncestorWithNodeName(element,nodeName){while(element&amp;&amp;(element=element.parentNode)){if(nodeName.test(element.nodeName)&amp;&amp;!element.getAttribute(&quot;instantiated_by_use&quot;)){return true}}return false}return function(doc,callback,reviver){if(!doc){return}parseUseDirectives(doc);var startTime=new Date,svgUid=fabric.Object.__uid++,options=applyViewboxTransform(doc),descendants=fabric.util.toArray(doc.getElementsByTagName(&quot;*&quot;));options.svgUid=svgUid;if(descendants.length===0&amp;&amp;fabric.isLikelyNode){descendants=doc.selectNodes(&#39;//*[name(.)!=&quot;svg&quot;]&#39;);var arr=[];for(var i=0,len=descendants.length;i&lt;len;i++){arr[i]=descendants[i]}descendants=arr}var elements=descendants.filter(function(el){applyViewboxTransform(el);return reAllowedSVGTagNames.test(el.tagName)&amp;&amp;!hasAncestorWithNodeName(el,reNotAllowedAncestors)});if(!elements||elements&amp;&amp;!elements.length){callback&amp;&amp;callback([],{});return}fabric.gradientDefs[svgUid]=fabric.getGradientDefs(doc);fabric.cssRules[svgUid]=fabric.getCSSRules(doc);fabric.parseElements(elements,function(instances){fabric.documentParsingTime=new Date-startTime;if(callback){callback(instances,options)}},clone(options),reviver)}}();var svgCache={has:function(name,callback){callback(false)},get:function(){},set:function(){}};function _enlivenCachedObject(cachedObject){var objects=cachedObject.objects,options=cachedObject.options;objects=objects.map(function(o){return fabric[capitalize(o.type)].fromObject(o)});return{objects:objects,options:options}}function _createSVGPattern(markup,canvas,property){if(canvas[property]&amp;&amp;canvas[property].toSVG){markup.push(&#39;	&lt;pattern x=&quot;0&quot; y=&quot;0&quot; id=&quot;&#39;,property,&#39;Pattern&quot; &#39;,&#39;width=&quot;&#39;,canvas[property].source.width,&#39;&quot; height=&quot;&#39;,canvas[property].source.height,&#39;&quot; patternUnits=&quot;userSpaceOnUse&quot;&gt;\n&#39;,&#39;		&lt;image x=&quot;0&quot; y=&quot;0&quot; &#39;,&#39;width=&quot;&#39;,canvas[property].source.width,&#39;&quot; height=&quot;&#39;,canvas[property].source.height,&#39;&quot; xlink:href=&quot;&#39;,canvas[property].source.src,&#39;&quot;&gt;&lt;/image&gt;\n	&lt;/pattern&gt;\n&#39;)}}var reFontDeclaration=new RegExp(&quot;(normal|italic)?\\s*(normal|small-caps)?\\s*&quot;+&quot;(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*(&quot;+fabric.reNum+&quot;(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|&quot;+fabric.reNum+&quot;))?\\s+(.*)&quot;);extend(fabric,{parseFontDeclaration:function(value,oStyle){var match=value.match(reFontDeclaration);if(!match){return}var fontStyle=match[1],fontWeight=match[3],fontSize=match[4],lineHeight=match[5],fontFamily=match[6];if(fontStyle){oStyle.fontStyle=fontStyle}if(fontWeight){oStyle.fontWeight=isNaN(parseFloat(fontWeight))?fontWeight:parseFloat(fontWeight)}if(fontSize){oStyle.fontSize=parseUnit(fontSize)}if(fontFamily){oStyle.fontFamily=fontFamily}if(lineHeight){oStyle.lineHeight=lineHeight===&quot;normal&quot;?1:lineHeight}},getGradientDefs:function(doc){var linearGradientEls=doc.getElementsByTagName(&quot;linearGradient&quot;),radialGradientEls=doc.getElementsByTagName(&quot;radialGradient&quot;),el,i,j=0,id,xlink,elList=[],gradientDefs={},idsToXlinkMap={};elList.length=linearGradientEls.length+radialGradientEls.length;i=linearGradientEls.length;while(i--){elList[j++]=linearGradientEls[i]}i=radialGradientEls.length;while(i--){elList[j++]=radialGradientEls[i]}while(j--){el=elList[j];xlink=el.getAttribute(&quot;xlink:href&quot;);id=el.getAttribute(&quot;id&quot;);if(xlink){idsToXlinkMap[id]=xlink.substr(1)}gradientDefs[id]=el}for(id in idsToXlinkMap){var el2=gradientDefs[idsToXlinkMap[id]].cloneNode(true);el=gradientDefs[id];while(el2.firstChild){el.appendChild(el2.firstChild)}}return gradientDefs},parseAttributes:function(element,attributes,svgUid){if(!element){return}var value,parentAttributes={},fontSize;if(typeof svgUid===&quot;undefined&quot;){svgUid=element.getAttribute(&quot;svgUid&quot;)}if(element.parentNode&amp;&amp;reAllowedParents.test(element.parentNode.nodeName)){parentAttributes=fabric.parseAttributes(element.parentNode,attributes,svgUid)}fontSize=parentAttributes&amp;&amp;parentAttributes.fontSize||element.getAttribute(&quot;font-size&quot;)||fabric.Text.DEFAULT_SVG_FONT_SIZE;var ownAttributes=attributes.reduce(function(memo,attr){value=element.getAttribute(attr);if(value){attr=normalizeAttr(attr);value=normalizeValue(attr,value,parentAttributes,fontSize);memo[attr]=value}return memo},{});ownAttributes=extend(ownAttributes,extend(getGlobalStylesForElement(element,svgUid),fabric.parseStyleAttribute(element)));if(ownAttributes.font){fabric.parseFontDeclaration(ownAttributes.font,ownAttributes)}return _setStrokeFillOpacity(extend(parentAttributes,ownAttributes))},parseElements:function(elements,callback,options,reviver){new fabric.ElementsParser(elements,callback,options,reviver).parse()},parseStyleAttribute:function(element){var oStyle={},style=element.getAttribute(&quot;style&quot;);if(!style){return oStyle}if(typeof style===&quot;string&quot;){parseStyleString(style,oStyle)}else{parseStyleObject(style,oStyle)}return oStyle},parsePointsAttribute:function(points){if(!points){return null}points=points.replace(/,/g,&quot; &quot;).trim();points=points.split(/\s+/);var parsedPoints=[],i,len;i=0;len=points.length;for(;i&lt;len;i+=2){parsedPoints.push({x:parseFloat(points[i]),y:parseFloat(points[i+1])})}return parsedPoints},getCSSRules:function(doc){var styles=doc.getElementsByTagName(&quot;style&quot;),allRules={},rules;for(var i=0,len=styles.length;i&lt;len;i++){var styleContents=styles[i].textContent||styles[i].text;styleContents=styleContents.replace(/\/\*[\s\S]*?\*\//g,&quot;&quot;);if(styleContents.trim()===&quot;&quot;){continue}rules=styleContents.match(/[^{]*\{[\s\S]*?\}/g);rules=rules.map(function(rule){return rule.trim()});rules.forEach(function(rule){var match=rule.match(/([\s\S]*?)\s*\{([^}]*)\}/),ruleObj={},declaration=match[2].trim(),propertyValuePairs=declaration.replace(/;$/,&quot;&quot;).split(/\s*;\s*/);for(var i=0,len=propertyValuePairs.length;i&lt;len;i++){var pair=propertyValuePairs[i].split(/\s*:\s*/),property=normalizeAttr(pair[0]),value=normalizeValue(property,pair[1],pair[0]);ruleObj[property]=value}rule=match[1];rule.split(&quot;,&quot;).forEach(function(_rule){_rule=_rule.replace(/^svg/i,&quot;&quot;).trim();if(_rule===&quot;&quot;){return}allRules[_rule]=fabric.util.object.clone(ruleObj)})})}return allRules},loadSVGFromURL:function(url,callback,reviver){url=url.replace(/^\n\s*/,&quot;&quot;).trim();svgCache.has(url,function(hasUrl){if(hasUrl){svgCache.get(url,function(value){var enlivedRecord=_enlivenCachedObject(value);callback(enlivedRecord.objects,enlivedRecord.options)})}else{new fabric.util.request(url,{method:&quot;get&quot;,onComplete:onComplete})}});function onComplete(r){var xml=r.responseXML;if(xml&amp;&amp;!xml.documentElement&amp;&amp;fabric.window.ActiveXObject&amp;&amp;r.responseText){xml=new ActiveXObject(&quot;Microsoft.XMLDOM&quot;);xml.async=&quot;false&quot;;xml.loadXML(r.responseText.replace(/&lt;!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?&gt;/i,&quot;&quot;))}if(!xml||!xml.documentElement){callback&amp;&amp;callback(null)}fabric.parseSVGDocument(xml.documentElement,function(results,options){svgCache.set(url,{objects:fabric.util.array.invoke(results,&quot;toObject&quot;),options:options});callback&amp;&amp;callback(results,options)},reviver)}},loadSVGFromString:function(string,callback,reviver){string=string.trim();var doc;if(typeof DOMParser!==&quot;undefined&quot;){var parser=new DOMParser;if(parser&amp;&amp;parser.parseFromString){doc=parser.parseFromString(string,&quot;text/xml&quot;)}}else if(fabric.window.ActiveXObject){doc=new ActiveXObject(&quot;Microsoft.XMLDOM&quot;);doc.async=&quot;false&quot;;doc.loadXML(string.replace(/&lt;!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?&gt;/i,&quot;&quot;))}fabric.parseSVGDocument(doc.documentElement,function(results,options){callback(results,options)},reviver)},createSVGFontFacesMarkup:function(objects){var markup=&quot;&quot;,fontList={},obj,fontFamily,style,row,rowIndex,_char,charIndex,fontPaths=fabric.fontPaths;for(var i=0,len=objects.length;i&lt;len;i++){obj=objects[i];fontFamily=obj.fontFamily;if(obj.type.indexOf(&quot;text&quot;)===-1||fontList[fontFamily]||!fontPaths[fontFamily]){continue}fontList[fontFamily]=true;if(!obj.styles){continue}style=obj.styles;for(rowIndex in style){row=style[rowIndex];for(charIndex in row){_char=row[charIndex];fontFamily=_char.fontFamily;if(!fontList[fontFamily]&amp;&amp;fontPaths[fontFamily]){fontList[fontFamily]=true}}}}for(var j in fontList){markup+=[&quot;		@font-face {\n&quot;,&quot;			font-family: &#39;&quot;,j,&quot;&#39;;\n&quot;,&quot;			src: url(&#39;&quot;,fontPaths[j],&quot;&#39;);\n&quot;,&quot;		}\n&quot;].join(&quot;&quot;)}if(markup){markup=[&#39;	&lt;style type=&quot;text/css&quot;&gt;&#39;,&quot;&lt;![CDATA[\n&quot;,markup,&quot;]]&gt;&quot;,&quot;&lt;/style&gt;\n&quot;].join(&quot;&quot;)}return markup},createSVGRefElementsMarkup:function(canvas){var markup=[];_createSVGPattern(markup,canvas,&quot;backgroundColor&quot;);_createSVGPattern(markup,canvas,&quot;overlayColor&quot;);return markup.join(&quot;&quot;)}})})(typeof exports!==&quot;undefined&quot;?exports:this);fabric.ElementsParser=function(elements,callback,options,reviver){this.elements=elements;this.callback=callback;this.options=options;this.reviver=reviver;this.svgUid=options&amp;&amp;options.svgUid||0};fabric.ElementsParser.prototype.parse=function(){this.instances=new Array(this.elements.length);this.numElements=this.elements.length;this.createObjects()};fabric.ElementsParser.prototype.createObjects=function(){for(var i=0,len=this.elements.length;i&lt;len;i++){this.elements[i].setAttribute(&quot;svgUid&quot;,this.svgUid);(function(_this,i){setTimeout(function(){_this.createObject(_this.elements[i],i)},0)})(this,i)}};fabric.ElementsParser.prototype.createObject=function(el,index){var klass=fabric[fabric.util.string.capitalize(el.tagName)];if(klass&amp;&amp;klass.fromElement){try{this._createObject(klass,el,index)}catch(err){fabric.log(err)}}else{this.checkIfDone()}};fabric.ElementsParser.prototype._createObject=function(klass,el,index){if(klass.async){klass.fromElement(el,this.createCallback(index,el),this.options)}else{var obj=klass.fromElement(el,this.options);this.resolveGradient(obj,&quot;fill&quot;);this.resolveGradient(obj,&quot;stroke&quot;);this.reviver&amp;&amp;this.reviver(el,obj);this.instances[index]=obj;this.checkIfDone()}};fabric.ElementsParser.prototype.createCallback=function(index,el){var _this=this;return function(obj){_this.resolveGradient(obj,&quot;fill&quot;);_this.resolveGradient(obj,&quot;stroke&quot;);_this.reviver&amp;&amp;_this.reviver(el,obj);_this.instances[index]=obj;_this.checkIfDone()}};fabric.ElementsParser.prototype.resolveGradient=function(obj,property){var instanceFillValue=obj.get(property);if(!/^url\(/.test(instanceFillValue)){return}var gradientId=instanceFillValue.slice(5,instanceFillValue.length-1);if(fabric.gradientDefs[this.svgUid][gradientId]){obj.set(property,fabric.Gradient.fromElement(fabric.gradientDefs[this.svgUid][gradientId],obj))}};fabric.ElementsParser.prototype.checkIfDone=function(){if(--this.numElements===0){this.instances=this.instances.filter(function(el){return el!=null});this.callback(this.instances)}};(function(global){&quot;use strict&quot;;var fabric=global.fabric||(global.fabric={});if(fabric.Point){fabric.warn(&quot;fabric.Point is already defined&quot;);return}fabric.Point=Point;function Point(x,y){this.x=x;this.y=y}Point.prototype={constructor:Point,add:function(that){return new Point(this.x+that.x,this.y+that.y)},addEquals:function(that){this.x+=that.x;this.y+=that.y;return this},scalarAdd:function(scalar){return new Point(this.x+scalar,this.y+scalar)},scalarAddEquals:function(scalar){this.x+=scalar;this.y+=scalar;return this},subtract:function(that){return new Point(this.x-that.x,this.y-that.y)},subtractEquals:function(that){this.x-=that.x;this.y-=that.y;return this},scalarSubtract:function(scalar){return new Point(this.x-scalar,this.y-scalar)},scalarSubtractEquals:function(scalar){this.x-=scalar;this.y-=scalar;return this},multiply:function(scalar){return new Point(this.x*scalar,this.y*scalar)},multiplyEquals:function(scalar){this.x*=scalar;this.y*=scalar;return this},divide:function(scalar){return new Point(this.x/scalar,this.y/scalar)},divideEquals:function(scalar){this.x/=scalar;this.y/=scalar;return this},eq:function(that){return this.x===that.x&amp;&amp;this.y===that.y},lt:function(that){return this.x&lt;that.x&amp;&amp;this.y&lt;that.y},lte:function(that){return this.x&lt;=that.x&amp;&amp;this.y&lt;=that.y},gt:function(that){return this.x&gt;that.x&amp;&amp;this.y&gt;that.y},gte:function(that){return this.x&gt;=that.x&amp;&amp;this.y&gt;=that.y},lerp:function(that,t){return new Point(this.x+(that.x-this.x)*t,this.y+(that.y-this.y)*t)},distanceFrom:function(that){var dx=this.x-that.x,dy=this.y-that.y;return Math.sqrt(dx*dx+dy*dy)},midPointFrom:function(that){return new Point(this.x+(that.x-this.x)/2,this.y+(that.y-this.y)/2)},min:function(that){return new Point(Math.min(this.x,that.x),Math.min(this.y,that.y))},max:function(that){return new Point(Math.max(this.x,that.x),Math.max(this.y,that.y))},toString:function(){return this.x+&quot;,&quot;+this.y},setXY:function(x,y){this.x=x;this.y=y},setFromPoint:function(that){this.x=that.x;this.y=that.y},swap:function(that){var x=this.x,y=this.y;this.x=that.x;this.y=that.y;that.x=x;that.y=y}}})(typeof exports!==&quot;undefined&quot;?exports:this);(function(global){&quot;use strict&quot;;var fabric=global.fabric||(global.fabric={});if(fabric.Intersection){fabric.warn(&quot;fabric.Intersection is already defined&quot;);return}function Intersection(status){this.status=status;this.points=[]}fabric.Intersection=Intersection;fabric.Intersection.prototype={appendPoint:function(point){this.points.push(point)},appendPoints:function(points){this.points=this.points.concat(points)}};fabric.Intersection.intersectLineLine=function(a1,a2,b1,b2){var result,uaT=(b2.x-b1.x)*(a1.y-b1.y)-(b2.y-b1.y)*(a1.x-b1.x),ubT=(a2.x-a1.x)*(a1.y-b1.y)-(a2.y-a1.y)*(a1.x-b1.x),uB=(b2.y-b1.y)*(a2.x-a1.x)-(b2.x-b1.x)*(a2.y-a1.y);if(uB!==0){var ua=uaT/uB,ub=ubT/uB;if(0&lt;=ua&amp;&amp;ua&lt;=1&amp;&amp;0&lt;=ub&amp;&amp;ub&lt;=1){result=new Intersection(&quot;Intersection&quot;);result.points.push(new fabric.Point(a1.x+ua*(a2.x-a1.x),a1.y+ua*(a2.y-a1.y)))}else{result=new Intersection}}else{if(uaT===0||ubT===0){result=new Intersection(&quot;Coincident&quot;)}else{result=new Intersection(&quot;Parallel&quot;)}}return result};fabric.Intersection.intersectLinePolygon=function(a1,a2,points){var result=new Intersection,length=points.length;for(var i=0;i&lt;length;i++){var b1=points[i],b2=points[(i+1)%length],inter=Intersection.intersectLineLine(a1,a2,b1,b2);result.appendPoints(inter.points)}if(result.points.length&gt;0){result.status=&quot;Intersection&quot;}return result};fabric.Intersection.intersectPolygonPolygon=function(points1,points2){var result=new Intersection,length=points1.length;for(var i=0;i&lt;length;i++){var a1=points1[i],a2=points1[(i+1)%length],inter=Intersection.intersectLinePolygon(a1,a2,points2);result.appendPoints(inter.points)}if(result.points.length&gt;0){result.status=&quot;Intersection&quot;}return result};fabric.Intersection.intersectPolygonRectangle=function(points,r1,r2){var min=r1.min(r2),max=r1.max(r2),topRight=new fabric.Point(max.x,min.y),bottomLeft=new fabric.Point(min.x,max.y),inter1=Intersection.intersectLinePolygon(min,topRight,points),inter2=Intersection.intersectLinePolygon(topRight,max,points),inter3=Intersection.intersectLinePolygon(max,bottomLeft,points),inter4=Intersection.intersectLinePolygon(bottomLeft,min,points),result=new Intersection;result.appendPoints(inter1.points);result.appendPoints(inter2.points);result.appendPoints(inter3.points);result.appendPoints(inter4.points);if(result.points.length&gt;0){result.status=&quot;Intersection&quot;}return result}})(typeof exports!==&quot;undefined&quot;?exports:this);(function(global){&quot;use strict&quot;;var fabric=global.fabric||(global.fabric={});if(fabric.Color){fabric.warn(&quot;fabric.Color is already defined.&quot;);return}function Color(color){if(!color){this.setSource([0,0,0,1])}else{this._tryParsingColor(color)</td>
      </tr>
      <tr>
        <td id="L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="LC3" class="blob-code blob-code-inner js-file-line">}}fabric.Color=Color;fabric.Color.prototype={_tryParsingColor:function(color){var source;if(color in Color.colorNameMap){color=Color.colorNameMap[color]}if(color===&quot;transparent&quot;){source=[255,255,255,0]}if(!source){source=Color.sourceFromHex(color)}if(!source){source=Color.sourceFromRgb(color)}if(!source){source=Color.sourceFromHsl(color)}if(!source){source=[0,0,0,1]}if(source){this.setSource(source)}},_rgbToHsl:function(r,g,b){r/=255,g/=255,b/=255;var h,s,l,max=fabric.util.array.max([r,g,b]),min=fabric.util.array.min([r,g,b]);l=(max+min)/2;if(max===min){h=s=0}else{var d=max-min;s=l&gt;.5?d/(2-max-min):d/(max+min);switch(max){case r:h=(g-b)/d+(g&lt;b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break}h/=6}return[Math.round(h*360),Math.round(s*100),Math.round(l*100)]},getSource:function(){return this._source},setSource:function(source){this._source=source},toRgb:function(){var source=this.getSource();return&quot;rgb(&quot;+source[0]+&quot;,&quot;+source[1]+&quot;,&quot;+source[2]+&quot;)&quot;},toRgba:function(){var source=this.getSource();return&quot;rgba(&quot;+source[0]+&quot;,&quot;+source[1]+&quot;,&quot;+source[2]+&quot;,&quot;+source[3]+&quot;)&quot;},toHsl:function(){var source=this.getSource(),hsl=this._rgbToHsl(source[0],source[1],source[2]);return&quot;hsl(&quot;+hsl[0]+&quot;,&quot;+hsl[1]+&quot;%,&quot;+hsl[2]+&quot;%)&quot;},toHsla:function(){var source=this.getSource(),hsl=this._rgbToHsl(source[0],source[1],source[2]);return&quot;hsla(&quot;+hsl[0]+&quot;,&quot;+hsl[1]+&quot;%,&quot;+hsl[2]+&quot;%,&quot;+source[3]+&quot;)&quot;},toHex:function(){var source=this.getSource(),r,g,b;r=source[0].toString(16);r=r.length===1?&quot;0&quot;+r:r;g=source[1].toString(16);g=g.length===1?&quot;0&quot;+g:g;b=source[2].toString(16);b=b.length===1?&quot;0&quot;+b:b;return r.toUpperCase()+g.toUpperCase()+b.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(alpha){var source=this.getSource();source[3]=alpha;this.setSource(source);return this},toGrayscale:function(){var source=this.getSource(),average=parseInt((source[0]*.3+source[1]*.59+source[2]*.11).toFixed(0),10),currentAlpha=source[3];this.setSource([average,average,average,currentAlpha]);return this},toBlackWhite:function(threshold){var source=this.getSource(),average=(source[0]*.3+source[1]*.59+source[2]*.11).toFixed(0),currentAlpha=source[3];threshold=threshold||127;average=Number(average)&lt;Number(threshold)?0:255;this.setSource([average,average,average,currentAlpha]);return this},overlayWith:function(otherColor){if(!(otherColor instanceof Color)){otherColor=new Color(otherColor)}var result=[],alpha=this.getAlpha(),otherAlpha=.5,source=this.getSource(),otherSource=otherColor.getSource();for(var i=0;i&lt;3;i++){result.push(Math.round(source[i]*(1-otherAlpha)+otherSource[i]*otherAlpha))}result[3]=alpha;this.setSource(result);return this}};fabric.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/;fabric.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/;fabric.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i;fabric.Color.colorNameMap={aqua:&quot;#00FFFF&quot;,black:&quot;#000000&quot;,blue:&quot;#0000FF&quot;,fuchsia:&quot;#FF00FF&quot;,gray:&quot;#808080&quot;,grey:&quot;#808080&quot;,green:&quot;#008000&quot;,lime:&quot;#00FF00&quot;,maroon:&quot;#800000&quot;,navy:&quot;#000080&quot;,olive:&quot;#808000&quot;,orange:&quot;#FFA500&quot;,purple:&quot;#800080&quot;,red:&quot;#FF0000&quot;,silver:&quot;#C0C0C0&quot;,teal:&quot;#008080&quot;,white:&quot;#FFFFFF&quot;,yellow:&quot;#FFFF00&quot;};function hue2rgb(p,q,t){if(t&lt;0){t+=1}if(t&gt;1){t-=1}if(t&lt;1/6){return p+(q-p)*6*t}if(t&lt;1/2){return q}if(t&lt;2/3){return p+(q-p)*(2/3-t)*6}return p}fabric.Color.fromRgb=function(color){return Color.fromSource(Color.sourceFromRgb(color))};fabric.Color.sourceFromRgb=function(color){var match=color.match(Color.reRGBa);if(match){var r=parseInt(match[1],10)/(/%$/.test(match[1])?100:1)*(/%$/.test(match[1])?255:1),g=parseInt(match[2],10)/(/%$/.test(match[2])?100:1)*(/%$/.test(match[2])?255:1),b=parseInt(match[3],10)/(/%$/.test(match[3])?100:1)*(/%$/.test(match[3])?255:1);return[parseInt(r,10),parseInt(g,10),parseInt(b,10),match[4]?parseFloat(match[4]):1]}};fabric.Color.fromRgba=Color.fromRgb;fabric.Color.fromHsl=function(color){return Color.fromSource(Color.sourceFromHsl(color))};fabric.Color.sourceFromHsl=function(color){var match=color.match(Color.reHSLa);if(!match){return}var h=(parseFloat(match[1])%360+360)%360/360,s=parseFloat(match[2])/(/%$/.test(match[2])?100:1),l=parseFloat(match[3])/(/%$/.test(match[3])?100:1),r,g,b;if(s===0){r=g=b=l}else{var q=l&lt;=.5?l*(s+1):l+s-l*s,p=l*2-q;r=hue2rgb(p,q,h+1/3);g=hue2rgb(p,q,h);b=hue2rgb(p,q,h-1/3)}return[Math.round(r*255),Math.round(g*255),Math.round(b*255),match[4]?parseFloat(match[4]):1]};fabric.Color.fromHsla=Color.fromHsl;fabric.Color.fromHex=function(color){return Color.fromSource(Color.sourceFromHex(color))};fabric.Color.sourceFromHex=function(color){if(color.match(Color.reHex)){var value=color.slice(color.indexOf(&quot;#&quot;)+1),isShortNotation=value.length===3,r=isShortNotation?value.charAt(0)+value.charAt(0):value.substring(0,2),g=isShortNotation?value.charAt(1)+value.charAt(1):value.substring(2,4),b=isShortNotation?value.charAt(2)+value.charAt(2):value.substring(4,6);return[parseInt(r,16),parseInt(g,16),parseInt(b,16),1]}};fabric.Color.fromSource=function(source){var oColor=new Color;oColor.setSource(source);return oColor}})(typeof exports!==&quot;undefined&quot;?exports:this);(function(){function getColorStop(el){var style=el.getAttribute(&quot;style&quot;),offset=el.getAttribute(&quot;offset&quot;)||0,color,colorAlpha,opacity;offset=parseFloat(offset)/(/%$/.test(offset)?100:1);offset=offset&lt;0?0:offset&gt;1?1:offset;if(style){var keyValuePairs=style.split(/\s*;\s*/);if(keyValuePairs[keyValuePairs.length-1]===&quot;&quot;){keyValuePairs.pop()}for(var i=keyValuePairs.length;i--;){var split=keyValuePairs[i].split(/\s*:\s*/),key=split[0].trim(),value=split[1].trim();if(key===&quot;stop-color&quot;){color=value}else if(key===&quot;stop-opacity&quot;){opacity=value}}}if(!color){color=el.getAttribute(&quot;stop-color&quot;)||&quot;rgb(0,0,0)&quot;}if(!opacity){opacity=el.getAttribute(&quot;stop-opacity&quot;)}color=new fabric.Color(color);colorAlpha=color.getAlpha();opacity=isNaN(parseFloat(opacity))?1:parseFloat(opacity);opacity*=colorAlpha;return{offset:offset,color:color.toRgb(),opacity:opacity}}function getLinearCoords(el){return{x1:el.getAttribute(&quot;x1&quot;)||0,y1:el.getAttribute(&quot;y1&quot;)||0,x2:el.getAttribute(&quot;x2&quot;)||&quot;100%&quot;,y2:el.getAttribute(&quot;y2&quot;)||0}}function getRadialCoords(el){return{x1:el.getAttribute(&quot;fx&quot;)||el.getAttribute(&quot;cx&quot;)||&quot;50%&quot;,y1:el.getAttribute(&quot;fy&quot;)||el.getAttribute(&quot;cy&quot;)||&quot;50%&quot;,r1:0,x2:el.getAttribute(&quot;cx&quot;)||&quot;50%&quot;,y2:el.getAttribute(&quot;cy&quot;)||&quot;50%&quot;,r2:el.getAttribute(&quot;r&quot;)||&quot;50%&quot;}}fabric.Gradient=fabric.util.createClass({offsetX:0,offsetY:0,initialize:function(options){options||(options={});var coords={};this.id=fabric.Object.__uid++;this.type=options.type||&quot;linear&quot;;coords={x1:options.coords.x1||0,y1:options.coords.y1||0,x2:options.coords.x2||0,y2:options.coords.y2||0};if(this.type===&quot;radial&quot;){coords.r1=options.coords.r1||0;coords.r2=options.coords.r2||0}this.coords=coords;this.colorStops=options.colorStops.slice();if(options.gradientTransform){this.gradientTransform=options.gradientTransform}this.offsetX=options.offsetX||this.offsetX;this.offsetY=options.offsetY||this.offsetY},addColorStop:function(colorStop){for(var position in colorStop){var color=new fabric.Color(colorStop[position]);this.colorStops.push({offset:position,color:color.toRgb(),opacity:color.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform}},toSVG:function(object){var coords=fabric.util.object.clone(this.coords),markup,commonAttributes;this.colorStops.sort(function(a,b){return a.offset-b.offset});if(!(object.group&amp;&amp;object.group.type===&quot;path-group&quot;)){for(var prop in coords){if(prop===&quot;x1&quot;||prop===&quot;x2&quot;||prop===&quot;r2&quot;){coords[prop]+=this.offsetX-object.width/2}else if(prop===&quot;y1&quot;||prop===&quot;y2&quot;){coords[prop]+=this.offsetY-object.height/2}}}commonAttributes=&#39;id=&quot;SVGID_&#39;+this.id+&#39;&quot; gradientUnits=&quot;userSpaceOnUse&quot;&#39;;if(this.gradientTransform){commonAttributes+=&#39; gradientTransform=&quot;matrix(&#39;+this.gradientTransform.join(&quot; &quot;)+&#39;)&quot; &#39;}if(this.type===&quot;linear&quot;){markup=[&quot;&lt;linearGradient &quot;,commonAttributes,&#39; x1=&quot;&#39;,coords.x1,&#39;&quot; y1=&quot;&#39;,coords.y1,&#39;&quot; x2=&quot;&#39;,coords.x2,&#39;&quot; y2=&quot;&#39;,coords.y2,&#39;&quot;&gt;\n&#39;]}else if(this.type===&quot;radial&quot;){markup=[&quot;&lt;radialGradient &quot;,commonAttributes,&#39; cx=&quot;&#39;,coords.x2,&#39;&quot; cy=&quot;&#39;,coords.y2,&#39;&quot; r=&quot;&#39;,coords.r2,&#39;&quot; fx=&quot;&#39;,coords.x1,&#39;&quot; fy=&quot;&#39;,coords.y1,&#39;&quot;&gt;\n&#39;]}for(var i=0;i&lt;this.colorStops.length;i++){markup.push(&quot;&lt;stop &quot;,&#39;offset=&quot;&#39;,this.colorStops[i].offset*100+&quot;%&quot;,&#39;&quot; style=&quot;stop-color:&#39;,this.colorStops[i].color,this.colorStops[i].opacity!=null?&quot;;stop-opacity: &quot;+this.colorStops[i].opacity:&quot;;&quot;,&#39;&quot;/&gt;\n&#39;)}markup.push(this.type===&quot;linear&quot;?&quot;&lt;/linearGradient&gt;\n&quot;:&quot;&lt;/radialGradient&gt;\n&quot;);return markup.join(&quot;&quot;)},toLive:function(ctx,object){var gradient,prop,coords=fabric.util.object.clone(this.coords);if(!this.type){return}if(object.group&amp;&amp;object.group.type===&quot;path-group&quot;){for(prop in coords){if(prop===&quot;x1&quot;||prop===&quot;x2&quot;){coords[prop]+=-this.offsetX+object.width/2}else if(prop===&quot;y1&quot;||prop===&quot;y2&quot;){coords[prop]+=-this.offsetY+object.height/2}}}if(this.type===&quot;linear&quot;){gradient=ctx.createLinearGradient(coords.x1,coords.y1,coords.x2,coords.y2)}else if(this.type===&quot;radial&quot;){gradient=ctx.createRadialGradient(coords.x1,coords.y1,coords.r1,coords.x2,coords.y2,coords.r2)}for(var i=0,len=this.colorStops.length;i&lt;len;i++){var color=this.colorStops[i].color,opacity=this.colorStops[i].opacity,offset=this.colorStops[i].offset;if(typeof opacity!==&quot;undefined&quot;){color=new fabric.Color(color).setAlpha(opacity).toRgba()}gradient.addColorStop(parseFloat(offset),color)}return gradient}});fabric.util.object.extend(fabric.Gradient,{fromElement:function(el,instance){var colorStopEls=el.getElementsByTagName(&quot;stop&quot;),type=el.nodeName===&quot;linearGradient&quot;?&quot;linear&quot;:&quot;radial&quot;,gradientUnits=el.getAttribute(&quot;gradientUnits&quot;)||&quot;objectBoundingBox&quot;,gradientTransform=el.getAttribute(&quot;gradientTransform&quot;),colorStops=[],coords={},ellipseMatrix;if(type===&quot;linear&quot;){coords=getLinearCoords(el)}else if(type===&quot;radial&quot;){coords=getRadialCoords(el)}for(var i=colorStopEls.length;i--;){colorStops.push(getColorStop(colorStopEls[i]))}ellipseMatrix=_convertPercentUnitsToValues(instance,coords,gradientUnits);var gradient=new fabric.Gradient({type:type,coords:coords,colorStops:colorStops,offsetX:-instance.left,offsetY:-instance.top});if(gradientTransform||ellipseMatrix!==&quot;&quot;){gradient.gradientTransform=fabric.parseTransformAttribute((gradientTransform||&quot;&quot;)+ellipseMatrix)}return gradient},forObject:function(obj,options){options||(options={});_convertPercentUnitsToValues(obj,options.coords,&quot;userSpaceOnUse&quot;);return new fabric.Gradient(options)}});function _convertPercentUnitsToValues(object,options,gradientUnits){var propValue,addFactor=0,multFactor=1,ellipseMatrix=&quot;&quot;;for(var prop in options){propValue=parseFloat(options[prop],10);if(typeof options[prop]===&quot;string&quot;&amp;&amp;/^\d+%$/.test(options[prop])){multFactor=.01}else{multFactor=1}if(prop===&quot;x1&quot;||prop===&quot;x2&quot;||prop===&quot;r2&quot;){multFactor*=gradientUnits===&quot;objectBoundingBox&quot;?object.width:1;addFactor=gradientUnits===&quot;objectBoundingBox&quot;?object.left||0:0}else if(prop===&quot;y1&quot;||prop===&quot;y2&quot;){multFactor*=gradientUnits===&quot;objectBoundingBox&quot;?object.height:1;addFactor=gradientUnits===&quot;objectBoundingBox&quot;?object.top||0:0}options[prop]=propValue*multFactor+addFactor}if(object.type===&quot;ellipse&quot;&amp;&amp;options.r2!==null&amp;&amp;gradientUnits===&quot;objectBoundingBox&quot;&amp;&amp;object.rx!==object.ry){var scaleFactor=object.ry/object.rx;ellipseMatrix=&quot; scale(1, &quot;+scaleFactor+&quot;)&quot;;if(options.y1){options.y1/=scaleFactor}if(options.y2){options.y2/=scaleFactor}}return ellipseMatrix}})();fabric.Pattern=fabric.util.createClass({repeat:&quot;repeat&quot;,offsetX:0,offsetY:0,initialize:function(options){options||(options={});this.id=fabric.Object.__uid++;if(options.source){if(typeof options.source===&quot;string&quot;){if(typeof fabric.util.getFunctionBody(options.source)!==&quot;undefined&quot;){this.source=new Function(fabric.util.getFunctionBody(options.source))}else{var _this=this;this.source=fabric.util.createImage();fabric.util.loadImage(options.source,function(img){_this.source=img})}}else{this.source=options.source}}if(options.repeat){this.repeat=options.repeat}if(options.offsetX){this.offsetX=options.offsetX}if(options.offsetY){this.offsetY=options.offsetY}},toObject:function(){var source;if(typeof this.source===&quot;function&quot;){source=String(this.source)}else if(typeof this.source.src===&quot;string&quot;){source=this.source.src}else if(typeof this.source===&quot;object&quot;&amp;&amp;this.source.toDataURL){source=this.source.toDataURL()}return{source:source,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(object){var patternSource=typeof this.source===&quot;function&quot;?this.source():this.source,patternWidth=patternSource.width/object.getWidth(),patternHeight=patternSource.height/object.getHeight(),patternOffsetX=this.offsetX/object.getWidth(),patternOffsetY=this.offsetY/object.getHeight(),patternImgSrc=&quot;&quot;;if(this.repeat===&quot;repeat-x&quot;||this.repeat===&quot;no-repeat&quot;){patternHeight=1}if(this.repeat===&quot;repeat-y&quot;||this.repeat===&quot;no-repeat&quot;){patternWidth=1}if(patternSource.src){patternImgSrc=patternSource.src}else if(patternSource.toDataURL){patternImgSrc=patternSource.toDataURL()}return&#39;&lt;pattern id=&quot;SVGID_&#39;+this.id+&#39;&quot; x=&quot;&#39;+patternOffsetX+&#39;&quot; y=&quot;&#39;+patternOffsetY+&#39;&quot; width=&quot;&#39;+patternWidth+&#39;&quot; height=&quot;&#39;+patternHeight+&#39;&quot;&gt;\n&#39;+&#39;&lt;image x=&quot;0&quot; y=&quot;0&quot;&#39;+&#39; width=&quot;&#39;+patternSource.width+&#39;&quot; height=&quot;&#39;+patternSource.height+&#39;&quot; xlink:href=&quot;&#39;+patternImgSrc+&#39;&quot;&gt;&lt;/image&gt;\n&#39;+&quot;&lt;/pattern&gt;\n&quot;},toLive:function(ctx){var source=typeof this.source===&quot;function&quot;?this.source():this.source;if(!source){return&quot;&quot;}if(typeof source.src!==&quot;undefined&quot;){if(!source.complete){return&quot;&quot;}if(source.naturalWidth===0||source.naturalHeight===0){return&quot;&quot;}}return ctx.createPattern(source,this.repeat)}});(function(global){&quot;use strict&quot;;var fabric=global.fabric||(global.fabric={}),toFixed=fabric.util.toFixed;if(fabric.Shadow){fabric.warn(&quot;fabric.Shadow is already defined.&quot;);return}fabric.Shadow=fabric.util.createClass({color:&quot;rgb(0,0,0)&quot;,blur:0,offsetX:0,offsetY:0,affectStroke:false,includeDefaultValues:true,initialize:function(options){if(typeof options===&quot;string&quot;){options=this._parseShadow(options)}for(var prop in options){this[prop]=options[prop]}this.id=fabric.Object.__uid++},_parseShadow:function(shadow){var shadowStr=shadow.trim(),offsetsAndBlur=fabric.Shadow.reOffsetsAndBlur.exec(shadowStr)||[],color=shadowStr.replace(fabric.Shadow.reOffsetsAndBlur,&quot;&quot;)||&quot;rgb(0,0,0)&quot;;return{color:color.trim(),offsetX:parseInt(offsetsAndBlur[1],10)||0,offsetY:parseInt(offsetsAndBlur[2],10)||0,blur:parseInt(offsetsAndBlur[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join(&quot;px &quot;)},toSVG:function(object){var fBoxX=40,fBoxY=40,NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS,offset=fabric.util.rotateVector({x:this.offsetX,y:this.offsetY},fabric.util.degreesToRadians(-object.angle)),BLUR_BOX=20;if(object.width&amp;&amp;object.height){fBoxX=toFixed((Math.abs(offset.x)+this.blur)/object.width,NUM_FRACTION_DIGITS)*100+BLUR_BOX;fBoxY=toFixed((Math.abs(offset.y)+this.blur)/object.height,NUM_FRACTION_DIGITS)*100+BLUR_BOX}if(object.flipX){offset.x*=-1}if(object.flipY){offset.y*=-1}return&#39;&lt;filter id=&quot;SVGID_&#39;+this.id+&#39;&quot; y=&quot;-&#39;+fBoxY+&#39;%&quot; height=&quot;&#39;+(100+2*fBoxY)+&#39;%&quot; &#39;+&#39;x=&quot;-&#39;+fBoxX+&#39;%&quot; width=&quot;&#39;+(100+2*fBoxX)+&#39;%&quot; &#39;+&quot;&gt;\n&quot;+&#39;	&lt;feGaussianBlur in=&quot;SourceAlpha&quot; stdDeviation=&quot;&#39;+toFixed(this.blur?this.blur/2:0,NUM_FRACTION_DIGITS)+&#39;&quot;&gt;&lt;/feGaussianBlur&gt;\n&#39;+&#39;	&lt;feOffset dx=&quot;&#39;+toFixed(offset.x,NUM_FRACTION_DIGITS)+&#39;&quot; dy=&quot;&#39;+toFixed(offset.y,NUM_FRACTION_DIGITS)+&#39;&quot; result=&quot;oBlur&quot; &gt;&lt;/feOffset&gt;\n&#39;+&#39;	&lt;feFlood flood-color=&quot;&#39;+this.color+&#39;&quot;/&gt;\n&#39;+&#39;	&lt;feComposite in2=&quot;oBlur&quot; operator=&quot;in&quot; /&gt;\n&#39;+&quot;	&lt;feMerge&gt;\n&quot;+&quot;		&lt;feMergeNode&gt;&lt;/feMergeNode&gt;\n&quot;+&#39;		&lt;feMergeNode in=&quot;SourceGraphic&quot;&gt;&lt;/feMergeNode&gt;\n&#39;+&quot;	&lt;/feMerge&gt;\n&quot;+&quot;&lt;/filter&gt;\n&quot;},toObject:function(){if(this.includeDefaultValues){return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke}}var obj={},proto=fabric.Shadow.prototype;[&quot;color&quot;,&quot;blur&quot;,&quot;offsetX&quot;,&quot;offsetY&quot;,&quot;affectStroke&quot;].forEach(function(prop){if(this[prop]!==proto[prop]){obj[prop]=this[prop]}},this);return obj}});fabric.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/})(typeof exports!==&quot;undefined&quot;?exports:this);(function(){&quot;use strict&quot;;if(fabric.StaticCanvas){fabric.warn(&quot;fabric.StaticCanvas is already defined.&quot;);return}var extend=fabric.util.object.extend,getElementOffset=fabric.util.getElementOffset,removeFromArray=fabric.util.removeFromArray,toFixed=fabric.util.toFixed,CANVAS_INIT_ERROR=new Error(&quot;Could not initialize `canvas` element&quot;);fabric.StaticCanvas=fabric.util.createClass({initialize:function(el,options){options||(options={});this._initStatic(el,options)},backgroundColor:&quot;&quot;,backgroundImage:null,overlayColor:&quot;&quot;,overlayImage:null,includeDefaultValues:true,stateful:true,renderOnAddRemove:true,clipTo:null,controlsAboveOverlay:false,allowTouchScrolling:false,imageSmoothingEnabled:true,preserveObjectStacking:false,viewportTransform:[1,0,0,1,0,0],backgroundVpt:true,overlayVpt:true,onBeforeScaleRotate:function(){},enableRetinaScaling:true,_initStatic:function(el,options){this._objects=[];this._createLowerCanvas(el);this._initOptions(options);this._setImageSmoothing();if(!this.interactive){this._initRetinaScaling()}if(options.overlayImage){this.setOverlayImage(options.overlayImage,this.renderAll.bind(this))}if(options.backgroundImage){this.setBackgroundImage(options.backgroundImage,this.renderAll.bind(this))}if(options.backgroundColor){this.setBackgroundColor(options.backgroundColor,this.renderAll.bind(this))}if(options.overlayColor){this.setOverlayColor(options.overlayColor,this.renderAll.bind(this))}this.calcOffset()},_isRetinaScaling:function(){return fabric.devicePixelRatio!==1&amp;&amp;this.enableRetinaScaling},_initRetinaScaling:function(){if(!this._isRetinaScaling()){return}this.lowerCanvasEl.setAttribute(&quot;width&quot;,this.width*fabric.devicePixelRatio);this.lowerCanvasEl.setAttribute(&quot;height&quot;,this.height*fabric.devicePixelRatio);this.contextContainer.scale(fabric.devicePixelRatio,fabric.devicePixelRatio)},calcOffset:function(){this._offset=getElementOffset(this.lowerCanvasEl);return this},setOverlayImage:function(image,callback,options){return this.__setBgOverlayImage(&quot;overlayImage&quot;,image,callback,options)},setBackgroundImage:function(image,callback,options){return this.__setBgOverlayImage(&quot;backgroundImage&quot;,image,callback,options)},setOverlayColor:function(overlayColor,callback){return this.__setBgOverlayColor(&quot;overlayColor&quot;,overlayColor,callback)},setBackgroundColor:function(backgroundColor,callback){return this.__setBgOverlayColor(&quot;backgroundColor&quot;,backgroundColor,callback)},_setImageSmoothing:function(){var ctx=this.getContext();ctx.imageSmoothingEnabled=ctx.imageSmoothingEnabled||ctx.webkitImageSmoothingEnabled||ctx.mozImageSmoothingEnabled||ctx.msImageSmoothingEnabled||ctx.oImageSmoothingEnabled;ctx.imageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(property,image,callback,options){if(typeof image===&quot;string&quot;){fabric.util.loadImage(image,function(img){img&amp;&amp;(this[property]=new fabric.Image(img,options));callback&amp;&amp;callback(img)},this,options&amp;&amp;options.crossOrigin)}else{options&amp;&amp;image.setOptions(options);this[property]=image;callback&amp;&amp;callback(image)}return this},__setBgOverlayColor:function(property,color,callback){if(color&amp;&amp;color.source){var _this=this;fabric.util.loadImage(color.source,function(img){_this[property]=new fabric.Pattern({source:img,repeat:color.repeat,offsetX:color.offsetX,offsetY:color.offsetY});callback&amp;&amp;callback()})}else{this[property]=color;callback&amp;&amp;callback()}return this},_createCanvasElement:function(){var element=fabric.document.createElement(&quot;canvas&quot;);if(!element.style){element.style={}}if(!element){throw CANVAS_INIT_ERROR}this._initCanvasElement(element);return element},_initCanvasElement:function(element){fabric.util.createCanvasElement(element);if(typeof element.getContext===&quot;undefined&quot;){throw CANVAS_INIT_ERROR}},_initOptions:function(options){for(var prop in options){this[prop]=options[prop]}this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0;this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0;if(!this.lowerCanvasEl.style){return}this.lowerCanvasEl.width=this.width;this.lowerCanvasEl.height=this.height;this.lowerCanvasEl.style.width=this.width+&quot;px&quot;;this.lowerCanvasEl.style.height=this.height+&quot;px&quot;;this.viewportTransform=this.viewportTransform.slice()},_createLowerCanvas:function(canvasEl){this.lowerCanvasEl=fabric.util.getById(canvasEl)||this._createCanvasElement();this._initCanvasElement(this.lowerCanvasEl);fabric.util.addClass(this.lowerCanvasEl,&quot;lower-canvas&quot;);if(this.interactive){this._applyCanvasStyle(this.lowerCanvasEl)}this.contextContainer=this.lowerCanvasEl.getContext(&quot;2d&quot;)},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(value,options){return this.setDimensions({width:value},options)},setHeight:function(value,options){return this.setDimensions({height:value},options)},setDimensions:function(dimensions,options){var cssValue;options=options||{};for(var prop in dimensions){cssValue=dimensions[prop];if(!options.cssOnly){this._setBackstoreDimension(prop,dimensions[prop]);cssValue+=&quot;px&quot;}if(!options.backstoreOnly){this._setCssDimension(prop,cssValue)}}this._initRetinaScaling();this._setImageSmoothing();this.calcOffset();if(!options.cssOnly){this.renderAll()}return this},_setBackstoreDimension:function(prop,value){this.lowerCanvasEl[prop]=value;if(this.upperCanvasEl){this.upperCanvasEl[prop]=value}if(this.cacheCanvasEl){this.cacheCanvasEl[prop]=value}this[prop]=value;return this},_setCssDimension:function(prop,value){this.lowerCanvasEl.style[prop]=value;if(this.upperCanvasEl){this.upperCanvasEl.style[prop]=value}if(this.wrapperEl){this.wrapperEl.style[prop]=value}return this},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*this.viewportTransform[3])},setViewportTransform:function(vpt){var activeGroup=this.getActiveGroup();this.viewportTransform=vpt;this.renderAll();for(var i=0,len=this._objects.length;i&lt;len;i++){this._objects[i].setCoords()}if(activeGroup){activeGroup.setCoords()}return this},zoomToPoint:function(point,value){var before=point;point=fabric.util.transformPoint(point,fabric.util.invertTransform(this.viewportTransform));this.viewportTransform[0]=value;this.viewportTransform[3]=value;var after=fabric.util.transformPoint(point,this.viewportTransform);this.viewportTransform[4]+=before.x-after.x;this.viewportTransform[5]+=before.y-after.y;this.renderAll();for(var i=0,len=this._objects.length;i&lt;len;i++){this._objects[i].setCoords()}return this},setZoom:function(value){this.zoomToPoint(new fabric.Point(0,0),value);return this},absolutePan:function(point){this.viewportTransform[4]=-point.x;this.viewportTransform[5]=-point.y;this.renderAll();for(var i=0,len=this._objects.length;i&lt;len;i++){this._objects[i].setCoords()}return this},relativePan:function(point){return this.absolutePan(new fabric.Point(-point.x-this.viewportTransform[4],-point.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_onObjectAdded:function(obj){this.stateful&amp;&amp;obj.setupState();obj._set(&quot;canvas&quot;,this);obj.setCoords();this.fire(&quot;object:added&quot;,{target:obj});obj.fire(&quot;added&quot;)},_onObjectRemoved:function(obj){if(this.getActiveObject()===obj){this.fire(&quot;before:selection:cleared&quot;,{target:obj});this._discardActiveObject();this.fire(&quot;selection:cleared&quot;)}this.fire(&quot;object:removed&quot;,{target:obj});obj.fire(&quot;removed&quot;)},clearContext:function(ctx){ctx.clearRect(0,0,this.width,this.height);return this},getContext:function(){return this.contextContainer},clear:function(){this._objects.length=0;if(this.discardActiveGroup){this.discardActiveGroup()}if(this.discardActiveObject){this.discardActiveObject()}this.clearContext(this.contextContainer);if(this.contextTop){this.clearContext(this.contextTop)}this.fire(&quot;canvas:cleared&quot;);this.renderAll();return this},_chooseObjectsToRender:function(){var activeGroup=this.getActiveGroup(),object,objsToRender=[],activeGroupObjects=[];if(activeGroup&amp;&amp;!this.preserveObjectStacking){for(var i=0,length=this._objects.length;i&lt;length;i++){object=this._objects[i];if(!activeGroup.contains(object)){objsToRender.push(object)}else{activeGroupObjects.push(object)}}activeGroup._set(&quot;_objects&quot;,activeGroupObjects)}else{objsToRender=this._objects}return objsToRender},renderAll:function(){var canvasToDrawOn=this.contextContainer,objsToRender;if(this.contextTop&amp;&amp;this.selection&amp;&amp;!this._groupSelector&amp;&amp;!this.isDrawingMode){this.clearContext(this.contextTop)}this.clearContext(canvasToDrawOn);this.fire(&quot;before:render&quot;);if(this.clipTo){fabric.util.clipContext(this,canvasToDrawOn)}this._renderBackground(canvasToDrawOn);canvasToDrawOn.save();objsToRender=this._chooseObjectsToRender();canvasToDrawOn.transform.apply(canvasToDrawOn,this.viewportTransform);this._renderObjects(canvasToDrawOn,objsToRender);this.preserveObjectStacking||this._renderObjects(canvasToDrawOn,[this.getActiveGroup()]);canvasToDrawOn.restore();if(!this.controlsAboveOverlay&amp;&amp;this.interactive){this.drawControls(canvasToDrawOn)}if(this.clipTo){canvasToDrawOn.restore()}this._renderOverlay(canvasToDrawOn);if(this.controlsAboveOverlay&amp;&amp;this.interactive){this.drawControls(canvasToDrawOn)}this.fire(&quot;after:render&quot;);return this},_renderObjects:function(ctx,objects){for(var i=0,length=objects.length;i&lt;length;++i){objects[i]&amp;&amp;objects[i].render(ctx)}},_renderBackgroundOrOverlay:function(ctx,property){var object=this[property+&quot;Color&quot;];if(object){ctx.fillStyle=object.toLive?object.toLive(ctx):object;ctx.fillRect(object.offsetX||0,object.offsetY||0,this.width,this.height)}object=this[property+&quot;Image&quot;];if(object){if(this[property+&quot;Vpt&quot;]){ctx.save();ctx.transform.apply(ctx,this.viewportTransform)}object.render(ctx);this[property+&quot;Vpt&quot;]&amp;&amp;ctx.restore()}},_renderBackground:function(ctx){this._renderBackgroundOrOverlay(ctx,&quot;background&quot;)},_renderOverlay:function(ctx){this._renderBackgroundOrOverlay(ctx,&quot;overlay&quot;)},renderTop:function(){var ctx=this.contextTop||this.contextContainer;this.clearContext(ctx);if(this.selection&amp;&amp;this._groupSelector){this._drawSelection()}this.fire(&quot;after:render&quot;);return this},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(object){return this._centerObject(object,new fabric.Point(this.getCenter().left,object.getCenterPoint().y))},centerObjectV:function(object){return this._centerObject(object,new fabric.Point(object.getCenterPoint().x,this.getCenter().top))},centerObject:function(object){var center=this.getCenter();return this._centerObject(object,new fabric.Point(center.left,center.top))},viewportCenterObject:function(object){var vpCenter=this.getVpCenter();return this._centerObject(object,vpCenter)},viewportCenterObjectH:function(object){var vpCenter=this.getVpCenter();this._centerObject(object,new fabric.Point(vpCenter.x,object.getCenterPoint().y));return this},viewportCenterObjectV:function(object){var vpCenter=this.getVpCenter();return this._centerObject(object,new fabric.Point(object.getCenterPoint().x,vpCenter.y))},getVpCenter:function(){var center=this.getCenter(),iVpt=fabric.util.invertTransform(this.viewportTransform);return fabric.util.transformPoint({x:center.left,y:center.top},iVpt)},_centerObject:function(object,center){object.setPositionByOrigin(center,&quot;center&quot;,&quot;center&quot;);this.renderAll();return this},toDatalessJSON:function(propertiesToInclude){return this.toDatalessObject(propertiesToInclude)},toObject:function(propertiesToInclude){return this._toObjectMethod(&quot;toObject&quot;,propertiesToInclude)},toDatalessObject:function(propertiesToInclude){return this._toObjectMethod(&quot;toDatalessObject&quot;,propertiesToInclude)},_toObjectMethod:function(methodName,propertiesToInclude){var data={objects:this._toObjects(methodName,propertiesToInclude)};extend(data,this.__serializeBgOverlay());fabric.util.populateWithProperties(this,data,propertiesToInclude);return data},_toObjects:function(methodName,propertiesToInclude){return this.getObjects().filter(function(object){return!object.excludeFromExport}).map(function(instance){return this._toObject(instance,methodName,propertiesToInclude)},this)},_toObject:function(instance,methodName,propertiesToInclude){var originalValue;if(!this.includeDefaultValues){originalValue=instance.includeDefaultValues;instance.includeDefaultValues=false}var originalProperties=this._realizeGroupTransformOnObject(instance),object=instance[methodName](propertiesToInclude);if(!this.includeDefaultValues){instance.includeDefaultValues=originalValue}this._unwindGroupTransformOnObject(instance,originalProperties);return object},_realizeGroupTransformOnObject:function(instance){var layoutProps=[&quot;angle&quot;,&quot;flipX&quot;,&quot;flipY&quot;,&quot;height&quot;,&quot;left&quot;,&quot;scaleX&quot;,&quot;scaleY&quot;,&quot;top&quot;,&quot;width&quot;];if(instance.group&amp;&amp;instance.group===this.getActiveGroup()){var originalValues={};layoutProps.forEach(function(prop){originalValues[prop]=instance[prop]});this.getActiveGroup().realizeTransform(instance);return originalValues}else{return null}},_unwindGroupTransformOnObject:function(instance,originalValues){if(originalValues){instance.set(originalValues)}},__serializeBgOverlay:function(){var data={background:this.backgroundColor&amp;&amp;this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor};if(this.overlayColor){data.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor}if(this.backgroundImage){data.backgroundImage=this.backgroundImage.toObject()}if(this.overlayImage){data.overlayImage=this.overlayImage.toObject()}return data},svgViewportTransformation:true,toSVG:function(options,reviver){options||(options={});var markup=[];this._setSVGPreamble(markup,options);this._setSVGHeader(markup,options);this._setSVGBgOverlayColor(markup,&quot;backgroundColor&quot;);this._setSVGBgOverlayImage(markup,&quot;backgroundImage&quot;,reviver);this._setSVGObjects(markup,reviver);this._setSVGBgOverlayColor(markup,&quot;overlayColor&quot;);this._setSVGBgOverlayImage(markup,&quot;overlayImage&quot;,reviver);markup.push(&quot;&lt;/svg&gt;&quot;);return markup.join(&quot;&quot;)},_setSVGPreamble:function(markup,options){if(options.suppressPreamble){return}markup.push(&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;&#39;,options.encoding||&quot;UTF-8&quot;,&#39;&quot; standalone=&quot;no&quot; ?&gt;\n&#39;,&#39;&lt;!DOCTYPE svg PUBLIC &quot;-//W3C//DTD SVG 1.1//EN&quot; &#39;,&#39;&quot;http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd&quot;&gt;\n&#39;)},_setSVGHeader:function(markup,options){var width=options.width||this.width,height=options.height||this.height,vpt,viewBox=&#39;viewBox=&quot;0 0 &#39;+this.width+&quot; &quot;+this.height+&#39;&quot; &#39;,NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS;if(options.viewBox){viewBox=&#39;viewBox=&quot;&#39;+options.viewBox.x+&quot; &quot;+options.viewBox.y+&quot; &quot;+options.viewBox.width+&quot; &quot;+options.viewBox.height+&#39;&quot; &#39;}else{if(this.svgViewportTransformation){vpt=this.viewportTransform;viewBox=&#39;viewBox=&quot;&#39;+toFixed(-vpt[4]/vpt[0],NUM_FRACTION_DIGITS)+&quot; &quot;+toFixed(-vpt[5]/vpt[3],NUM_FRACTION_DIGITS)+&quot; &quot;+toFixed(this.width/vpt[0],NUM_FRACTION_DIGITS)+&quot; &quot;+toFixed(this.height/vpt[3],NUM_FRACTION_DIGITS)+&#39;&quot; &#39;}}markup.push(&quot;&lt;svg &quot;,&#39;xmlns=&quot;http://www.w3.org/2000/svg&quot; &#39;,&#39;xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot; &#39;,&#39;version=&quot;1.1&quot; &#39;,&#39;width=&quot;&#39;,width,&#39;&quot; &#39;,&#39;height=&quot;&#39;,height,&#39;&quot; &#39;,this.backgroundColor&amp;&amp;!this.backgroundColor.toLive?&#39;style=&quot;background-color: &#39;+this.backgroundColor+&#39;&quot; &#39;:null,viewBox,&#39;xml:space=&quot;preserve&quot;&gt;\n&#39;,&quot;&lt;desc&gt;Created with Fabric.js &quot;,fabric.version,&quot;&lt;/desc&gt;\n&quot;,&quot;&lt;defs&gt;&quot;,fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),&quot;&lt;/defs&gt;\n&quot;)},_setSVGObjects:function(markup,reviver){var instance,originalProperties;for(var i=0,objects=this.getObjects(),len=objects.length;i&lt;len;i++){instance=objects[i];if(instance.excludeFromExport){continue}originalProperties=this._realizeGroupTransformOnObject(instance);markup.push(instance.toSVG(reviver));this._unwindGroupTransformOnObject(instance,originalProperties)</td>
      </tr>
      <tr>
        <td id="L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="LC4" class="blob-code blob-code-inner js-file-line">}},_setSVGBgOverlayImage:function(markup,property,reviver){if(this[property]&amp;&amp;this[property].toSVG){markup.push(this[property].toSVG(reviver))}},_setSVGBgOverlayColor:function(markup,property){if(this[property]&amp;&amp;this[property].source){markup.push(&#39;&lt;rect x=&quot;&#39;,this[property].offsetX,&#39;&quot; y=&quot;&#39;,this[property].offsetY,&#39;&quot; &#39;,&#39;width=&quot;&#39;,this[property].repeat===&quot;repeat-y&quot;||this[property].repeat===&quot;no-repeat&quot;?this[property].source.width:this.width,&#39;&quot; height=&quot;&#39;,this[property].repeat===&quot;repeat-x&quot;||this[property].repeat===&quot;no-repeat&quot;?this[property].source.height:this.height,&#39;&quot; fill=&quot;url(#&#39;+property+&#39;Pattern)&quot;&#39;,&quot;&gt;&lt;/rect&gt;\n&quot;)}else if(this[property]&amp;&amp;property===&quot;overlayColor&quot;){markup.push(&#39;&lt;rect x=&quot;0&quot; y=&quot;0&quot; &#39;,&#39;width=&quot;&#39;,this.width,&#39;&quot; height=&quot;&#39;,this.height,&#39;&quot; fill=&quot;&#39;,this[property],&#39;&quot;&#39;,&quot;&gt;&lt;/rect&gt;\n&quot;)}},sendToBack:function(object){if(!object){return this}var activeGroup=this.getActiveGroup?this.getActiveGroup():null,i,obj,objs;if(object===activeGroup){objs=activeGroup._objects;for(i=objs.length;i--;){obj=objs[i];removeFromArray(this._objects,obj);this._objects.unshift(obj)}}else{removeFromArray(this._objects,object);this._objects.unshift(object)}return this.renderAll&amp;&amp;this.renderAll()},bringToFront:function(object){if(!object){return this}var activeGroup=this.getActiveGroup?this.getActiveGroup():null,i,obj,objs;if(object===activeGroup){objs=activeGroup._objects;for(i=0;i&lt;objs.length;i++){obj=objs[i];removeFromArray(this._objects,obj);this._objects.push(obj)}}else{removeFromArray(this._objects,object);this._objects.push(object)}return this.renderAll&amp;&amp;this.renderAll()},sendBackwards:function(object,intersecting){if(!object){return this}var activeGroup=this.getActiveGroup?this.getActiveGroup():null,i,obj,idx,newIdx,objs;if(object===activeGroup){objs=activeGroup._objects;for(i=0;i&lt;objs.length;i++){obj=objs[i];idx=this._objects.indexOf(obj);if(idx!==0){newIdx=idx-1;removeFromArray(this._objects,obj);this._objects.splice(newIdx,0,obj)}}}else{idx=this._objects.indexOf(object);if(idx!==0){newIdx=this._findNewLowerIndex(object,idx,intersecting);removeFromArray(this._objects,object);this._objects.splice(newIdx,0,object)}}this.renderAll&amp;&amp;this.renderAll();return this},_findNewLowerIndex:function(object,idx,intersecting){var newIdx;if(intersecting){newIdx=idx;for(var i=idx-1;i&gt;=0;--i){var isIntersecting=object.intersectsWithObject(this._objects[i])||object.isContainedWithinObject(this._objects[i])||this._objects[i].isContainedWithinObject(object);if(isIntersecting){newIdx=i;break}}}else{newIdx=idx-1}return newIdx},bringForward:function(object,intersecting){if(!object){return this}var activeGroup=this.getActiveGroup?this.getActiveGroup():null,i,obj,idx,newIdx,objs;if(object===activeGroup){objs=activeGroup._objects;for(i=objs.length;i--;){obj=objs[i];idx=this._objects.indexOf(obj);if(idx!==this._objects.length-1){newIdx=idx+1;removeFromArray(this._objects,obj);this._objects.splice(newIdx,0,obj)}}}else{idx=this._objects.indexOf(object);if(idx!==this._objects.length-1){newIdx=this._findNewUpperIndex(object,idx,intersecting);removeFromArray(this._objects,object);this._objects.splice(newIdx,0,object)}}this.renderAll&amp;&amp;this.renderAll();return this},_findNewUpperIndex:function(object,idx,intersecting){var newIdx;if(intersecting){newIdx=idx;for(var i=idx+1;i&lt;this._objects.length;++i){var isIntersecting=object.intersectsWithObject(this._objects[i])||object.isContainedWithinObject(this._objects[i])||this._objects[i].isContainedWithinObject(object);if(isIntersecting){newIdx=i;break}}}else{newIdx=idx+1}return newIdx},moveTo:function(object,index){removeFromArray(this._objects,object);this._objects.splice(index,0,object);return this.renderAll&amp;&amp;this.renderAll()},dispose:function(){this.clear();return this},toString:function(){return&quot;#&lt;fabric.Canvas (&quot;+this.complexity()+&quot;): &quot;+&quot;{ objects: &quot;+this.getObjects().length+&quot; }&gt;&quot;}});extend(fabric.StaticCanvas.prototype,fabric.Observable);extend(fabric.StaticCanvas.prototype,fabric.Collection);extend(fabric.StaticCanvas.prototype,fabric.DataURLExporter);extend(fabric.StaticCanvas,{EMPTY_JSON:&#39;{&quot;objects&quot;: [], &quot;background&quot;: &quot;white&quot;}&#39;,supports:function(methodName){var el=fabric.util.createCanvasElement();if(!el||!el.getContext){return null}var ctx=el.getContext(&quot;2d&quot;);if(!ctx){return null}switch(methodName){case&quot;getImageData&quot;:return typeof ctx.getImageData!==&quot;undefined&quot;;case&quot;setLineDash&quot;:return typeof ctx.setLineDash!==&quot;undefined&quot;;case&quot;toDataURL&quot;:return typeof el.toDataURL!==&quot;undefined&quot;;case&quot;toDataURLWithQuality&quot;:try{el.toDataURL(&quot;image/jpeg&quot;,0);return true}catch(e){}return false;default:return null}}});fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject})();fabric.BaseBrush=fabric.util.createClass({color:&quot;rgb(0, 0, 0)&quot;,width:1,shadow:null,strokeLineCap:&quot;round&quot;,strokeLineJoin:&quot;round&quot;,strokeDashArray:null,setShadow:function(options){this.shadow=new fabric.Shadow(options);return this},_setBrushStyles:function(){var ctx=this.canvas.contextTop;ctx.strokeStyle=this.color;ctx.lineWidth=this.width;ctx.lineCap=this.strokeLineCap;ctx.lineJoin=this.strokeLineJoin;if(this.strokeDashArray&amp;&amp;fabric.StaticCanvas.supports(&quot;setLineDash&quot;)){ctx.setLineDash(this.strokeDashArray)}},_setShadow:function(){if(!this.shadow){return}var ctx=this.canvas.contextTop;ctx.shadowColor=this.shadow.color;ctx.shadowBlur=this.shadow.blur;ctx.shadowOffsetX=this.shadow.offsetX;ctx.shadowOffsetY=this.shadow.offsetY},_resetShadow:function(){var ctx=this.canvas.contextTop;ctx.shadowColor=&quot;&quot;;ctx.shadowBlur=ctx.shadowOffsetX=ctx.shadowOffsetY=0}});(function(){fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(canvas){this.canvas=canvas;this._points=[]},onMouseDown:function(pointer){this._prepareForDrawing(pointer);this._captureDrawingPath(pointer);this._render()},onMouseMove:function(pointer){this._captureDrawingPath(pointer);this.canvas.clearContext(this.canvas.contextTop);this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(pointer){var p=new fabric.Point(pointer.x,pointer.y);this._reset();this._addPoint(p);this.canvas.contextTop.moveTo(p.x,p.y)},_addPoint:function(point){this._points.push(point)},_reset:function(){this._points.length=0;this._setBrushStyles();this._setShadow()},_captureDrawingPath:function(pointer){var pointerPoint=new fabric.Point(pointer.x,pointer.y);this._addPoint(pointerPoint)},_render:function(){var ctx=this.canvas.contextTop,v=this.canvas.viewportTransform,p1=this._points[0],p2=this._points[1];ctx.save();ctx.transform(v[0],v[1],v[2],v[3],v[4],v[5]);ctx.beginPath();if(this._points.length===2&amp;&amp;p1.x===p2.x&amp;&amp;p1.y===p2.y){p1.x-=.5;p2.x+=.5}ctx.moveTo(p1.x,p1.y);for(var i=1,len=this._points.length;i&lt;len;i++){var midPoint=p1.midPointFrom(p2);ctx.quadraticCurveTo(p1.x,p1.y,midPoint.x,midPoint.y);p1=this._points[i];p2=this._points[i+1]}ctx.lineTo(p1.x,p1.y);ctx.stroke();ctx.restore()},convertPointsToSVGPath:function(points){var path=[],p1=new fabric.Point(points[0].x,points[0].y),p2=new fabric.Point(points[1].x,points[1].y);path.push(&quot;M &quot;,points[0].x,&quot; &quot;,points[0].y,&quot; &quot;);for(var i=1,len=points.length;i&lt;len;i++){var midPoint=p1.midPointFrom(p2);path.push(&quot;Q &quot;,p1.x,&quot; &quot;,p1.y,&quot; &quot;,midPoint.x,&quot; &quot;,midPoint.y,&quot; &quot;);p1=new fabric.Point(points[i].x,points[i].y);if(i+1&lt;points.length){p2=new fabric.Point(points[i+1].x,points[i+1].y)}}path.push(&quot;L &quot;,p1.x,&quot; &quot;,p1.y,&quot; &quot;);return path},createPath:function(pathData){var path=new fabric.Path(pathData,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray,originX:&quot;center&quot;,originY:&quot;center&quot;});if(this.shadow){this.shadow.affectStroke=true;path.setShadow(this.shadow)}return path},_finalizeAndAddPath:function(){var ctx=this.canvas.contextTop;ctx.closePath();var pathData=this.convertPointsToSVGPath(this._points).join(&quot;&quot;);if(pathData===&quot;M 0 0 Q 0 0 0 0 L 0 0&quot;){this.canvas.renderAll();return}var path=this.createPath(pathData);this.canvas.add(path);path.setCoords();this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderAll();this.canvas.fire(&quot;path:created&quot;,{path:path})}})})();fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(canvas){this.canvas=canvas;this.points=[]},drawDot:function(pointer){var point=this.addPoint(pointer),ctx=this.canvas.contextTop,v=this.canvas.viewportTransform;ctx.save();ctx.transform(v[0],v[1],v[2],v[3],v[4],v[5]);ctx.fillStyle=point.fill;ctx.beginPath();ctx.arc(point.x,point.y,point.radius,0,Math.PI*2,false);ctx.closePath();ctx.fill();ctx.restore()},onMouseDown:function(pointer){this.points.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.drawDot(pointer)},onMouseMove:function(pointer){this.drawDot(pointer)},onMouseUp:function(){var originalRenderOnAddRemove=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=false;var circles=[];for(var i=0,len=this.points.length;i&lt;len;i++){var point=this.points[i],circle=new fabric.Circle({radius:point.radius,left:point.x,top:point.y,originX:&quot;center&quot;,originY:&quot;center&quot;,fill:point.fill});this.shadow&amp;&amp;circle.setShadow(this.shadow);circles.push(circle)}var group=new fabric.Group(circles,{originX:&quot;center&quot;,originY:&quot;center&quot;});group.canvas=this.canvas;this.canvas.add(group);this.canvas.fire(&quot;path:created&quot;,{path:group});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=originalRenderOnAddRemove;this.canvas.renderAll()},addPoint:function(pointer){var pointerPoint=new fabric.Point(pointer.x,pointer.y),circleRadius=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,circleColor=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();pointerPoint.radius=circleRadius;pointerPoint.fill=circleColor;this.points.push(pointerPoint);return pointerPoint}});fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:false,optimizeOverlapping:true,initialize:function(canvas){this.canvas=canvas;this.sprayChunks=[]},onMouseDown:function(pointer){this.sprayChunks.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.addSprayChunk(pointer);this.render()},onMouseMove:function(pointer){this.addSprayChunk(pointer);this.render()},onMouseUp:function(){var originalRenderOnAddRemove=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=false;var rects=[];for(var i=0,ilen=this.sprayChunks.length;i&lt;ilen;i++){var sprayChunk=this.sprayChunks[i];for(var j=0,jlen=sprayChunk.length;j&lt;jlen;j++){var rect=new fabric.Rect({width:sprayChunk[j].width,height:sprayChunk[j].width,left:sprayChunk[j].x+1,top:sprayChunk[j].y+1,originX:&quot;center&quot;,originY:&quot;center&quot;,fill:this.color});this.shadow&amp;&amp;rect.setShadow(this.shadow);rects.push(rect)}}if(this.optimizeOverlapping){rects=this._getOptimizedRects(rects)}var group=new fabric.Group(rects,{originX:&quot;center&quot;,originY:&quot;center&quot;});group.canvas=this.canvas;this.canvas.add(group);this.canvas.fire(&quot;path:created&quot;,{path:group});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=originalRenderOnAddRemove;this.canvas.renderAll()},_getOptimizedRects:function(rects){var uniqueRects={},key;for(var i=0,len=rects.length;i&lt;len;i++){key=rects[i].left+&quot;&quot;+rects[i].top;if(!uniqueRects[key]){uniqueRects[key]=rects[i]}}var uniqueRectsArray=[];for(key in uniqueRects){uniqueRectsArray.push(uniqueRects[key])}return uniqueRectsArray},render:function(){var ctx=this.canvas.contextTop;ctx.fillStyle=this.color;var v=this.canvas.viewportTransform;ctx.save();ctx.transform(v[0],v[1],v[2],v[3],v[4],v[5]);for(var i=0,len=this.sprayChunkPoints.length;i&lt;len;i++){var point=this.sprayChunkPoints[i];if(typeof point.opacity!==&quot;undefined&quot;){ctx.globalAlpha=point.opacity}ctx.fillRect(point.x,point.y,point.width,point.width)}ctx.restore()},addSprayChunk:function(pointer){this.sprayChunkPoints=[];var x,y,width,radius=this.width/2;for(var i=0;i&lt;this.density;i++){x=fabric.util.getRandomInt(pointer.x-radius,pointer.x+radius);y=fabric.util.getRandomInt(pointer.y-radius,pointer.y+radius);if(this.dotWidthVariance){width=fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance)}else{width=this.dotWidth}var point=new fabric.Point(x,y);point.width=width;if(this.randomOpacity){point.opacity=fabric.util.getRandomInt(0,100)/100}this.sprayChunkPoints.push(point)}this.sprayChunks.push(this.sprayChunkPoints)}});fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var dotWidth=20,dotDistance=5,patternCanvas=fabric.document.createElement(&quot;canvas&quot;),patternCtx=patternCanvas.getContext(&quot;2d&quot;);patternCanvas.width=patternCanvas.height=dotWidth+dotDistance;patternCtx.fillStyle=this.color;patternCtx.beginPath();patternCtx.arc(dotWidth/2,dotWidth/2,dotWidth/2,0,Math.PI*2,false);patternCtx.closePath();patternCtx.fill();return patternCanvas},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace(&quot;this.color&quot;,&#39;&quot;&#39;+this.color+&#39;&quot;&#39;)},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),&quot;repeat&quot;)},_setBrushStyles:function(){this.callSuper(&quot;_setBrushStyles&quot;);this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(pathData){var path=this.callSuper(&quot;createPath&quot;,pathData);path.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction()});return path}});(function(){var getPointer=fabric.util.getPointer,degreesToRadians=fabric.util.degreesToRadians,radiansToDegrees=fabric.util.radiansToDegrees,atan2=Math.atan2,abs=Math.abs,STROKE_OFFSET=.5;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(el,options){options||(options={});this._initStatic(el,options);this._initInteractive();this._createCacheCanvas()},uniScaleTransform:false,uniScaleKey:&quot;shiftKey&quot;,centeredScaling:false,centeredRotation:false,centeredKey:&quot;altKey&quot;,altActionKey:&quot;shiftKey&quot;,interactive:true,selection:true,selectionKey:&quot;shiftKey&quot;,selectionColor:&quot;rgba(100, 100, 255, 0.3)&quot;,selectionDashArray:[],selectionBorderColor:&quot;rgba(255, 255, 255, 0.3)&quot;,selectionLineWidth:1,hoverCursor:&quot;move&quot;,moveCursor:&quot;move&quot;,defaultCursor:&quot;default&quot;,freeDrawingCursor:&quot;crosshair&quot;,rotationCursor:&quot;crosshair&quot;,containerClass:&quot;canvas-container&quot;,perPixelTargetFind:false,targetFindTolerance:0,skipTargetFind:false,isDrawingMode:false,_initInteractive:function(){this._currentTransform=null;this._groupSelector=null;this._initWrapperElement();this._createUpperCanvas();this._initEventListeners();this._initRetinaScaling();this.freeDrawingBrush=fabric.PencilBrush&amp;&amp;new fabric.PencilBrush(this);this.calcOffset()},_resetCurrentTransform:function(){var t=this._currentTransform;t.target.set({scaleX:t.original.scaleX,scaleY:t.original.scaleY,skewX:t.original.skewX,skewY:t.original.skewY,left:t.original.left,top:t.original.top});if(this._shouldCenterTransform(t.target)){if(t.action===&quot;rotate&quot;){this._setOriginToCenter(t.target)}else{if(t.originX!==&quot;center&quot;){if(t.originX===&quot;right&quot;){t.mouseXSign=-1}else{t.mouseXSign=1}}if(t.originY!==&quot;center&quot;){if(t.originY===&quot;bottom&quot;){t.mouseYSign=-1}else{t.mouseYSign=1}}t.originX=&quot;center&quot;;t.originY=&quot;center&quot;}}else{t.originX=t.original.originX;t.originY=t.original.originY}},containsPoint:function(e,target,point){var pointer=point||this.getPointer(e,true),xy=this._normalizePointer(target,pointer);if(target.group&amp;&amp;target.group===this.getActiveGroup()){xy=this._normalizePointer(target.group,pointer)}else{xy={x:pointer.x,y:pointer.y}}return target.containsPoint(xy)||target._findTargetCorner(pointer)},_normalizePointer:function(object,pointer){var lt,m;m=fabric.util.multiplyTransformMatrices(this.viewportTransform,object.calcTransformMatrix());m=fabric.util.invertTransform(m);pointer=fabric.util.transformPoint(pointer,m,false);lt=fabric.util.transformPoint(object.getCenterPoint(),m,false);pointer.x-=lt.x;pointer.y-=lt.y;return{x:pointer.x,y:pointer.y}},isTargetTransparent:function(target,x,y){var hasBorders=target.hasBorders,transparentCorners=target.transparentCorners,ctx=this.contextCache,shouldTransform=target.group&amp;&amp;target.group===this.getActiveGroup();target.hasBorders=target.transparentCorners=false;if(shouldTransform){ctx.save();ctx.transform.apply(ctx,target.group.calcTransformMatrix())}target.render(ctx);target.active&amp;&amp;target._renderControls(ctx);target.hasBorders=hasBorders;target.transparentCorners=transparentCorners;var isTransparent=fabric.util.isTransparent(ctx,x,y,this.targetFindTolerance);shouldTransform&amp;&amp;ctx.restore();this.clearContext(ctx);return isTransparent},_shouldClearSelection:function(e,target){var activeGroup=this.getActiveGroup(),activeObject=this.getActiveObject();return!target||target&amp;&amp;activeGroup&amp;&amp;!activeGroup.contains(target)&amp;&amp;activeGroup!==target&amp;&amp;!e[this.selectionKey]||target&amp;&amp;!target.evented||target&amp;&amp;!target.selectable&amp;&amp;activeObject&amp;&amp;activeObject!==target},_shouldCenterTransform:function(target){if(!target){return}var t=this._currentTransform,centerTransform;if(t.action===&quot;scale&quot;||t.action===&quot;scaleX&quot;||t.action===&quot;scaleY&quot;){centerTransform=this.centeredScaling||target.centeredScaling}else if(t.action===&quot;rotate&quot;){centerTransform=this.centeredRotation||target.centeredRotation}return centerTransform?!t.altKey:t.altKey},_getOriginFromCorner:function(target,corner){var origin={x:target.originX,y:target.originY};if(corner===&quot;ml&quot;||corner===&quot;tl&quot;||corner===&quot;bl&quot;){origin.x=&quot;right&quot;}else if(corner===&quot;mr&quot;||corner===&quot;tr&quot;||corner===&quot;br&quot;){origin.x=&quot;left&quot;}if(corner===&quot;tl&quot;||corner===&quot;mt&quot;||corner===&quot;tr&quot;){origin.y=&quot;bottom&quot;}else if(corner===&quot;bl&quot;||corner===&quot;mb&quot;||corner===&quot;br&quot;){origin.y=&quot;top&quot;}return origin},_getActionFromCorner:function(target,corner,e){if(!corner){return&quot;drag&quot;}switch(corner){case&quot;mtr&quot;:return&quot;rotate&quot;;case&quot;ml&quot;:case&quot;mr&quot;:return e[this.altActionKey]?&quot;skewY&quot;:&quot;scaleX&quot;;case&quot;mt&quot;:case&quot;mb&quot;:return e[this.altActionKey]?&quot;skewX&quot;:&quot;scaleY&quot;;default:return&quot;scale&quot;}},_setupCurrentTransform:function(e,target){if(!target){return}var pointer=this.getPointer(e),corner=target._findTargetCorner(this.getPointer(e,true)),action=this._getActionFromCorner(target,corner,e),origin=this._getOriginFromCorner(target,corner);this._currentTransform={target:target,action:action,corner:corner,scaleX:target.scaleX,scaleY:target.scaleY,skewX:target.skewX,skewY:target.skewY,offsetX:pointer.x-target.left,offsetY:pointer.y-target.top,originX:origin.x,originY:origin.y,ex:pointer.x,ey:pointer.y,lastX:pointer.x,lastY:pointer.y,left:target.left,top:target.top,theta:degreesToRadians(target.angle),width:target.width*target.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:e.shiftKey,altKey:e[this.centeredKey]};this._currentTransform.original={left:target.left,top:target.top,scaleX:target.scaleX,scaleY:target.scaleY,skewX:target.skewX,skewY:target.skewY,originX:origin.x,originY:origin.y};this._resetCurrentTransform()},_translateObject:function(x,y){var transform=this._currentTransform,target=transform.target,newLeft=x-transform.offsetX,newTop=y-transform.offsetY,moveX=!target.get(&quot;lockMovementX&quot;)&amp;&amp;target.left!==newLeft,moveY=!target.get(&quot;lockMovementY&quot;)&amp;&amp;target.top!==newTop;moveX&amp;&amp;target.set(&quot;left&quot;,newLeft);moveY&amp;&amp;target.set(&quot;top&quot;,newTop);return moveX||moveY},_changeSkewTransformOrigin:function(mouseMove,t,by){var property=&quot;originX&quot;,origins={0:&quot;center&quot;},skew=t.target.skewX,originA=&quot;left&quot;,originB=&quot;right&quot;,corner=t.corner===&quot;mt&quot;||t.corner===&quot;ml&quot;?1:-1,flipSign=1;mouseMove=mouseMove&gt;0?1:-1;if(by===&quot;y&quot;){skew=t.target.skewY;originA=&quot;top&quot;;originB=&quot;bottom&quot;;property=&quot;originY&quot;}origins[-1]=originA;origins[1]=originB;t.target.flipX&amp;&amp;(flipSign*=-1);t.target.flipY&amp;&amp;(flipSign*=-1);if(skew===0){t.skewSign=-corner*mouseMove*flipSign;t[property]=origins[-mouseMove]}else{skew=skew&gt;0?1:-1;t.skewSign=skew;t[property]=origins[skew*corner*flipSign]}},_skewObject:function(x,y,by){var t=this._currentTransform,target=t.target,skewed=false,lockSkewingX=target.get(&quot;lockSkewingX&quot;),lockSkewingY=target.get(&quot;lockSkewingY&quot;);if(lockSkewingX&amp;&amp;by===&quot;x&quot;||lockSkewingY&amp;&amp;by===&quot;y&quot;){return false}var center=target.getCenterPoint(),actualMouseByCenter=target.toLocalPoint(new fabric.Point(x,y),&quot;center&quot;,&quot;center&quot;)[by],lastMouseByCenter=target.toLocalPoint(new fabric.Point(t.lastX,t.lastY),&quot;center&quot;,&quot;center&quot;)[by],actualMouseByOrigin,constraintPosition,dim=target._getTransformedDimensions();this._changeSkewTransformOrigin(actualMouseByCenter-lastMouseByCenter,t,by);actualMouseByOrigin=target.toLocalPoint(new fabric.Point(x,y),t.originX,t.originY)[by],constraintPosition=target.translateToOriginPoint(center,t.originX,t.originY);skewed=this._setObjectSkew(actualMouseByOrigin,t,by,dim);t.lastX=x;t.lastY=y;target.setPositionByOrigin(constraintPosition,t.originX,t.originY);return skewed},_setObjectSkew:function(localMouse,transform,by,_dim){var target=transform.target,newValue,skewed=false,skewSign=transform.skewSign,newDim,dimNoSkew,otherBy,_otherBy,_by,newDimMouse,skewX,skewY;if(by===&quot;x&quot;){otherBy=&quot;y&quot;;_otherBy=&quot;Y&quot;;_by=&quot;X&quot;;skewX=0;skewY=target.skewY}else{otherBy=&quot;x&quot;;_otherBy=&quot;X&quot;;_by=&quot;Y&quot;;skewX=target.skewX;skewY=0}dimNoSkew=target._getTransformedDimensions(skewX,skewY);newDimMouse=2*Math.abs(localMouse)-dimNoSkew[by];if(newDimMouse&lt;=2){newValue=0}else{newValue=skewSign*Math.atan(newDimMouse/target[&quot;scale&quot;+_by]/(dimNoSkew[otherBy]/target[&quot;scale&quot;+_otherBy]));newValue=fabric.util.radiansToDegrees(newValue)}skewed=target[&quot;skew&quot;+_by]!==newValue;target.set(&quot;skew&quot;+_by,newValue);if(target[&quot;skew&quot;+_otherBy]!==0){newDim=target._getTransformedDimensions();newValue=_dim[otherBy]/newDim[otherBy]*target[&quot;scale&quot;+_otherBy];target.set(&quot;scale&quot;+_otherBy,newValue)}return skewed},_scaleObject:function(x,y,by){var t=this._currentTransform,target=t.target,lockScalingX=target.get(&quot;lockScalingX&quot;),lockScalingY=target.get(&quot;lockScalingY&quot;),lockScalingFlip=target.get(&quot;lockScalingFlip&quot;);if(lockScalingX&amp;&amp;lockScalingY){return false}var constraintPosition=target.translateToOriginPoint(target.getCenterPoint(),t.originX,t.originY),localMouse=target.toLocalPoint(new fabric.Point(x,y),t.originX,t.originY),dim=target._getTransformedDimensions(),scaled=false;this._setLocalMouse(localMouse,t);scaled=this._setObjectScale(localMouse,t,lockScalingX,lockScalingY,by,lockScalingFlip,dim);target.setPositionByOrigin(constraintPosition,t.originX,t.originY);return scaled},_setObjectScale:function(localMouse,transform,lockScalingX,lockScalingY,by,lockScalingFlip,_dim){var target=transform.target,forbidScalingX=false,forbidScalingY=false,scaled=false,changeX,changeY,scaleX,scaleY;scaleX=localMouse.x*target.scaleX/_dim.x;scaleY=localMouse.y*target.scaleY/_dim.y;changeX=target.scaleX!==scaleX;changeY=target.scaleY!==scaleY;if(lockScalingFlip&amp;&amp;scaleX&lt;=0&amp;&amp;scaleX&lt;target.scaleX){forbidScalingX=true}if(lockScalingFlip&amp;&amp;scaleY&lt;=0&amp;&amp;scaleY&lt;target.scaleY){forbidScalingY=true}if(by===&quot;equally&quot;&amp;&amp;!lockScalingX&amp;&amp;!lockScalingY){forbidScalingX||forbidScalingY||(scaled=this._scaleObjectEqually(localMouse,target,transform,_dim))}else if(!by){forbidScalingX||lockScalingX||target.set(&quot;scaleX&quot;,scaleX)&amp;&amp;(scaled=scaled||changeX);forbidScalingY||lockScalingY||target.set(&quot;scaleY&quot;,scaleY)&amp;&amp;(scaled=scaled||changeY)}else if(by===&quot;x&quot;&amp;&amp;!target.get(&quot;lockUniScaling&quot;)){forbidScalingX||lockScalingX||target.set(&quot;scaleX&quot;,scaleX)&amp;&amp;(scaled=scaled||changeX)}else if(by===&quot;y&quot;&amp;&amp;!target.get(&quot;lockUniScaling&quot;)){forbidScalingY||lockScalingY||target.set(&quot;scaleY&quot;,scaleY)&amp;&amp;(scaled=scaled||changeY)}transform.newScaleX=scaleX;transform.newScaleY=scaleY;forbidScalingX||forbidScalingY||this._flipObject(transform,by);return scaled},_scaleObjectEqually:function(localMouse,target,transform,_dim){var dist=localMouse.y+localMouse.x,lastDist=_dim.y*transform.original.scaleY/target.scaleY+_dim.x*transform.original.scaleX/target.scaleX,scaled;transform.newScaleX=transform.original.scaleX*dist/lastDist;transform.newScaleY=transform.original.scaleY*dist/lastDist;scaled=transform.newScaleX!==target.scaleX||transform.newScaleY!==target.scaleY;target.set(&quot;scaleX&quot;,transform.newScaleX);target.set(&quot;scaleY&quot;,transform.newScaleY);return scaled},_flipObject:function(transform,by){if(transform.newScaleX&lt;0&amp;&amp;by!==&quot;y&quot;){if(transform.originX===&quot;left&quot;){transform.originX=&quot;right&quot;}else if(transform.originX===&quot;right&quot;){transform.originX=&quot;left&quot;}}if(transform.newScaleY&lt;0&amp;&amp;by!==&quot;x&quot;){if(transform.originY===&quot;top&quot;){transform.originY=&quot;bottom&quot;}else if(transform.originY===&quot;bottom&quot;){transform.originY=&quot;top&quot;}}},_setLocalMouse:function(localMouse,t){var target=t.target;if(t.originX===&quot;right&quot;){localMouse.x*=-1}else if(t.originX===&quot;center&quot;){localMouse.x*=t.mouseXSign*2;if(localMouse.x&lt;0){t.mouseXSign=-t.mouseXSign}}if(t.originY===&quot;bottom&quot;){localMouse.y*=-1}else if(t.originY===&quot;center&quot;){localMouse.y*=t.mouseYSign*2;if(localMouse.y&lt;0){t.mouseYSign=-t.mouseYSign}}if(abs(localMouse.x)&gt;target.padding){if(localMouse.x&lt;0){localMouse.x+=target.padding}else{localMouse.x-=target.padding}}else{localMouse.x=0}if(abs(localMouse.y)&gt;target.padding){if(localMouse.y&lt;0){localMouse.y+=target.padding}else{localMouse.y-=target.padding}}else{localMouse.y=0}},_rotateObject:function(x,y){var t=this._currentTransform;if(t.target.get(&quot;lockRotation&quot;)){return false}var lastAngle=atan2(t.ey-t.top,t.ex-t.left),curAngle=atan2(y-t.top,x-t.left),angle=radiansToDegrees(curAngle-lastAngle+t.theta);if(angle&lt;0){angle=360+angle}t.target.angle=angle%360;return true},setCursor:function(value){this.upperCanvasEl.style.cursor=value},_resetObjectTransform:function(target){target.scaleX=1;target.scaleY=1;target.skewX=0;target.skewY=0;target.setAngle(0)},_drawSelection:function(){var ctx=this.contextTop,groupSelector=this._groupSelector,left=groupSelector.left,top=groupSelector.top,aleft=abs(left),atop=abs(top);ctx.fillStyle=this.selectionColor;ctx.fillRect(groupSelector.ex-(left&gt;0?0:-left),groupSelector.ey-(top&gt;0?0:-top),aleft,atop);ctx.lineWidth=this.selectionLineWidth;ctx.strokeStyle=this.selectionBorderColor;if(this.selectionDashArray.length&gt;1){var px=groupSelector.ex+STROKE_OFFSET-(left&gt;0?0:aleft),py=groupSelector.ey+STROKE_OFFSET-(top&gt;0?0:atop);ctx.beginPath();fabric.util.drawDashedLine(ctx,px,py,px+aleft,py,this.selectionDashArray);fabric.util.drawDashedLine(ctx,px,py+atop-1,px+aleft,py+atop-1,this.selectionDashArray);fabric.util.drawDashedLine(ctx,px,py,px,py+atop,this.selectionDashArray);fabric.util.drawDashedLine(ctx,px+aleft-1,py,px+aleft-1,py+atop,this.selectionDashArray);ctx.closePath();ctx.stroke()}else{ctx.strokeRect(groupSelector.ex+STROKE_OFFSET-(left&gt;0?0:aleft),groupSelector.ey+STROKE_OFFSET-(top&gt;0?0:atop),aleft,atop)}},_isLastRenderedObject:function(pointer){var lastRendered=this.lastRenderedWithControls;return lastRendered&amp;&amp;lastRendered.visible&amp;&amp;(this.containsPoint(null,lastRendered,pointer)||lastRendered._findTargetCorner(pointer))},findTarget:function(e,skipGroup){if(this.skipTargetFind){return}var activeGroup=this.getActiveGroup();if(activeGroup&amp;&amp;!skipGroup&amp;&amp;this._checkTarget(pointer,activeGroup)){return activeGroup}var pointer=this.getPointer(e,true),objects=this._objects;this.targets=[];if(this._isLastRenderedObject(pointer)){objects=[this.lastRenderedWithControls]}var target=this._searchPossibleTargets(objects,pointer);this._fireOverOutEvents(target,e);return target},_fireOverOutEvents:function(target,e){if(target){if(this._hoveredTarget!==target){if(this._hoveredTarget){this.fire(&quot;mouse:out&quot;,{target:this._hoveredTarget,e:e});this._hoveredTarget.fire(&quot;mouseout&quot;)}this.fire(&quot;mouse:over&quot;,{target:target,e:e});target.fire(&quot;mouseover&quot;);this._hoveredTarget=target}}else if(this._hoveredTarget){this.fire(&quot;mouse:out&quot;,{target:this._hoveredTarget,e:e});this._hoveredTarget.fire(&quot;mouseout&quot;);this._hoveredTarget=null}},_checkTarget:function(pointer,obj){if(obj&amp;&amp;obj.visible&amp;&amp;obj.evented&amp;&amp;this.containsPoint(null,obj,pointer)){if((this.perPixelTargetFind||obj.perPixelTargetFind)&amp;&amp;!obj.isEditing){var isTransparent=this.isTargetTransparent(obj,pointer.x,pointer.y);if(!isTransparent){return true}}else{return true}}},_searchPossibleTargets:function(objects,pointer){var target,i=objects.length,normalizedPointer,subTarget;while(i--){if(this._checkTarget(pointer,objects[i])){target=objects[i];if(target.type===&quot;group&quot;&amp;&amp;target.subTargetCheck){normalizedPointer=this._normalizePointer(target,pointer);subTarget=this._searchPossibleTargets(target._objects,normalizedPointer);subTarget&amp;&amp;this.targets.push(subTarget)}break}}return target},getPointer:function(e,ignoreZoom,upperCanvasEl){if(!upperCanvasEl){upperCanvasEl=this.upperCanvasEl}var pointer=getPointer(e),bounds=upperCanvasEl.getBoundingClientRect(),boundsWidth=bounds.width||0,boundsHeight=bounds.height||0,cssScale;if(!boundsWidth||!boundsHeight){if(&quot;top&quot;in bounds&amp;&amp;&quot;bottom&quot;in bounds){boundsHeight=Math.abs(bounds.top-bounds.bottom)}if(&quot;right&quot;in bounds&amp;&amp;&quot;left&quot;in bounds){boundsWidth=Math.abs(bounds.right-bounds.left)}}this.calcOffset();pointer.x=pointer.x-this._offset.left;pointer.y=pointer.y-this._offset.top;if(!ignoreZoom){pointer=fabric.util.transformPoint(pointer,fabric.util.invertTransform(this.viewportTransform))}if(boundsWidth===0||boundsHeight===0){cssScale={width:1,height:1}}else{cssScale={width:upperCanvasEl.width/boundsWidth,height:upperCanvasEl.height/boundsHeight}}return{x:pointer.x*cssScale.width,y:pointer.y*cssScale.height}},_createUpperCanvas:function(){var lowerCanvasClass=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,&quot;&quot;);this.upperCanvasEl=this._createCanvasElement();fabric.util.addClass(this.upperCanvasEl,&quot;upper-canvas &quot;+lowerCanvasClass);this.wrapperEl.appendChild(this.upperCanvasEl);this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext(&quot;2d&quot;)},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute(&quot;width&quot;,this.width);this.cacheCanvasEl.setAttribute(&quot;height&quot;,this.height);this.contextCache=this.cacheCanvasEl.getContext(&quot;2d&quot;)},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,&quot;div&quot;,{&quot;class&quot;:this.containerClass});fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+&quot;px&quot;,height:this.getHeight()+&quot;px&quot;,position:&quot;relative&quot;});fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(element){var width=this.getWidth()||element.width,height=this.getHeight()||element.height;fabric.util.setStyle(element,{position:&quot;absolute&quot;,width:width+&quot;px&quot;,height:height+&quot;px&quot;,left:0,top:0});element.width=width;element.height=height;fabric.util.makeElementUnselectable(element)},_copyCanvasStyle:function(fromEl,toEl){toEl.style.cssText=fromEl.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(object){if(this._activeObject){this._activeObject.set(&quot;active&quot;,false)}this._activeObject=object;object.set(&quot;active&quot;,true)},setActiveObject:function(object,e){this._setActiveObject(object);this.renderAll();this.fire(&quot;object:selected&quot;,{target:object,e:e});object.fire(&quot;selected&quot;,{e:e});return this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){if(this._activeObject){this._activeObject.set(&quot;active&quot;,false)}this._activeObject=null},discardActiveObject:function(e){this._discardActiveObject();this.renderAll();this.fire(&quot;selection:cleared&quot;,{e:e});return this},_setActiveGroup:function(group){this._activeGroup=group;if(group){group.set(&quot;active&quot;,true)}},setActiveGroup:function(group,e){this._setActiveGroup(group);if(group){this.fire(&quot;object:selected&quot;,{target:group,e:e});group.fire(&quot;selected&quot;,{e:e})}return this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var g=this.getActiveGroup();if(g){g.destroy()}this.setActiveGroup(null)},discardActiveGroup:function(e){this._discardActiveGroup();this.fire(&quot;selection:cleared&quot;,{e:e});return this},deactivateAll:function(){var allObjects=this.getObjects(),i=0,len=allObjects.length;for(;i&lt;len;i++){allObjects[i].set(&quot;active&quot;,false)}this._discardActiveGroup();this._discardActiveObject();return this},deactivateAllWithDispatch:function(e){var activeObject=this.getActiveGroup()||this.getActiveObject();</td>
      </tr>
      <tr>
        <td id="L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="LC5" class="blob-code blob-code-inner js-file-line">if(activeObject){this.fire(&quot;before:selection:cleared&quot;,{target:activeObject,e:e})}this.deactivateAll();if(activeObject){this.fire(&quot;selection:cleared&quot;,{e:e})}return this},dispose:function(){this.callSuper(&quot;dispose&quot;);var wrapper=this.wrapperEl;this.removeListeners();wrapper.removeChild(this.upperCanvasEl);wrapper.removeChild(this.lowerCanvasEl);delete this.upperCanvasEl;if(wrapper.parentNode){wrapper.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl)}delete this.wrapperEl;return this},drawControls:function(ctx){var activeGroup=this.getActiveGroup();if(activeGroup){activeGroup._renderControls(ctx)}else{this._drawObjectsControls(ctx)}},_drawObjectsControls:function(ctx){for(var i=0,len=this._objects.length;i&lt;len;++i){if(!this._objects[i]||!this._objects[i].active){continue}this._objects[i]._renderControls(ctx);this.lastRenderedWithControls=this._objects[i]}},_onObjectRemoved:function(obj){if(obj===this.lastRenderedWithControls){delete this.lastRenderedWithControls}this.callSuper(&quot;_onObjectRemoved&quot;,obj)}});for(var prop in fabric.StaticCanvas){if(prop!==&quot;prototype&quot;){fabric.Canvas[prop]=fabric.StaticCanvas[prop]}}if(fabric.isTouchSupported){fabric.Canvas.prototype._setCursorFromEvent=function(){}}fabric.Element=fabric.Canvas})();(function(){var cursorOffset={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},addListener=fabric.util.addListener,removeListener=fabric.util.removeListener;fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:[&quot;n-resize&quot;,&quot;ne-resize&quot;,&quot;e-resize&quot;,&quot;se-resize&quot;,&quot;s-resize&quot;,&quot;sw-resize&quot;,&quot;w-resize&quot;,&quot;nw-resize&quot;],_initEventListeners:function(){this._bindEvents();addListener(fabric.window,&quot;resize&quot;,this._onResize);addListener(this.upperCanvasEl,&quot;mousedown&quot;,this._onMouseDown);addListener(this.upperCanvasEl,&quot;mousemove&quot;,this._onMouseMove);addListener(this.upperCanvasEl,&quot;mousewheel&quot;,this._onMouseWheel);addListener(this.upperCanvasEl,&quot;mouseout&quot;,this._onMouseOut);addListener(this.upperCanvasEl,&quot;touchstart&quot;,this._onMouseDown);addListener(this.upperCanvasEl,&quot;touchmove&quot;,this._onMouseMove);if(typeof eventjs!==&quot;undefined&quot;&amp;&amp;&quot;add&quot;in eventjs){eventjs.add(this.upperCanvasEl,&quot;gesture&quot;,this._onGesture);eventjs.add(this.upperCanvasEl,&quot;drag&quot;,this._onDrag);eventjs.add(this.upperCanvasEl,&quot;orientation&quot;,this._onOrientationChange);eventjs.add(this.upperCanvasEl,&quot;shake&quot;,this._onShake);eventjs.add(this.upperCanvasEl,&quot;longpress&quot;,this._onLongPress)}},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=this._onMouseUp.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=this._onGesture.bind(this);this._onDrag=this._onDrag.bind(this);this._onShake=this._onShake.bind(this);this._onLongPress=this._onLongPress.bind(this);this._onOrientationChange=this._onOrientationChange.bind(this);this._onMouseWheel=this._onMouseWheel.bind(this);this._onMouseOut=this._onMouseOut.bind(this)},removeListeners:function(){removeListener(fabric.window,&quot;resize&quot;,this._onResize);removeListener(this.upperCanvasEl,&quot;mousedown&quot;,this._onMouseDown);removeListener(this.upperCanvasEl,&quot;mousemove&quot;,this._onMouseMove);removeListener(this.upperCanvasEl,&quot;mousewheel&quot;,this._onMouseWheel);removeListener(this.upperCanvasEl,&quot;mouseout&quot;,this._onMouseOut);removeListener(this.upperCanvasEl,&quot;touchstart&quot;,this._onMouseDown);removeListener(this.upperCanvasEl,&quot;touchmove&quot;,this._onMouseMove);if(typeof eventjs!==&quot;undefined&quot;&amp;&amp;&quot;remove&quot;in eventjs){eventjs.remove(this.upperCanvasEl,&quot;gesture&quot;,this._onGesture);eventjs.remove(this.upperCanvasEl,&quot;drag&quot;,this._onDrag);eventjs.remove(this.upperCanvasEl,&quot;orientation&quot;,this._onOrientationChange);eventjs.remove(this.upperCanvasEl,&quot;shake&quot;,this._onShake);eventjs.remove(this.upperCanvasEl,&quot;longpress&quot;,this._onLongPress)}},_onGesture:function(e,self){this.__onTransformGesture&amp;&amp;this.__onTransformGesture(e,self)},_onDrag:function(e,self){this.__onDrag&amp;&amp;this.__onDrag(e,self)},_onMouseWheel:function(e,self){this.__onMouseWheel&amp;&amp;this.__onMouseWheel(e,self)},_onMouseOut:function(e){var target=this._hoveredTarget;this.fire(&quot;mouse:out&quot;,{target:target,e:e});this._hoveredTarget=null;target&amp;&amp;target.fire(&quot;mouseout&quot;,{e:e})},_onOrientationChange:function(e,self){this.__onOrientationChange&amp;&amp;this.__onOrientationChange(e,self)},_onShake:function(e,self){this.__onShake&amp;&amp;this.__onShake(e,self)},_onLongPress:function(e,self){this.__onLongPress&amp;&amp;this.__onLongPress(e,self)},_onMouseDown:function(e){this.__onMouseDown(e);addListener(fabric.document,&quot;touchend&quot;,this._onMouseUp);addListener(fabric.document,&quot;touchmove&quot;,this._onMouseMove);removeListener(this.upperCanvasEl,&quot;mousemove&quot;,this._onMouseMove);removeListener(this.upperCanvasEl,&quot;touchmove&quot;,this._onMouseMove);if(e.type===&quot;touchstart&quot;){removeListener(this.upperCanvasEl,&quot;mousedown&quot;,this._onMouseDown)}else{addListener(fabric.document,&quot;mouseup&quot;,this._onMouseUp);addListener(fabric.document,&quot;mousemove&quot;,this._onMouseMove)}},_onMouseUp:function(e){this.__onMouseUp(e);removeListener(fabric.document,&quot;mouseup&quot;,this._onMouseUp);removeListener(fabric.document,&quot;touchend&quot;,this._onMouseUp);removeListener(fabric.document,&quot;mousemove&quot;,this._onMouseMove);removeListener(fabric.document,&quot;touchmove&quot;,this._onMouseMove);addListener(this.upperCanvasEl,&quot;mousemove&quot;,this._onMouseMove);addListener(this.upperCanvasEl,&quot;touchmove&quot;,this._onMouseMove);if(e.type===&quot;touchend&quot;){var _this=this;setTimeout(function(){addListener(_this.upperCanvasEl,&quot;mousedown&quot;,_this._onMouseDown)},400)}},_onMouseMove:function(e){!this.allowTouchScrolling&amp;&amp;e.preventDefault&amp;&amp;e.preventDefault();this.__onMouseMove(e)},_onResize:function(){this.calcOffset()},_shouldRender:function(target,pointer){var activeObject=this.getActiveGroup()||this.getActiveObject();return!!(target&amp;&amp;(target.isMoving||target!==activeObject)||!target&amp;&amp;!!activeObject||!target&amp;&amp;!activeObject&amp;&amp;!this._groupSelector||pointer&amp;&amp;this._previousPointer&amp;&amp;this.selection&amp;&amp;(pointer.x!==this._previousPointer.x||pointer.y!==this._previousPointer.y))},__onMouseUp:function(e){var target,searchTarget=true,transform=this._currentTransform,groupSelector=this._groupSelector,isClick=!groupSelector||groupSelector.left===0&amp;&amp;groupSelector.top===0;if(this.isDrawingMode&amp;&amp;this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(e);return}if(transform){this._finalizeCurrentTransform();searchTarget=!transform.actionPerformed}target=searchTarget?this.findTarget(e,true):transform.target;var shouldRender=this._shouldRender(target,this.getPointer(e));if(target||!isClick){this._maybeGroupObjects(e)}else{this._groupSelector=null;this._currentTransform=null}if(target){target.isMoving=false}this._handleCursorAndEvent(e,target,&quot;up&quot;);shouldRender&amp;&amp;this.renderAll()},_handleCursorAndEvent:function(e,target,eventType){this._setCursorFromEvent(e,target);this._handleEvent(e,eventType,target?target:null)},_handleEvent:function(e,eventType,targetObj){var target=typeof targetObj===undefined?this.findTarget(e):targetObj,targets=this.targets,options={e:e,target:target,subTargets:targets};this.fire(&quot;mouse:&quot;+eventType,options);target&amp;&amp;target.fire(&quot;mouse&quot;+eventType,options);for(var i=0;i&lt;targets.length;i++){targets[i].fire(&quot;mouse&quot;+eventType,options)}},_finalizeCurrentTransform:function(){var transform=this._currentTransform,target=transform.target;if(target._scaling){target._scaling=false}target.setCoords();this._restoreOriginXY(target);if(transform.actionPerformed||this.stateful&amp;&amp;target.hasStateChanged()){this.fire(&quot;object:modified&quot;,{target:target});target.fire(&quot;modified&quot;)}},_restoreOriginXY:function(target){if(this._previousOriginX&amp;&amp;this._previousOriginY){var originPoint=target.translateToOriginPoint(target.getCenterPoint(),this._previousOriginX,this._previousOriginY);target.originX=this._previousOriginX;target.originY=this._previousOriginY;target.left=originPoint.x;target.top=originPoint.y;this._previousOriginX=null;this._previousOriginY=null}},_onMouseDownInDrawingMode:function(e){this._isCurrentlyDrawing=true;this.discardActiveObject(e).renderAll();if(this.clipTo){fabric.util.clipContext(this,this.contextTop)}var ivt=fabric.util.invertTransform(this.viewportTransform),pointer=fabric.util.transformPoint(this.getPointer(e,true),ivt);this.freeDrawingBrush.onMouseDown(pointer);this._handleEvent(e,&quot;down&quot;)},_onMouseMoveInDrawingMode:function(e){if(this._isCurrentlyDrawing){var ivt=fabric.util.invertTransform(this.viewportTransform),pointer=fabric.util.transformPoint(this.getPointer(e,true),ivt);this.freeDrawingBrush.onMouseMove(pointer)}this.setCursor(this.freeDrawingCursor);this._handleEvent(e,&quot;move&quot;)},_onMouseUpInDrawingMode:function(e){this._isCurrentlyDrawing=false;if(this.clipTo){this.contextTop.restore()}this.freeDrawingBrush.onMouseUp();this._handleEvent(e,&quot;up&quot;)},__onMouseDown:function(e){var isLeftClick=&quot;which&quot;in e?e.which===1:e.button===0;if(!isLeftClick&amp;&amp;!fabric.isTouchSupported){return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(e);return}if(this._currentTransform){return}var target=this.findTarget(e),pointer=this.getPointer(e,true);this._previousPointer=pointer;var shouldRender=this._shouldRender(target,pointer),shouldGroup=this._shouldGroup(e,target);if(this._shouldClearSelection(e,target)){this._clearSelection(e,target,pointer)}else if(shouldGroup){this._handleGrouping(e,target);target=this.getActiveGroup()}if(target){if(target.selectable&amp;&amp;(target.__corner||!shouldGroup)){this._beforeTransform(e,target);this._setupCurrentTransform(e,target)}if(target!==this.getActiveGroup()&amp;&amp;target!==this.getActiveObject()){this.deactivateAll();target.selectable&amp;&amp;this.setActiveObject(target,e)}}this._handleEvent(e,&quot;down&quot;,target?target:null);shouldRender&amp;&amp;this.renderAll()},_beforeTransform:function(e,target){this.stateful&amp;&amp;target.saveState();if(target._findTargetCorner(this.getPointer(e))){this.onBeforeScaleRotate(target)}},_clearSelection:function(e,target,pointer){this.deactivateAllWithDispatch(e);if(target&amp;&amp;target.selectable){this.setActiveObject(target,e)}else if(this.selection){this._groupSelector={ex:pointer.x,ey:pointer.y,top:0,left:0}}},_setOriginToCenter:function(target){this._previousOriginX=this._currentTransform.target.originX;this._previousOriginY=this._currentTransform.target.originY;var center=target.getCenterPoint();target.originX=&quot;center&quot;;target.originY=&quot;center&quot;;target.left=center.x;target.top=center.y;this._currentTransform.left=target.left;this._currentTransform.top=target.top},_setCenterToOrigin:function(target){var originPoint=target.translateToOriginPoint(target.getCenterPoint(),this._previousOriginX,this._previousOriginY);target.originX=this._previousOriginX;target.originY=this._previousOriginY;target.left=originPoint.x;target.top=originPoint.y;this._previousOriginX=null;this._previousOriginY=null},__onMouseMove:function(e){var target,pointer;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(e);return}if(typeof e.touches!==&quot;undefined&quot;&amp;&amp;e.touches.length&gt;1){return}var groupSelector=this._groupSelector;if(groupSelector){pointer=this.getPointer(e,true);groupSelector.left=pointer.x-groupSelector.ex;groupSelector.top=pointer.y-groupSelector.ey;this.renderTop()}else if(!this._currentTransform){target=this.findTarget(e);this._setCursorFromEvent(e,target)}else{this._transformObject(e)}this._handleEvent(e,&quot;move&quot;,target?target:null)},_transformObject:function(e){var pointer=this.getPointer(e),transform=this._currentTransform;transform.reset=false,transform.target.isMoving=true;this._beforeScaleTransform(e,transform);this._performTransformAction(e,transform,pointer);this.renderAll()},_performTransformAction:function(e,transform,pointer){var x=pointer.x,y=pointer.y,target=transform.target,action=transform.action,actionPerformed=false;if(action===&quot;rotate&quot;){(actionPerformed=this._rotateObject(x,y))&amp;&amp;this._fire(&quot;rotating&quot;,target,e)}else if(action===&quot;scale&quot;){(actionPerformed=this._onScale(e,transform,x,y))&amp;&amp;this._fire(&quot;scaling&quot;,target,e)}else if(action===&quot;scaleX&quot;){(actionPerformed=this._scaleObject(x,y,&quot;x&quot;))&amp;&amp;this._fire(&quot;scaling&quot;,target,e)}else if(action===&quot;scaleY&quot;){(actionPerformed=this._scaleObject(x,y,&quot;y&quot;))&amp;&amp;this._fire(&quot;scaling&quot;,target,e)}else if(action===&quot;skewX&quot;){(actionPerformed=this._skewObject(x,y,&quot;x&quot;))&amp;&amp;this._fire(&quot;skewing&quot;,target,e)}else if(action===&quot;skewY&quot;){(actionPerformed=this._skewObject(x,y,&quot;y&quot;))&amp;&amp;this._fire(&quot;skewing&quot;,target,e)}else{actionPerformed=this._translateObject(x,y);if(actionPerformed){this._fire(&quot;moving&quot;,target,e);this.setCursor(target.moveCursor||this.moveCursor)}}transform.actionPerformed=actionPerformed},_fire:function(eventName,target,e){this.fire(&quot;object:&quot;+eventName,{target:target,e:e});target.fire(eventName,{e:e})},_beforeScaleTransform:function(e,transform){if(transform.action===&quot;scale&quot;||transform.action===&quot;scaleX&quot;||transform.action===&quot;scaleY&quot;){var centerTransform=this._shouldCenterTransform(transform.target);if(centerTransform&amp;&amp;(transform.originX!==&quot;center&quot;||transform.originY!==&quot;center&quot;)||!centerTransform&amp;&amp;transform.originX===&quot;center&quot;&amp;&amp;transform.originY===&quot;center&quot;){this._resetCurrentTransform();transform.reset=true}}},_onScale:function(e,transform,x,y){if((e[this.uniScaleKey]||this.uniScaleTransform)&amp;&amp;!transform.target.get(&quot;lockUniScaling&quot;)){transform.currentAction=&quot;scale&quot;;return this._scaleObject(x,y)}else{if(!transform.reset&amp;&amp;transform.currentAction===&quot;scale&quot;){this._resetCurrentTransform()}transform.currentAction=&quot;scaleEqually&quot;;return this._scaleObject(x,y,&quot;equally&quot;)}},_setCursorFromEvent:function(e,target){if(!target){this.setCursor(this.defaultCursor);return false}var hoverCursor=target.hoverCursor||this.hoverCursor;if(!target.selectable){this.setCursor(hoverCursor)}else{var activeGroup=this.getActiveGroup(),corner=target._findTargetCorner&amp;&amp;(!activeGroup||!activeGroup.contains(target))&amp;&amp;target._findTargetCorner(this.getPointer(e,true));if(!corner){this.setCursor(hoverCursor)}else{this._setCornerCursor(corner,target,e)}}return true},_setCornerCursor:function(corner,target,e){if(corner in cursorOffset){this.setCursor(this._getRotatedCornerCursor(corner,target,e))}else if(corner===&quot;mtr&quot;&amp;&amp;target.hasRotatingPoint){this.setCursor(this.rotationCursor)}else{this.setCursor(this.defaultCursor);return false}},_getRotatedCornerCursor:function(corner,target,e){var n=Math.round(target.getAngle()%360/45);if(n&lt;0){n+=8}n+=cursorOffset[corner];if(e[this.altActionKey]&amp;&amp;cursorOffset[corner]%2===0){n+=2}n%=8;return this.cursorMap[n]}})})();(function(){var min=Math.min,max=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(e,target){var activeObject=this.getActiveObject();return e[this.selectionKey]&amp;&amp;target&amp;&amp;target.selectable&amp;&amp;(this.getActiveGroup()||activeObject&amp;&amp;activeObject!==target)&amp;&amp;this.selection},_handleGrouping:function(e,target){var activeGroup=this.getActiveGroup();if(target===activeGroup){target=this.findTarget(e,true);if(!target){return}}if(activeGroup){this._updateActiveGroup(target,e)}else{this._createActiveGroup(target,e)}if(this._activeGroup){this._activeGroup.saveCoords()}},_updateActiveGroup:function(target,e){var activeGroup=this.getActiveGroup();if(activeGroup.contains(target)){activeGroup.removeWithUpdate(target);target.set(&quot;active&quot;,false);if(activeGroup.size()===1){this.discardActiveGroup(e);this.setActiveObject(activeGroup.item(0));return}}else{activeGroup.addWithUpdate(target)}this.fire(&quot;selection:created&quot;,{target:activeGroup,e:e});activeGroup.set(&quot;active&quot;,true)},_createActiveGroup:function(target,e){if(this._activeObject&amp;&amp;target!==this._activeObject){var group=this._createGroup(target);group.addWithUpdate();this.setActiveGroup(group);this._activeObject=null;this.fire(&quot;selection:created&quot;,{target:group,e:e})}target.set(&quot;active&quot;,true)},_createGroup:function(target){var objects=this.getObjects(),isActiveLower=objects.indexOf(this._activeObject)&lt;objects.indexOf(target),groupObjects=isActiveLower?[this._activeObject,target]:[target,this._activeObject];this._activeObject.isEditing&amp;&amp;this._activeObject.exitEditing();return new fabric.Group(groupObjects,{canvas:this})},_groupSelectedObjects:function(e){var group=this._collectObjects();if(group.length===1){this.setActiveObject(group[0],e)}else if(group.length&gt;1){group=new fabric.Group(group.reverse(),{canvas:this});group.addWithUpdate();this.setActiveGroup(group,e);group.saveCoords();this.fire(&quot;selection:created&quot;,{target:group});this.renderAll()}},_collectObjects:function(){var group=[],currentObject,x1=this._groupSelector.ex,y1=this._groupSelector.ey,x2=x1+this._groupSelector.left,y2=y1+this._groupSelector.top,selectionX1Y1=new fabric.Point(min(x1,x2),min(y1,y2)),selectionX2Y2=new fabric.Point(max(x1,x2),max(y1,y2)),isClick=x1===x2&amp;&amp;y1===y2;for(var i=this._objects.length;i--;){currentObject=this._objects[i];if(!currentObject||!currentObject.selectable||!currentObject.visible){continue}if(currentObject.intersectsWithRect(selectionX1Y1,selectionX2Y2)||currentObject.isContainedWithinRect(selectionX1Y1,selectionX2Y2)||currentObject.containsPoint(selectionX1Y1)||currentObject.containsPoint(selectionX2Y2)){currentObject.set(&quot;active&quot;,true);group.push(currentObject);if(isClick){break}}}return group},_maybeGroupObjects:function(e){if(this.selection&amp;&amp;this._groupSelector){this._groupSelectedObjects(e)}var activeGroup=this.getActiveGroup();if(activeGroup){activeGroup.setObjectsCoords().setCoords();activeGroup.isMoving=false;this.setCursor(this.defaultCursor)}this._groupSelector=null;this._currentTransform=null}})})();fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(options){options||(options={});var format=options.format||&quot;png&quot;,quality=options.quality||1,multiplier=options.multiplier||1,cropping={left:options.left,top:options.top,width:options.width,height:options.height};if(this._isRetinaScaling()){multiplier*=fabric.devicePixelRatio}if(multiplier!==1){return this.__toDataURLWithMultiplier(format,quality,cropping,multiplier)}else{return this.__toDataURL(format,quality,cropping)}},__toDataURL:function(format,quality,cropping){this.renderAll();var canvasEl=this.contextContainer.canvas,croppedCanvasEl=this.__getCroppedCanvas(canvasEl,cropping);if(format===&quot;jpg&quot;){format=&quot;jpeg&quot;}var data=fabric.StaticCanvas.supports(&quot;toDataURLWithQuality&quot;)?(croppedCanvasEl||canvasEl).toDataURL(&quot;image/&quot;+format,quality):(croppedCanvasEl||canvasEl).toDataURL(&quot;image/&quot;+format);if(croppedCanvasEl){croppedCanvasEl=null}return data},__getCroppedCanvas:function(canvasEl,cropping){var croppedCanvasEl,croppedCtx,shouldCrop=&quot;left&quot;in cropping||&quot;top&quot;in cropping||&quot;width&quot;in cropping||&quot;height&quot;in cropping;if(shouldCrop){croppedCanvasEl=fabric.util.createCanvasElement();croppedCtx=croppedCanvasEl.getContext(&quot;2d&quot;);croppedCanvasEl.width=cropping.width||this.width;croppedCanvasEl.height=cropping.height||this.height;croppedCtx.drawImage(canvasEl,-cropping.left||0,-cropping.top||0)}return croppedCanvasEl},__toDataURLWithMultiplier:function(format,quality,cropping,multiplier){var origWidth=this.getWidth(),origHeight=this.getHeight(),scaledWidth=origWidth*multiplier,scaledHeight=origHeight*multiplier,activeObject=this.getActiveObject(),activeGroup=this.getActiveGroup(),zoom=this.getZoom(),newZoom=zoom*multiplier/fabric.devicePixelRatio;if(multiplier&gt;1){this.setDimensions({width:scaledWidth,height:scaledHeight})}this.setZoom(newZoom);if(cropping.left){cropping.left*=multiplier}if(cropping.top){cropping.top*=multiplier}if(cropping.width){cropping.width*=multiplier}else if(multiplier&lt;1){cropping.width=scaledWidth}if(cropping.height){cropping.height*=multiplier}else if(multiplier&lt;1){cropping.height=scaledHeight}if(activeGroup){this._tempRemoveBordersControlsFromGroup(activeGroup)}else if(activeObject&amp;&amp;this.deactivateAll){this.deactivateAll()}var data=this.__toDataURL(format,quality,cropping);if(activeGroup){this._restoreBordersControlsOnGroup(activeGroup)}else if(activeObject&amp;&amp;this.setActiveObject){this.setActiveObject(activeObject)}this.setZoom(zoom);this.setDimensions({width:origWidth,height:origHeight});return data},toDataURLWithMultiplier:function(format,multiplier,quality){return this.toDataURL({format:format,multiplier:multiplier,quality:quality})},_tempRemoveBordersControlsFromGroup:function(group){group.origHasControls=group.hasControls;group.origBorderColor=group.borderColor;group.hasControls=true;group.borderColor=&quot;rgba(0,0,0,0)&quot;;group.forEachObject(function(o){o.origBorderColor=o.borderColor;o.borderColor=&quot;rgba(0,0,0,0)&quot;})},_restoreBordersControlsOnGroup:function(group){group.hideControls=group.origHideControls;group.borderColor=group.origBorderColor;group.forEachObject(function(o){o.borderColor=o.origBorderColor;delete o.origBorderColor})}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(json,callback,reviver){return this.loadFromJSON(json,callback,reviver)},loadFromJSON:function(json,callback,reviver){if(!json){return}var serialized=typeof json===&quot;string&quot;?JSON.parse(json):fabric.util.object.clone(json);this.clear();var _this=this;this._enlivenObjects(serialized.objects,function(){_this._setBgOverlay(serialized,function(){delete serialized.objects;delete serialized.backgroundImage;delete serialized.overlayImage;delete serialized.background;delete serialized.overlay;for(var prop in serialized){_this[prop]=serialized[prop]}callback&amp;&amp;callback()})},reviver);return this},_setBgOverlay:function(serialized,callback){var _this=this,loaded={backgroundColor:false,overlayColor:false,backgroundImage:false,overlayImage:false};if(!serialized.backgroundImage&amp;&amp;!serialized.overlayImage&amp;&amp;!serialized.background&amp;&amp;!serialized.overlay){callback&amp;&amp;callback();return}var cbIfLoaded=function(){if(loaded.backgroundImage&amp;&amp;loaded.overlayImage&amp;&amp;loaded.backgroundColor&amp;&amp;loaded.overlayColor){_this.renderAll();callback&amp;&amp;callback()}};this.__setBgOverlay(&quot;backgroundImage&quot;,serialized.backgroundImage,loaded,cbIfLoaded);this.__setBgOverlay(&quot;overlayImage&quot;,serialized.overlayImage,loaded,cbIfLoaded);this.__setBgOverlay(&quot;backgroundColor&quot;,serialized.background,loaded,cbIfLoaded);this.__setBgOverlay(&quot;overlayColor&quot;,serialized.overlay,loaded,cbIfLoaded);cbIfLoaded()},__setBgOverlay:function(property,value,loaded,callback){var _this=this;if(!value){loaded[property]=true;return}if(property===&quot;backgroundImage&quot;||property===&quot;overlayImage&quot;){fabric.Image.fromObject(value,function(img){_this[property]=img;loaded[property]=true;callback&amp;&amp;callback()})}else{this[&quot;set&quot;+fabric.util.string.capitalize(property,true)](value,function(){loaded[property]=true;callback&amp;&amp;callback()})}},_enlivenObjects:function(objects,callback,reviver){var _this=this;if(!objects||objects.length===0){callback&amp;&amp;callback();return}var renderOnAddRemove=this.renderOnAddRemove;this.renderOnAddRemove=false;fabric.util.enlivenObjects(objects,function(enlivenedObjects){enlivenedObjects.forEach(function(obj,index){_this.insertAt(obj,index,true)});_this.renderOnAddRemove=renderOnAddRemove;callback&amp;&amp;callback()},null,reviver)},_toDataURL:function(format,callback){this.clone(function(clone){callback(clone.toDataURL(format))})},_toDataURLWithMultiplier:function(format,multiplier,callback){this.clone(function(clone){callback(clone.toDataURLWithMultiplier(format,multiplier))})},clone:function(callback,properties){var data=JSON.stringify(this.toJSON(properties));this.cloneWithoutData(function(clone){clone.loadFromJSON(data,function(){callback&amp;&amp;callback(clone)})})},cloneWithoutData:function(callback){var el=fabric.document.createElement(&quot;canvas&quot;);el.width=this.getWidth();el.height=this.getHeight();var clone=new fabric.Canvas(el);clone.clipTo=this.clipTo;if(this.backgroundImage){clone.setBackgroundImage(this.backgroundImage.src,function(){clone.renderAll();callback&amp;&amp;callback(clone)});clone.backgroundImageOpacity=this.backgroundImageOpacity;clone.backgroundImageStretch=this.backgroundImageStretch}else{callback&amp;&amp;callback(clone)}}});(function(global){&quot;use strict&quot;;var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,toFixed=fabric.util.toFixed,capitalize=fabric.util.string.capitalize,degreesToRadians=fabric.util.degreesToRadians,supportsLineDash=fabric.StaticCanvas.supports(&quot;setLineDash&quot;);if(fabric.Object){return}fabric.Object=fabric.util.createClass({type:&quot;object&quot;,originX:&quot;left&quot;,originY:&quot;top&quot;,top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:false,flipY:false,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,transparentCorners:true,hoverCursor:null,moveCursor:null,padding:0,borderColor:&quot;rgba(102,153,255,0.75)&quot;,borderDashArray:null,cornerColor:&quot;rgba(102,153,255,0.5)&quot;,cornerStrokeColor:null,cornerStyle:&quot;rect&quot;,cornerDashArray:null,centeredScaling:false,centeredRotation:true,fill:&quot;rgb(0,0,0)&quot;,fillRule:&quot;nonzero&quot;,globalCompositeOperation:&quot;source-over&quot;,backgroundColor:&quot;&quot;,selectionBackgroundColor:&quot;&quot;,stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:&quot;butt&quot;,strokeLineJoin:&quot;miter&quot;,strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:true,evented:true,visible:true,hasControls:true,hasBorders:true,hasRotatingPoint:true,rotatingPointOffset:40,perPixelTargetFind:false,includeDefaultValues:true,clipTo:null,lockMovementX:false,lockMovementY:false,lockRotation:false,lockScalingX:false,lockScalingY:false,lockUniScaling:false,lockSkewingX:false,lockSkewingY:false,lockScalingFlip:false,excludeFromExport:false,stateProperties:(&quot;top left width height scaleX scaleY flipX flipY originX originY transformMatrix &quot;+&quot;stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit &quot;+&quot;angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor &quot;+&quot;alignX alignY meetOrSlice skewX skewY&quot;).split(&quot; &quot;),initialize:function(options){if(options){this.setOptions(options)}},_initGradient:function(options){if(options.fill&amp;&amp;options.fill.colorStops&amp;&amp;!(options.fill instanceof fabric.Gradient)){this.set(&quot;fill&quot;,new fabric.Gradient(options.fill))}if(options.stroke&amp;&amp;options.stroke.colorStops&amp;&amp;!(options.stroke instanceof fabric.Gradient)){this.set(&quot;stroke&quot;,new fabric.Gradient(options.stroke))}},_initPattern:function(options){if(options.fill&amp;&amp;options.fill.source&amp;&amp;!(options.fill instanceof fabric.Pattern)){this.set(&quot;fill&quot;,new fabric.Pattern(options.fill))}if(options.stroke&amp;&amp;options.stroke.source&amp;&amp;!(options.stroke instanceof fabric.Pattern)){this.set(&quot;stroke&quot;,new fabric.Pattern(options.stroke))}},_initClipping:function(options){if(!options.clipTo||typeof options.clipTo!==&quot;string&quot;){return}var functionBody=fabric.util.getFunctionBody(options.clipTo);if(typeof functionBody!==&quot;undefined&quot;){this.clipTo=new Function(&quot;ctx&quot;,functionBody)}},setOptions:function(options){for(var prop in options){this.set(prop,options[prop])}this._initGradient(options);this._initPattern(options);this._initClipping(options)},transform:function(ctx,fromLeft){if(this.group&amp;&amp;this.canvas.preserveObjectStacking&amp;&amp;this.group===this.canvas._activeGroup){this.group.transform(ctx)}var center=fromLeft?this._getLeftTopCoords():this.getCenterPoint();ctx.translate(center.x,center.y);ctx.rotate(degreesToRadians(this.angle));ctx.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1));ctx.transform(1,0,Math.tan(degreesToRadians(this.skewX)),1,0,0);ctx.transform(1,Math.tan(degreesToRadians(this.skewY)),0,1,0,0)},toObject:function(propertiesToInclude){var NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS,object={type:this.type,originX:this.originX,originY:this.originY,left:toFixed(this.left,NUM_FRACTION_DIGITS),top:toFixed(this.top,NUM_FRACTION_DIGITS),width:toFixed(this.width,NUM_FRACTION_DIGITS),height:toFixed(this.height,NUM_FRACTION_DIGITS),fill:this.fill&amp;&amp;this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&amp;&amp;this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:toFixed(this.strokeWidth,NUM_FRACTION_DIGITS),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:toFixed(this.strokeMiterLimit,NUM_FRACTION_DIGITS),scaleX:toFixed(this.scaleX,NUM_FRACTION_DIGITS),scaleY:toFixed(this.scaleY,NUM_FRACTION_DIGITS),angle:toFixed(this.getAngle(),NUM_FRACTION_DIGITS),flipX:this.flipX,flipY:this.flipY,opacity:toFixed(this.opacity,NUM_FRACTION_DIGITS),shadow:this.shadow&amp;&amp;this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&amp;&amp;String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation,transformMatrix:this.transformMatrix?this.transformMatrix.concat():this.transformMatrix,skewX:toFixed(this.skewX,NUM_FRACTION_DIGITS),skewY:toFixed(this.skewY,NUM_FRACTION_DIGITS)};if(!this.includeDefaultValues){object=this._removeDefaultValues(object)}fabric.util.populateWithProperties(this,object,propertiesToInclude);return object},toDatalessObject:function(propertiesToInclude){return this.toObject(propertiesToInclude)},_removeDefaultValues:function(object){var prototype=fabric.util.getKlass(object.type).prototype,stateProperties=prototype.stateProperties;stateProperties.forEach(function(prop){if(object[prop]===prototype[prop]){delete object[prop]}var isArray=Object.prototype.toString.call(object[prop])===&quot;[object Array]&quot;&amp;&amp;Object.prototype.toString.call(prototype[prop])===&quot;[object Array]&quot;;if(isArray&amp;&amp;object[prop].length===0&amp;&amp;prototype[prop].length===0){delete object[prop]}});return object},toString:function(){return&quot;#&lt;fabric.&quot;+capitalize(this.type)+&quot;&gt;&quot;},get:function(property){return this[property]},_setObject:function(obj){for(var prop in obj){this._set(prop,obj[prop])}},set:function(key,value){if(typeof key===&quot;object&quot;){this._setObject(key)}else{if(typeof value===&quot;function&quot;&amp;&amp;key!==&quot;clipTo&quot;){this._set(key,value(this.get(key)))}else{this._set(key,value)}}return this},_set:function(key,value){var shouldConstrainValue=key===&quot;scaleX&quot;||key===&quot;scaleY&quot;;if(shouldConstrainValue){value=this._constrainScale(value)}if(key===&quot;scaleX&quot;&amp;&amp;value&lt;0){this.flipX=!this.flipX;value*=-1}else if(key===&quot;scaleY&quot;&amp;&amp;value&lt;0){this.flipY=!this.flipY;value*=-1}else if(key===&quot;shadow&quot;&amp;&amp;value&amp;&amp;!(value instanceof fabric.Shadow)){value=new fabric.Shadow(value)}this[key]=value;if(key===&quot;width&quot;||key===&quot;height&quot;){this.minScaleLimit=Math.min(.1,1/Math.max(this.width,this.height))}return this},setOnGroup:function(){},toggle:function(property){var value=this.get(property);if(typeof value===&quot;boolean&quot;){this.set(property,!value)}return this},setSourcePath:function(value){this.sourcePath=value;return this},getViewportTransform:function(){if(this.canvas&amp;&amp;this.canvas.viewportTransform){return this.canvas.viewportTransform}return[1,0,0,1,0,0]},render:function(ctx,noTransform){if(this.width===0&amp;&amp;this.height===0||!this.visible){return}ctx.save();this._setupCompositeOperation(ctx);this.drawSelectionBackground(ctx);if(!noTransform){this.transform(ctx)}this._setStrokeStyles(ctx);this._setFillStyles(ctx);if(this.transformMatrix){ctx.transform.apply(ctx,this.transformMatrix)}this._setOpacity(ctx);this._setShadow(ctx);this.clipTo&amp;&amp;fabric.util.clipContext(this,ctx);this._render(ctx,noTransform);this.clipTo&amp;&amp;ctx.restore();ctx.restore()},_setOpacity:function(ctx){if(this.group){this.group._setOpacity(ctx)}ctx.globalAlpha*=this.opacity},_setStrokeStyles:function(ctx){if(this.stroke){ctx.lineWidth=this.strokeWidth;ctx.lineCap=this.strokeLineCap;ctx.lineJoin=this.strokeLineJoin;ctx.miterLimit=this.strokeMiterLimit;ctx.strokeStyle=this.stroke.toLive?this.stroke.toLive(ctx,this):this.stroke}},_setFillStyles:function(ctx){if(this.fill){ctx.fillStyle=this.fill.toLive?this.fill.toLive(ctx,this):this.fill}},_setLineDash:function(ctx,dashArray,alternative){if(!dashArray){return}if(1&amp;dashArray.length){dashArray.push.apply(dashArray,dashArray)}if(supportsLineDash){ctx.setLineDash(dashArray)}else{alternative&amp;&amp;alternative(ctx)}},_renderControls:function(ctx,noTransform){if(!this.active||noTransform||this.group&amp;&amp;this.group!==this.canvas.getActiveGroup()){return}var vpt=this.getViewportTransform(),matrix=this.calcTransformMatrix(),options;matrix=fabric.util.multiplyTransformMatrices(vpt,matrix);options=fabric.util.qrDecompose(matrix);ctx.save();ctx.translate(options.translateX,options.translateY);</td>
      </tr>
      <tr>
        <td id="L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="LC6" class="blob-code blob-code-inner js-file-line">ctx.lineWidth=1/this.borderScaleFactor;ctx.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;if(this.group&amp;&amp;this.group===this.canvas.getActiveGroup()){ctx.rotate(degreesToRadians(options.angle));this.drawBordersInGroup(ctx,options)}else{ctx.rotate(degreesToRadians(this.angle));this.drawBorders(ctx)}this.drawControls(ctx);ctx.restore()},_setShadow:function(ctx){if(!this.shadow){return}var multX=this.canvas&amp;&amp;this.canvas.viewportTransform[0]||1,multY=this.canvas&amp;&amp;this.canvas.viewportTransform[3]||1;if(this.canvas&amp;&amp;this.canvas._isRetinaScaling()){multX*=fabric.devicePixelRatio;multY*=fabric.devicePixelRatio}ctx.shadowColor=this.shadow.color;ctx.shadowBlur=this.shadow.blur*(multX+multY)*(this.scaleX+this.scaleY)/4;ctx.shadowOffsetX=this.shadow.offsetX*multX*this.scaleX;ctx.shadowOffsetY=this.shadow.offsetY*multY*this.scaleY},_removeShadow:function(ctx){if(!this.shadow){return}ctx.shadowColor=&quot;&quot;;ctx.shadowBlur=ctx.shadowOffsetX=ctx.shadowOffsetY=0},_renderFill:function(ctx){if(!this.fill){return}ctx.save();if(this.fill.gradientTransform){var g=this.fill.gradientTransform;ctx.transform.apply(ctx,g)}if(this.fill.toLive){ctx.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0)}if(this.fillRule===&quot;evenodd&quot;){ctx.fill(&quot;evenodd&quot;)}else{ctx.fill()}ctx.restore()},_renderStroke:function(ctx){if(!this.stroke||this.strokeWidth===0){return}if(this.shadow&amp;&amp;!this.shadow.affectStroke){this._removeShadow(ctx)}ctx.save();this._setLineDash(ctx,this.strokeDashArray,this._renderDashedStroke);if(this.stroke.gradientTransform){var g=this.stroke.gradientTransform;ctx.transform.apply(ctx,g)}if(this.stroke.toLive){ctx.translate(-this.width/2+this.stroke.offsetX||0,-this.height/2+this.stroke.offsetY||0)}ctx.stroke();ctx.restore()},clone:function(callback,propertiesToInclude){if(this.constructor.fromObject){return this.constructor.fromObject(this.toObject(propertiesToInclude),callback)}return new fabric.Object(this.toObject(propertiesToInclude))},cloneAsImage:function(callback){var dataUrl=this.toDataURL();fabric.util.loadImage(dataUrl,function(img){if(callback){callback(new fabric.Image(img))}});return this},toDataURL:function(options){options||(options={});var el=fabric.util.createCanvasElement(),boundingRect=this.getBoundingRect();el.width=boundingRect.width;el.height=boundingRect.height;fabric.util.wrapElement(el,&quot;div&quot;);var canvas=new fabric.StaticCanvas(el);if(options.format===&quot;jpg&quot;){options.format=&quot;jpeg&quot;}if(options.format===&quot;jpeg&quot;){canvas.backgroundColor=&quot;#fff&quot;}var origParams={active:this.get(&quot;active&quot;),left:this.getLeft(),top:this.getTop()};this.set(&quot;active&quot;,false);this.setPositionByOrigin(new fabric.Point(canvas.getWidth()/2,canvas.getHeight()/2),&quot;center&quot;,&quot;center&quot;);var originalCanvas=this.canvas;canvas.add(this);var data=canvas.toDataURL(options);this.set(origParams).setCoords();this.canvas=originalCanvas;canvas.dispose();canvas=null;return data},isType:function(type){return this.type===type},complexity:function(){return 0},toJSON:function(propertiesToInclude){return this.toObject(propertiesToInclude)},setGradient:function(property,options){options||(options={});var gradient={colorStops:[]};gradient.type=options.type||(options.r1||options.r2?&quot;radial&quot;:&quot;linear&quot;);gradient.coords={x1:options.x1,y1:options.y1,x2:options.x2,y2:options.y2};if(options.r1||options.r2){gradient.coords.r1=options.r1;gradient.coords.r2=options.r2}options.gradientTransform&amp;&amp;(gradient.gradientTransform=options.gradientTransform);for(var position in options.colorStops){var color=new fabric.Color(options.colorStops[position]);gradient.colorStops.push({offset:position,color:color.toRgb(),opacity:color.getAlpha()})}return this.set(property,fabric.Gradient.forObject(this,gradient))},setPatternFill:function(options){return this.set(&quot;fill&quot;,new fabric.Pattern(options))},setShadow:function(options){return this.set(&quot;shadow&quot;,options?new fabric.Shadow(options):null)},setColor:function(color){this.set(&quot;fill&quot;,color);return this},setAngle:function(angle){var shouldCenterOrigin=(this.originX!==&quot;center&quot;||this.originY!==&quot;center&quot;)&amp;&amp;this.centeredRotation;if(shouldCenterOrigin){this._setOriginToCenter()}this.set(&quot;angle&quot;,angle);if(shouldCenterOrigin){this._resetOrigin()}return this},centerH:function(){this.canvas&amp;&amp;this.canvas.centerObjectH(this);return this},viewportCenterH:function(){this.canvas&amp;&amp;this.canvas.viewportCenterObjectH(this);return this},centerV:function(){this.canvas&amp;&amp;this.canvas.centerObjectV(this);return this},viewportCenterV:function(){this.canvas&amp;&amp;this.canvas.viewportCenterObjectV(this);return this},center:function(){this.canvas&amp;&amp;this.canvas.centerObject(this);return this},viewportCenter:function(){this.canvas&amp;&amp;this.canvas.viewportCenterObject(this);return this},remove:function(){this.canvas&amp;&amp;this.canvas.remove(this);return this},getLocalPointer:function(e,pointer){pointer=pointer||this.canvas.getPointer(e);var pClicked=new fabric.Point(pointer.x,pointer.y),objectLeftTop=this._getLeftTopCoords();if(this.angle){pClicked=fabric.util.rotatePoint(pClicked,objectLeftTop,fabric.util.degreesToRadians(-this.angle))}return{x:pClicked.x-objectLeftTop.x,y:pClicked.y-objectLeftTop.y}},_setupCompositeOperation:function(ctx){if(this.globalCompositeOperation){ctx.globalCompositeOperation=this.globalCompositeOperation}}});fabric.util.createAccessors(fabric.Object);fabric.Object.prototype.rotate=fabric.Object.prototype.setAngle;extend(fabric.Object.prototype,fabric.Observable);fabric.Object.NUM_FRACTION_DIGITS=2;fabric.Object.__uid=0})(typeof exports!==&quot;undefined&quot;?exports:this);(function(){var degreesToRadians=fabric.util.degreesToRadians,originXOffset={left:-.5,center:0,right:.5},originYOffset={top:-.5,center:0,bottom:.5};fabric.util.object.extend(fabric.Object.prototype,{translateToGivenOrigin:function(point,fromOriginX,fromOriginY,toOriginX,toOriginY){var x=point.x,y=point.y,offsetX=originXOffset[toOriginX]-originXOffset[fromOriginX],offsetY=originYOffset[toOriginY]-originYOffset[fromOriginY],dim;if(offsetX||offsetY){dim=this._getTransformedDimensions();x=point.x+offsetX*dim.x;y=point.y+offsetY*dim.y}return new fabric.Point(x,y)},translateToCenterPoint:function(point,originX,originY){var p=this.translateToGivenOrigin(point,originX,originY,&quot;center&quot;,&quot;center&quot;);if(this.angle){return fabric.util.rotatePoint(p,point,degreesToRadians(this.angle))}return p},translateToOriginPoint:function(center,originX,originY){var p=this.translateToGivenOrigin(center,&quot;center&quot;,&quot;center&quot;,originX,originY);if(this.angle){return fabric.util.rotatePoint(p,center,degreesToRadians(this.angle))}return p},getCenterPoint:function(){var leftTop=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(leftTop,this.originX,this.originY)},getPointByOrigin:function(originX,originY){var center=this.getCenterPoint();return this.translateToOriginPoint(center,originX,originY)},toLocalPoint:function(point,originX,originY){var center=this.getCenterPoint(),p,p2;if(originX&amp;&amp;originY){p=this.translateToGivenOrigin(center,&quot;center&quot;,&quot;center&quot;,originX,originY)}else{p=new fabric.Point(this.left,this.top)}p2=new fabric.Point(point.x,point.y);if(this.angle){p2=fabric.util.rotatePoint(p2,center,-degreesToRadians(this.angle))}return p2.subtractEquals(p)},setPositionByOrigin:function(pos,originX,originY){var center=this.translateToCenterPoint(pos,originX,originY),position=this.translateToOriginPoint(center,this.originX,this.originY);this.set(&quot;left&quot;,position.x);this.set(&quot;top&quot;,position.y)},adjustPosition:function(to){var angle=degreesToRadians(this.angle),hypotFull=this.getWidth(),xFull=Math.cos(angle)*hypotFull,yFull=Math.sin(angle)*hypotFull;this.left+=xFull*(originXOffset[to]-originXOffset[this.originX]);this.top+=yFull*(originXOffset[to]-originXOffset[this.originX]);this.setCoords();this.originX=to},_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var center=this.getCenterPoint();this.originX=&quot;center&quot;;this.originY=&quot;center&quot;;this.left=center.x;this.top=center.y},_resetOrigin:function(){var originPoint=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=originPoint.x;this.top=originPoint.y;this._originalOriginX=null;this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),&quot;left&quot;,&quot;top&quot;)}})})();(function(){function getCoords(oCoords){return[new fabric.Point(oCoords.tl.x,oCoords.tl.y),new fabric.Point(oCoords.tr.x,oCoords.tr.y),new fabric.Point(oCoords.br.x,oCoords.br.y),new fabric.Point(oCoords.bl.x,oCoords.bl.y)]}var degreesToRadians=fabric.util.degreesToRadians,multiplyMatrices=fabric.util.multiplyTransformMatrices;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(pointTL,pointBR){var oCoords=getCoords(this.oCoords),intersection=fabric.Intersection.intersectPolygonRectangle(oCoords,pointTL,pointBR);return intersection.status===&quot;Intersection&quot;},intersectsWithObject:function(other){var intersection=fabric.Intersection.intersectPolygonPolygon(getCoords(this.oCoords),getCoords(other.oCoords));return intersection.status===&quot;Intersection&quot;},isContainedWithinObject:function(other){var boundingRect=other.getBoundingRect(),point1=new fabric.Point(boundingRect.left,boundingRect.top),point2=new fabric.Point(boundingRect.left+boundingRect.width,boundingRect.top+boundingRect.height);return this.isContainedWithinRect(point1,point2)},isContainedWithinRect:function(pointTL,pointBR){var boundingRect=this.getBoundingRect();return boundingRect.left&gt;=pointTL.x&amp;&amp;boundingRect.left+boundingRect.width&lt;=pointBR.x&amp;&amp;boundingRect.top&gt;=pointTL.y&amp;&amp;boundingRect.top+boundingRect.height&lt;=pointBR.y},containsPoint:function(point){if(!this.oCoords){this.setCoords()}var lines=this._getImageLines(this.oCoords),xPoints=this._findCrossPoints(point,lines);return xPoints!==0&amp;&amp;xPoints%2===1},_getImageLines:function(oCoords){return{topline:{o:oCoords.tl,d:oCoords.tr},rightline:{o:oCoords.tr,d:oCoords.br},bottomline:{o:oCoords.br,d:oCoords.bl},leftline:{o:oCoords.bl,d:oCoords.tl}}},_findCrossPoints:function(point,oCoords){var b1,b2,a1,a2,xi,yi,xcount=0,iLine;for(var lineKey in oCoords){iLine=oCoords[lineKey];if(iLine.o.y&lt;point.y&amp;&amp;iLine.d.y&lt;point.y){continue}if(iLine.o.y&gt;=point.y&amp;&amp;iLine.d.y&gt;=point.y){continue}if(iLine.o.x===iLine.d.x&amp;&amp;iLine.o.x&gt;=point.x){xi=iLine.o.x;yi=point.y}else{b1=0;b2=(iLine.d.y-iLine.o.y)/(iLine.d.x-iLine.o.x);a1=point.y-b1*point.x;a2=iLine.o.y-b2*iLine.o.x;xi=-(a1-a2)/(b1-b2);yi=a1+b1*xi}if(xi&gt;=point.x){xcount+=1}if(xcount===2){break}}return xcount},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();return fabric.util.makeBoundingBoxFromPoints([this.oCoords.tl,this.oCoords.tr,this.oCoords.br,this.oCoords.bl])},getWidth:function(){return this._getTransformedDimensions().x},getHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(value){if(Math.abs(value)&lt;this.minScaleLimit){if(value&lt;0){return-this.minScaleLimit}else{return this.minScaleLimit}}return value},scale:function(value){value=this._constrainScale(value);if(value&lt;0){this.flipX=!this.flipX;this.flipY=!this.flipY;value*=-1}this.scaleX=value;this.scaleY=value;this.setCoords();return this},scaleToWidth:function(value){var boundingRectFactor=this.getBoundingRect().width/this.getWidth();return this.scale(value/this.width/boundingRectFactor)},scaleToHeight:function(value){var boundingRectFactor=this.getBoundingRect().height/this.getHeight();return this.scale(value/this.height/boundingRectFactor)},setCoords:function(){var theta=degreesToRadians(this.angle),vpt=this.getViewportTransform(),dim=this._calculateCurrentDimensions(),currentWidth=dim.x,currentHeight=dim.y;if(currentWidth&lt;0){currentWidth=Math.abs(currentWidth)}var sinTh=Math.sin(theta),cosTh=Math.cos(theta),_angle=currentWidth&gt;0?Math.atan(currentHeight/currentWidth):0,_hypotenuse=currentWidth/Math.cos(_angle)/2,offsetX=Math.cos(_angle+theta)*_hypotenuse,offsetY=Math.sin(_angle+theta)*_hypotenuse,coords=fabric.util.transformPoint(this.getCenterPoint(),vpt),tl=new fabric.Point(coords.x-offsetX,coords.y-offsetY),tr=new fabric.Point(tl.x+currentWidth*cosTh,tl.y+currentWidth*sinTh),bl=new fabric.Point(tl.x-currentHeight*sinTh,tl.y+currentHeight*cosTh),br=new fabric.Point(coords.x+offsetX,coords.y+offsetY),ml=new fabric.Point((tl.x+bl.x)/2,(tl.y+bl.y)/2),mt=new fabric.Point((tr.x+tl.x)/2,(tr.y+tl.y)/2),mr=new fabric.Point((br.x+tr.x)/2,(br.y+tr.y)/2),mb=new fabric.Point((br.x+bl.x)/2,(br.y+bl.y)/2),mtr=new fabric.Point(mt.x+sinTh*this.rotatingPointOffset,mt.y-cosTh*this.rotatingPointOffset);this.oCoords={tl:tl,tr:tr,br:br,bl:bl,ml:ml,mt:mt,mr:mr,mb:mb,mtr:mtr};this._setCornerCoords&amp;&amp;this._setCornerCoords();return this},_calcRotateMatrix:function(){if(this.angle){var theta=degreesToRadians(this.angle),cos=Math.cos(theta),sin=Math.sin(theta);return[cos,sin,-sin,cos,0,0]}return[1,0,0,1,0,0]},calcTransformMatrix:function(){var center=this.getCenterPoint(),translateMatrix=[1,0,0,1,center.x,center.y],rotateMatrix=this._calcRotateMatrix(),dimensionMatrix=this._calcDimensionsTransformMatrix(this.skewX,this.skewY,true),matrix=this.group?this.group.calcTransformMatrix():[1,0,0,1,0,0];matrix=multiplyMatrices(matrix,translateMatrix);matrix=multiplyMatrices(matrix,rotateMatrix);matrix=multiplyMatrices(matrix,dimensionMatrix);return matrix},_calcDimensionsTransformMatrix:function(skewX,skewY,flipping){var skewMatrixX=[1,0,Math.tan(degreesToRadians(skewX)),1],skewMatrixY=[1,Math.tan(degreesToRadians(skewY)),0,1],scaleX=this.scaleX*(flipping&amp;&amp;this.flipX?-1:1),scaleY=this.scaleY*(flipping&amp;&amp;this.flipY?-1:1),scaleMatrix=[scaleX,0,0,scaleY],m=multiplyMatrices(scaleMatrix,skewMatrixX,true);return multiplyMatrices(m,skewMatrixY,true)}})})();fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){if(this.group){fabric.StaticCanvas.prototype.sendToBack.call(this.group,this)}else{this.canvas.sendToBack(this)}return this},bringToFront:function(){if(this.group){fabric.StaticCanvas.prototype.bringToFront.call(this.group,this)}else{this.canvas.bringToFront(this)}return this},sendBackwards:function(intersecting){if(this.group){fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,intersecting)}else{this.canvas.sendBackwards(this,intersecting)}return this},bringForward:function(intersecting){if(this.group){fabric.StaticCanvas.prototype.bringForward.call(this.group,this,intersecting)}else{this.canvas.bringForward(this,intersecting)}return this},moveTo:function(index){if(this.group){fabric.StaticCanvas.prototype.moveTo.call(this.group,this,index)}else{this.canvas.moveTo(this,index)}return this}});(function(){function getSvgColorString(prop,value){if(!value){return prop+&quot;: none; &quot;}else if(value.toLive){return prop+&quot;: url(#SVGID_&quot;+value.id+&quot;); &quot;}else{var color=new fabric.Color(value),str=prop+&quot;: &quot;+color.toRgb()+&quot;; &quot;,opacity=color.getAlpha();if(opacity!==1){str+=prop+&quot;-opacity: &quot;+opacity.toString()+&quot;; &quot;}return str}}fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(skipShadow){var fillRule=this.fillRule,strokeWidth=this.strokeWidth?this.strokeWidth:&quot;0&quot;,strokeDashArray=this.strokeDashArray?this.strokeDashArray.join(&quot; &quot;):&quot;none&quot;,strokeLineCap=this.strokeLineCap?this.strokeLineCap:&quot;butt&quot;,strokeLineJoin=this.strokeLineJoin?this.strokeLineJoin:&quot;miter&quot;,strokeMiterLimit=this.strokeMiterLimit?this.strokeMiterLimit:&quot;4&quot;,opacity=typeof this.opacity!==&quot;undefined&quot;?this.opacity:&quot;1&quot;,visibility=this.visible?&quot;&quot;:&quot; visibility: hidden;&quot;,filter=skipShadow?&quot;&quot;:this.getSvgFilter(),fill=getSvgColorString(&quot;fill&quot;,this.fill),stroke=getSvgColorString(&quot;stroke&quot;,this.stroke);return[stroke,&quot;stroke-width: &quot;,strokeWidth,&quot;; &quot;,&quot;stroke-dasharray: &quot;,strokeDashArray,&quot;; &quot;,&quot;stroke-linecap: &quot;,strokeLineCap,&quot;; &quot;,&quot;stroke-linejoin: &quot;,strokeLineJoin,&quot;; &quot;,&quot;stroke-miterlimit: &quot;,strokeMiterLimit,&quot;; &quot;,fill,&quot;fill-rule: &quot;,fillRule,&quot;; &quot;,&quot;opacity: &quot;,opacity,&quot;;&quot;,filter,visibility].join(&quot;&quot;)},getSvgFilter:function(){return this.shadow?&quot;filter: url(#SVGID_&quot;+this.shadow.id+&quot;);&quot;:&quot;&quot;},getSvgId:function(){return this.id?&#39;id=&quot;&#39;+this.id+&#39;&quot; &#39;:&quot;&quot;},getSvgTransform:function(){if(this.group&amp;&amp;this.group.type===&quot;path-group&quot;){return&quot;&quot;}var toFixed=fabric.util.toFixed,angle=this.getAngle(),skewX=this.getSkewX()%360,skewY=this.getSkewY()%360,center=this.getCenterPoint(),NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS,translatePart=this.type===&quot;path-group&quot;?&quot;&quot;:&quot;translate(&quot;+toFixed(center.x,NUM_FRACTION_DIGITS)+&quot; &quot;+toFixed(center.y,NUM_FRACTION_DIGITS)+&quot;)&quot;,anglePart=angle!==0?&quot; rotate(&quot;+toFixed(angle,NUM_FRACTION_DIGITS)+&quot;)&quot;:&quot;&quot;,scalePart=this.scaleX===1&amp;&amp;this.scaleY===1?&quot;&quot;:&quot; scale(&quot;+toFixed(this.scaleX,NUM_FRACTION_DIGITS)+&quot; &quot;+toFixed(this.scaleY,NUM_FRACTION_DIGITS)+&quot;)&quot;,skewXPart=skewX!==0?&quot; skewX(&quot;+toFixed(skewX,NUM_FRACTION_DIGITS)+&quot;)&quot;:&quot;&quot;,skewYPart=skewY!==0?&quot; skewY(&quot;+toFixed(skewY,NUM_FRACTION_DIGITS)+&quot;)&quot;:&quot;&quot;,addTranslateX=this.type===&quot;path-group&quot;?this.width:0,flipXPart=this.flipX?&quot; matrix(-1 0 0 1 &quot;+addTranslateX+&quot; 0) &quot;:&quot;&quot;,addTranslateY=this.type===&quot;path-group&quot;?this.height:0,flipYPart=this.flipY?&quot; matrix(1 0 0 -1 0 &quot;+addTranslateY+&quot;)&quot;:&quot;&quot;;return[translatePart,anglePart,scalePart,flipXPart,flipYPart,skewXPart,skewYPart].join(&quot;&quot;)},getSvgTransformMatrix:function(){return this.transformMatrix?&quot; matrix(&quot;+this.transformMatrix.join(&quot; &quot;)+&quot;) &quot;:&quot;&quot;},_createBaseSVGMarkup:function(){var markup=[];if(this.fill&amp;&amp;this.fill.toLive){markup.push(this.fill.toSVG(this,false))}if(this.stroke&amp;&amp;this.stroke.toLive){markup.push(this.stroke.toSVG(this,false))}if(this.shadow){markup.push(this.shadow.toSVG(this))}return markup}})})();fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(prop){return this.get(prop)!==this.originalState[prop]},this)},saveState:function(options){this.stateProperties.forEach(function(prop){this.originalState[prop]=this.get(prop)},this);if(options&amp;&amp;options.stateProperties){options.stateProperties.forEach(function(prop){this.originalState[prop]=this.get(prop)},this)}return this},setupState:function(){this.originalState={};this.saveState();return this}});(function(){var degreesToRadians=fabric.util.degreesToRadians,isVML=function(){return typeof G_vmlCanvasManager!==&quot;undefined&quot;};fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(pointer){if(!this.hasControls||!this.active){return false}var ex=pointer.x,ey=pointer.y,xPoints,lines;this.__corner=0;for(var i in this.oCoords){if(!this.isControlVisible(i)){continue}if(i===&quot;mtr&quot;&amp;&amp;!this.hasRotatingPoint){continue}if(this.get(&quot;lockUniScaling&quot;)&amp;&amp;(i===&quot;mt&quot;||i===&quot;mr&quot;||i===&quot;mb&quot;||i===&quot;ml&quot;)){continue}lines=this._getImageLines(this.oCoords[i].corner);xPoints=this._findCrossPoints({x:ex,y:ey},lines);if(xPoints!==0&amp;&amp;xPoints%2===1){this.__corner=i;return i}}return false},_setCornerCoords:function(){var coords=this.oCoords,newTheta=degreesToRadians(45-this.angle),cornerHypotenuse=this.cornerSize*.707106,cosHalfOffset=cornerHypotenuse*Math.cos(newTheta),sinHalfOffset=cornerHypotenuse*Math.sin(newTheta),x,y;for(var point in coords){x=coords[point].x;y=coords[point].y;coords[point].corner={tl:{x:x-sinHalfOffset,y:y-cosHalfOffset},tr:{x:x+cosHalfOffset,y:y-sinHalfOffset},bl:{x:x-cosHalfOffset,y:y+sinHalfOffset},br:{x:x+sinHalfOffset,y:y+cosHalfOffset}}}},_getNonTransformedDimensions:function(){var strokeWidth=this.strokeWidth,w=this.width,h=this.height,addStrokeToW=true,addStrokeToH=true;if(this.type===&quot;line&quot;&amp;&amp;this.strokeLineCap===&quot;butt&quot;){addStrokeToH=w;addStrokeToW=h}if(addStrokeToH){h+=h&lt;0?-strokeWidth:strokeWidth}if(addStrokeToW){w+=w&lt;0?-strokeWidth:strokeWidth}return{x:w,y:h}},_getTransformedDimensions:function(skewX,skewY){if(typeof skewX===&quot;undefined&quot;){skewX=this.skewX}if(typeof skewY===&quot;undefined&quot;){skewY=this.skewY}var dimensions=this._getNonTransformedDimensions(),dimX=dimensions.x/2,dimY=dimensions.y/2,points=[{x:-dimX,y:-dimY},{x:dimX,y:-dimY},{x:-dimX,y:dimY},{x:dimX,y:dimY}],i,transformMatrix=this._calcDimensionsTransformMatrix(skewX,skewY,false),bbox;for(i=0;i&lt;points.length;i++){points[i]=fabric.util.transformPoint(points[i],transformMatrix)}bbox=fabric.util.makeBoundingBoxFromPoints(points);return{x:bbox.width,y:bbox.height}},_calculateCurrentDimensions:function(){var vpt=this.getViewportTransform(),dim=this._getTransformedDimensions(),w=dim.x,h=dim.y;w+=2*this.padding;h+=2*this.padding;return fabric.util.transformPoint(new fabric.Point(w,h),vpt,true)},drawSelectionBackground:function(ctx){if(!this.selectionBackgroundColor||!this.active||this.group){return this}ctx.save();var center=this.getCenterPoint(),wh=this._calculateCurrentDimensions();ctx.translate(center.x,center.y);ctx.rotate(degreesToRadians(this.angle));ctx.fillStyle=this.selectionBackgroundColor;ctx.fillRect(-wh.x/2,-wh.y/2,wh.x,wh.y);ctx.restore();return this},drawBorders:function(ctx){if(!this.hasBorders){return this}var wh=this._calculateCurrentDimensions(),strokeWidth=1/this.borderScaleFactor,width=wh.x+strokeWidth,height=wh.y+strokeWidth;ctx.save();ctx.strokeStyle=this.borderColor;this._setLineDash(ctx,this.borderDashArray,null);ctx.strokeRect(-width/2,-height/2,width,height);if(this.hasRotatingPoint&amp;&amp;this.isControlVisible(&quot;mtr&quot;)&amp;&amp;!this.get(&quot;lockRotation&quot;)&amp;&amp;this.hasControls){var rotateHeight=-height/2;ctx.beginPath();ctx.moveTo(0,rotateHeight);ctx.lineTo(0,rotateHeight-this.rotatingPointOffset);ctx.closePath();ctx.stroke()}ctx.restore();return this},drawBordersInGroup:function(ctx,options){if(!this.hasBorders){return this}var p=this._getNonTransformedDimensions(),matrix=fabric.util.customTransformMatrix(options.scaleX,options.scaleY,options.skewX),wh=fabric.util.transformPoint(p,matrix),strokeWidth=1/this.borderScaleFactor,width=wh.x+strokeWidth+2*this.padding,height=wh.y+strokeWidth+2*this.padding;ctx.save();this._setLineDash(ctx,this.borderDashArray,null);ctx.strokeStyle=this.borderColor;ctx.strokeRect(-width/2,-height/2,width,height);ctx.restore();return this},drawControls:function(ctx){if(!this.hasControls){return this}var wh=this._calculateCurrentDimensions(),width=wh.x,height=wh.y,scaleOffset=this.cornerSize,left=-(width+scaleOffset)/2,top=-(height+scaleOffset)/2,methodName=this.transparentCorners?&quot;stroke&quot;:&quot;fill&quot;;ctx.save();ctx.strokeStyle=ctx.fillStyle=this.cornerColor;if(!this.transparentCorners){ctx.strokeStyle=this.cornerStrokeColor}this._setLineDash(ctx,this.cornerDashArray,null);this._drawControl(&quot;tl&quot;,ctx,methodName,left,top);this._drawControl(&quot;tr&quot;,ctx,methodName,left+width,top);this._drawControl(&quot;bl&quot;,ctx,methodName,left,top+height);this._drawControl(&quot;br&quot;,ctx,methodName,left+width,top+height);if(!this.get(&quot;lockUniScaling&quot;)){this._drawControl(&quot;mt&quot;,ctx,methodName,left+width/2,top);this._drawControl(&quot;mb&quot;,ctx,methodName,left+width/2,top+height);this._drawControl(&quot;mr&quot;,ctx,methodName,left+width,top+height/2);this._drawControl(&quot;ml&quot;,ctx,methodName,left,top+height/2)}if(this.hasRotatingPoint){this._drawControl(&quot;mtr&quot;,ctx,methodName,left+width/2,top-this.rotatingPointOffset)}ctx.restore();return this},_drawControl:function(control,ctx,methodName,left,top){if(!this.isControlVisible(control)){return}var size=this.cornerSize,stroke=!this.transparentCorners&amp;&amp;this.cornerStrokeColor;switch(this.cornerStyle){case&quot;circle&quot;:ctx.beginPath();ctx.arc(left+size/2,top+size/2,size/2,0,2*Math.PI,false);ctx[methodName]();if(stroke){ctx.stroke()}break;default:isVML()||this.transparentCorners||ctx.clearRect(left,top,size,size);ctx[methodName+&quot;Rect&quot;](left,top,size,size);if(stroke){ctx.strokeRect(left,top,size,size)}}},isControlVisible:function(controlName){return this._getControlsVisibility()[controlName]},setControlVisible:function(controlName,visible){this._getControlsVisibility()[controlName]=visible;return this},setControlsVisibility:function(options){options||(options={});for(var p in options){this.setControlVisible(p,options[p])}return this},_getControlsVisibility:function(){if(!this._controlsVisibility){this._controlsVisibility={tl:true,tr:true,br:true,bl:true,ml:true,mt:true,mr:true,mb:true,mtr:true}}return this._controlsVisibility}})})();fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(object,callbacks){callbacks=callbacks||{};var empty=function(){},onComplete=callbacks.onComplete||empty,onChange=callbacks.onChange||empty,_this=this;fabric.util.animate({startValue:object.get(&quot;left&quot;),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(value){object.set(&quot;left&quot;,value);_this.renderAll();onChange()},onComplete:function(){object.setCoords();onComplete()}});return this},fxCenterObjectV:function(object,callbacks){callbacks=callbacks||{};var empty=function(){},onComplete=callbacks.onComplete||empty,onChange=callbacks.onChange||empty,_this=this;fabric.util.animate({startValue:object.get(&quot;top&quot;),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(value){object.set(&quot;top&quot;,value);_this.renderAll();onChange()},onComplete:function(){object.setCoords();onComplete()}});return this},fxRemove:function(object,callbacks){callbacks=callbacks||{};var empty=function(){},onComplete=callbacks.onComplete||empty,onChange=callbacks.onChange||empty,_this=this;fabric.util.animate({startValue:object.get(&quot;opacity&quot;),endValue:0,duration:this.FX_DURATION,onStart:function(){object.set(&quot;active&quot;,false)},onChange:function(value){object.set(&quot;opacity&quot;,value);_this.renderAll();onChange()},onComplete:function(){_this.remove(object);onComplete()}});return this}});fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&amp;&amp;typeof arguments[0]===&quot;object&quot;){var propsToAnimate=[],prop,skipCallbacks;for(prop in arguments[0]){propsToAnimate.push(prop)}for(var i=0,len=propsToAnimate.length;i&lt;len;i++){prop=propsToAnimate[i];skipCallbacks=i!==len-1;this._animate(prop,arguments[0][prop],arguments[1],skipCallbacks)}}else{this._animate.apply(this,arguments)}return this},_animate:function(property,to,options,skipCallbacks){var _this=this,propPair;to=to.toString();if(!options){options={}}else{options=fabric.util.object.clone(options)}if(~property.indexOf(&quot;.&quot;)){propPair=property.split(&quot;.&quot;)}var currentValue=propPair?this.get(propPair[0])[propPair[1]]:this.get(property);if(!(&quot;from&quot;in options)){options.from=currentValue}if(~to.indexOf(&quot;=&quot;)){to=currentValue+parseFloat(to.replace(&quot;=&quot;,&quot;&quot;))}else{to=parseFloat(to)}fabric.util.animate({startValue:options.from,endValue:to,byValue:options.by,easing:options.easing,duration:options.duration,abort:options.abort&amp;&amp;function(){return options.abort.call(_this)},onChange:function(value){if(propPair){_this[propPair[0]][propPair[1]]=value}else{_this.set(property,value)}if(skipCallbacks){return}options.onChange&amp;&amp;options.onChange()},onComplete:function(){if(skipCallbacks){return}_this.setCoords();options.onComplete&amp;&amp;options.onComplete()}})}});(function(global){&quot;use strict&quot;;var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,coordProps={x1:1,x2:1,y1:1,y2:1},supportsLineDash=fabric.StaticCanvas.supports(&quot;setLineDash&quot;);if(fabric.Line){fabric.warn(&quot;fabric.Line is already defined&quot;);return}fabric.Line=fabric.util.createClass(fabric.Object,{type:&quot;line&quot;,x1:0,y1:0,x2:0,y2:0,initialize:function(points,options){options=options||{};if(!points){points=[0,0,0,0]}this.callSuper(&quot;initialize&quot;,options);this.set(&quot;x1&quot;,points[0]);this.set(&quot;y1&quot;,points[1]);this.set(&quot;x2&quot;,points[2]);this.set(&quot;y2&quot;,points[3]);this._setWidthHeight(options)},_setWidthHeight:function(options){options||(options={});this.width=Math.abs(this.x2-this.x1);this.height=Math.abs(this.y2-this.y1);this.left=&quot;left&quot;in options?options.left:this._getLeftToOriginX();this.top=&quot;top&quot;in options?options.top:this._getTopToOriginY()},_set:function(key,value){this.callSuper(&quot;_set&quot;,key,value);if(typeof coordProps[key]!==&quot;undefined&quot;){this._setWidthHeight()}return this},_getLeftToOriginX:makeEdgeToOriginGetter({origin:&quot;originX&quot;,axis1:&quot;x1&quot;,axis2:&quot;x2&quot;,dimension:&quot;width&quot;},{nearest:&quot;left&quot;,center:&quot;center&quot;,farthest:&quot;right&quot;}),_getTopToOriginY:makeEdgeToOriginGetter({origin:&quot;originY&quot;,axis1:&quot;y1&quot;,axis2:&quot;y2&quot;,dimension:&quot;height&quot;},{nearest:&quot;top&quot;,center:&quot;center&quot;,farthest:&quot;bottom&quot;}),_render:function(ctx,noTransform){ctx.beginPath();if(noTransform){var cp=this.getCenterPoint();ctx.translate(cp.x-this.strokeWidth/2,cp.y-this.strokeWidth/2)}if(!this.strokeDashArray||this.strokeDashArray&amp;&amp;supportsLineDash){var p=this.calcLinePoints();ctx.moveTo(p.x1,p.y1);ctx.lineTo(p.x2,p.y2)}ctx.lineWidth=this.strokeWidth;var origStrokeStyle=ctx.strokeStyle;ctx.strokeStyle=this.stroke||ctx.fillStyle;this.stroke&amp;&amp;this._renderStroke(ctx);ctx.strokeStyle=origStrokeStyle},_renderDashedStroke:function(ctx){var p=this.calcLinePoints();ctx.beginPath();fabric.util.drawDashedLine(ctx,p.x1,p.y1,p.x2,p.y2,this.strokeDashArray);ctx.closePath()},toObject:function(propertiesToInclude){return extend(this.callSuper(&quot;toObject&quot;,propertiesToInclude),this.calcLinePoints())},calcLinePoints:function(){var xMult=this.x1&lt;=this.x2?-1:1,yMult=this.y1&lt;=this.y2?-1:1,x1=xMult*this.width*.5,y1=yMult*this.height*.5,x2=xMult*this.width*-.5,y2=yMult*this.height*-.5;return{x1:x1,x2:x2,y1:y1,y2:y2}},toSVG:function(reviver){var markup=this._createBaseSVGMarkup(),p={x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};if(!(this.group&amp;&amp;this.group.type===&quot;path-group&quot;)){p=this.calcLinePoints()}markup.push(&quot;&lt;line &quot;,this.getSvgId(),&#39;x1=&quot;&#39;,p.x1,&#39;&quot; y1=&quot;&#39;,p.y1,&#39;&quot; x2=&quot;&#39;,p.x2,&#39;&quot; y2=&quot;&#39;,p.y2,&#39;&quot; style=&quot;&#39;,this.getSvgStyles(),&#39;&quot; transform=&quot;&#39;,this.getSvgTransform(),this.getSvgTransformMatrix(),&#39;&quot;/&gt;\n&#39;);return reviver?reviver(markup.join(&quot;&quot;)):markup.join(&quot;&quot;)},complexity:function(){return 1}});fabric.Line.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat(&quot;x1 y1 x2 y2&quot;.split(&quot; &quot;));fabric.Line.fromElement=function(element,options){var parsedAttributes=fabric.parseAttributes(element,fabric.Line.ATTRIBUTE_NAMES),points=[parsedAttributes.x1||0,parsedAttributes.y1||0,parsedAttributes.x2||0,parsedAttributes.y2||0];return new fabric.Line(points,extend(parsedAttributes,options))};fabric.Line.fromObject=function(object){var points=[object.x1,object.y1,object.x2,object.y2];return new fabric.Line(points,object)};function makeEdgeToOriginGetter(propertyNames,originValues){var origin=propertyNames.origin,axis1=propertyNames.axis1,axis2=propertyNames.axis2,dimension=propertyNames.dimension,nearest=originValues.nearest,center=originValues.center,farthest=originValues.farthest;return function(){switch(this.get(origin)){case nearest:return Math.min(this.get(axis1),this.get(axis2));case center:return Math.min(this.get(axis1),this.get(axis2))+.5*this.get(dimension);case farthest:return Math.max(this.get(axis1),this.get(axis2))}}}})(typeof exports!==&quot;undefined&quot;?exports:this);(function(global){&quot;use strict&quot;;var fabric=global.fabric||(global.fabric={}),pi=Math.PI,extend=fabric.util.object.extend;if(fabric.Circle){fabric.warn(&quot;fabric.Circle is already defined.&quot;);return}fabric.Circle=fabric.util.createClass(fabric.Object,{type:&quot;circle&quot;,radius:0,startAngle:0,endAngle:pi*2,initialize:function(options){options=options||{};this.callSuper(&quot;initialize&quot;,options);this.set(&quot;radius&quot;,options.radius||0);this.startAngle=options.startAngle||this.startAngle;this.endAngle=options.endAngle||this.endAngle},_set:function(key,value){this.callSuper(&quot;_set&quot;,key,value);if(key===&quot;radius&quot;){this.setRadius(value)}return this},toObject:function(propertiesToInclude){return extend(this.callSuper(&quot;toObject&quot;,propertiesToInclude),{radius:this.get(&quot;radius&quot;),startAngle:this.startAngle,endAngle:this.endAngle})},toSVG:function(reviver){var markup=this._createBaseSVGMarkup(),x=0,y=0,angle=(this.endAngle-this.startAngle)%(2*pi);if(angle===0){if(this.group&amp;&amp;this.group.type===&quot;path-group&quot;){x=this.left+this.radius;y=this.top+this.radius}markup.push(&quot;&lt;circle &quot;,this.getSvgId(),&#39;cx=&quot;&#39;+x+&#39;&quot; cy=&quot;&#39;+y+&#39;&quot; &#39;,&#39;r=&quot;&#39;,this.radius,&#39;&quot; style=&quot;&#39;,this.getSvgStyles(),&#39;&quot; transform=&quot;&#39;,this.getSvgTransform(),&quot; &quot;,this.getSvgTransformMatrix(),&#39;&quot;/&gt;\n&#39;)</td>
      </tr>
      <tr>
        <td id="L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="LC7" class="blob-code blob-code-inner js-file-line">}else{var startX=Math.cos(this.startAngle)*this.radius,startY=Math.sin(this.startAngle)*this.radius,endX=Math.cos(this.endAngle)*this.radius,endY=Math.sin(this.endAngle)*this.radius,largeFlag=angle&gt;pi?&quot;1&quot;:&quot;0&quot;;markup.push(&#39;&lt;path d=&quot;M &#39;+startX+&quot; &quot;+startY,&quot; A &quot;+this.radius+&quot; &quot;+this.radius,&quot; 0 &quot;,+largeFlag+&quot; 1&quot;,&quot; &quot;+endX+&quot; &quot;+endY,&#39;&quot; style=&quot;&#39;,this.getSvgStyles(),&#39;&quot; transform=&quot;&#39;,this.getSvgTransform(),&quot; &quot;,this.getSvgTransformMatrix(),&#39;&quot;/&gt;\n&#39;)}return reviver?reviver(markup.join(&quot;&quot;)):markup.join(&quot;&quot;)},_render:function(ctx,noTransform){ctx.beginPath();ctx.arc(noTransform?this.left+this.radius:0,noTransform?this.top+this.radius:0,this.radius,this.startAngle,this.endAngle,false);this._renderFill(ctx);this._renderStroke(ctx)},getRadiusX:function(){return this.get(&quot;radius&quot;)*this.get(&quot;scaleX&quot;)},getRadiusY:function(){return this.get(&quot;radius&quot;)*this.get(&quot;scaleY&quot;)},setRadius:function(value){this.radius=value;return this.set(&quot;width&quot;,value*2).set(&quot;height&quot;,value*2)},complexity:function(){return 1}});fabric.Circle.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat(&quot;cx cy r&quot;.split(&quot; &quot;));fabric.Circle.fromElement=function(element,options){options||(options={});var parsedAttributes=fabric.parseAttributes(element,fabric.Circle.ATTRIBUTE_NAMES);if(!isValidRadius(parsedAttributes)){throw new Error(&quot;value of `r` attribute is required and can not be negative&quot;)}parsedAttributes.left=parsedAttributes.left||0;parsedAttributes.top=parsedAttributes.top||0;var obj=new fabric.Circle(extend(parsedAttributes,options));obj.left-=obj.radius;obj.top-=obj.radius;return obj};function isValidRadius(attributes){return&quot;radius&quot;in attributes&amp;&amp;attributes.radius&gt;=0}fabric.Circle.fromObject=function(object){return new fabric.Circle(object)}})(typeof exports!==&quot;undefined&quot;?exports:this);(function(global){&quot;use strict&quot;;var fabric=global.fabric||(global.fabric={});if(fabric.Triangle){fabric.warn(&quot;fabric.Triangle is already defined&quot;);return}fabric.Triangle=fabric.util.createClass(fabric.Object,{type:&quot;triangle&quot;,initialize:function(options){options=options||{};this.callSuper(&quot;initialize&quot;,options);this.set(&quot;width&quot;,options.width||100).set(&quot;height&quot;,options.height||100)},_render:function(ctx){var widthBy2=this.width/2,heightBy2=this.height/2;ctx.beginPath();ctx.moveTo(-widthBy2,heightBy2);ctx.lineTo(0,-heightBy2);ctx.lineTo(widthBy2,heightBy2);ctx.closePath();this._renderFill(ctx);this._renderStroke(ctx)},_renderDashedStroke:function(ctx){var widthBy2=this.width/2,heightBy2=this.height/2;ctx.beginPath();fabric.util.drawDashedLine(ctx,-widthBy2,heightBy2,0,-heightBy2,this.strokeDashArray);fabric.util.drawDashedLine(ctx,0,-heightBy2,widthBy2,heightBy2,this.strokeDashArray);fabric.util.drawDashedLine(ctx,widthBy2,heightBy2,-widthBy2,heightBy2,this.strokeDashArray);ctx.closePath()},toSVG:function(reviver){var markup=this._createBaseSVGMarkup(),widthBy2=this.width/2,heightBy2=this.height/2,points=[-widthBy2+&quot; &quot;+heightBy2,&quot;0 &quot;+-heightBy2,widthBy2+&quot; &quot;+heightBy2].join(&quot;,&quot;);markup.push(&quot;&lt;polygon &quot;,this.getSvgId(),&#39;points=&quot;&#39;,points,&#39;&quot; style=&quot;&#39;,this.getSvgStyles(),&#39;&quot; transform=&quot;&#39;,this.getSvgTransform(),&#39;&quot;/&gt;&#39;);return reviver?reviver(markup.join(&quot;&quot;)):markup.join(&quot;&quot;)},complexity:function(){return 1}});fabric.Triangle.fromObject=function(object){return new fabric.Triangle(object)}})(typeof exports!==&quot;undefined&quot;?exports:this);(function(global){&quot;use strict&quot;;var fabric=global.fabric||(global.fabric={}),piBy2=Math.PI*2,extend=fabric.util.object.extend;if(fabric.Ellipse){fabric.warn(&quot;fabric.Ellipse is already defined.&quot;);return}fabric.Ellipse=fabric.util.createClass(fabric.Object,{type:&quot;ellipse&quot;,rx:0,ry:0,initialize:function(options){options=options||{};this.callSuper(&quot;initialize&quot;,options);this.set(&quot;rx&quot;,options.rx||0);this.set(&quot;ry&quot;,options.ry||0)},_set:function(key,value){this.callSuper(&quot;_set&quot;,key,value);switch(key){case&quot;rx&quot;:this.rx=value;this.set(&quot;width&quot;,value*2);break;case&quot;ry&quot;:this.ry=value;this.set(&quot;height&quot;,value*2);break}return this},getRx:function(){return this.get(&quot;rx&quot;)*this.get(&quot;scaleX&quot;)},getRy:function(){return this.get(&quot;ry&quot;)*this.get(&quot;scaleY&quot;)},toObject:function(propertiesToInclude){return extend(this.callSuper(&quot;toObject&quot;,propertiesToInclude),{rx:this.get(&quot;rx&quot;),ry:this.get(&quot;ry&quot;)})},toSVG:function(reviver){var markup=this._createBaseSVGMarkup(),x=0,y=0;if(this.group&amp;&amp;this.group.type===&quot;path-group&quot;){x=this.left+this.rx;y=this.top+this.ry}markup.push(&quot;&lt;ellipse &quot;,this.getSvgId(),&#39;cx=&quot;&#39;,x,&#39;&quot; cy=&quot;&#39;,y,&#39;&quot; &#39;,&#39;rx=&quot;&#39;,this.rx,&#39;&quot; ry=&quot;&#39;,this.ry,&#39;&quot; style=&quot;&#39;,this.getSvgStyles(),&#39;&quot; transform=&quot;&#39;,this.getSvgTransform(),this.getSvgTransformMatrix(),&#39;&quot;/&gt;\n&#39;);return reviver?reviver(markup.join(&quot;&quot;)):markup.join(&quot;&quot;)},_render:function(ctx,noTransform){ctx.beginPath();ctx.save();ctx.transform(1,0,0,this.ry/this.rx,0,0);ctx.arc(noTransform?this.left+this.rx:0,noTransform?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,piBy2,false);ctx.restore();this._renderFill(ctx);this._renderStroke(ctx)},complexity:function(){return 1}});fabric.Ellipse.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat(&quot;cx cy rx ry&quot;.split(&quot; &quot;));fabric.Ellipse.fromElement=function(element,options){options||(options={});var parsedAttributes=fabric.parseAttributes(element,fabric.Ellipse.ATTRIBUTE_NAMES);parsedAttributes.left=parsedAttributes.left||0;parsedAttributes.top=parsedAttributes.top||0;var ellipse=new fabric.Ellipse(extend(parsedAttributes,options));ellipse.top-=ellipse.ry;ellipse.left-=ellipse.rx;return ellipse};fabric.Ellipse.fromObject=function(object){return new fabric.Ellipse(object)}})(typeof exports!==&quot;undefined&quot;?exports:this);(function(global){&quot;use strict&quot;;var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;if(fabric.Rect){fabric.warn(&quot;fabric.Rect is already defined&quot;);return}var stateProperties=fabric.Object.prototype.stateProperties.concat();stateProperties.push(&quot;rx&quot;,&quot;ry&quot;,&quot;x&quot;,&quot;y&quot;);fabric.Rect=fabric.util.createClass(fabric.Object,{stateProperties:stateProperties,type:&quot;rect&quot;,rx:0,ry:0,strokeDashArray:null,initialize:function(options){options=options||{};this.callSuper(&quot;initialize&quot;,options);this._initRxRy()},_initRxRy:function(){if(this.rx&amp;&amp;!this.ry){this.ry=this.rx}else if(this.ry&amp;&amp;!this.rx){this.rx=this.ry}},_render:function(ctx,noTransform){if(this.width===1&amp;&amp;this.height===1){ctx.fillRect(-.5,-.5,1,1);return}var rx=this.rx?Math.min(this.rx,this.width/2):0,ry=this.ry?Math.min(this.ry,this.height/2):0,w=this.width,h=this.height,x=noTransform?this.left:-this.width/2,y=noTransform?this.top:-this.height/2,isRounded=rx!==0||ry!==0,k=1-.5522847498;ctx.beginPath();ctx.moveTo(x+rx,y);ctx.lineTo(x+w-rx,y);isRounded&amp;&amp;ctx.bezierCurveTo(x+w-k*rx,y,x+w,y+k*ry,x+w,y+ry);ctx.lineTo(x+w,y+h-ry);isRounded&amp;&amp;ctx.bezierCurveTo(x+w,y+h-k*ry,x+w-k*rx,y+h,x+w-rx,y+h);ctx.lineTo(x+rx,y+h);isRounded&amp;&amp;ctx.bezierCurveTo(x+k*rx,y+h,x,y+h-k*ry,x,y+h-ry);ctx.lineTo(x,y+ry);isRounded&amp;&amp;ctx.bezierCurveTo(x,y+k*ry,x+k*rx,y,x+rx,y);ctx.closePath();this._renderFill(ctx);this._renderStroke(ctx)},_renderDashedStroke:function(ctx){var x=-this.width/2,y=-this.height/2,w=this.width,h=this.height;ctx.beginPath();fabric.util.drawDashedLine(ctx,x,y,x+w,y,this.strokeDashArray);fabric.util.drawDashedLine(ctx,x+w,y,x+w,y+h,this.strokeDashArray);fabric.util.drawDashedLine(ctx,x+w,y+h,x,y+h,this.strokeDashArray);fabric.util.drawDashedLine(ctx,x,y+h,x,y,this.strokeDashArray);ctx.closePath()},toObject:function(propertiesToInclude){var object=extend(this.callSuper(&quot;toObject&quot;,propertiesToInclude),{rx:this.get(&quot;rx&quot;)||0,ry:this.get(&quot;ry&quot;)||0});if(!this.includeDefaultValues){this._removeDefaultValues(object)}return object},toSVG:function(reviver){var markup=this._createBaseSVGMarkup(),x=this.left,y=this.top;if(!(this.group&amp;&amp;this.group.type===&quot;path-group&quot;)){x=-this.width/2;y=-this.height/2}markup.push(&quot;&lt;rect &quot;,this.getSvgId(),&#39;x=&quot;&#39;,x,&#39;&quot; y=&quot;&#39;,y,&#39;&quot; rx=&quot;&#39;,this.get(&quot;rx&quot;),&#39;&quot; ry=&quot;&#39;,this.get(&quot;ry&quot;),&#39;&quot; width=&quot;&#39;,this.width,&#39;&quot; height=&quot;&#39;,this.height,&#39;&quot; style=&quot;&#39;,this.getSvgStyles(),&#39;&quot; transform=&quot;&#39;,this.getSvgTransform(),this.getSvgTransformMatrix(),&#39;&quot;/&gt;\n&#39;);return reviver?reviver(markup.join(&quot;&quot;)):markup.join(&quot;&quot;)},complexity:function(){return 1}});fabric.Rect.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat(&quot;x y rx ry width height&quot;.split(&quot; &quot;));fabric.Rect.fromElement=function(element,options){if(!element){return null}options=options||{};var parsedAttributes=fabric.parseAttributes(element,fabric.Rect.ATTRIBUTE_NAMES);parsedAttributes.left=parsedAttributes.left||0;parsedAttributes.top=parsedAttributes.top||0;var rect=new fabric.Rect(extend(options?fabric.util.object.clone(options):{},parsedAttributes));rect.visible=rect.width&gt;0&amp;&amp;rect.height&gt;0;return rect};fabric.Rect.fromObject=function(object){return new fabric.Rect(object)}})(typeof exports!==&quot;undefined&quot;?exports:this);(function(global){&quot;use strict&quot;;var fabric=global.fabric||(global.fabric={});if(fabric.Polyline){fabric.warn(&quot;fabric.Polyline is already defined&quot;);return}fabric.Polyline=fabric.util.createClass(fabric.Object,{type:&quot;polyline&quot;,points:null,minX:0,minY:0,initialize:function(points,options){return fabric.Polygon.prototype.initialize.call(this,points,options)},_calcDimensions:function(){return fabric.Polygon.prototype._calcDimensions.call(this)},toObject:function(propertiesToInclude){return fabric.Polygon.prototype.toObject.call(this,propertiesToInclude)},toSVG:function(reviver){return fabric.Polygon.prototype.toSVG.call(this,reviver)},_render:function(ctx,noTransform){if(!fabric.Polygon.prototype.commonRender.call(this,ctx,noTransform)){return}this._renderFill(ctx);this._renderStroke(ctx)},_renderDashedStroke:function(ctx){var p1,p2;ctx.beginPath();for(var i=0,len=this.points.length;i&lt;len;i++){p1=this.points[i];p2=this.points[i+1]||p1;fabric.util.drawDashedLine(ctx,p1.x,p1.y,p2.x,p2.y,this.strokeDashArray)}},complexity:function(){return this.get(&quot;points&quot;).length}});fabric.Polyline.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat();fabric.Polyline.fromElement=function(element,options){if(!element){return null}options||(options={});var points=fabric.parsePointsAttribute(element.getAttribute(&quot;points&quot;)),parsedAttributes=fabric.parseAttributes(element,fabric.Polyline.ATTRIBUTE_NAMES);return new fabric.Polyline(points,fabric.util.object.extend(parsedAttributes,options))};fabric.Polyline.fromObject=function(object){var points=object.points;return new fabric.Polyline(points,object,true)}})(typeof exports!==&quot;undefined&quot;?exports:this);(function(global){&quot;use strict&quot;;var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,min=fabric.util.array.min,max=fabric.util.array.max,toFixed=fabric.util.toFixed;if(fabric.Polygon){fabric.warn(&quot;fabric.Polygon is already defined&quot;);return}fabric.Polygon=fabric.util.createClass(fabric.Object,{type:&quot;polygon&quot;,points:null,minX:0,minY:0,initialize:function(points,options){options=options||{};this.points=points||[];this.callSuper(&quot;initialize&quot;,options);this._calcDimensions();if(!(&quot;top&quot;in options)){this.top=this.minY}if(!(&quot;left&quot;in options)){this.left=this.minX}this.pathOffset={x:this.minX+this.width/2,y:this.minY+this.height/2}},_calcDimensions:function(){var points=this.points,minX=min(points,&quot;x&quot;),minY=min(points,&quot;y&quot;),maxX=max(points,&quot;x&quot;),maxY=max(points,&quot;y&quot;);this.width=maxX-minX||0;this.height=maxY-minY||0;this.minX=minX||0,this.minY=minY||0},toObject:function(propertiesToInclude){return extend(this.callSuper(&quot;toObject&quot;,propertiesToInclude),{points:this.points.concat()})},toSVG:function(reviver){var points=[],addTransform,markup=this._createBaseSVGMarkup();for(var i=0,len=this.points.length;i&lt;len;i++){points.push(toFixed(this.points[i].x,2),&quot;,&quot;,toFixed(this.points[i].y,2),&quot; &quot;)}if(!(this.group&amp;&amp;this.group.type===&quot;path-group&quot;)){addTransform=&quot; translate(&quot;+-this.pathOffset.x+&quot;, &quot;+-this.pathOffset.y+&quot;) &quot;}markup.push(&quot;&lt;&quot;,this.type,&quot; &quot;,this.getSvgId(),&#39;points=&quot;&#39;,points.join(&quot;&quot;),&#39;&quot; style=&quot;&#39;,this.getSvgStyles(),&#39;&quot; transform=&quot;&#39;,this.getSvgTransform(),addTransform,&quot; &quot;,this.getSvgTransformMatrix(),&#39;&quot;/&gt;\n&#39;);return reviver?reviver(markup.join(&quot;&quot;)):markup.join(&quot;&quot;)},_render:function(ctx,noTransform){if(!this.commonRender(ctx,noTransform)){return}this._renderFill(ctx);if(this.stroke||this.strokeDashArray){ctx.closePath();this._renderStroke(ctx)}},commonRender:function(ctx,noTransform){var point,len=this.points.length;if(!len||isNaN(this.points[len-1].y)){return false}noTransform||ctx.translate(-this.pathOffset.x,-this.pathOffset.y);ctx.beginPath();ctx.moveTo(this.points[0].x,this.points[0].y);for(var i=0;i&lt;len;i++){point=this.points[i];ctx.lineTo(point.x,point.y)}return true},_renderDashedStroke:function(ctx){fabric.Polyline.prototype._renderDashedStroke.call(this,ctx);ctx.closePath()},complexity:function(){return this.points.length}});fabric.Polygon.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat();fabric.Polygon.fromElement=function(element,options){if(!element){return null}options||(options={});var points=fabric.parsePointsAttribute(element.getAttribute(&quot;points&quot;)),parsedAttributes=fabric.parseAttributes(element,fabric.Polygon.ATTRIBUTE_NAMES);return new fabric.Polygon(points,extend(parsedAttributes,options))};fabric.Polygon.fromObject=function(object){return new fabric.Polygon(object.points,object,true)}})(typeof exports!==&quot;undefined&quot;?exports:this);(function(global){&quot;use strict&quot;;var fabric=global.fabric||(global.fabric={}),min=fabric.util.array.min,max=fabric.util.array.max,extend=fabric.util.object.extend,_toString=Object.prototype.toString,drawArc=fabric.util.drawArc,commandLengths={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},repeatedCommands={m:&quot;l&quot;,M:&quot;L&quot;};if(fabric.Path){fabric.warn(&quot;fabric.Path is already defined&quot;);return}fabric.Path=fabric.util.createClass(fabric.Object,{type:&quot;path&quot;,path:null,minX:0,minY:0,initialize:function(path,options){options=options||{};this.setOptions(options);if(!path){path=[]}var fromArray=_toString.call(path)===&quot;[object Array]&quot;;this.path=fromArray?path:path.match&amp;&amp;path.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);if(!this.path){return}if(!fromArray){this.path=this._parsePath()}this._setPositionDimensions(options);if(options.sourcePath){this.setSourcePath(options.sourcePath)}},_setPositionDimensions:function(options){var calcDim=this._parseDimensions();this.minX=calcDim.left;this.minY=calcDim.top;this.width=calcDim.width;this.height=calcDim.height;if(typeof options.left===&quot;undefined&quot;){this.left=calcDim.left+(this.originX===&quot;center&quot;?this.width/2:this.originX===&quot;right&quot;?this.width:0)}if(typeof options.top===&quot;undefined&quot;){this.top=calcDim.top+(this.originY===&quot;center&quot;?this.height/2:this.originY===&quot;bottom&quot;?this.height:0)}this.pathOffset=this.pathOffset||{x:this.minX+this.width/2,y:this.minY+this.height/2}},_render:function(ctx){var current,previous=null,subpathStartX=0,subpathStartY=0,x=0,y=0,controlX=0,controlY=0,tempX,tempY,l=-this.pathOffset.x,t=-this.pathOffset.y;if(this.group&amp;&amp;this.group.type===&quot;path-group&quot;){l=0;t=0}ctx.beginPath();for(var i=0,len=this.path.length;i&lt;len;++i){current=this.path[i];switch(current[0]){case&quot;l&quot;:x+=current[1];y+=current[2];ctx.lineTo(x+l,y+t);break;case&quot;L&quot;:x=current[1];y=current[2];ctx.lineTo(x+l,y+t);break;case&quot;h&quot;:x+=current[1];ctx.lineTo(x+l,y+t);break;case&quot;H&quot;:x=current[1];ctx.lineTo(x+l,y+t);break;case&quot;v&quot;:y+=current[1];ctx.lineTo(x+l,y+t);break;case&quot;V&quot;:y=current[1];ctx.lineTo(x+l,y+t);break;case&quot;m&quot;:x+=current[1];y+=current[2];subpathStartX=x;subpathStartY=y;ctx.moveTo(x+l,y+t);break;case&quot;M&quot;:x=current[1];y=current[2];subpathStartX=x;subpathStartY=y;ctx.moveTo(x+l,y+t);break;case&quot;c&quot;:tempX=x+current[5];tempY=y+current[6];controlX=x+current[3];controlY=y+current[4];ctx.bezierCurveTo(x+current[1]+l,y+current[2]+t,controlX+l,controlY+t,tempX+l,tempY+t);x=tempX;y=tempY;break;case&quot;C&quot;:x=current[5];y=current[6];controlX=current[3];controlY=current[4];ctx.bezierCurveTo(current[1]+l,current[2]+t,controlX+l,controlY+t,x+l,y+t);break;case&quot;s&quot;:tempX=x+current[3];tempY=y+current[4];if(previous[0].match(/[CcSs]/)===null){controlX=x;controlY=y}else{controlX=2*x-controlX;controlY=2*y-controlY}ctx.bezierCurveTo(controlX+l,controlY+t,x+current[1]+l,y+current[2]+t,tempX+l,tempY+t);controlX=x+current[1];controlY=y+current[2];x=tempX;y=tempY;break;case&quot;S&quot;:tempX=current[3];tempY=current[4];if(previous[0].match(/[CcSs]/)===null){controlX=x;controlY=y}else{controlX=2*x-controlX;controlY=2*y-controlY}ctx.bezierCurveTo(controlX+l,controlY+t,current[1]+l,current[2]+t,tempX+l,tempY+t);x=tempX;y=tempY;controlX=current[1];controlY=current[2];break;case&quot;q&quot;:tempX=x+current[3];tempY=y+current[4];controlX=x+current[1];controlY=y+current[2];ctx.quadraticCurveTo(controlX+l,controlY+t,tempX+l,tempY+t);x=tempX;y=tempY;break;case&quot;Q&quot;:tempX=current[3];tempY=current[4];ctx.quadraticCurveTo(current[1]+l,current[2]+t,tempX+l,tempY+t);x=tempX;y=tempY;controlX=current[1];controlY=current[2];break;case&quot;t&quot;:tempX=x+current[1];tempY=y+current[2];if(previous[0].match(/[QqTt]/)===null){controlX=x;controlY=y}else{controlX=2*x-controlX;controlY=2*y-controlY}ctx.quadraticCurveTo(controlX+l,controlY+t,tempX+l,tempY+t);x=tempX;y=tempY;break;case&quot;T&quot;:tempX=current[1];tempY=current[2];if(previous[0].match(/[QqTt]/)===null){controlX=x;controlY=y}else{controlX=2*x-controlX;controlY=2*y-controlY}ctx.quadraticCurveTo(controlX+l,controlY+t,tempX+l,tempY+t);x=tempX;y=tempY;break;case&quot;a&quot;:drawArc(ctx,x+l,y+t,[current[1],current[2],current[3],current[4],current[5],current[6]+x+l,current[7]+y+t]);x+=current[6];y+=current[7];break;case&quot;A&quot;:drawArc(ctx,x+l,y+t,[current[1],current[2],current[3],current[4],current[5],current[6]+l,current[7]+t]);x=current[6];y=current[7];break;case&quot;z&quot;:case&quot;Z&quot;:x=subpathStartX;y=subpathStartY;ctx.closePath();break}previous=current}this._renderFill(ctx);this._renderStroke(ctx)},toString:function(){return&quot;#&lt;fabric.Path (&quot;+this.complexity()+&#39;): { &quot;top&quot;: &#39;+this.top+&#39;, &quot;left&quot;: &#39;+this.left+&quot; }&gt;&quot;},toObject:function(propertiesToInclude){var o=extend(this.callSuper(&quot;toObject&quot;,propertiesToInclude),{path:this.path.map(function(item){return item.slice()}),pathOffset:this.pathOffset});if(this.sourcePath){o.sourcePath=this.sourcePath}if(this.transformMatrix){o.transformMatrix=this.transformMatrix}return o},toDatalessObject:function(propertiesToInclude){var o=this.toObject(propertiesToInclude);if(this.sourcePath){o.path=this.sourcePath}delete o.sourcePath;return o},toSVG:function(reviver){var chunks=[],markup=this._createBaseSVGMarkup(),addTransform=&quot;&quot;;for(var i=0,len=this.path.length;i&lt;len;i++){chunks.push(this.path[i].join(&quot; &quot;))}var path=chunks.join(&quot; &quot;);if(!(this.group&amp;&amp;this.group.type===&quot;path-group&quot;)){addTransform=&quot; translate(&quot;+-this.pathOffset.x+&quot;, &quot;+-this.pathOffset.y+&quot;) &quot;}markup.push(&quot;&lt;path &quot;,this.getSvgId(),&#39;d=&quot;&#39;,path,&#39;&quot; style=&quot;&#39;,this.getSvgStyles(),&#39;&quot; transform=&quot;&#39;,this.getSvgTransform(),addTransform,this.getSvgTransformMatrix(),&#39;&quot; stroke-linecap=&quot;round&quot; &#39;,&quot;/&gt;\n&quot;);return reviver?reviver(markup.join(&quot;&quot;)):markup.join(&quot;&quot;)},complexity:function(){return this.path.length},_parsePath:function(){var result=[],coords=[],currentPath,parsed,re=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,match,coordsStr;for(var i=0,coordsParsed,len=this.path.length;i&lt;len;i++){currentPath=this.path[i];coordsStr=currentPath.slice(1).trim();coords.length=0;while(match=re.exec(coordsStr)){coords.push(match[0])}coordsParsed=[currentPath.charAt(0)];for(var j=0,jlen=coords.length;j&lt;jlen;j++){parsed=parseFloat(coords[j]);if(!isNaN(parsed)){coordsParsed.push(parsed)}}var command=coordsParsed[0],commandLength=commandLengths[command.toLowerCase()],repeatedCommand=repeatedCommands[command]||command;if(coordsParsed.length-1&gt;commandLength){for(var k=1,klen=coordsParsed.length;k&lt;klen;k+=commandLength){result.push([command].concat(coordsParsed.slice(k,k+commandLength)));command=repeatedCommand}}else{result.push(coordsParsed)}}return result},_parseDimensions:function(){var aX=[],aY=[],current,previous=null,subpathStartX=0,subpathStartY=0,x=0,y=0,controlX=0,controlY=0,tempX,tempY,bounds;for(var i=0,len=this.path.length;i&lt;len;++i){current=this.path[i];switch(current[0]){case&quot;l&quot;:x+=current[1];y+=current[2];bounds=[];break;case&quot;L&quot;:x=current[1];y=current[2];bounds=[];break;case&quot;h&quot;:x+=current[1];bounds=[];break;case&quot;H&quot;:x=current[1];bounds=[];break;case&quot;v&quot;:y+=current[1];bounds=[];break;case&quot;V&quot;:y=current[1];bounds=[];break;case&quot;m&quot;:x+=current[1];y+=current[2];subpathStartX=x;subpathStartY=y;bounds=[];break;case&quot;M&quot;:x=current[1];y=current[2];subpathStartX=x;subpathStartY=y;bounds=[];break;case&quot;c&quot;:tempX=x+current[5];tempY=y+current[6];controlX=x+current[3];controlY=y+current[4];bounds=fabric.util.getBoundsOfCurve(x,y,x+current[1],y+current[2],controlX,controlY,tempX,tempY);x=tempX;y=tempY;break;case&quot;C&quot;:x=current[5];y=current[6];controlX=current[3];controlY=current[4];bounds=fabric.util.getBoundsOfCurve(x,y,current[1],current[2],controlX,controlY,x,y);break;case&quot;s&quot;:tempX=x+current[3];tempY=y+current[4];if(previous[0].match(/[CcSs]/)===null){controlX=x;controlY=y}else{controlX=2*x-controlX;controlY=2*y-controlY}bounds=fabric.util.getBoundsOfCurve(x,y,controlX,controlY,x+current[1],y+current[2],tempX,tempY);controlX=x+current[1];controlY=y+current[2];x=tempX;y=tempY;break;case&quot;S&quot;:tempX=current[3];tempY=current[4];if(previous[0].match(/[CcSs]/)===null){controlX=x;controlY=y}else{controlX=2*x-controlX;controlY=2*y-controlY}bounds=fabric.util.getBoundsOfCurve(x,y,controlX,controlY,current[1],current[2],tempX,tempY);x=tempX;y=tempY;controlX=current[1];controlY=current[2];break;case&quot;q&quot;:tempX=x+current[3];tempY=y+current[4];controlX=x+current[1];controlY=y+current[2];bounds=fabric.util.getBoundsOfCurve(x,y,controlX,controlY,controlX,controlY,tempX,tempY);x=tempX;y=tempY;break;case&quot;Q&quot;:controlX=current[1];controlY=current[2];bounds=fabric.util.getBoundsOfCurve(x,y,controlX,controlY,controlX,controlY,current[3],current[4]);x=current[3];y=current[4];break;case&quot;t&quot;:tempX=x+current[1];tempY=y+current[2];if(previous[0].match(/[QqTt]/)===null){controlX=x;controlY=y}else{controlX=2*x-controlX;controlY=2*y-controlY}bounds=fabric.util.getBoundsOfCurve(x,y,controlX,controlY,controlX,controlY,tempX,tempY);x=tempX;y=tempY;break;case&quot;T&quot;:tempX=current[1];tempY=current[2];if(previous[0].match(/[QqTt]/)===null){controlX=x;controlY=y}else{controlX=2*x-controlX;controlY=2*y-controlY}bounds=fabric.util.getBoundsOfCurve(x,y,controlX,controlY,controlX,controlY,tempX,tempY);x=tempX;y=tempY;break;case&quot;a&quot;:bounds=fabric.util.getBoundsOfArc(x,y,current[1],current[2],current[3],current[4],current[5],current[6]+x,current[7]+y);x+=current[6];y+=current[7];break;case&quot;A&quot;:bounds=fabric.util.getBoundsOfArc(x,y,current[1],current[2],current[3],current[4],current[5],current[6],current[7]);x=current[6];y=current[7];break;case&quot;z&quot;:case&quot;Z&quot;:x=subpathStartX;y=subpathStartY;break}previous=current;bounds.forEach(function(point){aX.push(point.x);aY.push(point.y)});aX.push(x);aY.push(y)}var minX=min(aX)||0,minY=min(aY)||0,maxX=max(aX)||0,maxY=max(aY)||0,deltaX=maxX-minX,deltaY=maxY-minY,o={left:minX,top:minY,width:deltaX,height:deltaY};return o}});fabric.Path.fromObject=function(object,callback){if(typeof object.path===&quot;string&quot;){fabric.loadSVGFromURL(object.path,function(elements){var path=elements[0],pathUrl=object.path;delete object.path;fabric.util.object.extend(path,object);path.setSourcePath(pathUrl);callback(path)})}else{callback(new fabric.Path(object.path,object))}};fabric.Path.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat([&quot;d&quot;]);fabric.Path.fromElement=function(element,callback,options){var parsedAttributes=fabric.parseAttributes(element,fabric.Path.ATTRIBUTE_NAMES);callback&amp;&amp;callback(new fabric.Path(parsedAttributes.d,extend(parsedAttributes,options)))};fabric.Path.async=true})(typeof exports!==&quot;undefined&quot;?exports:this);(function(global){&quot;use strict&quot;;var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,invoke=fabric.util.array.invoke,parentToObject=fabric.Object.prototype.toObject;if(fabric.PathGroup){fabric.warn(&quot;fabric.PathGroup is already defined&quot;);return}fabric.PathGroup=fabric.util.createClass(fabric.Path,{type:&quot;path-group&quot;,fill:&quot;&quot;,initialize:function(paths,options){options=options||{};this.paths=paths||[];for(var i=this.paths.length;i--;){this.paths[i].group=this}if(options.toBeParsed){this.parseDimensionsFromPaths(options);delete options.toBeParsed}this.setOptions(options);this.setCoords();if(options.sourcePath){this.setSourcePath(options.sourcePath)}},parseDimensionsFromPaths:function(options){var points,p,xC=[],yC=[],path,height,width,m;for(var j=this.paths.length;j--;){path=this.paths[j];height=path.height+path.strokeWidth;width=path.width+path.strokeWidth;points=[{x:path.left,y:path.top},{x:path.left+width,y:path.top},{x:path.left,y:path.top+height},{x:path.left+width,y:path.top+height}];m=this.paths[j].transformMatrix;for(var i=0;i&lt;points.length;i++){p=points[i];if(m){p=fabric.util.transformPoint(p,m,false)}xC.push(p.x);yC.push(p.y)}}options.width=Math.max.apply(null,xC);options.height=Math.max.apply(null,yC)},render:function(ctx){if(!this.visible){return}ctx.save();if(this.transformMatrix){ctx.transform.apply(ctx,this.transformMatrix)}this.transform(ctx);this._setShadow(ctx);this.clipTo&amp;&amp;fabric.util.clipContext(this,ctx);ctx.translate(-this.width/2,-this.height/2);for(var i=0,l=this.paths.length;i&lt;l;++i){this.paths[i].render(ctx,true)}this.clipTo&amp;&amp;ctx.restore();ctx.restore()},_set:function(prop,value){if(prop===&quot;fill&quot;&amp;&amp;value&amp;&amp;this.isSameColor()){var i=this.paths.length;while(i--){this.paths[i]._set(prop,value)}}return this.callSuper(&quot;_set&quot;,prop,value)},toObject:function(propertiesToInclude){var o=extend(parentToObject.call(this,propertiesToInclude),{paths:invoke(this.getObjects(),&quot;toObject&quot;,propertiesToInclude)});if(this.sourcePath){o.sourcePath=this.sourcePath}return o},toDatalessObject:function(propertiesToInclude){var o=this.toObject(propertiesToInclude);if(this.sourcePath){o.paths=this.sourcePath}return o},toSVG:function(reviver){var objects=this.getObjects(),p=this.getPointByOrigin(&quot;left&quot;,&quot;top&quot;),translatePart=&quot;translate(&quot;+p.x+&quot; &quot;+p.y+&quot;)&quot;,markup=this._createBaseSVGMarkup();markup.push(&quot;&lt;g &quot;,this.getSvgId(),&#39;style=&quot;&#39;,this.getSvgStyles(),&#39;&quot; &#39;,&#39;transform=&quot;&#39;,this.getSvgTransformMatrix(),translatePart,this.getSvgTransform(),&#39;&quot; &#39;,&quot;&gt;\n&quot;);for(var i=0,len=objects.length;i&lt;len;i++){markup.push(&quot;	&quot;,objects[i].toSVG(reviver))}markup.push(&quot;&lt;/g&gt;\n&quot;);return reviver?reviver(markup.join(&quot;&quot;)):markup.join(&quot;&quot;)},toString:function(){return&quot;#&lt;fabric.PathGroup (&quot;+this.complexity()+&quot;): { top: &quot;+this.top+&quot;, left: &quot;+this.left+&quot; }&gt;&quot;},isSameColor:function(){var firstPathFill=this.getObjects()[0].get(&quot;fill&quot;)||&quot;&quot;;if(typeof firstPathFill!==&quot;string&quot;){return false}firstPathFill=firstPathFill.toLowerCase();return this.getObjects().every(function(path){var pathFill=path.get(&quot;fill&quot;)||&quot;&quot;;return typeof pathFill===&quot;string&quot;&amp;&amp;pathFill.toLowerCase()===firstPathFill})},complexity:function(){return this.paths.reduce(function(total,path){return total+(path&amp;&amp;path.complexity?path.complexity():0)},0)},getObjects:function(){return this.paths}});fabric.PathGroup.fromObject=function(object,callback){if(typeof object.paths===&quot;string&quot;){fabric.loadSVGFromURL(object.paths,function(elements){var pathUrl=object.paths;delete object.paths;var pathGroup=fabric.util.groupSVGElements(elements,object,pathUrl);callback(pathGroup)})}else{fabric.util.enlivenObjects(object.paths,function(enlivenedObjects){delete object.paths;callback(new fabric.PathGroup(enlivenedObjects,object))})}};fabric.PathGroup.async=true})(typeof exports!==&quot;undefined&quot;?exports:this);(function(global){&quot;use strict&quot;;var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,min=fabric.util.array.min,max=fabric.util.array.max,invoke=fabric.util.array.invoke;if(fabric.Group){return}var _lockProperties={lockMovementX:true,lockMovementY:true,lockRotation:true,lockScalingX:true,lockScalingY:true,lockUniScaling:true};fabric.Group=fabric.util.createClass(fabric.Object,fabric.Collection,{type:&quot;group&quot;,strokeWidth:0,subTargetCheck:false,initialize:function(objects,options,isAlreadyGrouped){options=options||{};this._objects=[];isAlreadyGrouped&amp;&amp;this.callSuper(&quot;initialize&quot;,options);this._objects=objects||[];for(var i=this._objects.length;i--;){this._objects[i].group=this}this.originalState={};if(options.originX){this.originX=options.originX}if(options.originY){this.originY=options.originY}if(isAlreadyGrouped){this._updateObjectsCoords(true)}else{this._calcBounds();this._updateObjectsCoords();this.callSuper(&quot;initialize&quot;,options)}this.setCoords();this.saveCoords()},_updateObjectsCoords:function(skipCoordsChange){for(var i=this._objects.length;i--;){this._updateObjectCoords(this._objects[i],skipCoordsChange)}},_updateObjectCoords:function(object,skipCoordsChange){object.__origHasControls=object.hasControls;object.hasControls=false;if(skipCoordsChange){return}var objectLeft=object.getLeft(),objectTop=object.getTop(),center=this.getCenterPoint();object.set({originalLeft:objectLeft,originalTop:objectTop,left:objectLeft-center.x,top:objectTop-center.y});object.setCoords()},toString:function(){return&quot;#&lt;fabric.Group: (&quot;+this.complexity()+&quot;)&gt;&quot;},addWithUpdate:function(object){this._restoreObjectsState();fabric.util.resetObjectTransform(this);if(object){this._objects.push(object);object.group=this;object._set(&quot;canvas&quot;,this.canvas)}this.forEachObject(this._setObjectActive,this);this._calcBounds();this._updateObjectsCoords();return this},_setObjectActive:function(object){object.set(&quot;active&quot;,true);object.group=this},removeWithUpdate:function(object){this._restoreObjectsState();fabric.util.resetObjectTransform(this);this.forEachObject(this._setObjectActive,this);this.remove(object);this._calcBounds();this._updateObjectsCoords();return this},_onObjectAdded:function(object){object.group=this;object._set(&quot;canvas&quot;,this.canvas)},_onObjectRemoved:function(object){delete object.group;object.set(&quot;active&quot;,false)},delegatedProperties:{fill:true,stroke:true,strokeWidth:true,fontFamily:true,fontWeight:true,fontSize:true,fontStyle:true,lineHeight:true,textDecoration:true,textAlign:true,backgroundColor:true},_set:function(key,value){var i=this._objects.length;if(this.delegatedProperties[key]||key===&quot;canvas&quot;){while(i--){this._objects[i].set(key,value)}}else{while(i--){this._objects[i].setOnGroup(key,value)}}this.callSuper(&quot;_set&quot;,key,value)},toObject:function(propertiesToInclude){return extend(this.callSuper(&quot;toObject&quot;,propertiesToInclude),{objects:invoke(this._objects,&quot;toObject&quot;,propertiesToInclude)})},render:function(ctx){if(!this.visible){return}ctx.save();if(this.transformMatrix){ctx.transform.apply(ctx,this.transformMatrix)}this.transform(ctx);this._setShadow(ctx);this.clipTo&amp;&amp;fabric.util.clipContext(this,ctx);for(var i=0,len=this._objects.length;i&lt;len;i++){this._renderObject(this._objects[i],ctx)}this.clipTo&amp;&amp;ctx.restore();ctx.restore()},_renderControls:function(ctx,noTransform){this.callSuper(&quot;_renderControls&quot;,ctx,noTransform);for(var i=0,len=this._objects.length;i&lt;len;i++){this._objects[i]._renderControls(ctx)}},_renderObject:function(object,ctx){if(!object.visible){return}var originalHasRotatingPoint=object.hasRotatingPoint;object.hasRotatingPoint=false;object.render(ctx);object.hasRotatingPoint=originalHasRotatingPoint},_restoreObjectsState:function(){this._objects.forEach(this._restoreObjectState,this);return this},realizeTransform:function(object){var matrix=object.calcTransformMatrix(),options=fabric.util.qrDecompose(matrix),center=new fabric.Point(options.translateX,options.translateY);object.scaleX=options.scaleX;object.scaleY=options.scaleY;object.skewX=options.skewX;object.skewY=options.skewY;object.angle=options.angle;object.flipX=false;object.flipY=false;object.setPositionByOrigin(center,&quot;center&quot;,&quot;center&quot;);return object},_restoreObjectState:function(object){this.realizeTransform(object);object.setCoords();object.hasControls=object.__origHasControls;delete object.__origHasControls;object.set(&quot;active&quot;,false);delete object.group;return this},destroy:function(){return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=this.get(&quot;left&quot;);this._originalTop=this.get(&quot;top&quot;);return this},hasMoved:function(){return this._originalLeft!==this.get(&quot;left&quot;)||this._originalTop!==this.get(&quot;top&quot;)},setObjectsCoords:function(){this.forEachObject(function(object){object.setCoords()</td>
      </tr>
      <tr>
        <td id="L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="LC8" class="blob-code blob-code-inner js-file-line">});return this},_calcBounds:function(onlyWidthHeight){var aX=[],aY=[],o,prop,props=[&quot;tr&quot;,&quot;br&quot;,&quot;bl&quot;,&quot;tl&quot;],i=0,iLen=this._objects.length,j,jLen=props.length;for(;i&lt;iLen;++i){o=this._objects[i];o.setCoords();for(j=0;j&lt;jLen;j++){prop=props[j];aX.push(o.oCoords[prop].x);aY.push(o.oCoords[prop].y)}}this.set(this._getBounds(aX,aY,onlyWidthHeight))},_getBounds:function(aX,aY,onlyWidthHeight){var ivt=fabric.util.invertTransform(this.getViewportTransform()),minXY=fabric.util.transformPoint(new fabric.Point(min(aX),min(aY)),ivt),maxXY=fabric.util.transformPoint(new fabric.Point(max(aX),max(aY)),ivt),obj={width:maxXY.x-minXY.x||0,height:maxXY.y-minXY.y||0};if(!onlyWidthHeight){obj.left=minXY.x||0;obj.top=minXY.y||0;if(this.originX===&quot;center&quot;){obj.left+=obj.width/2}if(this.originX===&quot;right&quot;){obj.left+=obj.width}if(this.originY===&quot;center&quot;){obj.top+=obj.height/2}if(this.originY===&quot;bottom&quot;){obj.top+=obj.height}}return obj},toSVG:function(reviver){var markup=this._createBaseSVGMarkup();markup.push(&quot;&lt;g &quot;,this.getSvgId(),&#39;transform=&quot;&#39;,this.getSvgTransform(),this.getSvgTransformMatrix(),&#39;&quot; style=&quot;&#39;,this.getSvgFilter(),&#39;&quot;&gt;\n&#39;);for(var i=0,len=this._objects.length;i&lt;len;i++){markup.push(&quot;	&quot;,this._objects[i].toSVG(reviver))}markup.push(&quot;&lt;/g&gt;\n&quot;);return reviver?reviver(markup.join(&quot;&quot;)):markup.join(&quot;&quot;)},get:function(prop){if(prop in _lockProperties){if(this[prop]){return this[prop]}else{for(var i=0,len=this._objects.length;i&lt;len;i++){if(this._objects[i][prop]){return true}}return false}}else{if(prop in this.delegatedProperties){return this._objects[0]&amp;&amp;this._objects[0].get(prop)}return this[prop]}}});fabric.Group.fromObject=function(object,callback){fabric.util.enlivenObjects(object.objects,function(enlivenedObjects){delete object.objects;callback&amp;&amp;callback(new fabric.Group(enlivenedObjects,object,true))})};fabric.Group.async=true})(typeof exports!==&quot;undefined&quot;?exports:this);(function(global){&quot;use strict&quot;;var extend=fabric.util.object.extend;if(!global.fabric){global.fabric={}}if(global.fabric.Image){fabric.warn(&quot;fabric.Image is already defined.&quot;);return}fabric.Image=fabric.util.createClass(fabric.Object,{type:&quot;image&quot;,crossOrigin:&quot;&quot;,alignX:&quot;none&quot;,alignY:&quot;none&quot;,meetOrSlice:&quot;meet&quot;,strokeWidth:0,_lastScaleX:1,_lastScaleY:1,initialize:function(element,options){options||(options={});this.filters=[];this.resizeFilters=[];this.callSuper(&quot;initialize&quot;,options);this._initElement(element,options)},getElement:function(){return this._element},setElement:function(element,callback,options){this._element=element;this._originalElement=element;this._initConfig(options);if(this.filters.length!==0){this.applyFilters(callback)}else if(callback){callback()}return this},setCrossOrigin:function(value){this.crossOrigin=value;this._element.crossOrigin=value;return this},getOriginalSize:function(){var element=this.getElement();return{width:element.width,height:element.height}},_stroke:function(ctx){if(!this.stroke||this.strokeWidth===0){return}var w=this.width/2,h=this.height/2;ctx.beginPath();ctx.moveTo(-w,-h);ctx.lineTo(w,-h);ctx.lineTo(w,h);ctx.lineTo(-w,h);ctx.lineTo(-w,-h);ctx.closePath()},_renderDashedStroke:function(ctx){var x=-this.width/2,y=-this.height/2,w=this.width,h=this.height;ctx.save();this._setStrokeStyles(ctx);ctx.beginPath();fabric.util.drawDashedLine(ctx,x,y,x+w,y,this.strokeDashArray);fabric.util.drawDashedLine(ctx,x+w,y,x+w,y+h,this.strokeDashArray);fabric.util.drawDashedLine(ctx,x+w,y+h,x,y+h,this.strokeDashArray);fabric.util.drawDashedLine(ctx,x,y+h,x,y,this.strokeDashArray);ctx.closePath();ctx.restore()},toObject:function(propertiesToInclude){var filters=[],resizeFilters=[],element=this._originalElement,scaleX=1,scaleY=1;this.filters.forEach(function(filterObj){if(filterObj){if(filterObj.type===&quot;Resize&quot;){scaleX*=filterObj.scaleX;scaleY*=filterObj.scaleY}filters.push(filterObj.toObject())}});this.resizeFilters.forEach(function(filterObj){filterObj&amp;&amp;resizeFilters.push(filterObj.toObject())});var object=extend(this.callSuper(&quot;toObject&quot;,propertiesToInclude),{src:element?element.src||element._src:&quot;&quot;,filters:filters,resizeFilters:resizeFilters,crossOrigin:this.crossOrigin,alignX:this.alignX,alignY:this.alignY,meetOrSlice:this.meetOrSlice});object.width/=scaleX;object.height/=scaleY;if(!this.includeDefaultValues){this._removeDefaultValues(object)}return object},toSVG:function(reviver){var markup=this._createBaseSVGMarkup(),x=-this.width/2,y=-this.height/2,preserveAspectRatio=&quot;none&quot;;if(this.group&amp;&amp;this.group.type===&quot;path-group&quot;){x=this.left;y=this.top}if(this.alignX!==&quot;none&quot;&amp;&amp;this.alignY!==&quot;none&quot;){preserveAspectRatio=&quot;x&quot;+this.alignX+&quot;Y&quot;+this.alignY+&quot; &quot;+this.meetOrSlice}markup.push(&#39;&lt;g transform=&quot;&#39;,this.getSvgTransform(),this.getSvgTransformMatrix(),&#39;&quot;&gt;\n&#39;,&quot;&lt;image &quot;,this.getSvgId(),&#39;xlink:href=&quot;&#39;,this.getSvgSrc(),&#39;&quot; x=&quot;&#39;,x,&#39;&quot; y=&quot;&#39;,y,&#39;&quot; style=&quot;&#39;,this.getSvgStyles(),&#39;&quot; width=&quot;&#39;,this.width,&#39;&quot; height=&quot;&#39;,this.height,&#39;&quot; preserveAspectRatio=&quot;&#39;,preserveAspectRatio,&#39;&quot;&#39;,&quot;&gt;&lt;/image&gt;\n&quot;);if(this.stroke||this.strokeDashArray){var origFill=this.fill;this.fill=null;markup.push(&quot;&lt;rect &quot;,&#39;x=&quot;&#39;,x,&#39;&quot; y=&quot;&#39;,y,&#39;&quot; width=&quot;&#39;,this.width,&#39;&quot; height=&quot;&#39;,this.height,&#39;&quot; style=&quot;&#39;,this.getSvgStyles(),&#39;&quot;/&gt;\n&#39;);this.fill=origFill}markup.push(&quot;&lt;/g&gt;\n&quot;);return reviver?reviver(markup.join(&quot;&quot;)):markup.join(&quot;&quot;)},getSrc:function(){if(this.getElement()){return this.getElement().src||this.getElement()._src}},setSrc:function(src,callback,options){fabric.util.loadImage(src,function(img){return this.setElement(img,callback,options)},this,options&amp;&amp;options.crossOrigin)},toString:function(){return&#39;#&lt;fabric.Image: { src: &quot;&#39;+this.getSrc()+&#39;&quot; }&gt;&#39;},clone:function(callback,propertiesToInclude){this.constructor.fromObject(this.toObject(propertiesToInclude),callback)},applyFilters:function(callback,filters,imgElement,forResizing){filters=filters||this.filters;imgElement=imgElement||this._originalElement;if(!imgElement){return}var imgEl=imgElement,canvasEl=fabric.util.createCanvasElement(),replacement=fabric.util.createImage(),_this=this;canvasEl.width=imgEl.width;canvasEl.height=imgEl.height;canvasEl.getContext(&quot;2d&quot;).drawImage(imgEl,0,0,imgEl.width,imgEl.height);if(filters.length===0){this._element=imgElement;callback&amp;&amp;callback();return canvasEl}filters.forEach(function(filter){filter&amp;&amp;filter.applyTo(canvasEl,filter.scaleX||_this.scaleX,filter.scaleY||_this.scaleY);if(!forResizing&amp;&amp;filter&amp;&amp;filter.type===&quot;Resize&quot;){_this.width*=filter.scaleX;_this.height*=filter.scaleY}});replacement.width=canvasEl.width;replacement.height=canvasEl.height;if(fabric.isLikelyNode){replacement.src=canvasEl.toBuffer(undefined,fabric.Image.pngCompression);_this._element=replacement;!forResizing&amp;&amp;(_this._filteredEl=replacement);callback&amp;&amp;callback()}else{replacement.onload=function(){_this._element=replacement;!forResizing&amp;&amp;(_this._filteredEl=replacement);callback&amp;&amp;callback();replacement.onload=canvasEl=imgEl=null};replacement.src=canvasEl.toDataURL(&quot;image/png&quot;)}return canvasEl},_render:function(ctx,noTransform){var x,y,imageMargins=this._findMargins(),elementToDraw;x=noTransform?this.left:-this.width/2;y=noTransform?this.top:-this.height/2;if(this.meetOrSlice===&quot;slice&quot;){ctx.beginPath();ctx.rect(x,y,this.width,this.height);ctx.clip()}if(this.isMoving===false&amp;&amp;this.resizeFilters.length&amp;&amp;this._needsResize()){this._lastScaleX=this.scaleX;this._lastScaleY=this.scaleY;elementToDraw=this.applyFilters(null,this.resizeFilters,this._filteredEl||this._originalElement,true)}else{elementToDraw=this._element}elementToDraw&amp;&amp;ctx.drawImage(elementToDraw,x+imageMargins.marginX,y+imageMargins.marginY,imageMargins.width,imageMargins.height);this._stroke(ctx);this._renderStroke(ctx)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_findMargins:function(){var width=this.width,height=this.height,scales,scale,marginX=0,marginY=0;if(this.alignX!==&quot;none&quot;||this.alignY!==&quot;none&quot;){scales=[this.width/this._element.width,this.height/this._element.height];scale=this.meetOrSlice===&quot;meet&quot;?Math.min.apply(null,scales):Math.max.apply(null,scales);width=this._element.width*scale;height=this._element.height*scale;if(this.alignX===&quot;Mid&quot;){marginX=(this.width-width)/2}if(this.alignX===&quot;Max&quot;){marginX=this.width-width}if(this.alignY===&quot;Mid&quot;){marginY=(this.height-height)/2}if(this.alignY===&quot;Max&quot;){marginY=this.height-height}}return{width:width,height:height,marginX:marginX,marginY:marginY}},_resetWidthHeight:function(){var element=this.getElement();this.set(&quot;width&quot;,element.width);this.set(&quot;height&quot;,element.height)},_initElement:function(element,options){this.setElement(fabric.util.getById(element),null,options);fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(options){options||(options={});this.setOptions(options);this._setWidthHeight(options);if(this._element&amp;&amp;this.crossOrigin){this._element.crossOrigin=this.crossOrigin}},_initFilters:function(filters,callback){if(filters&amp;&amp;filters.length){fabric.util.enlivenObjects(filters,function(enlivenedObjects){callback&amp;&amp;callback(enlivenedObjects)},&quot;fabric.Image.filters&quot;)}else{callback&amp;&amp;callback()}},_setWidthHeight:function(options){this.width=&quot;width&quot;in options?options.width:this.getElement()?this.getElement().width||0:0;this.height=&quot;height&quot;in options?options.height:this.getElement()?this.getElement().height||0:0},complexity:function(){return 1}});fabric.Image.CSS_CANVAS=&quot;canvas-img&quot;;fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc;fabric.Image.fromObject=function(object,callback){fabric.util.loadImage(object.src,function(img){fabric.Image.prototype._initFilters.call(object,object.filters,function(filters){object.filters=filters||[];fabric.Image.prototype._initFilters.call(object,object.resizeFilters,function(resizeFilters){object.resizeFilters=resizeFilters||[];var instance=new fabric.Image(img,object);callback&amp;&amp;callback(instance)})})},null,object.crossOrigin)};fabric.Image.fromURL=function(url,callback,imgOptions){fabric.util.loadImage(url,function(img){callback&amp;&amp;callback(new fabric.Image(img,imgOptions))},null,imgOptions&amp;&amp;imgOptions.crossOrigin)};fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat(&quot;x y width height preserveAspectRatio xlink:href&quot;.split(&quot; &quot;));fabric.Image.fromElement=function(element,callback,options){var parsedAttributes=fabric.parseAttributes(element,fabric.Image.ATTRIBUTE_NAMES),preserveAR;if(parsedAttributes.preserveAspectRatio){preserveAR=fabric.util.parsePreserveAspectRatioAttribute(parsedAttributes.preserveAspectRatio);extend(parsedAttributes,preserveAR)}fabric.Image.fromURL(parsedAttributes[&quot;xlink:href&quot;],callback,extend(options?fabric.util.object.clone(options):{},parsedAttributes))};fabric.Image.async=true;fabric.Image.pngCompression=1})(typeof exports!==&quot;undefined&quot;?exports:this);fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var angle=this.getAngle()%360;if(angle&gt;0){return Math.round((angle-1)/90)*90}return Math.round(angle/90)*90},straighten:function(){this.setAngle(this._getAngleValueForStraighten());return this},fxStraighten:function(callbacks){callbacks=callbacks||{};var empty=function(){},onComplete=callbacks.onComplete||empty,onChange=callbacks.onChange||empty,_this=this;fabric.util.animate({startValue:this.get(&quot;angle&quot;),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(value){_this.setAngle(value);onChange()},onComplete:function(){_this.setCoords();onComplete()},onStart:function(){_this.set(&quot;active&quot;,false)}});return this}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(object){object.straighten();this.renderAll();return this},fxStraightenObject:function(object){object.fxStraighten({onChange:this.renderAll.bind(this)});return this}});fabric.Image.filters=fabric.Image.filters||{};fabric.Image.filters.BaseFilter=fabric.util.createClass({type:&quot;BaseFilter&quot;,initialize:function(options){if(options){this.setOptions(options)}},setOptions:function(options){for(var prop in options){this[prop]=options[prop]}},toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}});(function(global){&quot;use strict&quot;;var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;fabric.Image.filters.Brightness=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:&quot;Brightness&quot;,initialize:function(options){options=options||{};this.brightness=options.brightness||0},applyTo:function(canvasEl){var context=canvasEl.getContext(&quot;2d&quot;),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,brightness=this.brightness;for(var i=0,len=data.length;i&lt;len;i+=4){data[i]+=brightness;data[i+1]+=brightness;data[i+2]+=brightness}context.putImageData(imageData,0,0)},toObject:function(){return extend(this.callSuper(&quot;toObject&quot;),{brightness:this.brightness})}});fabric.Image.filters.Brightness.fromObject=function(object){return new fabric.Image.filters.Brightness(object)}})(typeof exports!==&quot;undefined&quot;?exports:this);(function(global){&quot;use strict&quot;;var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;fabric.Image.filters.Convolute=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:&quot;Convolute&quot;,initialize:function(options){options=options||{};this.opaque=options.opaque;this.matrix=options.matrix||[0,0,0,0,1,0,0,0,0]},applyTo:function(canvasEl){var weights=this.matrix,context=canvasEl.getContext(&quot;2d&quot;),pixels=context.getImageData(0,0,canvasEl.width,canvasEl.height),side=Math.round(Math.sqrt(weights.length)),halfSide=Math.floor(side/2),src=pixels.data,sw=pixels.width,sh=pixels.height,output=context.createImageData(sw,sh),dst=output.data,alphaFac=this.opaque?1:0,r,g,b,a,dstOff,scx,scy,srcOff,wt;for(var y=0;y&lt;sh;y++){for(var x=0;x&lt;sw;x++){dstOff=(y*sw+x)*4;r=0;g=0;b=0;a=0;for(var cy=0;cy&lt;side;cy++){for(var cx=0;cx&lt;side;cx++){scy=y+cy-halfSide;scx=x+cx-halfSide;if(scy&lt;0||scy&gt;sh||scx&lt;0||scx&gt;sw){continue}srcOff=(scy*sw+scx)*4;wt=weights[cy*side+cx];r+=src[srcOff]*wt;g+=src[srcOff+1]*wt;b+=src[srcOff+2]*wt;a+=src[srcOff+3]*wt}}dst[dstOff]=r;dst[dstOff+1]=g;dst[dstOff+2]=b;dst[dstOff+3]=a+alphaFac*(255-a)}}context.putImageData(output,0,0)},toObject:function(){return extend(this.callSuper(&quot;toObject&quot;),{opaque:this.opaque,matrix:this.matrix})}});fabric.Image.filters.Convolute.fromObject=function(object){return new fabric.Image.filters.Convolute(object)}})(typeof exports!==&quot;undefined&quot;?exports:this);(function(global){&quot;use strict&quot;;var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;fabric.Image.filters.GradientTransparency=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:&quot;GradientTransparency&quot;,initialize:function(options){options=options||{};this.threshold=options.threshold||100},applyTo:function(canvasEl){var context=canvasEl.getContext(&quot;2d&quot;),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,threshold=this.threshold,total=data.length;for(var i=0,len=data.length;i&lt;len;i+=4){data[i+3]=threshold+255*(total-i)/total}context.putImageData(imageData,0,0)},toObject:function(){return extend(this.callSuper(&quot;toObject&quot;),{threshold:this.threshold})}});fabric.Image.filters.GradientTransparency.fromObject=function(object){return new fabric.Image.filters.GradientTransparency(object)}})(typeof exports!==&quot;undefined&quot;?exports:this);(function(global){&quot;use strict&quot;;var fabric=global.fabric||(global.fabric={});fabric.Image.filters.Grayscale=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:&quot;Grayscale&quot;,applyTo:function(canvasEl){var context=canvasEl.getContext(&quot;2d&quot;),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,len=imageData.width*imageData.height*4,index=0,average;while(index&lt;len){average=(data[index]+data[index+1]+data[index+2])/3;data[index]=average;data[index+1]=average;data[index+2]=average;index+=4}context.putImageData(imageData,0,0)}});fabric.Image.filters.Grayscale.fromObject=function(){return new fabric.Image.filters.Grayscale}})(typeof exports!==&quot;undefined&quot;?exports:this);(function(global){&quot;use strict&quot;;var fabric=global.fabric||(global.fabric={});fabric.Image.filters.Invert=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:&quot;Invert&quot;,applyTo:function(canvasEl){var context=canvasEl.getContext(&quot;2d&quot;),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,iLen=data.length,i;for(i=0;i&lt;iLen;i+=4){data[i]=255-data[i];data[i+1]=255-data[i+1];data[i+2]=255-data[i+2]}context.putImageData(imageData,0,0)}});fabric.Image.filters.Invert.fromObject=function(){return new fabric.Image.filters.Invert}})(typeof exports!==&quot;undefined&quot;?exports:this);(function(global){&quot;use strict&quot;;var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;fabric.Image.filters.Mask=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:&quot;Mask&quot;,initialize:function(options){options=options||{};this.mask=options.mask;this.channel=[0,1,2,3].indexOf(options.channel)&gt;-1?options.channel:0},applyTo:function(canvasEl){if(!this.mask){return}var context=canvasEl.getContext(&quot;2d&quot;),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,maskEl=this.mask.getElement(),maskCanvasEl=fabric.util.createCanvasElement(),channel=this.channel,i,iLen=imageData.width*imageData.height*4;maskCanvasEl.width=canvasEl.width;maskCanvasEl.height=canvasEl.height;maskCanvasEl.getContext(&quot;2d&quot;).drawImage(maskEl,0,0,canvasEl.width,canvasEl.height);var maskImageData=maskCanvasEl.getContext(&quot;2d&quot;).getImageData(0,0,canvasEl.width,canvasEl.height),maskData=maskImageData.data;for(i=0;i&lt;iLen;i+=4){data[i+3]=maskData[i+channel]}context.putImageData(imageData,0,0)},toObject:function(){return extend(this.callSuper(&quot;toObject&quot;),{mask:this.mask.toObject(),channel:this.channel})}});fabric.Image.filters.Mask.fromObject=function(object,callback){fabric.util.loadImage(object.mask.src,function(img){object.mask=new fabric.Image(img,object.mask);callback&amp;&amp;callback(new fabric.Image.filters.Mask(object))})};fabric.Image.filters.Mask.async=true})(typeof exports!==&quot;undefined&quot;?exports:this);(function(global){&quot;use strict&quot;;var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;fabric.Image.filters.Noise=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:&quot;Noise&quot;,initialize:function(options){options=options||{};this.noise=options.noise||0},applyTo:function(canvasEl){var context=canvasEl.getContext(&quot;2d&quot;),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,noise=this.noise,rand;for(var i=0,len=data.length;i&lt;len;i+=4){rand=(.5-Math.random())*noise;data[i]+=rand;data[i+1]+=rand;data[i+2]+=rand}context.putImageData(imageData,0,0)},toObject:function(){return extend(this.callSuper(&quot;toObject&quot;),{noise:this.noise})}});fabric.Image.filters.Noise.fromObject=function(object){return new fabric.Image.filters.Noise(object)}})(typeof exports!==&quot;undefined&quot;?exports:this);(function(global){&quot;use strict&quot;;var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;fabric.Image.filters.Pixelate=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:&quot;Pixelate&quot;,initialize:function(options){options=options||{};this.blocksize=options.blocksize||4},applyTo:function(canvasEl){var context=canvasEl.getContext(&quot;2d&quot;),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,iLen=imageData.height,jLen=imageData.width,index,i,j,r,g,b,a;for(i=0;i&lt;iLen;i+=this.blocksize){for(j=0;j&lt;jLen;j+=this.blocksize){index=i*4*jLen+j*4;r=data[index];g=data[index+1];b=data[index+2];a=data[index+3];for(var _i=i,_ilen=i+this.blocksize;_i&lt;_ilen;_i++){for(var _j=j,_jlen=j+this.blocksize;_j&lt;_jlen;_j++){index=_i*4*jLen+_j*4;data[index]=r;data[index+1]=g;data[index+2]=b;data[index+3]=a}}}}context.putImageData(imageData,0,0)},toObject:function(){return extend(this.callSuper(&quot;toObject&quot;),{blocksize:this.blocksize})}});fabric.Image.filters.Pixelate.fromObject=function(object){return new fabric.Image.filters.Pixelate(object)}})(typeof exports!==&quot;undefined&quot;?exports:this);(function(global){&quot;use strict&quot;;var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;fabric.Image.filters.RemoveWhite=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:&quot;RemoveWhite&quot;,initialize:function(options){options=options||{};this.threshold=options.threshold||30;this.distance=options.distance||20},applyTo:function(canvasEl){var context=canvasEl.getContext(&quot;2d&quot;),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,threshold=this.threshold,distance=this.distance,limit=255-threshold,abs=Math.abs,r,g,b;for(var i=0,len=data.length;i&lt;len;i+=4){r=data[i];g=data[i+1];b=data[i+2];if(r&gt;limit&amp;&amp;g&gt;limit&amp;&amp;b&gt;limit&amp;&amp;abs(r-g)&lt;distance&amp;&amp;abs(r-b)&lt;distance&amp;&amp;abs(g-b)&lt;distance){data[i+3]=0}}context.putImageData(imageData,0,0)},toObject:function(){return extend(this.callSuper(&quot;toObject&quot;),{threshold:this.threshold,distance:this.distance})}});fabric.Image.filters.RemoveWhite.fromObject=function(object){return new fabric.Image.filters.RemoveWhite(object)}})(typeof exports!==&quot;undefined&quot;?exports:this);(function(global){&quot;use strict&quot;;var fabric=global.fabric||(global.fabric={});fabric.Image.filters.Sepia=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:&quot;Sepia&quot;,applyTo:function(canvasEl){var context=canvasEl.getContext(&quot;2d&quot;),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,iLen=data.length,i,avg;for(i=0;i&lt;iLen;i+=4){avg=.3*data[i]+.59*data[i+1]+.11*data[i+2];data[i]=avg+100;data[i+1]=avg+50;data[i+2]=avg+255}context.putImageData(imageData,0,0)}});fabric.Image.filters.Sepia.fromObject=function(){return new fabric.Image.filters.Sepia}})(typeof exports!==&quot;undefined&quot;?exports:this);(function(global){&quot;use strict&quot;;var fabric=global.fabric||(global.fabric={});fabric.Image.filters.Sepia2=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:&quot;Sepia2&quot;,applyTo:function(canvasEl){var context=canvasEl.getContext(&quot;2d&quot;),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,iLen=data.length,i,r,g,b;for(i=0;i&lt;iLen;i+=4){r=data[i];g=data[i+1];b=data[i+2];data[i]=(r*.393+g*.769+b*.189)/1.351;data[i+1]=(r*.349+g*.686+b*.168)/1.203;data[i+2]=(r*.272+g*.534+b*.131)/2.14}context.putImageData(imageData,0,0)}});fabric.Image.filters.Sepia2.fromObject=function(){return new fabric.Image.filters.Sepia2}})(typeof exports!==&quot;undefined&quot;?exports:this);(function(global){&quot;use strict&quot;;var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;fabric.Image.filters.Tint=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:&quot;Tint&quot;,initialize:function(options){options=options||{};this.color=options.color||&quot;#000000&quot;;this.opacity=typeof options.opacity!==&quot;undefined&quot;?options.opacity:new fabric.Color(this.color).getAlpha()},applyTo:function(canvasEl){var context=canvasEl.getContext(&quot;2d&quot;),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,iLen=data.length,i,tintR,tintG,tintB,r,g,b,alpha1,source;source=new fabric.Color(this.color).getSource();tintR=source[0]*this.opacity;tintG=source[1]*this.opacity;tintB=source[2]*this.opacity;alpha1=1-this.opacity;for(i=0;i&lt;iLen;i+=4){r=data[i];g=data[i+1];b=data[i+2];data[i]=tintR+r*alpha1;data[i+1]=tintG+g*alpha1;data[i+2]=tintB+b*alpha1}context.putImageData(imageData,0,0)},toObject:function(){return extend(this.callSuper(&quot;toObject&quot;),{color:this.color,opacity:this.opacity})}});fabric.Image.filters.Tint.fromObject=function(object){return new fabric.Image.filters.Tint(object)}})(typeof exports!==&quot;undefined&quot;?exports:this);(function(global){&quot;use strict&quot;;var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;fabric.Image.filters.Multiply=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:&quot;Multiply&quot;,initialize:function(options){options=options||{};this.color=options.color||&quot;#000000&quot;},applyTo:function(canvasEl){var context=canvasEl.getContext(&quot;2d&quot;),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,iLen=data.length,i,source;source=new fabric.Color(this.color).getSource();for(i=0;i&lt;iLen;i+=4){data[i]*=source[0]/255;data[i+1]*=source[1]/255;data[i+2]*=source[2]/255}context.putImageData(imageData,0,0)},toObject:function(){return extend(this.callSuper(&quot;toObject&quot;),{color:this.color})}});fabric.Image.filters.Multiply.fromObject=function(object){return new fabric.Image.filters.Multiply(object)}})(typeof exports!==&quot;undefined&quot;?exports:this);(function(global){&quot;use strict&quot;;var fabric=global.fabric;fabric.Image.filters.Blend=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:&quot;Blend&quot;,initialize:function(options){options=options||{};this.color=options.color||&quot;#000&quot;;this.image=options.image||false;this.mode=options.mode||&quot;multiply&quot;;this.alpha=options.alpha||1},applyTo:function(canvasEl){var context=canvasEl.getContext(&quot;2d&quot;),imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height),data=imageData.data,tr,tg,tb,r,g,b,_r,_g,_b,source,isImage=false;if(this.image){isImage=true;var _el=fabric.util.createCanvasElement();_el.width=this.image.width;_el.height=this.image.height;var tmpCanvas=new fabric.StaticCanvas(_el);tmpCanvas.add(this.image);var context2=tmpCanvas.getContext(&quot;2d&quot;);source=context2.getImageData(0,0,tmpCanvas.width,tmpCanvas.height).data}else{source=new fabric.Color(this.color).getSource();tr=source[0]*this.alpha;tg=source[1]*this.alpha;tb=source[2]*this.alpha}for(var i=0,len=data.length;i&lt;len;i+=4){r=data[i];g=data[i+1];b=data[i+2];if(isImage){tr=source[i]*this.alpha;tg=source[i+1]*this.alpha;tb=source[i+2]*this.alpha}switch(this.mode){case&quot;multiply&quot;:data[i]=r*tr/255;data[i+1]=g*tg/255;data[i+2]=b*tb/255;break;case&quot;screen&quot;:data[i]=1-(1-r)*(1-tr);data[i+1]=1-(1-g)*(1-tg);data[i+2]=1-(1-b)*(1-tb);break;case&quot;add&quot;:data[i]=Math.min(255,r+tr);data[i+1]=Math.min(255,g+tg);data[i+2]=Math.min(255,b+tb);break;case&quot;diff&quot;:case&quot;difference&quot;:data[i]=Math.abs(r-tr);data[i+1]=Math.abs(g-tg);data[i+2]=Math.abs(b-tb);break;case&quot;subtract&quot;:_r=r-tr;_g=g-tg;_b=b-tb;data[i]=_r&lt;0?0:_r;data[i+1]=_g&lt;0?0:_g;data[i+2]=_b&lt;0?0:_b;break;case&quot;darken&quot;:data[i]=Math.min(r,tr);data[i+1]=Math.min(g,tg);data[i+2]=Math.min(b,tb);break;case&quot;lighten&quot;:data[i]=Math.max(r,tr);data[i+1]=Math.max(g,tg);data[i+2]=Math.max(b,tb);break}}context.putImageData(imageData,0,0)},toObject:function(){return{color:this.color,image:this.image,mode:this.mode,alpha:this.alpha}}});fabric.Image.filters.Blend.fromObject=function(object){return new fabric.Image.filters.Blend(object)}})(typeof exports!==&quot;undefined&quot;?exports:this);(function(global){&quot;use strict&quot;;var fabric=global.fabric||(global.fabric={}),pow=Math.pow,floor=Math.floor,sqrt=Math.sqrt,abs=Math.abs,max=Math.max,round=Math.round,sin=Math.sin,ceil=Math.ceil;fabric.Image.filters.Resize=fabric.util.createClass(fabric.Image.filters.BaseFilter,{type:&quot;Resize&quot;,resizeType:&quot;hermite&quot;,scaleX:0,scaleY:0,lanczosLobes:3,applyTo:function(canvasEl,scaleX,scaleY){this.rcpScaleX=1/scaleX;this.rcpScaleY=1/scaleY;var oW=canvasEl.width,oH=canvasEl.height,dW=round(oW*scaleX),dH=round(oH*scaleY),imageData;if(this.resizeType===&quot;sliceHack&quot;){imageData=this.sliceByTwo(canvasEl,oW,oH,dW,dH)}if(this.resizeType===&quot;hermite&quot;){imageData=this.hermiteFastResize(canvasEl,oW,oH,dW,dH)}if(this.resizeType===&quot;bilinear&quot;){imageData=this.bilinearFiltering(canvasEl,oW,oH,dW,dH)}if(this.resizeType===&quot;lanczos&quot;){imageData=this.lanczosResize(canvasEl,oW,oH,dW,dH)}canvasEl.width=dW;canvasEl.height=dH;canvasEl.getContext(&quot;2d&quot;).putImageData(imageData,0,0)},sliceByTwo:function(canvasEl,width,height,newWidth,newHeight){var context=canvasEl.getContext(&quot;2d&quot;),imageData,multW=.5,multH=.5,signW=1,signH=1,doneW=false,doneH=false,stepW=width,stepH=height,tmpCanvas=fabric.util.createCanvasElement(),tmpCtx=tmpCanvas.getContext(&quot;2d&quot;);newWidth=floor(newWidth);newHeight=floor(newHeight);tmpCanvas.width=max(newWidth,width);tmpCanvas.height=max(newHeight,height);if(newWidth&gt;width){multW=2;signW=-1}if(newHeight&gt;height){multH=2;signH=-1}imageData=context.getImageData(0,0,width,height);canvasEl.width=max(newWidth,width);canvasEl.height=max(newHeight,height);context.putImageData(imageData,0,0);while(!doneW||!doneH){width=stepW;height=stepH;if(newWidth*signW&lt;floor(stepW*multW*signW)){stepW=floor(stepW*multW)}else{stepW=newWidth;doneW=true}if(newHeight*signH&lt;floor(stepH*multH*signH)){stepH=floor(stepH*multH)}else{stepH=newHeight;doneH=true}imageData=context.getImageData(0,0,width,height);tmpCtx.putImageData(imageData,0,0);context.clearRect(0,0,stepW,stepH);context.drawImage(tmpCanvas,0,0,width,height,0,0,stepW,stepH)}return context.getImageData(0,0,newWidth,newHeight)},lanczosResize:function(canvasEl,oW,oH,dW,dH){function lanczosCreate(lobes){return function(x){if(x&gt;lobes){return 0}x*=Math.PI;if(abs(x)&lt;1e-16){return 1}var xx=x/lobes;return sin(x)*sin(xx)/x/xx}}function process(u){var v,i,weight,idx,a,red,green,blue,alpha,fX,fY;center.x=(u+.5)*ratioX;icenter.x=floor(center.x);for(v=0;v&lt;dH;v++){center.y=(v+.5)*ratioY;icenter.y=floor(center.y);a=0,red=0,green=0,blue=0,alpha=0;for(i=icenter.x-range2X;i&lt;=icenter.x+range2X;i++){if(i&lt;0||i&gt;=oW){continue}fX=floor(1e3*abs(i-center.x));if(!cacheLanc[fX]){cacheLanc[fX]={}}for(var j=icenter.y-range2Y;j&lt;=icenter.y+range2Y;j++){if(j&lt;0||j&gt;=oH){continue}fY=floor(1e3*abs(j-center.y));if(!cacheLanc[fX][fY]){cacheLanc[fX][fY]=lanczos(sqrt(pow(fX*rcpRatioX,2)+pow(fY*rcpRatioY,2))/1e3)}weight=cacheLanc[fX][fY];if(weight&gt;0){idx=(j*oW+i)*4;a+=weight;red+=weight*srcData[idx];green+=weight*srcData[idx+1];blue+=weight*srcData[idx+2];alpha+=weight*srcData[idx+3]}}}idx=(v*dW+u)*4;destData[idx]=red/a;destData[idx+1]=green/a;destData[idx+2]=blue/a;destData[idx+3]=alpha/a}if(++u&lt;dW){return process(u)}else{return destImg}}var context=canvasEl.getContext(&quot;2d&quot;),srcImg=context.getImageData(0,0,oW,oH),destImg=context.getImageData(0,0,dW,dH),srcData=srcImg.data,destData=destImg.data,lanczos=lanczosCreate(this.lanczosLobes),ratioX=this.rcpScaleX,ratioY=this.rcpScaleY,rcpRatioX=2/this.rcpScaleX,rcpRatioY=2/this.rcpScaleY,range2X=ceil(ratioX*this.lanczosLobes/2),range2Y=ceil(ratioY*this.lanczosLobes/2),cacheLanc={},center={},icenter={};return process(0)},bilinearFiltering:function(canvasEl,w,h,w2,h2){var a,b,c,d,x,y,i,j,xDiff,yDiff,chnl,color,offset=0,origPix,ratioX=this.rcpScaleX,ratioY=this.rcpScaleY,context=canvasEl.getContext(&quot;2d&quot;),w4=4*(w-1),img=context.getImageData(0,0,w,h),pixels=img.data,destImage=context.getImageData(0,0,w2,h2),destPixels=destImage.data;for(i=0;i&lt;h2;i++){for(j=0;j&lt;w2;j++){x=floor(ratioX*j);y=floor(ratioY*i);xDiff=ratioX*j-x;yDiff=ratioY*i-y;origPix=4*(y*w+x);for(chnl=0;chnl&lt;4;chnl++){a=pixels[origPix+chnl];b=pixels[origPix+4+chnl];c=pixels[origPix+w4+chnl];d=pixels[origPix+w4+4+chnl];color=a*(1-xDiff)*(1-yDiff)+b*xDiff*(1-yDiff)+c*yDiff*(1-xDiff)+d*xDiff*yDiff;destPixels[offset++]=color}}}return destImage},hermiteFastResize:function(canvasEl,oW,oH,dW,dH){var ratioW=this.rcpScaleX,ratioH=this.rcpScaleY,ratioWHalf=ceil(ratioW/2),ratioHHalf=ceil(ratioH/2),context=canvasEl.getContext(&quot;2d&quot;),img=context.getImageData(0,0,oW,oH),data=img.data,img2=context.getImageData(0,0,dW,dH),data2=img2.data;for(var j=0;j&lt;dH;j++){for(var i=0;i&lt;dW;i++){var x2=(i+j*dW)*4,weight=0,weights=0,weightsAlpha=0,gxR=0,gxG=0,gxB=0,gxA=0,centerY=(j+.5)*ratioH;for(var yy=floor(j*ratioH);yy&lt;(j+1)*ratioH;yy++){var dy=abs(centerY-(yy+.5))/ratioHHalf,centerX=(i+.5)*ratioW,w0=dy*dy;for(var xx=floor(i*ratioW);xx&lt;(i+1)*ratioW;xx++){var dx=abs(centerX-(xx+.5))/ratioWHalf,w=sqrt(w0+dx*dx);if(w&gt;1&amp;&amp;w&lt;-1){continue}weight=2*w*w*w-3*w*w+1;if(weight&gt;0){dx=4*(xx+yy*oW);gxA+=weight*data[dx+3];weightsAlpha+=weight;if(data[dx+3]&lt;255){weight=weight*data[dx+3]/250}gxR+=weight*data[dx];gxG+=weight*data[dx+1];gxB+=weight*data[dx+2];weights+=weight}}}data2[x2]=gxR/weights;data2[x2+1]=gxG/weights;data2[x2+2]=gxB/weights;data2[x2+3]=gxA/weightsAlpha}}return img2},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}});fabric.Image.filters.Resize.fromObject=function(object){return new fabric.Image.filters.Resize(object)</td>
      </tr>
      <tr>
        <td id="L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="LC9" class="blob-code blob-code-inner js-file-line">}})(typeof exports!==&quot;undefined&quot;?exports:this);(function(global){&quot;use strict&quot;;var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,clone=fabric.util.object.clone,toFixed=fabric.util.toFixed,supportsLineDash=fabric.StaticCanvas.supports(&quot;setLineDash&quot;),NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS;if(fabric.Text){fabric.warn(&quot;fabric.Text is already defined&quot;);return}var stateProperties=fabric.Object.prototype.stateProperties.concat();stateProperties.push(&quot;fontFamily&quot;,&quot;fontWeight&quot;,&quot;fontSize&quot;,&quot;text&quot;,&quot;textDecoration&quot;,&quot;textAlign&quot;,&quot;fontStyle&quot;,&quot;lineHeight&quot;,&quot;textBackgroundColor&quot;);fabric.Text=fabric.util.createClass(fabric.Object,{_dimensionAffectingProps:{fontSize:true,fontWeight:true,fontFamily:true,fontStyle:true,lineHeight:true,stroke:true,strokeWidth:true,text:true,textAlign:true},_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]+/g,type:&quot;text&quot;,fontSize:40,fontWeight:&quot;normal&quot;,fontFamily:&quot;Times New Roman&quot;,textDecoration:&quot;&quot;,textAlign:&quot;left&quot;,fontStyle:&quot;&quot;,lineHeight:1.16,textBackgroundColor:&quot;&quot;,stateProperties:stateProperties,stroke:null,shadow:null,_fontSizeFraction:.25,_fontSizeMult:1.13,initialize:function(text,options){options=options||{};this.text=text;this.__skipDimension=true;this.setOptions(options);this.__skipDimension=false;this._initDimensions()},_initDimensions:function(ctx){if(this.__skipDimension){return}if(!ctx){ctx=fabric.util.createCanvasElement().getContext(&quot;2d&quot;);this._setTextStyles(ctx)}this._textLines=this._splitTextIntoLines();this._clearCache();this.width=this._getTextWidth(ctx);this.height=this._getTextHeight(ctx)},toString:function(){return&quot;#&lt;fabric.Text (&quot;+this.complexity()+&#39;): { &quot;text&quot;: &quot;&#39;+this.text+&#39;&quot;, &quot;fontFamily&quot;: &quot;&#39;+this.fontFamily+&#39;&quot; }&gt;&#39;},_render:function(ctx){this.clipTo&amp;&amp;fabric.util.clipContext(this,ctx);this._setOpacity(ctx);this._setShadow(ctx);this._setupCompositeOperation(ctx);this._renderTextBackground(ctx);this._setStrokeStyles(ctx);this._setFillStyles(ctx);this._renderText(ctx);this._renderTextDecoration(ctx);this.clipTo&amp;&amp;ctx.restore()},_renderText:function(ctx){this._translateForTextAlign(ctx);this._renderTextFill(ctx);this._renderTextStroke(ctx);this._translateForTextAlign(ctx,true)},_translateForTextAlign:function(ctx,back){if(this.textAlign!==&quot;left&quot;&amp;&amp;this.textAlign!==&quot;justify&quot;){var sign=back?-1:1;ctx.translate(this.textAlign===&quot;center&quot;?sign*this.width/2:sign*this.width,0)}},_setTextStyles:function(ctx){ctx.textBaseline=&quot;alphabetic&quot;;if(!this.skipTextAlign){ctx.textAlign=this.textAlign}ctx.font=this._getFontDeclaration()},_getTextHeight:function(){return this._textLines.length*this._getHeightOfLine()},_getTextWidth:function(ctx){var maxWidth=this._getLineWidth(ctx,0);for(var i=1,len=this._textLines.length;i&lt;len;i++){var currentLineWidth=this._getLineWidth(ctx,i);if(currentLineWidth&gt;maxWidth){maxWidth=currentLineWidth}}return maxWidth},_getNonTransformedDimensions:function(){return{x:this.width,y:this.height}},_renderChars:function(method,ctx,chars,left,top){var shortM=method.slice(0,-4);if(this[shortM].toLive){var offsetX=-this.width/2+this[shortM].offsetX||0,offsetY=-this.height/2+this[shortM].offsetY||0;ctx.save();ctx.translate(offsetX,offsetY);left-=offsetX;top-=offsetY}ctx[method](chars,left,top);this[shortM].toLive&amp;&amp;ctx.restore()},_renderTextLine:function(method,ctx,line,left,top,lineIndex){top-=this.fontSize*this._fontSizeFraction;var lineWidth=this._getLineWidth(ctx,lineIndex);if(this.textAlign!==&quot;justify&quot;||this.width&lt;lineWidth){this._renderChars(method,ctx,line,left,top,lineIndex);return}var words=line.split(/\s+/),charOffset=0,wordsWidth=this._getWidthOfWords(ctx,line,lineIndex,0),widthDiff=this.width-wordsWidth,numSpaces=words.length-1,spaceWidth=numSpaces&gt;0?widthDiff/numSpaces:0,leftOffset=0,word;for(var i=0,len=words.length;i&lt;len;i++){while(line[charOffset]===&quot; &quot;&amp;&amp;charOffset&lt;line.length){charOffset++}word=words[i];this._renderChars(method,ctx,word,left+leftOffset,top,lineIndex,charOffset);leftOffset+=this._getWidthOfWords(ctx,word,lineIndex,charOffset)+spaceWidth;charOffset+=word.length}},_getWidthOfWords:function(ctx,line){return ctx.measureText(line.replace(/\s+/g,&quot;&quot;)).width},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},isEmptyStyles:function(){return true},_renderTextFill:function(ctx){if(!this.fill&amp;&amp;this.isEmptyStyles()){return}var lineHeights=0;for(var i=0,len=this._textLines.length;i&lt;len;i++){var heightOfLine=this._getHeightOfLine(ctx,i),maxHeight=heightOfLine/this.lineHeight;this._renderTextLine(&quot;fillText&quot;,ctx,this._textLines[i],this._getLeftOffset(),this._getTopOffset()+lineHeights+maxHeight,i);lineHeights+=heightOfLine}},_renderTextStroke:function(ctx){if((!this.stroke||this.strokeWidth===0)&amp;&amp;this.isEmptyStyles()){return}var lineHeights=0;if(this.shadow&amp;&amp;!this.shadow.affectStroke){this._removeShadow(ctx)}ctx.save();if(this.strokeDashArray){if(1&amp;this.strokeDashArray.length){this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray)}supportsLineDash&amp;&amp;ctx.setLineDash(this.strokeDashArray)}ctx.beginPath();for(var i=0,len=this._textLines.length;i&lt;len;i++){var heightOfLine=this._getHeightOfLine(ctx,i),maxHeight=heightOfLine/this.lineHeight;this._renderTextLine(&quot;strokeText&quot;,ctx,this._textLines[i],this._getLeftOffset(),this._getTopOffset()+lineHeights+maxHeight,i);lineHeights+=heightOfLine}ctx.closePath();ctx.restore()},_getHeightOfLine:function(){return this.fontSize*this._fontSizeMult*this.lineHeight},_renderTextBackground:function(ctx){this._renderTextBoxBackground(ctx);this._renderTextLinesBackground(ctx)},_renderTextBoxBackground:function(ctx){if(!this.backgroundColor){return}ctx.fillStyle=this.backgroundColor;ctx.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height);this._removeShadow(ctx)},_renderTextLinesBackground:function(ctx){if(!this.textBackgroundColor){return}var lineTopOffset=0,heightOfLine,lineWidth,lineLeftOffset;ctx.fillStyle=this.textBackgroundColor;for(var i=0,len=this._textLines.length;i&lt;len;i++){heightOfLine=this._getHeightOfLine(ctx,i);lineWidth=this._getLineWidth(ctx,i);if(lineWidth&gt;0){lineLeftOffset=this._getLineLeftOffset(lineWidth);ctx.fillRect(this._getLeftOffset()+lineLeftOffset,this._getTopOffset()+lineTopOffset,lineWidth,heightOfLine/this.lineHeight)}lineTopOffset+=heightOfLine}this._removeShadow(ctx)},_getLineLeftOffset:function(lineWidth){if(this.textAlign===&quot;center&quot;){return(this.width-lineWidth)/2}if(this.textAlign===&quot;right&quot;){return this.width-lineWidth}return 0},_clearCache:function(){this.__lineWidths=[];this.__lineHeights=[]},_shouldClearCache:function(){var shouldClear=false;if(this._forceClearCache){this._forceClearCache=false;return true}for(var prop in this._dimensionAffectingProps){if(this[&quot;__&quot;+prop]!==this[prop]){this[&quot;__&quot;+prop]=this[prop];shouldClear=true}}return shouldClear},_getLineWidth:function(ctx,lineIndex){if(this.__lineWidths[lineIndex]){return this.__lineWidths[lineIndex]===-1?this.width:this.__lineWidths[lineIndex]}var width,wordCount,line=this._textLines[lineIndex];if(line===&quot;&quot;){width=0}else{width=this._measureLine(ctx,lineIndex)}this.__lineWidths[lineIndex]=width;if(width&amp;&amp;this.textAlign===&quot;justify&quot;){wordCount=line.split(/\s+/);if(wordCount.length&gt;1){this.__lineWidths[lineIndex]=-1}}return width},_measureLine:function(ctx,lineIndex){return ctx.measureText(this._textLines[lineIndex]).width},_renderTextDecoration:function(ctx){if(!this.textDecoration){return}var halfOfVerticalBox=this.height/2,_this=this,offsets=[];function renderLinesAtOffset(offsets){var i,lineHeight=0,len,j,oLen,lineWidth,lineLeftOffset,heightOfLine;for(i=0,len=_this._textLines.length;i&lt;len;i++){lineWidth=_this._getLineWidth(ctx,i),lineLeftOffset=_this._getLineLeftOffset(lineWidth),heightOfLine=_this._getHeightOfLine(ctx,i);for(j=0,oLen=offsets.length;j&lt;oLen;j++){ctx.fillRect(_this._getLeftOffset()+lineLeftOffset,lineHeight+(_this._fontSizeMult-1+offsets[j])*_this.fontSize-halfOfVerticalBox,lineWidth,_this.fontSize/15)}lineHeight+=heightOfLine}}if(this.textDecoration.indexOf(&quot;underline&quot;)&gt;-1){offsets.push(.85)}if(this.textDecoration.indexOf(&quot;line-through&quot;)&gt;-1){offsets.push(.43)}if(this.textDecoration.indexOf(&quot;overline&quot;)&gt;-1){offsets.push(-.12)}if(offsets.length&gt;0){renderLinesAtOffset(offsets)}},_getFontDeclaration:function(){return[fabric.isLikelyNode?this.fontWeight:this.fontStyle,fabric.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+&quot;px&quot;,fabric.isLikelyNode?&#39;&quot;&#39;+this.fontFamily+&#39;&quot;&#39;:this.fontFamily].join(&quot; &quot;)},render:function(ctx,noTransform){if(!this.visible){return}ctx.save();this._setTextStyles(ctx);if(this._shouldClearCache()){this._initDimensions(ctx)}this.drawSelectionBackground(ctx);if(!noTransform){this.transform(ctx)}if(this.transformMatrix){ctx.transform.apply(ctx,this.transformMatrix)}if(this.group&amp;&amp;this.group.type===&quot;path-group&quot;){ctx.translate(this.left,this.top)}this._render(ctx);ctx.restore()},_splitTextIntoLines:function(){return this.text.split(this._reNewline)},toObject:function(propertiesToInclude){var object=extend(this.callSuper(&quot;toObject&quot;,propertiesToInclude),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,textBackgroundColor:this.textBackgroundColor});if(!this.includeDefaultValues){this._removeDefaultValues(object)}return object},toSVG:function(reviver){var markup=this._createBaseSVGMarkup(),offsets=this._getSVGLeftTopOffsets(this.ctx),textAndBg=this._getSVGTextAndBg(offsets.textTop,offsets.textLeft);this._wrapSVGTextAndBg(markup,textAndBg);return reviver?reviver(markup.join(&quot;&quot;)):markup.join(&quot;&quot;)},_getSVGLeftTopOffsets:function(ctx){var lineTop=this._getHeightOfLine(ctx,0),textLeft=-this.width/2,textTop=0;return{textLeft:textLeft+(this.group&amp;&amp;this.group.type===&quot;path-group&quot;?this.left:0),textTop:textTop+(this.group&amp;&amp;this.group.type===&quot;path-group&quot;?-this.top:0),lineTop:lineTop}},_wrapSVGTextAndBg:function(markup,textAndBg){var noShadow=true,filter=this.getSvgFilter(),style=filter===&quot;&quot;?&quot;&quot;:&#39; style=&quot;&#39;+filter+&#39;&quot;&#39;;markup.push(&quot;	&lt;g &quot;,this.getSvgId(),&#39;transform=&quot;&#39;,this.getSvgTransform(),this.getSvgTransformMatrix(),&#39;&quot;&#39;,style,&quot;&gt;\n&quot;,textAndBg.textBgRects.join(&quot;&quot;),&quot;		&lt;text &quot;,this.fontFamily?&#39;font-family=&quot;&#39;+this.fontFamily.replace(/&quot;/g,&quot;&#39;&quot;)+&#39;&quot; &#39;:&quot;&quot;,this.fontSize?&#39;font-size=&quot;&#39;+this.fontSize+&#39;&quot; &#39;:&quot;&quot;,this.fontStyle?&#39;font-style=&quot;&#39;+this.fontStyle+&#39;&quot; &#39;:&quot;&quot;,this.fontWeight?&#39;font-weight=&quot;&#39;+this.fontWeight+&#39;&quot; &#39;:&quot;&quot;,this.textDecoration?&#39;text-decoration=&quot;&#39;+this.textDecoration+&#39;&quot; &#39;:&quot;&quot;,&#39;style=&quot;&#39;,this.getSvgStyles(noShadow),&#39;&quot; &gt;\n&#39;,textAndBg.textSpans.join(&quot;&quot;),&quot;		&lt;/text&gt;\n&quot;,&quot;	&lt;/g&gt;\n&quot;)},_getSVGTextAndBg:function(textTopOffset,textLeftOffset){var textSpans=[],textBgRects=[],height=0;this._setSVGBg(textBgRects);for(var i=0,len=this._textLines.length;i&lt;len;i++){if(this.textBackgroundColor){this._setSVGTextLineBg(textBgRects,i,textLeftOffset,textTopOffset,height)}this._setSVGTextLineText(i,textSpans,height,textLeftOffset,textTopOffset,textBgRects);height+=this._getHeightOfLine(this.ctx,i)}return{textSpans:textSpans,textBgRects:textBgRects}},_setSVGTextLineText:function(i,textSpans,height,textLeftOffset,textTopOffset){var yPos=this.fontSize*(this._fontSizeMult-this._fontSizeFraction)-textTopOffset+height-this.height/2;if(this.textAlign===&quot;justify&quot;){this._setSVGTextLineJustifed(i,textSpans,yPos,textLeftOffset);return}textSpans.push(&#39;			&lt;tspan x=&quot;&#39;,toFixed(textLeftOffset+this._getLineLeftOffset(this._getLineWidth(this.ctx,i)),NUM_FRACTION_DIGITS),&#39;&quot; &#39;,&#39;y=&quot;&#39;,toFixed(yPos,NUM_FRACTION_DIGITS),&#39;&quot; &#39;,this._getFillAttributes(this.fill),&quot;&gt;&quot;,fabric.util.string.escapeXml(this._textLines[i]),&quot;&lt;/tspan&gt;\n&quot;)},_setSVGTextLineJustifed:function(i,textSpans,yPos,textLeftOffset){var ctx=fabric.util.createCanvasElement().getContext(&quot;2d&quot;);this._setTextStyles(ctx);var line=this._textLines[i],words=line.split(/\s+/),wordsWidth=this._getWidthOfWords(ctx,line),widthDiff=this.width-wordsWidth,numSpaces=words.length-1,spaceWidth=numSpaces&gt;0?widthDiff/numSpaces:0,word,attributes=this._getFillAttributes(this.fill),len;textLeftOffset+=this._getLineLeftOffset(this._getLineWidth(ctx,i));for(i=0,len=words.length;i&lt;len;i++){word=words[i];textSpans.push(&#39;			&lt;tspan x=&quot;&#39;,toFixed(textLeftOffset,NUM_FRACTION_DIGITS),&#39;&quot; &#39;,&#39;y=&quot;&#39;,toFixed(yPos,NUM_FRACTION_DIGITS),&#39;&quot; &#39;,attributes,&quot;&gt;&quot;,fabric.util.string.escapeXml(word),&quot;&lt;/tspan&gt;\n&quot;);textLeftOffset+=this._getWidthOfWords(ctx,word)+spaceWidth}},_setSVGTextLineBg:function(textBgRects,i,textLeftOffset,textTopOffset,height){textBgRects.push(&quot;		&lt;rect &quot;,this._getFillAttributes(this.textBackgroundColor),&#39; x=&quot;&#39;,toFixed(textLeftOffset+this._getLineLeftOffset(this._getLineWidth(this.ctx,i)),NUM_FRACTION_DIGITS),&#39;&quot; y=&quot;&#39;,toFixed(height-this.height/2,NUM_FRACTION_DIGITS),&#39;&quot; width=&quot;&#39;,toFixed(this._getLineWidth(this.ctx,i),NUM_FRACTION_DIGITS),&#39;&quot; height=&quot;&#39;,toFixed(this._getHeightOfLine(this.ctx,i)/this.lineHeight,NUM_FRACTION_DIGITS),&#39;&quot;&gt;&lt;/rect&gt;\n&#39;)},_setSVGBg:function(textBgRects){if(this.backgroundColor){textBgRects.push(&quot;		&lt;rect &quot;,this._getFillAttributes(this.backgroundColor),&#39; x=&quot;&#39;,toFixed(-this.width/2,NUM_FRACTION_DIGITS),&#39;&quot; y=&quot;&#39;,toFixed(-this.height/2,NUM_FRACTION_DIGITS),&#39;&quot; width=&quot;&#39;,toFixed(this.width,NUM_FRACTION_DIGITS),&#39;&quot; height=&quot;&#39;,toFixed(this.height,NUM_FRACTION_DIGITS),&#39;&quot;&gt;&lt;/rect&gt;\n&#39;)}},_getFillAttributes:function(value){var fillColor=value&amp;&amp;typeof value===&quot;string&quot;?new fabric.Color(value):&quot;&quot;;if(!fillColor||!fillColor.getSource()||fillColor.getAlpha()===1){return&#39;fill=&quot;&#39;+value+&#39;&quot;&#39;}return&#39;opacity=&quot;&#39;+fillColor.getAlpha()+&#39;&quot; fill=&quot;&#39;+fillColor.setAlpha(1).toRgb()+&#39;&quot;&#39;},_set:function(key,value){this.callSuper(&quot;_set&quot;,key,value);if(key in this._dimensionAffectingProps){this._initDimensions();this.setCoords()}},complexity:function(){return 1}});fabric.Text.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat(&quot;x y dx dy font-family font-style font-weight font-size text-decoration text-anchor&quot;.split(&quot; &quot;));fabric.Text.DEFAULT_SVG_FONT_SIZE=16;fabric.Text.fromElement=function(element,options){if(!element){return null}var parsedAttributes=fabric.parseAttributes(element,fabric.Text.ATTRIBUTE_NAMES);options=fabric.util.object.extend(options?fabric.util.object.clone(options):{},parsedAttributes);options.top=options.top||0;options.left=options.left||0;if(&quot;dx&quot;in parsedAttributes){options.left+=parsedAttributes.dx}if(&quot;dy&quot;in parsedAttributes){options.top+=parsedAttributes.dy}if(!(&quot;fontSize&quot;in options)){options.fontSize=fabric.Text.DEFAULT_SVG_FONT_SIZE}if(!options.originX){options.originX=&quot;left&quot;}var textContent=&quot;&quot;;if(!(&quot;textContent&quot;in element)){if(&quot;firstChild&quot;in element&amp;&amp;element.firstChild!==null){if(&quot;data&quot;in element.firstChild&amp;&amp;element.firstChild.data!==null){textContent=element.firstChild.data}}}else{textContent=element.textContent}textContent=textContent.replace(/^\s+|\s+$|\n+/g,&quot;&quot;).replace(/\s+/g,&quot; &quot;);var text=new fabric.Text(textContent,options),offX=0;if(text.originX===&quot;left&quot;){offX=text.getWidth()/2}if(text.originX===&quot;right&quot;){offX=-text.getWidth()/2}text.set({left:text.getLeft()+offX,top:text.getTop()-text.getHeight()/2+text.fontSize*(.18+text._fontSizeFraction)});return text};fabric.Text.fromObject=function(object){return new fabric.Text(object.text,clone(object))};fabric.util.createAccessors(fabric.Text)})(typeof exports!==&quot;undefined&quot;?exports:this);(function(){var clone=fabric.util.object.clone;fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:&quot;i-text&quot;,selectionStart:0,selectionEnd:0,selectionColor:&quot;rgba(17,119,255,0.3)&quot;,isEditing:false,editable:true,editingBorderColor:&quot;rgba(102,153,255,0.25)&quot;,cursorWidth:2,cursorColor:&quot;#333&quot;,cursorDelay:1e3,cursorDuration:600,styles:null,caching:true,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:false,__widthOfSpace:[],initialize:function(text,options){this.styles=options?options.styles||{}:{};this.callSuper(&quot;initialize&quot;,text,options);this.initBehavior()},_clearCache:function(){this.callSuper(&quot;_clearCache&quot;);this.__widthOfSpace=[]},isEmptyStyles:function(){if(!this.styles){return true}var obj=this.styles;for(var p1 in obj){for(var p2 in obj[p1]){for(var p3 in obj[p1][p2]){return false}}}return true},setSelectionStart:function(index){index=Math.max(index,0);if(this.selectionStart!==index){this.fire(&quot;selection:changed&quot;);this.canvas&amp;&amp;this.canvas.fire(&quot;text:selection:changed&quot;,{target:this});this.selectionStart=index}this._updateTextarea()},setSelectionEnd:function(index){index=Math.min(index,this.text.length);if(this.selectionEnd!==index){this.fire(&quot;selection:changed&quot;);this.canvas&amp;&amp;this.canvas.fire(&quot;text:selection:changed&quot;,{target:this});this.selectionEnd=index}this._updateTextarea()},getSelectionStyles:function(startIndex,endIndex){if(arguments.length===2){var styles=[];for(var i=startIndex;i&lt;endIndex;i++){styles.push(this.getSelectionStyles(i))}return styles}var loc=this.get2DCursorLocation(startIndex),style=this._getStyleDeclaration(loc.lineIndex,loc.charIndex);return style||{}},setSelectionStyles:function(styles){if(this.selectionStart===this.selectionEnd){this._extendStyles(this.selectionStart,styles)}else{for(var i=this.selectionStart;i&lt;this.selectionEnd;i++){this._extendStyles(i,styles)}}this._forceClearCache=true;return this},_extendStyles:function(index,styles){var loc=this.get2DCursorLocation(index);if(!this._getLineStyle(loc.lineIndex)){this._setLineStyle(loc.lineIndex,{})}if(!this._getStyleDeclaration(loc.lineIndex,loc.charIndex)){this._setStyleDeclaration(loc.lineIndex,loc.charIndex,{})}fabric.util.object.extend(this._getStyleDeclaration(loc.lineIndex,loc.charIndex),styles)},_render:function(ctx){this.oldWidth=this.width;this.oldHeight=this.height;this.callSuper(&quot;_render&quot;,ctx);this.ctx=ctx;this.isEditing&amp;&amp;this.renderCursorOrSelection()},renderCursorOrSelection:function(){if(!this.active||!this.isEditing){return}var chars=this.text.split(&quot;&quot;),boundaries,ctx;if(this.canvas.contextTop){ctx=this.canvas.contextTop;ctx.save();ctx.transform.apply(ctx,this.canvas.viewportTransform);this.transform(ctx);this.transformMatrix&amp;&amp;ctx.transform.apply(ctx,this.transformMatrix);this._clearTextArea(ctx)}else{ctx=this.ctx;ctx.save()}if(this.selectionStart===this.selectionEnd){boundaries=this._getCursorBoundaries(chars,&quot;cursor&quot;);this.renderCursor(boundaries,ctx)}else{boundaries=this._getCursorBoundaries(chars,&quot;selection&quot;);this.renderSelection(chars,boundaries,ctx)}ctx.restore()},_clearTextArea:function(ctx){var width=this.oldWidth+4,height=this.oldHeight+4;ctx.clearRect(-width/2,-height/2,width,height)},get2DCursorLocation:function(selectionStart){if(typeof selectionStart===&quot;undefined&quot;){selectionStart=this.selectionStart}var len=this._textLines.length;for(var i=0;i&lt;len;i++){if(selectionStart&lt;=this._textLines[i].length){return{lineIndex:i,charIndex:selectionStart}}selectionStart-=this._textLines[i].length+1}return{lineIndex:i-1,charIndex:this._textLines[i-1].length&lt;selectionStart?this._textLines[i-1].length:selectionStart}},getCurrentCharStyle:function(lineIndex,charIndex){var style=this._getStyleDeclaration(lineIndex,charIndex===0?0:charIndex-1);return{fontSize:style&amp;&amp;style.fontSize||this.fontSize,fill:style&amp;&amp;style.fill||this.fill,textBackgroundColor:style&amp;&amp;style.textBackgroundColor||this.textBackgroundColor,textDecoration:style&amp;&amp;style.textDecoration||this.textDecoration,fontFamily:style&amp;&amp;style.fontFamily||this.fontFamily,fontWeight:style&amp;&amp;style.fontWeight||this.fontWeight,fontStyle:style&amp;&amp;style.fontStyle||this.fontStyle,stroke:style&amp;&amp;style.stroke||this.stroke,strokeWidth:style&amp;&amp;style.strokeWidth||this.strokeWidth}},getCurrentCharFontSize:function(lineIndex,charIndex){var style=this._getStyleDeclaration(lineIndex,charIndex===0?0:charIndex-1);return style&amp;&amp;style.fontSize?style.fontSize:this.fontSize},getCurrentCharColor:function(lineIndex,charIndex){var style=this._getStyleDeclaration(lineIndex,charIndex===0?0:charIndex-1);return style&amp;&amp;style.fill?style.fill:this.cursorColor},_getCursorBoundaries:function(chars,typeOfBoundaries){var left=Math.round(this._getLeftOffset()),top=this._getTopOffset(),offsets=this._getCursorBoundariesOffsets(chars,typeOfBoundaries);return{left:left,top:top,leftOffset:offsets.left+offsets.lineLeft,topOffset:offsets.top}},_getCursorBoundariesOffsets:function(chars,typeOfBoundaries){var lineLeftOffset=0,lineIndex=0,charIndex=0,topOffset=0,leftOffset=0;for(var i=0;i&lt;this.selectionStart;i++){if(chars[i]===&quot;\n&quot;){leftOffset=0;topOffset+=this._getHeightOfLine(this.ctx,lineIndex);lineIndex++;charIndex=0}else{leftOffset+=this._getWidthOfChar(this.ctx,chars[i],lineIndex,charIndex);charIndex++}lineLeftOffset=this._getLineLeftOffset(this._getLineWidth(this.ctx,lineIndex))}if(typeOfBoundaries===&quot;cursor&quot;){topOffset+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,lineIndex)/this.lineHeight-this.getCurrentCharFontSize(lineIndex,charIndex)*(1-this._fontSizeFraction)}return{top:topOffset,left:leftOffset,lineLeft:lineLeftOffset}},renderCursor:function(boundaries,ctx){var cursorLocation=this.get2DCursorLocation(),lineIndex=cursorLocation.lineIndex,charIndex=cursorLocation.charIndex,charHeight=this.getCurrentCharFontSize(lineIndex,charIndex),leftOffset=lineIndex===0&amp;&amp;charIndex===0?this._getLineLeftOffset(this._getLineWidth(ctx,lineIndex)):boundaries.leftOffset;ctx.fillStyle=this.getCurrentCharColor(lineIndex,charIndex);ctx.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity;ctx.fillRect(boundaries.left+leftOffset,boundaries.top+boundaries.topOffset,this.cursorWidth/this.scaleX,charHeight)},renderSelection:function(chars,boundaries,ctx){ctx.fillStyle=this.selectionColor;var start=this.get2DCursorLocation(this.selectionStart),end=this.get2DCursorLocation(this.selectionEnd),startLine=start.lineIndex,endLine=end.lineIndex;for(var i=startLine;i&lt;=endLine;i++){var lineOffset=this._getLineLeftOffset(this._getLineWidth(ctx,i))||0,lineHeight=this._getHeightOfLine(this.ctx,i),boxWidth=0,line=this._textLines[i];if(i===startLine){for(var j=0,len=line.length;j&lt;len;j++){if(j&gt;=start.charIndex&amp;&amp;(i!==endLine||j&lt;end.charIndex)){boxWidth+=this._getWidthOfChar(ctx,line[j],i,j)}if(j&lt;start.charIndex){lineOffset+=this._getWidthOfChar(ctx,line[j],i,j)}}}else if(i&gt;startLine&amp;&amp;i&lt;endLine){boxWidth+=this._getLineWidth(ctx,i)||5}else if(i===endLine){for(var j2=0,j2len=end.charIndex;j2&lt;j2len;j2++){boxWidth+=this._getWidthOfChar(ctx,line[j2],i,j2)}}ctx.fillRect(boundaries.left+lineOffset,boundaries.top+boundaries.topOffset,boxWidth,lineHeight);boundaries.topOffset+=lineHeight}},_renderChars:function(method,ctx,line,left,top,lineIndex,charOffset){if(this.isEmptyStyles()){return this._renderCharsFast(method,ctx,line,left,top)}charOffset=charOffset||0;this.skipTextAlign=true;left-=this.textAlign===&quot;center&quot;?this.width/2:this.textAlign===&quot;right&quot;?this.width:0;var lineHeight=this._getHeightOfLine(ctx,lineIndex),lineLeftOffset=this._getLineLeftOffset(this._getLineWidth(ctx,lineIndex)),prevStyle,thisStyle,charsToRender=&quot;&quot;;left+=lineLeftOffset||0;ctx.save();top-=lineHeight/this.lineHeight*this._fontSizeFraction;for(var i=charOffset,len=line.length+charOffset;i&lt;=len;i++){prevStyle=prevStyle||this.getCurrentCharStyle(lineIndex,i);thisStyle=this.getCurrentCharStyle(lineIndex,i+1);if(this._hasStyleChanged(prevStyle,thisStyle)||i===len){this._renderChar(method,ctx,lineIndex,i-1,charsToRender,left,top,lineHeight);charsToRender=&quot;&quot;;prevStyle=thisStyle}charsToRender+=line[i-charOffset]}ctx.restore()},_renderCharsFast:function(method,ctx,line,left,top){this.skipTextAlign=false;if(method===&quot;fillText&quot;&amp;&amp;this.fill){this.callSuper(&quot;_renderChars&quot;,method,ctx,line,left,top)}if(method===&quot;strokeText&quot;&amp;&amp;(this.stroke&amp;&amp;this.strokeWidth&gt;0||this.skipFillStrokeCheck)){this.callSuper(&quot;_renderChars&quot;,method,ctx,line,left,top)}},_renderChar:function(method,ctx,lineIndex,i,_char,left,top,lineHeight){var charWidth,charHeight,shouldFill,shouldStroke,decl=this._getStyleDeclaration(lineIndex,i),offset,textDecoration;if(decl){charHeight=this._getHeightOfChar(ctx,_char,lineIndex,i);shouldStroke=decl.stroke;shouldFill=decl.fill;textDecoration=decl.textDecoration}else{charHeight=this.fontSize}shouldStroke=(shouldStroke||this.stroke)&amp;&amp;method===&quot;strokeText&quot;;shouldFill=(shouldFill||this.fill)&amp;&amp;method===&quot;fillText&quot;;decl&amp;&amp;ctx.save();charWidth=this._applyCharStylesGetWidth(ctx,_char,lineIndex,i,decl||{});textDecoration=textDecoration||this.textDecoration;if(decl&amp;&amp;decl.textBackgroundColor){this._removeShadow(ctx)}shouldFill&amp;&amp;ctx.fillText(_char,left,top);shouldStroke&amp;&amp;ctx.strokeText(_char,left,top);if(textDecoration||textDecoration!==&quot;&quot;){offset=this._fontSizeFraction*lineHeight/this.lineHeight;this._renderCharDecoration(ctx,textDecoration,left,top,offset,charWidth,charHeight)}decl&amp;&amp;ctx.restore();ctx.translate(charWidth,0)},_hasStyleChanged:function(prevStyle,thisStyle){return prevStyle.fill!==thisStyle.fill||prevStyle.fontSize!==thisStyle.fontSize||prevStyle.textBackgroundColor!==thisStyle.textBackgroundColor||prevStyle.textDecoration!==thisStyle.textDecoration||prevStyle.fontFamily!==thisStyle.fontFamily||prevStyle.fontWeight!==thisStyle.fontWeight||prevStyle.fontStyle!==thisStyle.fontStyle||prevStyle.stroke!==thisStyle.stroke||prevStyle.strokeWidth!==thisStyle.strokeWidth},_renderCharDecoration:function(ctx,textDecoration,left,top,offset,charWidth,charHeight){if(!textDecoration){return}var decorationWeight=charHeight/15,positions={underline:top+charHeight/10,&quot;line-through&quot;:top-charHeight*(this._fontSizeFraction+this._fontSizeMult-1)+decorationWeight,overline:top-(this._fontSizeMult-this._fontSizeFraction)*charHeight},decorations=[&quot;underline&quot;,&quot;line-through&quot;,&quot;overline&quot;],i,decoration;for(i=0;i&lt;decorations.length;i++){decoration=decorations[i];if(textDecoration.indexOf(decoration)&gt;-1){ctx.fillRect(left,positions[decoration],charWidth,decorationWeight)}}},_renderTextLine:function(method,ctx,line,left,top,lineIndex){if(!this.isEmptyStyles()){top+=this.fontSize*(this._fontSizeFraction+.03)}this.callSuper(&quot;_renderTextLine&quot;,method,ctx,line,left,top,lineIndex)},_renderTextDecoration:function(ctx){if(this.isEmptyStyles()){return this.callSuper(&quot;_renderTextDecoration&quot;,ctx)}},_renderTextLinesBackground:function(ctx){this.callSuper(&quot;_renderTextLinesBackground&quot;,ctx);var lineTopOffset=0,heightOfLine,lineWidth,lineLeftOffset,leftOffset=this._getLeftOffset(),topOffset=this._getTopOffset(),line,_char,style;for(var i=0,len=this._textLines.length;i&lt;len;i++){heightOfLine=this._getHeightOfLine(ctx,i);line=this._textLines[i];if(line===&quot;&quot;||!this.styles||!this._getLineStyle(i)){lineTopOffset+=heightOfLine;continue}lineWidth=this._getLineWidth(ctx,i);lineLeftOffset=this._getLineLeftOffset(lineWidth);for(var j=0,jlen=line.length;j&lt;jlen;j++){style=this._getStyleDeclaration(i,j);if(!style||!style.textBackgroundColor){continue}_char=line[j];ctx.fillStyle=style.textBackgroundColor;ctx.fillRect(leftOffset+lineLeftOffset+this._getWidthOfCharsAt(ctx,i,j),topOffset+lineTopOffset,this._getWidthOfChar(ctx,_char,i,j)+1,heightOfLine/this.lineHeight)}lineTopOffset+=heightOfLine}},_getCacheProp:function(_char,styleDeclaration){return _char+styleDeclaration.fontSize+styleDeclaration.fontWeight+styleDeclaration.fontStyle},_getFontCache:function(fontFamily){if(!fabric.charWidthsCache[fontFamily]){fabric.charWidthsCache[fontFamily]={}}return fabric.charWidthsCache[fontFamily]},_applyCharStylesGetWidth:function(ctx,_char,lineIndex,charIndex,decl){var charDecl=this._getStyleDeclaration(lineIndex,charIndex),styleDeclaration=decl&amp;&amp;clone(decl)||clone(charDecl),width,cacheProp,charWidthsCache;this._applyFontStyles(styleDeclaration);charWidthsCache=this._getFontCache(styleDeclaration.fontFamily);cacheProp=this._getCacheProp(_char,styleDeclaration);if(!charDecl&amp;&amp;charWidthsCache[cacheProp]&amp;&amp;this.caching){return charWidthsCache[cacheProp]}if(typeof styleDeclaration.shadow===&quot;string&quot;){styleDeclaration.shadow=new fabric.Shadow(styleDeclaration.shadow)}var fill=styleDeclaration.fill||this.fill;ctx.fillStyle=fill.toLive?fill.toLive(ctx,this):fill;if(styleDeclaration.stroke){ctx.strokeStyle=styleDeclaration.stroke&amp;&amp;styleDeclaration.stroke.toLive?styleDeclaration.stroke.toLive(ctx,this):styleDeclaration.stroke}ctx.lineWidth=styleDeclaration.strokeWidth||this.strokeWidth;ctx.font=this._getFontDeclaration.call(styleDeclaration);if(styleDeclaration.shadow){styleDeclaration.scaleX=this.scaleX;styleDeclaration.scaleY=this.scaleY;styleDeclaration.canvas=this.canvas;this._setShadow.call(styleDeclaration,ctx)}if(!this.caching||!charWidthsCache[cacheProp]){width=ctx.measureText(_char).width;this.caching&amp;&amp;(charWidthsCache[cacheProp]=width);return width}return charWidthsCache[cacheProp]},_applyFontStyles:function(styleDeclaration){if(!styleDeclaration.fontFamily){styleDeclaration.fontFamily=this.fontFamily}if(!styleDeclaration.fontSize){styleDeclaration.fontSize=this.fontSize}if(!styleDeclaration.fontWeight){styleDeclaration.fontWeight=this.fontWeight}if(!styleDeclaration.fontStyle){styleDeclaration.fontStyle=this.fontStyle}},_getStyleDeclaration:function(lineIndex,charIndex,returnCloneOrEmpty){if(returnCloneOrEmpty){return this.styles[lineIndex]&amp;&amp;this.styles[lineIndex][charIndex]?clone(this.styles[lineIndex][charIndex]):{}}return this.styles[lineIndex]&amp;&amp;this.styles[lineIndex][charIndex]?this.styles[lineIndex][charIndex]:null},_setStyleDeclaration:function(lineIndex,charIndex,style){this.styles[lineIndex][charIndex]=style},_deleteStyleDeclaration:function(lineIndex,charIndex){delete this.styles[lineIndex][charIndex]},_getLineStyle:function(lineIndex){return this.styles[lineIndex]},_setLineStyle:function(lineIndex,style){this.styles[lineIndex]=style},_deleteLineStyle:function(lineIndex){delete this.styles[lineIndex]},_getWidthOfChar:function(ctx,_char,lineIndex,charIndex){if(!this._isMeasuring&amp;&amp;this.textAlign===&quot;justify&quot;&amp;&amp;this._reSpacesAndTabs.test(_char)){return this._getWidthOfSpace(ctx,lineIndex)}var charWidthsCache,cacheProp,styleDeclaration=this._getStyleDeclaration(lineIndex,charIndex,true);this._applyFontStyles(styleDeclaration);charWidthsCache=this._getFontCache(styleDeclaration.fontFamily);cacheProp=this._getCacheProp(_char,styleDeclaration);if(charWidthsCache[cacheProp]&amp;&amp;this.caching){return charWidthsCache[cacheProp]}else if(ctx){ctx.save();var width=this._applyCharStylesGetWidth(ctx,_char,lineIndex,charIndex);ctx.restore();return width}},_getHeightOfChar:function(ctx,lineIndex,charIndex){var style=this._getStyleDeclaration(lineIndex,charIndex);return style&amp;&amp;style.fontSize?style.fontSize:this.fontSize},_getWidthOfCharsAt:function(ctx,lineIndex,charIndex){var width=0,i,_char;for(i=0;i&lt;charIndex;i++){_char=this._textLines[lineIndex][i];width+=this._getWidthOfChar(ctx,_char,lineIndex,i)}return width},_measureLine:function(ctx,lineIndex){this._isMeasuring=true;var width=this._getWidthOfCharsAt(ctx,lineIndex,this._textLines[lineIndex].length);this._isMeasuring=false;return width},_getWidthOfSpace:function(ctx,lineIndex){if(this.__widthOfSpace[lineIndex]){return this.__widthOfSpace[lineIndex]}var line=this._textLines[lineIndex],wordsWidth=this._getWidthOfWords(ctx,line,lineIndex,0),widthDiff=this.width-wordsWidth,numSpaces=line.length-line.replace(this._reSpacesAndTabs,&quot;&quot;).length,width=Math.max(widthDiff/numSpaces,ctx.measureText(&quot; &quot;).width);this.__widthOfSpace[lineIndex]=width;return width},_getWidthOfWords:function(ctx,line,lineIndex,charOffset){var width=0;for(var charIndex=0;charIndex&lt;line.length;charIndex++){var _char=line[charIndex];if(!_char.match(/\s/)){width+=this._getWidthOfChar(ctx,_char,lineIndex,charIndex+charOffset)}}return width},_getHeightOfLine:function(ctx,lineIndex){if(this.__lineHeights[lineIndex]){return this.__lineHeights[lineIndex]}var line=this._textLines[lineIndex],maxHeight=this._getHeightOfChar(ctx,lineIndex,0);for(var i=1,len=line.length;i&lt;len;i++){var currentCharHeight=this._getHeightOfChar(ctx,lineIndex,i);if(currentCharHeight&gt;maxHeight){maxHeight=currentCharHeight}}this.__lineHeights[lineIndex]=maxHeight*this.lineHeight*this._fontSizeMult;return this.__lineHeights[lineIndex]},_getTextHeight:function(ctx){var height=0;for(var i=0,len=this._textLines.length;i&lt;len;i++){height+=this._getHeightOfLine(ctx,i)</td>
      </tr>
      <tr>
        <td id="L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="LC10" class="blob-code blob-code-inner js-file-line">}return height},toObject:function(propertiesToInclude){var clonedStyles={},i,j,row;for(i in this.styles){row=this.styles[i];clonedStyles[i]={};for(j in row){clonedStyles[i][j]=clone(row[j])}}return fabric.util.object.extend(this.callSuper(&quot;toObject&quot;,propertiesToInclude),{styles:clonedStyles})}});fabric.IText.fromObject=function(object){return new fabric.IText(object.text,clone(object))}})();(function(){var clone=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler();this.initRemovedHandler();this.initCursorSelectionHandlers();this.initDoubleClickSimulation()},initSelectedHandler:function(){this.on(&quot;selected&quot;,function(){var _this=this;setTimeout(function(){_this.selected=true},100)})},initAddedHandler:function(){var _this=this;this.on(&quot;added&quot;,function(){if(this.canvas&amp;&amp;!this.canvas._hasITextHandlers){this.canvas._hasITextHandlers=true;this._initCanvasHandlers()}if(_this.canvas){_this.canvas._iTextInstances=_this.canvas._iTextInstances||[];_this.canvas._iTextInstances.push(_this)}})},initRemovedHandler:function(){var _this=this;this.on(&quot;removed&quot;,function(){if(_this.canvas){_this.canvas._iTextInstances=_this.canvas._iTextInstances||[];fabric.util.removeFromArray(_this.canvas._iTextInstances,_this)}})},_initCanvasHandlers:function(){var _this=this;this.canvas.on(&quot;selection:cleared&quot;,function(){fabric.IText.prototype.exitEditingOnOthers(_this.canvas)});this.canvas.on(&quot;mouse:up&quot;,function(){if(_this.canvas._iTextInstances){_this.canvas._iTextInstances.forEach(function(obj){obj.__isMousedown=false})}});this.canvas.on(&quot;object:selected&quot;,function(){fabric.IText.prototype.exitEditingOnOthers(_this.canvas)})},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,&quot;_onTickComplete&quot;)},_animateCursor:function(obj,targetOpacity,duration,completeMethod){var tickState;tickState={isAborted:false,abort:function(){this.isAborted=true}};obj.animate(&quot;_currentCursorOpacity&quot;,targetOpacity,{duration:duration,onComplete:function(){if(!tickState.isAborted){obj[completeMethod]()}},onChange:function(){if(obj.canvas&amp;&amp;obj.selectionStart===obj.selectionEnd){obj.renderCursorOrSelection()}},abort:function(){return tickState.isAborted}});return tickState},_onTickComplete:function(){var _this=this;if(this._cursorTimeout1){clearTimeout(this._cursorTimeout1)}this._cursorTimeout1=setTimeout(function(){_this._currentTickCompleteState=_this._animateCursor(_this,0,this.cursorDuration/2,&quot;_tick&quot;)},100)},initDelayedCursor:function(restart){var _this=this,delay=restart?0:this.cursorDelay;this.abortCursorAnimation();this._currentCursorOpacity=1;this._cursorTimeout2=setTimeout(function(){_this._tick()},delay)},abortCursorAnimation:function(){this._currentTickState&amp;&amp;this._currentTickState.abort();this._currentTickCompleteState&amp;&amp;this._currentTickCompleteState.abort();clearTimeout(this._cursorTimeout1);clearTimeout(this._cursorTimeout2);this._currentCursorOpacity=0;this.canvas&amp;&amp;this.canvas.clearContext(this.canvas.contextTop||this.ctx)},selectAll:function(){this.setSelectionStart(0);this.setSelectionEnd(this.text.length)},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},findWordBoundaryLeft:function(startFrom){var offset=0,index=startFrom-1;if(this._reSpace.test(this.text.charAt(index))){while(this._reSpace.test(this.text.charAt(index))){offset++;index--}}while(/\S/.test(this.text.charAt(index))&amp;&amp;index&gt;-1){offset++;index--}return startFrom-offset},findWordBoundaryRight:function(startFrom){var offset=0,index=startFrom;if(this._reSpace.test(this.text.charAt(index))){while(this._reSpace.test(this.text.charAt(index))){offset++;index++}}while(/\S/.test(this.text.charAt(index))&amp;&amp;index&lt;this.text.length){offset++;index++}return startFrom+offset},findLineBoundaryLeft:function(startFrom){var offset=0,index=startFrom-1;while(!/\n/.test(this.text.charAt(index))&amp;&amp;index&gt;-1){offset++;index--}return startFrom-offset},findLineBoundaryRight:function(startFrom){var offset=0,index=startFrom;while(!/\n/.test(this.text.charAt(index))&amp;&amp;index&lt;this.text.length){offset++;index++}return startFrom+offset},getNumNewLinesInSelectedText:function(){var selectedText=this.getSelectedText(),numNewLines=0;for(var i=0,len=selectedText.length;i&lt;len;i++){if(selectedText[i]===&quot;\n&quot;){numNewLines++}}return numNewLines},searchWordBoundary:function(selectionStart,direction){var index=this._reSpace.test(this.text.charAt(selectionStart))?selectionStart-1:selectionStart,_char=this.text.charAt(index),reNonWord=/[ \n\.,;!\?\-]/;while(!reNonWord.test(_char)&amp;&amp;index&gt;0&amp;&amp;index&lt;this.text.length){index+=direction;_char=this.text.charAt(index)}if(reNonWord.test(_char)&amp;&amp;_char!==&quot;\n&quot;){index+=direction===1?0:1}return index},selectWord:function(selectionStart){var newSelectionStart=this.searchWordBoundary(selectionStart,-1),newSelectionEnd=this.searchWordBoundary(selectionStart,1);this.setSelectionStart(newSelectionStart);this.setSelectionEnd(newSelectionEnd)},selectLine:function(selectionStart){var newSelectionStart=this.findLineBoundaryLeft(selectionStart),newSelectionEnd=this.findLineBoundaryRight(selectionStart);this.setSelectionStart(newSelectionStart);this.setSelectionEnd(newSelectionEnd)},enterEditing:function(e){if(this.isEditing||!this.editable){return}if(this.canvas){this.exitEditingOnOthers(this.canvas)}this.isEditing=true;this.initHiddenTextarea(e);this.hiddenTextarea.focus();this._updateTextarea();this._saveEditingProps();this._setEditingProps();this._textBeforeEdit=this.text;this._tick();this.fire(&quot;editing:entered&quot;);if(!this.canvas){return this}this.canvas.renderAll();this.canvas.fire(&quot;text:editing:entered&quot;,{target:this});this.initMouseMoveHandler();return this},exitEditingOnOthers:function(canvas){if(canvas._iTextInstances){canvas._iTextInstances.forEach(function(obj){obj.selected=false;if(obj.isEditing){obj.exitEditing()}})}},initMouseMoveHandler:function(){this.canvas.on(&quot;mouse:move&quot;,this.mouseMoveHandler.bind(this))},mouseMoveHandler:function(options){if(!this.__isMousedown||!this.isEditing){return}var newSelectionStart=this.getSelectionStartFromPointer(options.e);if(newSelectionStart===this.__selectionStartOnMouseDown){return}if(newSelectionStart&gt;this.__selectionStartOnMouseDown){this.setSelectionStart(this.__selectionStartOnMouseDown);this.setSelectionEnd(newSelectionStart)}else{this.setSelectionStart(newSelectionStart);this.setSelectionEnd(this.__selectionStartOnMouseDown)}this.renderCursorOrSelection()},_setEditingProps:function(){this.hoverCursor=&quot;text&quot;;if(this.canvas){this.canvas.defaultCursor=this.canvas.moveCursor=&quot;text&quot;}this.borderColor=this.editingBorderColor;this.hasControls=this.selectable=false;this.lockMovementX=this.lockMovementY=true},_updateTextarea:function(){if(!this.hiddenTextarea||this.inCompositionMode){return}this.hiddenTextarea.value=this.text;this.hiddenTextarea.selectionStart=this.selectionStart;this.hiddenTextarea.selectionEnd=this.selectionEnd;if(this.selectionStart===this.selectionEnd){var p=this._calcTextareaPosition();this.hiddenTextarea.style.left=p.x+&quot;px&quot;;this.hiddenTextarea.style.top=p.y+&quot;px&quot;}},_calcTextareaPosition:function(){var chars=this.text.split(&quot;&quot;),boundaries=this._getCursorBoundaries(chars,&quot;cursor&quot;),cursorLocation=this.get2DCursorLocation(),lineIndex=cursorLocation.lineIndex,charIndex=cursorLocation.charIndex,charHeight=this.getCurrentCharFontSize(lineIndex,charIndex),leftOffset=lineIndex===0&amp;&amp;charIndex===0?this._getLineLeftOffset(this._getLineWidth(this.ctx,lineIndex)):boundaries.leftOffset,m=this.calcTransformMatrix(),p={x:boundaries.left+leftOffset,y:boundaries.top+boundaries.topOffset+charHeight};this.hiddenTextarea.style.fontSize=charHeight+&quot;px&quot;;return fabric.util.transformPoint(p,m)},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&amp;&amp;this.canvas.defaultCursor,moveCursor:this.canvas&amp;&amp;this.canvas.moveCursor}},_restoreEditingProps:function(){if(!this._savedProps){return}this.hoverCursor=this._savedProps.overCursor;this.hasControls=this._savedProps.hasControls;this.borderColor=this._savedProps.borderColor;this.lockMovementX=this._savedProps.lockMovementX;this.lockMovementY=this._savedProps.lockMovementY;if(this.canvas){this.canvas.defaultCursor=this._savedProps.defaultCursor;this.canvas.moveCursor=this._savedProps.moveCursor}},exitEditing:function(){var isTextChanged=this._textBeforeEdit!==this.text;this.selected=false;this.isEditing=false;this.selectable=true;this.selectionEnd=this.selectionStart;this.hiddenTextarea&amp;&amp;this.canvas&amp;&amp;this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea);this.hiddenTextarea=null;this.abortCursorAnimation();this._restoreEditingProps();this._currentCursorOpacity=0;this.fire(&quot;editing:exited&quot;);isTextChanged&amp;&amp;this.fire(&quot;modified&quot;);if(this.canvas){this.canvas.off(&quot;mouse:move&quot;,this.mouseMoveHandler);this.canvas.fire(&quot;text:editing:exited&quot;,{target:this});isTextChanged&amp;&amp;this.canvas.fire(&quot;object:modified&quot;,{target:this})}return this},_removeExtraneousStyles:function(){for(var prop in this.styles){if(!this._textLines[prop]){delete this.styles[prop]}}},_removeCharsFromTo:function(start,end){while(end!==start){this._removeSingleCharAndStyle(start+1);end--}this.setSelectionStart(start)},_removeSingleCharAndStyle:function(index){var isBeginningOfLine=this.text[index-1]===&quot;\n&quot;,indexStyle=isBeginningOfLine?index:index-1;this.removeStyleObject(isBeginningOfLine,indexStyle);this.text=this.text.slice(0,index-1)+this.text.slice(index);this._textLines=this._splitTextIntoLines()},insertChars:function(_chars,useCopiedStyle){var style;if(this.selectionEnd-this.selectionStart&gt;1){this._removeCharsFromTo(this.selectionStart,this.selectionEnd);this.setSelectionEnd(this.selectionStart)}if(!useCopiedStyle&amp;&amp;this.isEmptyStyles()){this.insertChar(_chars,false);return}for(var i=0,len=_chars.length;i&lt;len;i++){if(useCopiedStyle){style=fabric.copiedTextStyle[i]}this.insertChar(_chars[i],i&lt;len-1,style)}},insertChar:function(_char,skipUpdate,styleObject){var isEndOfLine=this.text[this.selectionStart]===&quot;\n&quot;;this.text=this.text.slice(0,this.selectionStart)+_char+this.text.slice(this.selectionEnd);this._textLines=this._splitTextIntoLines();this.insertStyleObjects(_char,isEndOfLine,styleObject);this.selectionStart+=_char.length;this.selectionEnd=this.selectionStart;if(skipUpdate){return}this._updateTextarea();this.canvas&amp;&amp;this.canvas.renderAll();this.setCoords();this.fire(&quot;changed&quot;);this.canvas&amp;&amp;this.canvas.fire(&quot;text:changed&quot;,{target:this})},insertNewlineStyleObject:function(lineIndex,charIndex,isEndOfLine){this.shiftLineStyles(lineIndex,+1);if(!this.styles[lineIndex+1]){this.styles[lineIndex+1]={}}var currentCharStyle={},newLineStyles={};if(this.styles[lineIndex]&amp;&amp;this.styles[lineIndex][charIndex-1]){currentCharStyle=this.styles[lineIndex][charIndex-1]}if(isEndOfLine){newLineStyles[0]=clone(currentCharStyle);this.styles[lineIndex+1]=newLineStyles}else{for(var index in this.styles[lineIndex]){if(parseInt(index,10)&gt;=charIndex){newLineStyles[parseInt(index,10)-charIndex]=this.styles[lineIndex][index];delete this.styles[lineIndex][index]}}this.styles[lineIndex+1]=newLineStyles}this._forceClearCache=true},insertCharStyleObject:function(lineIndex,charIndex,style){var currentLineStyles=this.styles[lineIndex],currentLineStylesCloned=clone(currentLineStyles);if(charIndex===0&amp;&amp;!style){charIndex=1}for(var index in currentLineStylesCloned){var numericIndex=parseInt(index,10);if(numericIndex&gt;=charIndex){currentLineStyles[numericIndex+1]=currentLineStylesCloned[numericIndex];if(!currentLineStylesCloned[numericIndex-1]){delete currentLineStyles[numericIndex]}}}this.styles[lineIndex][charIndex]=style||clone(currentLineStyles[charIndex-1]);this._forceClearCache=true},insertStyleObjects:function(_chars,isEndOfLine,styleObject){var cursorLocation=this.get2DCursorLocation(),lineIndex=cursorLocation.lineIndex,charIndex=cursorLocation.charIndex;if(!this._getLineStyle(lineIndex)){this._setLineStyle(lineIndex,{})}if(_chars===&quot;\n&quot;){this.insertNewlineStyleObject(lineIndex,charIndex,isEndOfLine)}else{this.insertCharStyleObject(lineIndex,charIndex,styleObject)}},shiftLineStyles:function(lineIndex,offset){var clonedStyles=clone(this.styles);for(var line in this.styles){var numericLine=parseInt(line,10);if(numericLine&gt;lineIndex){this.styles[numericLine+offset]=clonedStyles[numericLine];if(!clonedStyles[numericLine-offset]){delete this.styles[numericLine]}}}},removeStyleObject:function(isBeginningOfLine,index){var cursorLocation=this.get2DCursorLocation(index),lineIndex=cursorLocation.lineIndex,charIndex=cursorLocation.charIndex;this._removeStyleObject(isBeginningOfLine,cursorLocation,lineIndex,charIndex)},_getTextOnPreviousLine:function(lIndex){return this._textLines[lIndex-1]},_removeStyleObject:function(isBeginningOfLine,cursorLocation,lineIndex,charIndex){if(isBeginningOfLine){var textOnPreviousLine=this._getTextOnPreviousLine(cursorLocation.lineIndex),newCharIndexOnPrevLine=textOnPreviousLine?textOnPreviousLine.length:0;if(!this.styles[lineIndex-1]){this.styles[lineIndex-1]={}}for(charIndex in this.styles[lineIndex]){this.styles[lineIndex-1][parseInt(charIndex,10)+newCharIndexOnPrevLine]=this.styles[lineIndex][charIndex]}this.shiftLineStyles(cursorLocation.lineIndex,-1)}else{var currentLineStyles=this.styles[lineIndex];if(currentLineStyles){delete currentLineStyles[charIndex]}var currentLineStylesCloned=clone(currentLineStyles);for(var i in currentLineStylesCloned){var numericIndex=parseInt(i,10);if(numericIndex&gt;=charIndex&amp;&amp;numericIndex!==0){currentLineStyles[numericIndex-1]=currentLineStylesCloned[numericIndex];delete currentLineStyles[numericIndex]}}}},insertNewline:function(){this.insertChars(&quot;\n&quot;)}})})();fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date;this.__lastLastClickTime=+new Date;this.__lastPointer={};this.on(&quot;mousedown&quot;,this.onMouseDown.bind(this))},onMouseDown:function(options){this.__newClickTime=+new Date;var newPointer=this.canvas.getPointer(options.e);if(this.isTripleClick(newPointer)){this.fire(&quot;tripleclick&quot;,options);this._stopEvent(options.e)}else if(this.isDoubleClick(newPointer)){this.fire(&quot;dblclick&quot;,options);this._stopEvent(options.e)}this.__lastLastClickTime=this.__lastClickTime;this.__lastClickTime=this.__newClickTime;this.__lastPointer=newPointer;this.__lastIsEditing=this.isEditing;this.__lastSelected=this.selected},isDoubleClick:function(newPointer){return this.__newClickTime-this.__lastClickTime&lt;500&amp;&amp;this.__lastPointer.x===newPointer.x&amp;&amp;this.__lastPointer.y===newPointer.y&amp;&amp;this.__lastIsEditing},isTripleClick:function(newPointer){return this.__newClickTime-this.__lastClickTime&lt;500&amp;&amp;this.__lastClickTime-this.__lastLastClickTime&lt;500&amp;&amp;this.__lastPointer.x===newPointer.x&amp;&amp;this.__lastPointer.y===newPointer.y},_stopEvent:function(e){e.preventDefault&amp;&amp;e.preventDefault();e.stopPropagation&amp;&amp;e.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler();this.initMousedownHandler();this.initMouseupHandler();this.initClicks()},initClicks:function(){this.on(&quot;dblclick&quot;,function(options){this.selectWord(this.getSelectionStartFromPointer(options.e))});this.on(&quot;tripleclick&quot;,function(options){this.selectLine(this.getSelectionStartFromPointer(options.e))})},initMousedownHandler:function(){this.on(&quot;mousedown&quot;,function(options){if(!this.editable){return}var pointer=this.canvas.getPointer(options.e);this.__mousedownX=pointer.x;this.__mousedownY=pointer.y;this.__isMousedown=true;if(this.hiddenTextarea&amp;&amp;this.canvas){this.canvas.wrapperEl.appendChild(this.hiddenTextarea)}if(this.selected){this.setCursorByClick(options.e)}if(this.isEditing){this.__selectionStartOnMouseDown=this.selectionStart;this.initDelayedCursor(true)}})},_isObjectMoved:function(e){var pointer=this.canvas.getPointer(e);return this.__mousedownX!==pointer.x||this.__mousedownY!==pointer.y},initMouseupHandler:function(){this.on(&quot;mouseup&quot;,function(options){this.__isMousedown=false;if(!this.editable||this._isObjectMoved(options.e)){return}if(this.__lastSelected&amp;&amp;!this.__corner){this.enterEditing(options.e);this.initDelayedCursor(true)}this.selected=true})},setCursorByClick:function(e){var newSelectionStart=this.getSelectionStartFromPointer(e);if(e.shiftKey){if(newSelectionStart&lt;this.selectionStart){this.setSelectionEnd(this.selectionStart);this.setSelectionStart(newSelectionStart)}else{this.setSelectionEnd(newSelectionStart)}}else{this.setSelectionStart(newSelectionStart);this.setSelectionEnd(newSelectionStart)}},getSelectionStartFromPointer:function(e){var mouseOffset=this.getLocalPointer(e),prevWidth=0,width=0,height=0,charIndex=0,newSelectionStart,line;for(var i=0,len=this._textLines.length;i&lt;len;i++){line=this._textLines[i];height+=this._getHeightOfLine(this.ctx,i)*this.scaleY;var widthOfLine=this._getLineWidth(this.ctx,i),lineLeftOffset=this._getLineLeftOffset(widthOfLine);width=lineLeftOffset*this.scaleX;for(var j=0,jlen=line.length;j&lt;jlen;j++){prevWidth=width;width+=this._getWidthOfChar(this.ctx,line[j],i,this.flipX?jlen-j:j)*this.scaleX;if(height&lt;=mouseOffset.y||width&lt;=mouseOffset.x){charIndex++;continue}return this._getNewSelectionStartFromOffset(mouseOffset,prevWidth,width,charIndex+i,jlen)}if(mouseOffset.y&lt;height){return this._getNewSelectionStartFromOffset(mouseOffset,prevWidth,width,charIndex+i-1,jlen)}}if(typeof newSelectionStart===&quot;undefined&quot;){return this.text.length}},_getNewSelectionStartFromOffset:function(mouseOffset,prevWidth,width,index,jlen){var distanceBtwLastCharAndCursor=mouseOffset.x-prevWidth,distanceBtwNextCharAndCursor=width-mouseOffset.x,offset=distanceBtwNextCharAndCursor&gt;distanceBtwLastCharAndCursor?0:1,newSelectionStart=index+offset;if(this.flipX){newSelectionStart=jlen-newSelectionStart}if(newSelectionStart&gt;this.text.length){newSelectionStart=this.text.length}return newSelectionStart}});fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(e){var p;if(e&amp;&amp;this.canvas){p=this.canvas.getPointer(e)}else{this.oCoords||this.setCoords();p=this.oCoords.tl}this.hiddenTextarea=fabric.document.createElement(&quot;textarea&quot;);this.hiddenTextarea.setAttribute(&quot;autocapitalize&quot;,&quot;off&quot;);this.hiddenTextarea.style.cssText=&quot;position: absolute; top: &quot;+p.y+&quot;px; left: &quot;+p.x+&quot;px; opacity: 0;&quot;+&quot; width: 0px; height: 0px; z-index: -999;&quot;;if(this.canvas){this.canvas.lowerCanvasEl.parentNode.appendChild(this.hiddenTextarea)}else{fabric.document.body.appendChild(this.hiddenTextarea)}fabric.util.addListener(this.hiddenTextarea,&quot;keydown&quot;,this.onKeyDown.bind(this));fabric.util.addListener(this.hiddenTextarea,&quot;keyup&quot;,this.onKeyUp.bind(this));fabric.util.addListener(this.hiddenTextarea,&quot;input&quot;,this.onInput.bind(this));fabric.util.addListener(this.hiddenTextarea,&quot;copy&quot;,this.copy.bind(this));fabric.util.addListener(this.hiddenTextarea,&quot;cut&quot;,this.cut.bind(this));fabric.util.addListener(this.hiddenTextarea,&quot;paste&quot;,this.paste.bind(this));fabric.util.addListener(this.hiddenTextarea,&quot;compositionstart&quot;,this.onCompositionStart.bind(this));fabric.util.addListener(this.hiddenTextarea,&quot;compositionupdate&quot;,this.onCompositionUpdate.bind(this));fabric.util.addListener(this.hiddenTextarea,&quot;compositionend&quot;,this.onCompositionEnd.bind(this));if(!this._clickHandlerInitialized&amp;&amp;this.canvas){fabric.util.addListener(this.canvas.upperCanvasEl,&quot;click&quot;,this.onClick.bind(this));this._clickHandlerInitialized=true}},_keysMap:{8:&quot;removeChars&quot;,9:&quot;exitEditing&quot;,27:&quot;exitEditing&quot;,13:&quot;insertNewline&quot;,33:&quot;moveCursorUp&quot;,34:&quot;moveCursorDown&quot;,35:&quot;moveCursorRight&quot;,36:&quot;moveCursorLeft&quot;,37:&quot;moveCursorLeft&quot;,38:&quot;moveCursorUp&quot;,39:&quot;moveCursorRight&quot;,40:&quot;moveCursorDown&quot;,46:&quot;forwardDelete&quot;},_ctrlKeysMapUp:{67:&quot;copy&quot;,88:&quot;cut&quot;},_ctrlKeysMapDown:{65:&quot;selectAll&quot;},onClick:function(){this.hiddenTextarea&amp;&amp;this.hiddenTextarea.focus()},onKeyDown:function(e){if(!this.isEditing){return}if(e.keyCode in this._keysMap){this[this._keysMap[e.keyCode]](e)}else if(e.keyCode in this._ctrlKeysMapDown&amp;&amp;(e.ctrlKey||e.metaKey)){this[this._ctrlKeysMapDown[e.keyCode]](e)}else{return}e.stopImmediatePropagation();e.preventDefault();this.canvas&amp;&amp;this.canvas.renderAll()},onKeyUp:function(e){if(!this.isEditing||this._copyDone){this._copyDone=false;return}if(e.keyCode in this._ctrlKeysMapUp&amp;&amp;(e.ctrlKey||e.metaKey)){this[this._ctrlKeysMapUp[e.keyCode]](e)}else{return}e.stopImmediatePropagation();e.preventDefault();this.canvas&amp;&amp;this.canvas.renderAll()},onInput:function(e){if(!this.isEditing||this.inCompositionMode){return}var offset=this.selectionStart||0,offsetEnd=this.selectionEnd||0,textLength=this.text.length,newTextLength=this.hiddenTextarea.value.length,diff,charsToInsert,start;if(newTextLength&gt;textLength){start=this._selectionDirection===&quot;left&quot;?offsetEnd:offset;diff=newTextLength-textLength;charsToInsert=this.hiddenTextarea.value.slice(start,start+diff)}else{diff=newTextLength-textLength+offsetEnd-offset;charsToInsert=this.hiddenTextarea.value.slice(offset,offset+diff)}this.insertChars(charsToInsert);e.stopPropagation()},onCompositionStart:function(){this.inCompositionMode=true;this.prevCompositionLength=0;this.compositionStart=this.selectionStart},onCompositionEnd:function(){this.inCompositionMode=false},onCompositionUpdate:function(e){var data=e.data;this.selectionStart=this.compositionStart;this.selectionEnd=this.selectionEnd===this.selectionStart?this.compositionStart+this.prevCompositionLength:this.selectionEnd;this.insertChars(data,false);this.prevCompositionLength=data.length},forwardDelete:function(e){if(this.selectionStart===this.selectionEnd){if(this.selectionStart===this.text.length){return}this.moveCursorRight(e)}this.removeChars(e)},copy:function(e){if(this.selectionStart===this.selectionEnd){return}var selectedText=this.getSelectedText(),clipboardData=this._getClipboardData(e);if(clipboardData){clipboardData.setData(&quot;text&quot;,selectedText)}fabric.copiedText=selectedText;fabric.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd);e.stopImmediatePropagation();e.preventDefault();this._copyDone=true},paste:function(e){var copiedText=null,clipboardData=this._getClipboardData(e),useCopiedStyle=true;if(clipboardData){copiedText=clipboardData.getData(&quot;text&quot;).replace(/\r/g,&quot;&quot;);if(!fabric.copiedTextStyle||fabric.copiedText!==copiedText){useCopiedStyle=false}}else{copiedText=fabric.copiedText}if(copiedText){this.insertChars(copiedText,useCopiedStyle)}e.stopImmediatePropagation();e.preventDefault()},cut:function(e){if(this.selectionStart===this.selectionEnd){return}this.copy(e);this.removeChars(e)},_getClipboardData:function(e){return e&amp;&amp;e.clipboardData||fabric.window.clipboardData},getDownCursorOffset:function(e,isRight){var selectionProp=isRight?this.selectionEnd:this.selectionStart,cursorLocation=this.get2DCursorLocation(selectionProp),_char,lineLeftOffset,lineIndex=cursorLocation.lineIndex,textOnSameLineBeforeCursor=this._textLines[lineIndex].slice(0,cursorLocation.charIndex),textOnSameLineAfterCursor=this._textLines[lineIndex].slice(cursorLocation.charIndex),textOnNextLine=this._textLines[lineIndex+1]||&quot;&quot;;if(lineIndex===this._textLines.length-1||e.metaKey||e.keyCode===34){return this.text.length-selectionProp}var widthOfSameLineBeforeCursor=this._getLineWidth(this.ctx,lineIndex);lineLeftOffset=this._getLineLeftOffset(widthOfSameLineBeforeCursor);var widthOfCharsOnSameLineBeforeCursor=lineLeftOffset;for(var i=0,len=textOnSameLineBeforeCursor.length;i&lt;len;i++){_char=textOnSameLineBeforeCursor[i];widthOfCharsOnSameLineBeforeCursor+=this._getWidthOfChar(this.ctx,_char,lineIndex,i)}var indexOnNextLine=this._getIndexOnNextLine(cursorLocation,textOnNextLine,widthOfCharsOnSameLineBeforeCursor);return textOnSameLineAfterCursor.length+1+indexOnNextLine},_getIndexOnNextLine:function(cursorLocation,textOnNextLine,widthOfCharsOnSameLineBeforeCursor){var lineIndex=cursorLocation.lineIndex+1,widthOfNextLine=this._getLineWidth(this.ctx,lineIndex),lineLeftOffset=this._getLineLeftOffset(widthOfNextLine),widthOfCharsOnNextLine=lineLeftOffset,indexOnNextLine=0,foundMatch;for(var j=0,jlen=textOnNextLine.length;j&lt;jlen;j++){var _char=textOnNextLine[j],widthOfChar=this._getWidthOfChar(this.ctx,_char,lineIndex,j);widthOfCharsOnNextLine+=widthOfChar;if(widthOfCharsOnNextLine&gt;widthOfCharsOnSameLineBeforeCursor){foundMatch=true;var leftEdge=widthOfCharsOnNextLine-widthOfChar,rightEdge=widthOfCharsOnNextLine,offsetFromLeftEdge=Math.abs(leftEdge-widthOfCharsOnSameLineBeforeCursor),offsetFromRightEdge=Math.abs(rightEdge-widthOfCharsOnSameLineBeforeCursor);indexOnNextLine=offsetFromRightEdge&lt;offsetFromLeftEdge?j+1:j;break}}if(!foundMatch){indexOnNextLine=textOnNextLine.length}return indexOnNextLine},moveCursorDown:function(e){this.abortCursorAnimation();this._currentCursorOpacity=1;var offset=this.getDownCursorOffset(e,this._selectionDirection===&quot;right&quot;);if(e.shiftKey){this.moveCursorDownWithShift(offset)}else{this.moveCursorDownWithoutShift(offset)}this.initDelayedCursor()},moveCursorDownWithoutShift:function(offset){this._selectionDirection=&quot;right&quot;;this.setSelectionStart(this.selectionStart+offset);this.setSelectionEnd(this.selectionStart)},swapSelectionPoints:function(){var swapSel=this.selectionEnd;this.setSelectionEnd(this.selectionStart);this.setSelectionStart(swapSel)},moveCursorDownWithShift:function(offset){if(this.selectionEnd===this.selectionStart){this._selectionDirection=&quot;right&quot;}if(this._selectionDirection===&quot;right&quot;){this.setSelectionEnd(this.selectionEnd+offset)}else{this.setSelectionStart(this.selectionStart+offset)}if(this.selectionEnd&lt;this.selectionStart&amp;&amp;this._selectionDirection===&quot;left&quot;){this.swapSelectionPoints();this._selectionDirection=&quot;right&quot;}if(this.selectionEnd&gt;this.text.length){this.setSelectionEnd(this.text.length)}},getUpCursorOffset:function(e,isRight){var selectionProp=isRight?this.selectionEnd:this.selectionStart,cursorLocation=this.get2DCursorLocation(selectionProp),lineIndex=cursorLocation.lineIndex;if(lineIndex===0||e.metaKey||e.keyCode===33){return selectionProp}var textOnSameLineBeforeCursor=this._textLines[lineIndex].slice(0,cursorLocation.charIndex),textOnPreviousLine=this._textLines[lineIndex-1]||&quot;&quot;,_char,widthOfSameLineBeforeCursor=this._getLineWidth(this.ctx,cursorLocation.lineIndex),lineLeftOffset=this._getLineLeftOffset(widthOfSameLineBeforeCursor),widthOfCharsOnSameLineBeforeCursor=lineLeftOffset;for(var i=0,len=textOnSameLineBeforeCursor.length;i&lt;len;i++){_char=textOnSameLineBeforeCursor[i];widthOfCharsOnSameLineBeforeCursor+=this._getWidthOfChar(this.ctx,_char,lineIndex,i)}var indexOnPrevLine=this._getIndexOnPrevLine(cursorLocation,textOnPreviousLine,widthOfCharsOnSameLineBeforeCursor);return textOnPreviousLine.length-indexOnPrevLine+textOnSameLineBeforeCursor.length},_getIndexOnPrevLine:function(cursorLocation,textOnPreviousLine,widthOfCharsOnSameLineBeforeCursor){var lineIndex=cursorLocation.lineIndex-1,widthOfPreviousLine=this._getLineWidth(this.ctx,lineIndex),lineLeftOffset=this._getLineLeftOffset(widthOfPreviousLine),widthOfCharsOnPreviousLine=lineLeftOffset,indexOnPrevLine=0,foundMatch;for(var j=0,jlen=textOnPreviousLine.length;j&lt;jlen;j++){var _char=textOnPreviousLine[j],widthOfChar=this._getWidthOfChar(this.ctx,_char,lineIndex,j);widthOfCharsOnPreviousLine+=widthOfChar;if(widthOfCharsOnPreviousLine&gt;widthOfCharsOnSameLineBeforeCursor){foundMatch=true;var leftEdge=widthOfCharsOnPreviousLine-widthOfChar,rightEdge=widthOfCharsOnPreviousLine,offsetFromLeftEdge=Math.abs(leftEdge-widthOfCharsOnSameLineBeforeCursor),offsetFromRightEdge=Math.abs(rightEdge-widthOfCharsOnSameLineBeforeCursor);indexOnPrevLine=offsetFromRightEdge&lt;offsetFromLeftEdge?j:j-1;break}}if(!foundMatch){indexOnPrevLine=textOnPreviousLine.length-1}return indexOnPrevLine},moveCursorUp:function(e){this.abortCursorAnimation();this._currentCursorOpacity=1;var offset=this.getUpCursorOffset(e,this._selectionDirection===&quot;right&quot;);if(e.shiftKey){this.moveCursorUpWithShift(offset)}else{this.moveCursorUpWithoutShift(offset)}this.initDelayedCursor()},moveCursorUpWithShift:function(offset){if(this.selectionEnd===this.selectionStart){this._selectionDirection=&quot;left&quot;}if(this._selectionDirection===&quot;right&quot;){this.setSelectionEnd(this.selectionEnd-offset)}else{this.setSelectionStart(this.selectionStart-offset)}if(this.selectionEnd&lt;this.selectionStart&amp;&amp;this._selectionDirection===&quot;right&quot;){this.swapSelectionPoints();this._selectionDirection=&quot;left&quot;}},moveCursorUpWithoutShift:function(offset){if(this.selectionStart===this.selectionEnd){this.setSelectionStart(this.selectionStart-offset)}this.setSelectionEnd(this.selectionStart);this._selectionDirection=&quot;left&quot;},moveCursorLeft:function(e){if(this.selectionStart===0&amp;&amp;this.selectionEnd===0){return}this.abortCursorAnimation();this._currentCursorOpacity=1;if(e.shiftKey){this.moveCursorLeftWithShift(e)}else{this.moveCursorLeftWithoutShift(e)}this.initDelayedCursor()},_move:function(e,prop,direction){var propMethod=prop===&quot;selectionStart&quot;?&quot;setSelectionStart&quot;:&quot;setSelectionEnd&quot;;if(e.altKey){this[propMethod](this[&quot;findWordBoundary&quot;+direction](this[prop]))}else if(e.metaKey||e.keyCode===35||e.keyCode===36){this[propMethod](this[&quot;findLineBoundary&quot;+direction](this[prop]))}else{this[propMethod](this[prop]+(direction===&quot;Left&quot;?-1:1))}},_moveLeft:function(e,prop){this._move(e,prop,&quot;Left&quot;)},_moveRight:function(e,prop){this._move(e,prop,&quot;Right&quot;)},moveCursorLeftWithoutShift:function(e){this._selectionDirection=&quot;left&quot;;if(this.selectionEnd===this.selectionStart){this._moveLeft(e,&quot;selectionStart&quot;)}this.setSelectionEnd(this.selectionStart)},moveCursorLeftWithShift:function(e){if(this._selectionDirection===&quot;right&quot;&amp;&amp;this.selectionStart!==this.selectionEnd){this._moveLeft(e,&quot;selectionEnd&quot;)}else{this._selectionDirection=&quot;left&quot;;this._moveLeft(e,&quot;selectionStart&quot;)}},moveCursorRight:function(e){if(this.selectionStart&gt;=this.text.length&amp;&amp;this.selectionEnd&gt;=this.text.length){return}this.abortCursorAnimation();this._currentCursorOpacity=1;if(e.shiftKey){this.moveCursorRightWithShift(e)}else{this.moveCursorRightWithoutShift(e)}this.initDelayedCursor()},moveCursorRightWithShift:function(e){if(this._selectionDirection===&quot;left&quot;&amp;&amp;this.selectionStart!==this.selectionEnd){this._moveRight(e,&quot;selectionStart&quot;)}else{this._selectionDirection=&quot;right&quot;;this._moveRight(e,&quot;selectionEnd&quot;)}},moveCursorRightWithoutShift:function(e){this._selectionDirection=&quot;right&quot;;if(this.selectionStart===this.selectionEnd){this._moveRight(e,&quot;selectionStart&quot;);this.setSelectionEnd(this.selectionStart)}else{this.setSelectionEnd(this.selectionEnd+this.getNumNewLinesInSelectedText());this.setSelectionStart(this.selectionEnd)}},removeChars:function(e){if(this.selectionStart===this.selectionEnd){this._removeCharsNearCursor(e)}else{this._removeCharsFromTo(this.selectionStart,this.selectionEnd)}this.setSelectionEnd(this.selectionStart);this._removeExtraneousStyles();this.canvas&amp;&amp;this.canvas.renderAll();this.setCoords();this.fire(&quot;changed&quot;);this.canvas&amp;&amp;this.canvas.fire(&quot;text:changed&quot;,{target:this})},_removeCharsNearCursor:function(e){if(this.selectionStart===0){return}if(e.metaKey){var leftLineBoundary=this.findLineBoundaryLeft(this.selectionStart);this._removeCharsFromTo(leftLineBoundary,this.selectionStart);this.setSelectionStart(leftLineBoundary)}else if(e.altKey){var leftWordBoundary=this.findWordBoundaryLeft(this.selectionStart);this._removeCharsFromTo(leftWordBoundary,this.selectionStart);this.setSelectionStart(leftWordBoundary)}else{this._removeSingleCharAndStyle(this.selectionStart);this.setSelectionStart(this.selectionStart-1)}}});(function(){var toFixed=fabric.util.toFixed,NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS;fabric.util.object.extend(fabric.IText.prototype,{_setSVGTextLineText:function(lineIndex,textSpans,height,textLeftOffset,textTopOffset,textBgRects){if(!this._getLineStyle(lineIndex)){fabric.Text.prototype._setSVGTextLineText.call(this,lineIndex,textSpans,height,textLeftOffset,textTopOffset)}else{this._setSVGTextLineChars(lineIndex,textSpans,height,textLeftOffset,textBgRects)</td>
      </tr>
      <tr>
        <td id="L11" class="blob-num js-line-number" data-line-number="11"></td>
        <td id="LC11" class="blob-code blob-code-inner js-file-line">}},_setSVGTextLineChars:function(lineIndex,textSpans,height,textLeftOffset,textBgRects){var chars=this._textLines[lineIndex],charOffset=0,lineLeftOffset=this._getLineLeftOffset(this._getLineWidth(this.ctx,lineIndex))-this.width/2,lineOffset=this._getSVGLineTopOffset(lineIndex),heightOfLine=this._getHeightOfLine(this.ctx,lineIndex);for(var i=0,len=chars.length;i&lt;len;i++){var styleDecl=this._getStyleDeclaration(lineIndex,i)||{};textSpans.push(this._createTextCharSpan(chars[i],styleDecl,lineLeftOffset,lineOffset.lineTop+lineOffset.offset,charOffset));var charWidth=this._getWidthOfChar(this.ctx,chars[i],lineIndex,i);if(styleDecl.textBackgroundColor){textBgRects.push(this._createTextCharBg(styleDecl,lineLeftOffset,lineOffset.lineTop,heightOfLine,charWidth,charOffset))}charOffset+=charWidth}},_getSVGLineTopOffset:function(lineIndex){var lineTopOffset=0,lastHeight=0;for(var j=0;j&lt;lineIndex;j++){lineTopOffset+=this._getHeightOfLine(this.ctx,j)}lastHeight=this._getHeightOfLine(this.ctx,j);return{lineTop:lineTopOffset,offset:(this._fontSizeMult-this._fontSizeFraction)*lastHeight/(this.lineHeight*this._fontSizeMult)}},_createTextCharBg:function(styleDecl,lineLeftOffset,lineTopOffset,heightOfLine,charWidth,charOffset){return[&#39;		&lt;rect fill=&quot;&#39;,styleDecl.textBackgroundColor,&#39;&quot; x=&quot;&#39;,toFixed(lineLeftOffset+charOffset,NUM_FRACTION_DIGITS),&#39;&quot; y=&quot;&#39;,toFixed(lineTopOffset-this.height/2,NUM_FRACTION_DIGITS),&#39;&quot; width=&quot;&#39;,toFixed(charWidth,NUM_FRACTION_DIGITS),&#39;&quot; height=&quot;&#39;,toFixed(heightOfLine/this.lineHeight,NUM_FRACTION_DIGITS),&#39;&quot;&gt;&lt;/rect&gt;\n&#39;].join(&quot;&quot;)},_createTextCharSpan:function(_char,styleDecl,lineLeftOffset,lineTopOffset,charOffset){var fillStyles=this.getSvgStyles.call(fabric.util.object.extend({visible:true,fill:this.fill,stroke:this.stroke,type:&quot;text&quot;,getSvgFilter:fabric.Object.prototype.getSvgFilter},styleDecl));return[&#39;			&lt;tspan x=&quot;&#39;,toFixed(lineLeftOffset+charOffset,NUM_FRACTION_DIGITS),&#39;&quot; y=&quot;&#39;,toFixed(lineTopOffset-this.height/2,NUM_FRACTION_DIGITS),&#39;&quot; &#39;,styleDecl.fontFamily?&#39;font-family=&quot;&#39;+styleDecl.fontFamily.replace(/&quot;/g,&quot;&#39;&quot;)+&#39;&quot; &#39;:&quot;&quot;,styleDecl.fontSize?&#39;font-size=&quot;&#39;+styleDecl.fontSize+&#39;&quot; &#39;:&quot;&quot;,styleDecl.fontStyle?&#39;font-style=&quot;&#39;+styleDecl.fontStyle+&#39;&quot; &#39;:&quot;&quot;,styleDecl.fontWeight?&#39;font-weight=&quot;&#39;+styleDecl.fontWeight+&#39;&quot; &#39;:&quot;&quot;,styleDecl.textDecoration?&#39;text-decoration=&quot;&#39;+styleDecl.textDecoration+&#39;&quot; &#39;:&quot;&quot;,&#39;style=&quot;&#39;,fillStyles,&#39;&quot;&gt;&#39;,fabric.util.string.escapeXml(_char),&quot;&lt;/tspan&gt;\n&quot;].join(&quot;&quot;)}})})();(function(global){&quot;use strict&quot;;var fabric=global.fabric||(global.fabric={}),clone=fabric.util.object.clone;fabric.Textbox=fabric.util.createClass(fabric.IText,fabric.Observable,{type:&quot;textbox&quot;,minWidth:20,dynamicMinWidth:0,__cachedLines:null,lockScalingY:true,lockScalingFlip:true,initialize:function(text,options){this.ctx=fabric.util.createCanvasElement().getContext(&quot;2d&quot;);this.callSuper(&quot;initialize&quot;,text,options);this.setControlsVisibility(fabric.Textbox.getTextboxControlVisibility());this._dimensionAffectingProps.width=true},_initDimensions:function(ctx){if(this.__skipDimension){return}if(!ctx){ctx=fabric.util.createCanvasElement().getContext(&quot;2d&quot;);this._setTextStyles(ctx)}this.dynamicMinWidth=0;this._textLines=this._splitTextIntoLines();if(this.dynamicMinWidth&gt;this.width){this._set(&quot;width&quot;,this.dynamicMinWidth)}this._clearCache();this.height=this._getTextHeight(ctx)},_generateStyleMap:function(){var realLineCount=0,realLineCharCount=0,charCount=0,map={};for(var i=0;i&lt;this._textLines.length;i++){if(this.text[charCount]===&quot;\n&quot;){realLineCharCount=0;charCount++;realLineCount++}else if(this.text[charCount]===&quot; &quot;){realLineCharCount++;charCount++}map[i]={line:realLineCount,offset:realLineCharCount};charCount+=this._textLines[i].length;realLineCharCount+=this._textLines[i].length}return map},_getStyleDeclaration:function(lineIndex,charIndex,returnCloneOrEmpty){if(this._styleMap){var map=this._styleMap[lineIndex];if(!map){return returnCloneOrEmpty?{}:null}lineIndex=map.line;charIndex=map.offset+charIndex}return this.callSuper(&quot;_getStyleDeclaration&quot;,lineIndex,charIndex,returnCloneOrEmpty)},_setStyleDeclaration:function(lineIndex,charIndex,style){var map=this._styleMap[lineIndex];lineIndex=map.line;charIndex=map.offset+charIndex;this.styles[lineIndex][charIndex]=style},_deleteStyleDeclaration:function(lineIndex,charIndex){var map=this._styleMap[lineIndex];lineIndex=map.line;charIndex=map.offset+charIndex;delete this.styles[lineIndex][charIndex]},_getLineStyle:function(lineIndex){var map=this._styleMap[lineIndex];return this.styles[map.line]},_setLineStyle:function(lineIndex,style){var map=this._styleMap[lineIndex];this.styles[map.line]=style},_deleteLineStyle:function(lineIndex){var map=this._styleMap[lineIndex];delete this.styles[map.line]},_wrapText:function(ctx,text){var lines=text.split(this._reNewline),wrapped=[],i;for(i=0;i&lt;lines.length;i++){wrapped=wrapped.concat(this._wrapLine(ctx,lines[i],i))}return wrapped},_measureText:function(ctx,text,lineIndex,charOffset){var width=0;charOffset=charOffset||0;for(var i=0,len=text.length;i&lt;len;i++){width+=this._getWidthOfChar(ctx,text[i],lineIndex,i+charOffset)}return width},_wrapLine:function(ctx,text,lineIndex){var lineWidth=0,lines=[],line=&quot;&quot;,words=text.split(&quot; &quot;),word=&quot;&quot;,offset=0,infix=&quot; &quot;,wordWidth=0,infixWidth=0,largestWordWidth=0,lineJustStarted=true;for(var i=0;i&lt;words.length;i++){word=words[i];wordWidth=this._measureText(ctx,word,lineIndex,offset);offset+=word.length;lineWidth+=infixWidth+wordWidth;if(lineWidth&gt;=this.width&amp;&amp;!lineJustStarted){lines.push(line);line=&quot;&quot;;lineWidth=wordWidth;lineJustStarted=true}if(!lineJustStarted){line+=infix}line+=word;infixWidth=this._measureText(ctx,infix,lineIndex,offset);offset++;lineJustStarted=false;if(wordWidth&gt;largestWordWidth){largestWordWidth=wordWidth}}i&amp;&amp;lines.push(line);if(largestWordWidth&gt;this.dynamicMinWidth){this.dynamicMinWidth=largestWordWidth}return lines},_splitTextIntoLines:function(){var originalAlign=this.textAlign;this.ctx.save();this._setTextStyles(this.ctx);this.textAlign=&quot;left&quot;;var lines=this._wrapText(this.ctx,this.text);this.textAlign=originalAlign;this.ctx.restore();this._textLines=lines;this._styleMap=this._generateStyleMap();return lines},setOnGroup:function(key,value){if(key===&quot;scaleX&quot;){this.set(&quot;scaleX&quot;,Math.abs(1/value));this.set(&quot;width&quot;,this.get(&quot;width&quot;)*value/(typeof this.__oldScaleX===&quot;undefined&quot;?1:this.__oldScaleX));this.__oldScaleX=value}},get2DCursorLocation:function(selectionStart){if(typeof selectionStart===&quot;undefined&quot;){selectionStart=this.selectionStart}var numLines=this._textLines.length,removed=0;for(var i=0;i&lt;numLines;i++){var line=this._textLines[i],lineLen=line.length;if(selectionStart&lt;=removed+lineLen){return{lineIndex:i,charIndex:selectionStart-removed}}removed+=lineLen;if(this.text[removed]===&quot;\n&quot;||this.text[removed]===&quot; &quot;){removed++}}return{lineIndex:numLines-1,charIndex:this._textLines[numLines-1].length}},_getCursorBoundariesOffsets:function(chars,typeOfBoundaries){var topOffset=0,leftOffset=0,cursorLocation=this.get2DCursorLocation(),lineChars=this._textLines[cursorLocation.lineIndex].split(&quot;&quot;),lineLeftOffset=this._getLineLeftOffset(this._getLineWidth(this.ctx,cursorLocation.lineIndex));for(var i=0;i&lt;cursorLocation.charIndex;i++){leftOffset+=this._getWidthOfChar(this.ctx,lineChars[i],cursorLocation.lineIndex,i)}for(i=0;i&lt;cursorLocation.lineIndex;i++){topOffset+=this._getHeightOfLine(this.ctx,i)}if(typeOfBoundaries===&quot;cursor&quot;){topOffset+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,cursorLocation.lineIndex)/this.lineHeight-this.getCurrentCharFontSize(cursorLocation.lineIndex,cursorLocation.charIndex)*(1-this._fontSizeFraction)}return{top:topOffset,left:leftOffset,lineLeft:lineLeftOffset}},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},toObject:function(propertiesToInclude){return fabric.util.object.extend(this.callSuper(&quot;toObject&quot;,propertiesToInclude),{minWidth:this.minWidth})}});fabric.Textbox.fromObject=function(object){return new fabric.Textbox(object.text,clone(object))};fabric.Textbox.getTextboxControlVisibility=function(){return{tl:false,tr:false,br:false,bl:false,ml:true,mt:false,mr:true,mb:false,mtr:true}}})(typeof exports!==&quot;undefined&quot;?exports:this);(function(){var setObjectScaleOverridden=fabric.Canvas.prototype._setObjectScale;fabric.Canvas.prototype._setObjectScale=function(localMouse,transform,lockScalingX,lockScalingY,by,lockScalingFlip,_dim){var t=transform.target;if(t instanceof fabric.Textbox){var w=t.width*(localMouse.x/transform.scaleX/(t.width+t.strokeWidth));if(w&gt;=t.getMinWidth()){t.set(&quot;width&quot;,w);return true}}else{return setObjectScaleOverridden.call(fabric.Canvas.prototype,localMouse,transform,lockScalingX,lockScalingY,by,lockScalingFlip,_dim)}};fabric.Group.prototype._refreshControlsVisibility=function(){if(typeof fabric.Textbox===&quot;undefined&quot;){return}for(var i=this._objects.length;i--;){if(this._objects[i]instanceof fabric.Textbox){this.setControlsVisibility(fabric.Textbox.getTextboxControlVisibility());return}}};var clone=fabric.util.object.clone;fabric.util.object.extend(fabric.Textbox.prototype,{_removeExtraneousStyles:function(){for(var prop in this._styleMap){if(!this._textLines[prop]){delete this.styles[this._styleMap[prop].line]}}},insertCharStyleObject:function(lineIndex,charIndex,style){var map=this._styleMap[lineIndex];lineIndex=map.line;charIndex=map.offset+charIndex;fabric.IText.prototype.insertCharStyleObject.apply(this,[lineIndex,charIndex,style])},insertNewlineStyleObject:function(lineIndex,charIndex,isEndOfLine){var map=this._styleMap[lineIndex];lineIndex=map.line;charIndex=map.offset+charIndex;fabric.IText.prototype.insertNewlineStyleObject.apply(this,[lineIndex,charIndex,isEndOfLine])},shiftLineStyles:function(lineIndex,offset){var clonedStyles=clone(this.styles),map=this._styleMap[lineIndex];lineIndex=map.line;for(var line in this.styles){var numericLine=parseInt(line,10);if(numericLine&gt;lineIndex){this.styles[numericLine+offset]=clonedStyles[numericLine];if(!clonedStyles[numericLine-offset]){delete this.styles[numericLine]}}}},_getTextOnPreviousLine:function(lIndex){var textOnPreviousLine=this._textLines[lIndex-1];while(this._styleMap[lIndex-2]&amp;&amp;this._styleMap[lIndex-2].line===this._styleMap[lIndex-1].line){textOnPreviousLine=this._textLines[lIndex-2]+textOnPreviousLine;lIndex--}return textOnPreviousLine},removeStyleObject:function(isBeginningOfLine,index){var cursorLocation=this.get2DCursorLocation(index),map=this._styleMap[cursorLocation.lineIndex],lineIndex=map.line,charIndex=map.offset+cursorLocation.charIndex;this._removeStyleObject(isBeginningOfLine,cursorLocation,lineIndex,charIndex)}})})();(function(){var override=fabric.IText.prototype._getNewSelectionStartFromOffset;fabric.IText.prototype._getNewSelectionStartFromOffset=function(mouseOffset,prevWidth,width,index,jlen){index=override.call(this,mouseOffset,prevWidth,width,index,jlen);var tmp=0,removed=0;for(var i=0;i&lt;this._textLines.length;i++){tmp+=this._textLines[i].length;if(tmp+removed&gt;=index){break}if(this.text[tmp+removed]===&quot;\n&quot;||this.text[tmp+removed]===&quot; &quot;){removed++}}return index-i+removed}})();(function(){if(typeof document!==&quot;undefined&quot;&amp;&amp;typeof window!==&quot;undefined&quot;){return}var DOMParser=require(&quot;xmldom&quot;).DOMParser,URL=require(&quot;url&quot;),HTTP=require(&quot;http&quot;),HTTPS=require(&quot;https&quot;),Canvas=require(&quot;canvas&quot;),Image=require(&quot;canvas&quot;).Image;function request(url,encoding,callback){var oURL=URL.parse(url);if(!oURL.port){oURL.port=oURL.protocol.indexOf(&quot;https:&quot;)===0?443:80}var reqHandler=oURL.protocol.indexOf(&quot;https:&quot;)===0?HTTPS:HTTP,req=reqHandler.request({hostname:oURL.hostname,port:oURL.port,path:oURL.path,method:&quot;GET&quot;},function(response){var body=&quot;&quot;;if(encoding){response.setEncoding(encoding)}response.on(&quot;end&quot;,function(){callback(body)});response.on(&quot;data&quot;,function(chunk){if(response.statusCode===200){body+=chunk}})});req.on(&quot;error&quot;,function(err){if(err.errno===process.ECONNREFUSED){fabric.log(&quot;ECONNREFUSED: connection refused to &quot;+oURL.hostname+&quot;:&quot;+oURL.port)}else{fabric.log(err.message)}callback(null)});req.end()}function requestFs(path,callback){var fs=require(&quot;fs&quot;);fs.readFile(path,function(err,data){if(err){fabric.log(err);throw err}else{callback(data)}})}fabric.util.loadImage=function(url,callback,context){function createImageAndCallBack(data){if(data){img.src=new Buffer(data,&quot;binary&quot;);img._src=url;callback&amp;&amp;callback.call(context,img)}else{img=null;callback&amp;&amp;callback.call(context,null,true)}}var img=new Image;if(url&amp;&amp;(url instanceof Buffer||url.indexOf(&quot;data&quot;)===0)){img.src=img._src=url;callback&amp;&amp;callback.call(context,img)}else if(url&amp;&amp;url.indexOf(&quot;http&quot;)!==0){requestFs(url,createImageAndCallBack)}else if(url){request(url,&quot;binary&quot;,createImageAndCallBack)}else{callback&amp;&amp;callback.call(context,url)}};fabric.loadSVGFromURL=function(url,callback,reviver){url=url.replace(/^\n\s*/,&quot;&quot;).replace(/\?.*$/,&quot;&quot;).trim();if(url.indexOf(&quot;http&quot;)!==0){requestFs(url,function(body){fabric.loadSVGFromString(body.toString(),callback,reviver)})}else{request(url,&quot;&quot;,function(body){fabric.loadSVGFromString(body,callback,reviver)})}};fabric.loadSVGFromString=function(string,callback,reviver){var doc=(new DOMParser).parseFromString(string);fabric.parseSVGDocument(doc.documentElement,function(results,options){callback&amp;&amp;callback(results,options)},reviver)};fabric.util.getScript=function(url,callback){request(url,&quot;&quot;,function(body){eval(body);callback&amp;&amp;callback()})};fabric.Image.fromObject=function(object,callback){fabric.util.loadImage(object.src,function(img){var oImg=new fabric.Image(img);oImg._initConfig(object);oImg._initFilters(object.filters,function(filters){oImg.filters=filters||[];oImg._initFilters(object.resizeFilters,function(resizeFilters){oImg.resizeFilters=resizeFilters||[];callback&amp;&amp;callback(oImg)})})})};fabric.createCanvasForNode=function(width,height,options,nodeCanvasOptions){nodeCanvasOptions=nodeCanvasOptions||options;var canvasEl=fabric.document.createElement(&quot;canvas&quot;),nodeCanvas=new Canvas(width||600,height||600,nodeCanvasOptions);canvasEl.style={};canvasEl.width=nodeCanvas.width;canvasEl.height=nodeCanvas.height;var FabricCanvas=fabric.Canvas||fabric.StaticCanvas,fabricCanvas=new FabricCanvas(canvasEl,options);fabricCanvas.contextContainer=nodeCanvas.getContext(&quot;2d&quot;);fabricCanvas.nodeCanvas=nodeCanvas;fabricCanvas.Font=Canvas.Font;return fabricCanvas};fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()};fabric.StaticCanvas.prototype.createJPEGStream=function(opts){return this.nodeCanvas.createJPEGStream(opts)};var origSetWidth=fabric.StaticCanvas.prototype.setWidth;fabric.StaticCanvas.prototype.setWidth=function(width,options){origSetWidth.call(this,width,options);this.nodeCanvas.width=width;return this};if(fabric.Canvas){fabric.Canvas.prototype.setWidth=fabric.StaticCanvas.prototype.setWidth}var origSetHeight=fabric.StaticCanvas.prototype.setHeight;fabric.StaticCanvas.prototype.setHeight=function(height,options){origSetHeight.call(this,height,options);this.nodeCanvas.height=height;return this};if(fabric.Canvas){fabric.Canvas.prototype.setHeight=fabric.StaticCanvas.prototype.setHeight}})();</td>
      </tr>
</table>

  </div>

</div>

<button type="button" data-facebox="#jump-to-line" data-facebox-class="linejump" data-hotkey="l" class="hidden">Jump to Line</button>
<div id="jump-to-line" style="display:none">
  <!-- </textarea> --><!-- '"` --><form accept-charset="UTF-8" action="" class="js-jump-to-line-form" method="get"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /></div>
    <input class="form-control linejump-input js-jump-to-line-field" type="text" placeholder="Jump to line&hellip;" aria-label="Jump to line" autofocus>
    <button type="submit" class="btn">Go</button>
</form></div>

  </div>
  <div class="modal-backdrop js-touch-events"></div>
</div>


    </div>
  </div>

    </div>

        <div class="container site-footer-container">
  <div class="site-footer" role="contentinfo">
    <ul class="site-footer-links right">
        <li><a href="https://status.github.com/" data-ga-click="Footer, go to status, text:status">Status</a></li>
      <li><a href="https://developer.github.com" data-ga-click="Footer, go to api, text:api">API</a></li>
      <li><a href="https://training.github.com" data-ga-click="Footer, go to training, text:training">Training</a></li>
      <li><a href="https://shop.github.com" data-ga-click="Footer, go to shop, text:shop">Shop</a></li>
        <li><a href="https://github.com/blog" data-ga-click="Footer, go to blog, text:blog">Blog</a></li>
        <li><a href="https://github.com/about" data-ga-click="Footer, go to about, text:about">About</a></li>

    </ul>

    <a href="https://github.com" aria-label="Homepage" class="site-footer-mark" title="GitHub">
      <svg aria-hidden="true" class="octicon octicon-mark-github" height="24" version="1.1" viewBox="0 0 16 16" width="24"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></svg>
</a>
    <ul class="site-footer-links">
      <li>&copy; 2016 <span title="0.10524s from github-fe163-cp1-prd.iad.github.net">GitHub</span>, Inc.</li>
        <li><a href="https://github.com/site/terms" data-ga-click="Footer, go to terms, text:terms">Terms</a></li>
        <li><a href="https://github.com/site/privacy" data-ga-click="Footer, go to privacy, text:privacy">Privacy</a></li>
        <li><a href="https://github.com/security" data-ga-click="Footer, go to security, text:security">Security</a></li>
        <li><a href="https://github.com/contact" data-ga-click="Footer, go to contact, text:contact">Contact</a></li>
        <li><a href="https://help.github.com" data-ga-click="Footer, go to help, text:help">Help</a></li>
    </ul>
  </div>
</div>



    

    <div id="ajax-error-message" class="ajax-error-message flash flash-error">
      <svg aria-hidden="true" class="octicon octicon-alert" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M8.865 1.52c-.18-.31-.51-.5-.87-.5s-.69.19-.87.5L.275 13.5c-.18.31-.18.69 0 1 .19.31.52.5.87.5h13.7c.36 0 .69-.19.86-.5.17-.31.18-.69.01-1L8.865 1.52zM8.995 13h-2v-2h2v2zm0-3h-2V6h2v4z"></path></svg>
      <button type="button" class="flash-close js-flash-close js-ajax-error-dismiss" aria-label="Dismiss error">
        <svg aria-hidden="true" class="octicon octicon-x" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M7.48 8l3.75 3.75-1.48 1.48L6 9.48l-3.75 3.75-1.48-1.48L4.52 8 .77 4.25l1.48-1.48L6 6.52l3.75-3.75 1.48 1.48z"></path></svg>
      </button>
      Something went wrong with that request. Please try again.
    </div>


      
      <script crossorigin="anonymous" integrity="sha256-+aQGF+XqcTQtxXEDVUsHo8HtyIcSsE3hoECu1EiRoR0=" src="https://assets-cdn.github.com/assets/frameworks-f9a40617e5ea71342dc57103554b07a3c1edc88712b04de1a040aed44891a11d.js"></script>
      <script async="async" crossorigin="anonymous" integrity="sha256-FaARvBeuWMGMt0V9YZQpBKP4fX1dZfc+puvEz6YPPbc=" src="https://assets-cdn.github.com/assets/github-15a011bc17ae58c18cb7457d61942904a3f87d7d5d65f73ea6ebc4cfa60f3db7.js"></script>
      
      
      
      
      
      
    <div class="js-stale-session-flash stale-session-flash flash flash-warn flash-banner hidden">
      <svg aria-hidden="true" class="octicon octicon-alert" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M8.865 1.52c-.18-.31-.51-.5-.87-.5s-.69.19-.87.5L.275 13.5c-.18.31-.18.69 0 1 .19.31.52.5.87.5h13.7c.36 0 .69-.19.86-.5.17-.31.18-.69.01-1L8.865 1.52zM8.995 13h-2v-2h2v2zm0-3h-2V6h2v4z"></path></svg>
      <span class="signed-in-tab-flash">You signed in with another tab or window. <a href="">Reload</a> to refresh your session.</span>
      <span class="signed-out-tab-flash">You signed out in another tab or window. <a href="">Reload</a> to refresh your session.</span>
    </div>
    <div class="facebox" id="facebox" style="display:none;">
  <div class="facebox-popup">
    <div class="facebox-content" role="dialog" aria-labelledby="facebox-header" aria-describedby="facebox-description">
    </div>
    <button type="button" class="facebox-close js-facebox-close" aria-label="Close modal">
      <svg aria-hidden="true" class="octicon octicon-x" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M7.48 8l3.75 3.75-1.48 1.48L6 9.48l-3.75 3.75-1.48-1.48L4.52 8 .77 4.25l1.48-1.48L6 6.52l3.75-3.75 1.48 1.48z"></path></svg>
    </button>
  </div>
</div>

  </body>
</html>

