<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Topic Game</title>
</head>
<style type="text/css">
.hide {
    display: none;
}
.box {
	width: 96%;
	margin: 20px auto;
	font-family: "Microsoft YaHei";
}
table td,table th {
	background: #fff;
	padding: 10px
}
.pagination{
    float: right;margin:10px}
.bigpic{ width: 300px;
    height:100px;}
    .bigpic img{ width: 100%;}
</style>
<body>
<h1>Topic Game</h1>

<form action="topic_game_add" method="post">
  {% csrf_token %}
  <input hidden type="hidden" name="topic_id" value="{{ topic_id }}"/>
  <p>app center game id:<input type="text" name="app_center_game_id" value=""/></p>
  <input type="submit" value="新增" />
</form>


    <table width="100%" cellspacing="1" border="0" bgcolor="#666666">
      <tr>
        <th>topic_id</th>
        <th>game_center_id</th>
        <th>game detail</th>
        <th width="10%">order</th>
        <th>uptime</th>
        <th>操作 </th>
      </tr>

      </tr>
        {% for data in topic_game %}
         <tr>
            <td class="topic_id" data_topic_id="{{ data.topic_id }}">{{ data.topic_id }}</td>


            <td class="topic_id2" app_center_game_id="{{ data.app_center_game_id }}">{{ data.app_center_game_id }}</td>
            <td><a href="app_center_game_detail?app_center_id={{ data.app.id }}">{{ data.title }}</a></td>
            <td><span>{{ data.order }}</span><input class="hide order" type="text" value="{{ data.order }}"  /><button class="edit_button">edit</button><button class="save_button">save</button> </td>

            <td>{{ data.uptime }}</td>
            <td><a onclick="delete_game(this)"> 删除</a></td>
         </tr>
        {% endfor %}
    </table>

<script src="../../static/jquery.min.js"></script>
<script>
function delete_game(obj)
{
    //利用对话框返回的值 （true 或者 false）
    if(confirm("你确信要删除这条信息"))
    {
        console.log($(obj).parent().parent().find(".topic_id").attr("data_topic_id"));
        $.post("topic_game_delete",
          {
            app_center_game_id:$(obj).parent().parent().find(".topic_id2").attr("app_center_game_id"),
            topic_id:$(obj).parent().parent().find(".topic_id").attr("data_topic_id")
          },
          function(data,status){
//            alert("Data: " + data + "\nStatus: " + status);
            location.reload();
          });
    }
    else{
        //否则说明下了，赫赫

    }
}

$(".edit_button").click(
        function(){
            $(this).parent().find("span").hide();
            $(this).parent().find("input").show();
        }
)
$(".save_button").click(
        function(){
			var app_center_game_id=$(this).parent().parent().find(".topic_id2").attr("app_center_game_id");
			var topic_id=$(this).parent().parent().find(".topic_id").attr("data_topic_id");
			var order=$(this).parent().parent().find(".order").val();
            $.post(
                    "topic_game_order_edit",
                    {
                        app_center_game_id:app_center_game_id,
                        topic_id:topic_id,
                        order:order
                    },
              function(data,status) {
                  location.reload();
                  //alert("Data: " + data + "\nStatus: " + status);
              }
            );
        }
)
</script>
</body>
</html>